---
title: Конвертация валюты в службах Analysis Services | Документация Майкрософт
ms.date: 05/09/2019
ms.prod: sql
ms.technology: analysis-services
ms.custom: ''
ms.topic: conceptual
ms.author: owend
ms.reviewer: owend
author: minewiskan
manager: kfile
ms.openlocfilehash: e5e23e81f4f22ea7a31fdf09d46a1ccfdae52bf6
ms.sourcegitcommit: 6ab60b426fc6ec7bb9e727323f520c0b05a20d06
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2019
ms.locfileid: "65527401"
---
# <a name="currency-conversions-in-analysis-services"></a>Конвертация валюты в службах Analysis Services

[!INCLUDE[ssas-appliesto-sqlas-aas](../includes/ssas-appliesto-sqlas-aas.md)]

 Службы Analysis Services используют сочетания функций под управлением сценариев многомерных выражений (MDX) для обеспечения поддержки преобразований валюты в кубах, поддерживающих несколько валют.  
  
## <a name="currency-conversion-terminology"></a>Терминология конвертации валют  

 Следующая терминология используется для описания функционала конвертации валют:  
  
 **Сведение валюты** -представляет собой валюту, для которой обменные курсы вводятся в группе мер.  
  
 **Местная валюта** -представляет собой валюту, используемая для хранения транзакций, на котором основаны меры, для преобразования.  
  
Местная валюта может быть идентифицирована одним:  
  
-   Идентификатором валюты в таблице фактов, хранимым вместе с транзакцией, как это обычно бывает в банковских приложениях, в которых сама транзакция идентифицирует используемую для нее валюту.  
  
-   Идентификатором валюты, связанным с атрибутом в таблице измерения, который затем связывается с транзакцией в таблице фактов, как это обычно бывает в финансовых приложениях, где местоположение или другой идентификатор, например дочерняя компания, идентифицирует валюту, используемую для соответствующей транзакции.  
  
**Валюта отчета** -представляет собой валюту, в которую транзакции конвертируются из основной валюты.  
  
> [!NOTE]  
>  Для конвертаций валют «многие к одному» основная валюта и валюта отчета одинаковы.  
  
 **Измерение валют отчета** -измерением базы данных, определенные со следующими параметрами:  
  
-   Свойству **Type** измерения присвоено значение Currency.  
  
-   Свойству **Type** одного из атрибутов измерения присвоено значение CurrencyName.  
  
Значения этого атрибута должны использоваться во всех столбцах, которые должны содержать идентификатор валюты.  
  
**Группа мер обменного курса** -группы мер в кубе, определенная со следующими параметрами:  
  
-   Существует связь обычного измерения между измерением валют и группой мер курсов.  
  
-   Существует связь обычного измерения между измерением времени и группой мер курсов.  
  
-   Дополнительно свойство **Type** установлено равным ExchangeRate. В то время как мастер бизнес-аналитики использует связи с измерениями валют и времени для идентификации вероятных групп мер курсов, установка свойства **Type** равным ExchangeRate позволяет клиентским приложениям легче идентифицировать группы мер курсов.  
  
-   Одна или несколько мер, представляющих обменные курсы, содержащиеся в группе мер курсов.  
  
**Измерение валют отчета** -является измерение, определенное мастером бизнес-аналитики после определения конвертации валюты, содержащее валюты отчета для этой конвертации валюты. Измерение валют отчета основано на именованном запросе, определенном в представлении источника данных, на котором основано измерение валют, связанное с группой мер курсов, из главной таблицы измерения валют. Это измерение определено со следующими настройками.  
  
-   Свойству **Type** измерения присвоено значение Currency.  
  
-   Свойству **Type** ключевого атрибута измерения присвоено значение CurrencyName.  
  
-   Свойству **Type** одного из атрибутов измерения присвоено значение CurrencyDestination, и столбец, связанный с атрибутом, содержит идентификаторы валют, представляющие валюты отчета для этой конвертации валюты.  
  
## <a name="defining-currency-conversions"></a>Определение конвертаций валют  

 Можно использовать мастер бизнес-аналитики, чтобы определить функционал конвертации валют для куба, также можно вручную определить конвертации валют, используя скрипты многомерных выражений.  
  
### <a name="prerequisites"></a>предварительные требования  

 Перед тем как определять конвертацию валюты в кубе, используя мастер бизнес-аналитики, вначале необходимо определить хотя бы одно измерение валют, одно измерение времени и одну группу мер курсов. Из этих объектов мастер бизнес-аналитики может получать данные и метаданные, используемые для построения измерения валют отчета и скрипта многомерных выражений, необходимых для обеспечения функционала конвертации валют.  
  
### <a name="decisions"></a>Решения  

 Необходимо принять следующие решения перед тем, как мастер бизнес-аналитики сможет построить измерение валют отчета и скрипт многомерных выражений, необходимые для обеспечения функционала конвертации валют.  
  
-   Направление обменного курса  
  
-   Конвертируемые элементы  
  
-   Тип конвертации  
  
-   Местные валюты  
  
-   Валюты отчета.  
  
### <a name="exchange-rate-directions"></a>Направления обменных курсов  

 Группа мер курсов содержит меры, представляющие обменные курсы между местными валютами и основной валютой (обычно называемой корпоративной валютой). Сочетание направления обменного курса и типа конвертации определяет операцию, выполняемую по отношению к мерам, подлежащим конвертации скриптом многомерных выражений, сформированным с использованием мастера бизнес-аналитики. В следующей таблице содержатся описания операций, выполняемых в зависимости от направления обменного курса и типа конвертации, на основе параметров направления обменного курса и направлений конвертации, доступных в мастере бизнес-аналитики.  
  
|||||  
|-|-|-|-|  
|Направление обменного курса|**«многие к одному»**|**«Один ко многим»**|**«Многие ко многим»**|  
|**n в основной валюте к 1 в валюте образца**|Умножьте показатель, подлежащий конвертации, на показатель обменного курса для местной валюты, чтобы сконвертировать эту меру в основную валюту.|Разделите меру, подлежащую конвертации, на меру обменного курса для валюты отчета, чтобы сконвертировать эту меру в основную валюту.|Умножьте меру, подлежащую конвертации, на меру обменного курса для местной валюты, чтобы сконвертировать эту меру в основную валюту, затем разделите сконвертированную меру на меру обменного курса для валюты отчета, чтобы сконвертировать эту меру в валюту отчета.|  
|**n в валюте образца к 1 в основной валюте**|Разделите меру, подлежащую конвертации, на меру обменного курса для местной валюты, чтобы сконвертировать эту меру в основную валюту.|Умножьте меру, подлежащую конвертации, на меру обменного курса для валюты отчета, чтобы сконвертировать эту меру в основную валюту.|Разделите меру, подлежащую конвертации, на меру обменного курса для местной валюты, чтобы сконвертировать эту меру в основную валюту, затем умножьте сконвертированную меру на меру обменного курса для валюты отчета, чтобы сконвертировать эту меру в валюту отчета.|  
  
 Направление обменного курса выбирается на странице **Установка параметров конвертации валют** мастера бизнес-аналитики. Дополнительные сведения о настройке направлений конвертации валют см. в разделе [Установка параметров конвертации валюты (мастер бизнес-аналитики)](http://msdn.microsoft.com/library/a49d4e1f-bdda-4a83-ab4f-ce8c500e1d6d).  
  
### <a name="converted-members"></a>Конвертируемые элементы  

 Можно использовать мастер бизнес-аналитики, чтобы указать, какие меры из группы мер курсов используются для конвертации значений для:  
  
-   Меры в других группах мер;  
  
-   элементов в иерархии атрибутов для атрибута счета в измерении базы данных;  
  
-   типов счетов, используемых элементами иерархии атрибутов для атрибута счета в измерении базы данных.  
  
 Мастер бизнес-аналитики использует эти данные в скрипте многомерных выражений, сформированном мастером, чтобы определить область вычислений конвертации валют. Дополнительные сведения об указании элементов для конвертации валют см. в разделе [Выбор элементов (мастер бизнес-аналитики)](http://msdn.microsoft.com/library/1a147461-d594-41e7-a41d-09d2d003e1e0).  
  
### <a name="conversion-types"></a>Преобразование типов  

 Мастер бизнес-аналитики поддерживает три различных типа конвертации валют.  
  
-   **«Один ко многим»**  
  
     Транзакции хранятся в таблице фактов в основной валюте, а затем конвертируются в одну или несколько валют отчета.  
  
     Например, в качестве основной валюты может быть установлен доллар США (USD), и в таблице фактов хранятся транзакции в долларах США. Этот тип конвертации конвертирует эти транзакции из основной валюты в указанные валюты отчета. В результате эти транзакции можно хранить в указанной основной валюте и просматривать либо в указанной основной валюте, либо в одной из валют отчета, указанных в измерении валют отчета, определенном для конвертации валют.  
  
-   **«многие к одному»**  
  
     Транзакции хранятся в таблице фактов в местных валютах, а затем конвертируются в основную валюту. Основная валюта служит в качестве единственной указанной валюты отчета в измерении валют отчета.  
  
     Например, в качестве основной валюты может быть установлен доллар США (USD), а в таблице фактов хранятся транзакции в евро (EUR), австралийских долларах (AUD) и мексиканских песо (MXN). Этот тип конвертации конвертирует эти транзакции из их указанных местных валют в основную валюту. В результате эти транзакции можно хранить в указанных местных валютах и просматривать в основной валюте, которая указана в измерении валют отчета, определенном для конвертации валют.  
  
-   **«Многие ко многим»**  
  
     Транзакции хранятся в таблице фактов в местных валютах. Функционал конвертации валют конвертирует подобные транзакции в основную валюту, а затем в одну или несколько валют отчета.  
  
     Например, в качестве основной валюты может быть установлен доллар США (USD), а в таблице фактов хранятся транзакции в евро (EUR), австралийских долларах (AUD) и мексиканских песо (MXN). Этот тип конвертации конвертирует эти транзакции из их указанных местных валют в основную валюту, а затем сконвертированные транзакции конвертируются вновь из основной валюты в указанные валюты отчета. В результате эти транзакции можно хранить в указанных местных валютах и просматривать либо в указанной основной валюте, либо в любой из валют отчета, указанных в измерении валют отчета, определенном для конвертации валют.  
  
 Указание типа конвертации позволяет мастеру бизнес-аналитики определить именованный запрос и структуру измерения валют отчета, а также структуру скрипта многомерных выражений, определенного для конвертации валют.  
  
### <a name="local-currencies"></a>Местные валюты  

 При выборе типа конвертации «многие ко многим» или «многие к одному» для конвертации валют необходимо указать способ идентификации местных валют, на основе которых скрипт многомерных выражений, сформированный мастером бизнес-аналитики, выполняет вычисления конвертации валют. Местная валюта для транзакции в таблице фактов может быть идентифицирована одним из двух способов.  
  
-   Группа мер содержит связь обычного измерения с измерением валют. Например, в образце [!INCLUDE[ssAWDWsp](../includes/ssawdwsp-md.md)] базы данных служб [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] группа мер «Интернет-продажи» имеет связь обычного измерения с измерением «Валюта». Таблица фактов для группы мер содержит внешний ключевой столбец, который связывает идентификаторы валют в таблице измерений и это измерение. В этом случае можно выбрать атрибут из измерения валют, на который ссылается группа мер, чтобы идентифицировать местную валюту для транзакций в таблице фактов для этой группы мер. Эта ситуация наиболее часто возникает в банковских приложениях, где сама транзакция определяет используемую в ней валюту.  
  
-   Группа мер содержит ссылочную связь измерений с измерением валют через другое измерение, которое непосредственно ссылается на измерение валют. Например, в образце [!INCLUDE[ssAWDWsp](../includes/ssawdwsp-md.md)] базы данных [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] группа мер «Финансовая отчетность» имеет связь обычного измерения с измерением «Валюта» через измерение «Организация». Таблица фактов для этой группы мер содержит внешний ключевой столбец, который ссылается на элементы в таблице измерения «Организация». Таблица измерения «Организация», в свою очередь, содержит внешний ключевой столбец, который ссылается на идентификаторы валют в таблице измерения «Валюта». Эта ситуация наиболее часто возникает в приложениях для финансовой отчетности, где местоположение дочерней компании, участвующей в транзакции, определяет валюту для этой транзакции. В этом случае можно выбрать атрибут, который ссылается на измерение валют из измерения для бизнес-сущности.  
  
### <a name="reporting-currencies"></a>Валюты отчета.  

 При выборе типа конвертации «многие ко многим» или «один ко многим» для конвертации валют необходимо указать валюты отчета, на основе которых скрипт многомерных выражений, сформированный мастером бизнес-аналитики, выполняет вычисления конвертации валют. Можно либо указать все элементы измерения валют, связанные с группой мер курсов, либо выбрать отдельные элементы из измерения.  
  
 Мастер бизнес-аналитики создает измерение валют отчета на основе именованного запроса, построенного из таблицы измерения валют с использованием выбранных валют отчета.  
  
> [!NOTE]  
>  При выборе типа конвертации «один ко многим» также создается измерение валют отчета. Это измерение содержит только один элемент, представляющий основную валюту, поскольку она также используется в качестве валюты отчета для конвертации «один ко многим».  
  
 Для каждой конвертации валют, определенной в кубе, определяется отдельное измерение валют отчета. Можно изменить имена измерений валют отчета после их создания, но при этом необходимо также обновить скрипт многомерных выражений, сформированный для этой конвертации валют, чтобы гарантировать использование правильного имени командой скрипта при ссылке на измерение валют отчета.  
  
## <a name="defining-multiple-currency-conversions"></a>Определение нескольких конвертаций валют  

 Используя мастер бизнес-аналитики, можно определить столько конвертаций валют, сколько необходимо для решения бизнес-аналитики. Можно либо перезаписывать существующую конвертацию валют, либо добавлять новую конвертацию валют в скрипт многомерных выражений для куба. Несколько конвертаций валют, определенных в одном кубе, обеспечивают гибкость в приложениях бизнес-аналитики, имеющих сложные требования к отчетности, например в приложениях для финансовой отчетности, поддерживающих несколько различных требований конвертации для международной отчетности.  
  
### <a name="currency-conversion-in-multidimensional-models-by-using-business-intelligence-wizard"></a>Конвертации валют в многомерных моделях, используя мастер бизнес-аналитики  
 
Мастер бизнес-аналитики идентифицирует каждую конвертацию валют по разбиению команд скрипта для конвертации валют следующими комментариями:  
  
 `//<Currency conversion>`  
  
 `...`  
  
 `[MDX statements for the currency conversion]`  
  
 `...`  
  
 `//</Currency conversion>`  
  
 При изменении или удалении этих комментариев мастер бизнес-аналитики не способен обнаружить конвертацию валют, поэтому эти комментарии изменять не следует.  
  
 Мастер также хранит метаданные в комментариях внутри этих комментариев, включая дату и время создания, пользователя и тип конвертации. Эти комментарии также не следует изменять, поскольку мастер бизнес-аналитики использует эти метаданные при отображении существующих конвертаций валют.  
  
 При необходимости можно изменять команды скрипта, содержащиеся в конвертации валют. Однако при перезаписи конвертации валют эти изменения будут утеряны.  
  
## <a name="see-also"></a>См. также  
 [Сценарии глобализации для служб Analysis Services](../analysis-services/globalization-scenarios-for-analysis-services.md)  
  
  
