---
title: Определение связи фактов | Документация Майкрософт
ms.date: 05/06/2019
ms.prod: sql
ms.technology: analysis-services
ms.custom: multidimensional-models
ms.topic: tutorial
ms.author: owend
ms.reviewer: owend
author: minewiskan
manager: kfile
ms.openlocfilehash: 2d82ca352c574d02a5b0631df5c9448df12a5acc
ms.sourcegitcommit: 54c8420b62269f6a9e648378b15127b5b5f979c1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2019
ms.locfileid: "65404006"
---
# <a name="lesson-5-2---defining-a-fact-relationship"></a>Занятие 5-2-Определение связи фактов
[!INCLUDE[ssas-appliesto-sqlas](../../includes/ssas-appliesto-sqlas.md)]

Иногда пользователи хотят иметь возможность вводить для мер измерения, которые образуются из элементов данных таблицы фактов, или создавать запросы к таблице фактов для получения специальных дополнительных сведений, таких как номера счетов или номера заказов на покупку, относящихся к конкретным фактам продаж. При определении измерения, основанного на подобных элементах таблиц фактов, оно называется *измерением фактов*. Измерения фактов также называют вырожденными измерениями. Измерения фактов полезны для группирования строк таблицы фактов, например для выбора всех строк, относящихся к определенному номеру счета. Хотя можно поместить эти сведения в отдельную таблицу измерения в реляционной базе данных, создание такой таблицы измерения не принесет пользы, потому что таблица измерения станет расти так же быстро, как и таблица фактов, что будет лишь порождать дублирование и приведет к необоснованной сложности таблицы.  
  
Службы [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]позволяют указать, следует данные измерения фактов повторить в MOLAP-структуре измерения (это повышает производительность обработки запросов) или же определить измерение фактов как измерение ROLAP, чтобы сохранить место в хранилище за счет снижения производительности обработки запросов. При хранении измерения в режиме хранения MOLAP все элементы измерения, помимо хранения в секциях группы мер, хранятся в экземпляре служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] в крайне сжатой структуре MOLAP. При хранении измерения в режиме хранения ROLAP только определение измерения хранится в MOLAP сами же элементы структуры измерения запрашиваются из соответствующей реляционной таблицы фактов во время выполнения запроса. Выбор подходящего режима хранения зависит от того, как часто обращаются с запросами к измерению фактов, сколько строк возвращает типичный запрос, каковы производительность обработки запроса и стоимость обработки. Определение измерения как ROLAP не требует, чтобы все кубы, использующие это измерение, также хранились в режиме ROLAP. Режимы хранения для каждого измерения можно настраивать независимо.  
  
При определении измерения фактов можно задать связь между этим измерением и группой мер как связь фактов. К связям фактов применяются следующие ограничения:  
  
-   Атрибут гранулярности должен быть ключевым столбцом для измерения, что образует связь «один к одному» между измерением и фактами в таблице фактов.  
  
-   Измерение может иметь связь фактов только с одной группой мер.  
  
> [!NOTE]  
> В измерения фактов необходимо вносить частичные обновления после каждого обновления в группе мер, на которую ссылается связь фактов.  
  
Дополнительные сведения см. в разделах [Связи измерений](../multidimensional-models-olap-logical-cube-objects/dimension-relationships.md)и [Определение связей фактов и свойств связей фактов](../multidimensional-models/define-a-fact-relationship-and-fact-relationship-properties.md).  
  
В задачах этого раздела нужно добавить новое измерение куба, основанное на столбце **CustomerPONumber** таблицы фактов **FactInternetSales** . Затем предстоит указать связь фактов между этим новым измерением куба и группой мер **Продажи через Интернет** .  
  
## <a name="defining-the-internet-sales-orders-fact-dimension"></a>Определение измерения фактов «Заказы через Интернет»  
  
1.  В обозревателе решений щелкните правой кнопкой мыши узел **Измерения**и выберите команду **Создать измерение**.  
  
2.  На странице **Вас приветствует мастер измерений** нажмите кнопку **Далее**.  
  
3.  На странице **Выбор метода создания** выберите параметр **Использовать существующую таблицу** и нажмите кнопку **Далее**.  
  
4.  Убедитесь в том, что на странице **Определение исходных сведений** выбрано представление источника данных **Adventure Works DW 2012** .  
  
5.  В списке **Основная таблица** выберите таблицу **InternetSales**.  
  
6.  Убедитесь в том, что в списке **Ключевые столбцы** присутствуют столбцы **SalesOrderNumber** и **SalesOrderLineNumber** .  
  
7.  В списке **Столбец имени** выберите столбец **SalesOrderLineNumber**.  
  
8.  Нажмите кнопку **Далее**.  
  
9. На странице **Выбор связанных таблиц** снимите флажки для всех таблиц и нажмите кнопку **Далее**.  
  
10. На странице **Выбор атрибутов измерения** дважды щелкните флажок в заголовке, чтобы снять все флажки. Атрибут **Номер заказа** останется выбранным, так как он является ключевым атрибутом.  
  
11. Выберите атрибут **Номер почтового отделения заказчика** и нажмите кнопку **Далее**.  
  
12. На странице **Завершение работы мастера** измените имя на **Подробности заказа через Интернет** и нажмите кнопку **Готово** .  
  
13. В меню **Файл** выберите команду **Сохранить все**.  
  
14. На панели **Атрибуты** конструктора измерений для измерения **Подробности заказа через Интернет** выберите атрибут **Номер заказа**и в окне свойств задайте для свойства **Name** значение **Описание позиции**.  
  
15. В **NameColumn** свойства ячейки, нажмите кнопку обзора **(...)** . В диалоговом окне **Столбец имени** выберите в списке **Исходная таблица** значение **Product** , в списке **Исходный столбец** — значение **EnglishProductName**и нажмите кнопку **ОК**.  
  
16. Добавьте атрибут **Номер заказа на покупку** к этому измерению, перетащив столбец **SalesOrderNumber** из таблицы **InternetSales** панели **Представление источника данных** на панели **Атрибуты** .  
  
17. Измените свойство **Name** нового атрибута **Номер заказа на покупку** на **Номер заказа**, а значение свойства **OrderBy** на **По ключу**.  
  
18. На панели **Иерархии** создайте пользовательскую иерархию **Заказы через Интернет** , состоящую из уровней **Номер заказа** и **Описание позиции** в этом порядке.  
  
19. На панели **Атрибуты** выберите **Подробности заказа через Интернет**, а затем просмотрите значение свойства **StorageMode** в окне свойств.  
  
    Обратите внимание, что данное измерение хранится как измерение MOLAP. Хотя изменение режима хранения на ROLAP позволит сократить время обработки и пространство для хранения, это произойдет за счет уменьшения скорости обработки запросов. При выполнении упражнений данного учебника в качестве режима хранения будет использован MOLAP.  
  
20. Чтобы добавить созданное измерение в куб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Tutorial, переключитесь в **Конструктор кубов**. На вкладке **Структура куба** щелкните правой кнопкой мыши панель **Измерения** и выберите команду **Добавить измерение куба**.  
  
21. В диалоговом окне **Добавление измерения куба**выберите измерение **Подробности заказа через Интернет** и нажмите кнопку **ОК**.  
  
## <a name="defining-a-fact-relationship-for-the-fact-dimension"></a>Определение связи фактов для измерений фактов  
  
1.  В конструкторе кубов для куба по службам [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Tutorial перейдите на вкладку **Использование измерений** .  
  
    Обратите внимание, что измерение куба **Подробности заказа через Интернет** автоматически настроено как измерение, имеющее связь фактов, что отражает его уникальный значок.  
  
2.  Нажмите кнопку обзора (**...** ) в **описание элемента** ячейку на пересечении **Интернет-продажи** группы мер и **подробности заказа через Интернет** измерение, Просмотрите свойства связи фактов.  
  
    Будет открыто диалоговое окно **Задание связи** . Обратите внимание, что настройка свойств невозможна.  
  
    На рисунке ниже показаны свойства связи фактов в диалоговом окне **Задание связи** .  
  
    ![Диалоговое окно Определение связи](../media/l5-factrelationship-2.gif "диалоговое окно «Задание связи»")  
  
3.  Нажмите кнопку **Отмена**.  
  
## <a name="browsing-the-cube-by-using-the-fact-dimension"></a>Просмотр куба с использованием измерения фактов  
  
1.  В меню **Сборка** выберите команду **Развернуть Analysis Services Tutorial** , чтобы внести изменения в экземпляр служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] и обработать базу данных.  
  
2.  После успешного завершения развертывания перейдите в конструкторе кубов на вкладку **Браузер** , выберите куб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Tutorial и нажмите кнопку **Повторное соединение** .  
  
3.  Очистите все меры и иерархии на панели данных, а затем добавьте измерение **Продажи через Интернет — сумма продаж** в раздел строк области данных.  
  
4.  На панели метаданных разверните узлы **Заказчик**, **Расположение**, **География заказчика**, **Элементы**, **Все заказчики**, **Австралия**, **Квинсленд**, **Брисбейн**, **4000**, щелкните правой кнопкой мыши **Адам Пауэлл**и выберите пункт **Добавить в фильтр**.  
  
    Фильтр, согласно которому ограничивается число заказов, возвращаемых одному клиенту, позволяет пользователю выполнить детализацию по огромной таблице фактов, не ощущая заметного падения скорости обработки запросов.  
  
5.  Добавьте определяемую пользователем иерархию **Заказы через Интернет** из измерения **Подробности заказа через Интернет** в разделе строк панели данных.  
  
    Обратите внимание, что соответствующие номера заказов и объемы закупок Адама Пауэла теперь отображаются на панели данных.  
  
    На следующем рисунке показано, как выглядят измерения после выполнения ранее описанных шагов.  
  
    ![Создание измерения Internet Sales-Sales Amount](../media/l5-factrelationship-3.gif "Создание измерения Internet Sales-Sales Amount")  
  
## <a name="next-task-in-lesson"></a>Следующая задача занятия  
[Определение связи «многие ко многим»](lesson-5-3-defining-a-many-to-many-relationship.md)  
  
## <a name="see-also"></a>См. также  
[Связи измерений](../multidimensional-models-olap-logical-cube-objects/dimension-relationships.md)  
[Определение связей фактов и свойств связей фактов](../multidimensional-models/define-a-fact-relationship-and-fact-relationship-properties.md)  
  
  
  
