---
title: Определение связи «многие ко многим» | Документация Майкрософт
ms.date: 05/06/2019
ms.prod: sql
ms.technology: analysis-services
ms.custom: multidimensional-models
ms.topic: tutorial
ms.author: owend
ms.reviewer: owend
author: minewiskan
manager: kfile
ms.openlocfilehash: d3bf9211fb62db1452f48306e682638fd17041b8
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "65404066"
---
# <a name="lesson-5-3---defining-a-many-to-many-relationship"></a>Занятие 5-3-определение связи «многие ко многим»
[!INCLUDE[ssas-appliesto-sqlas](../../includes/ssas-appliesto-sqlas.md)]

При определении измерения каждый из фактов, как правило, соединяется с одним и только одним элементом измерения, в то время как отдельные элементы измерения могут быть связаны с несколькими разными фактами. Например, клиент может иметь много заказов, но каждый заказ принадлежит только одному клиенту. В терминологии реляционных баз данных такая связь имеет название *связь "один ко многим"* . Однако в некоторых случаях один факт может быть соединен с несколькими элементами измерения. В терминологии реляционных баз данных такая связь имеет название *связь "многие ко многим"* . Например, клиент может иметь несколько причин для совершения покупки, а причина покупки может быть связана с несколькими покупками. Соединяемая таблица используется для определения причин покупок, которые связаны с каждой покупкой. Измерение «Причина покупки», основанное на таких связях, будет иметь несколько элементов, связанных с одной транзакцией продажи. Связи «многие ко многим» выводят модель измерений за пределы классической схемы «звезда» и поддерживают комплексную аналитику, когда измерения не связаны напрямую с таблицей фактов.  
  
В службах [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]связь «многие ко многим» между измерением и группой мер определяется указанием промежуточной таблицы фактов, которая соединяется с таблицей измерения. В свою очередь, промежуточная таблица фактов соединена с промежуточной таблицей измерения, с которой связана эта таблица фактов. Связи «многие ко многим» между промежуточной таблицей фактов, таблицами измерений в этой связи и промежуточным измерением создают связи «многие ко многим» между элементами первичных измерений и мерами группы мер, которая указана данной связью. Чтобы определить связь «многие ко многим» между измерением и группой мер через промежуточную группу мер, промежуточная группа мер должна иметь одно или несколько общих измерений с исходной группой мер.  
  
С измерением «многие ко многим» значения суммируются отдельно, что означает, что они не вычисляются более одного раза для элемента «Все».  
  
> [!NOTE]  
> Для поддержки связи измерений многие ко многим, необходимо определить отношением первичного и внешнего ключа в представлении источника данных между всеми задействованными таблицами. В обратном случае будет невозможно выбрать верную промежуточную группу мер при определении связи на вкладке **Использование измерений** конструктора кубов.  
  
Дополнительные сведения см. в разделах [Связи измерений](../multidimensional-models-olap-logical-cube-objects/dimension-relationships.md)и [Определение связей "многие ко многим" и свойств связей "многие ко многим"](../multidimensional-models/define-a-many-to-many-relationship-and-many-to-many-relationship-properties.md).  
  
В задачах этого раздела предстоит определить измерение Sales Reasons и группу мер Sales Reasons, а также создать связь «многие ко многим» между измерением Sales Reasons и группой мер Internet Sales через группу мер Sales Reasons.  
  
## <a name="adding-required-tables-to-the-data-source-view"></a>Добавление необходимых таблиц к представлению источника данных  
  
1.  Откройте конструктор представлений источника данных для представления источников данных **Adventure Works DW 2012** .  
  
2.  Щелкните правой кнопкой мыши панель **Организатор диаграмм** , выберите команду **Создать диаграмму**и укажите **Причина заказа через Интернет** в качестве имени созданной диаграммы.  
  
3.  Перетащите таблицу **InternetSales** с панели **Таблицы** на панель **Диаграмма** .  
  
4.  Щелкните правой кнопкой мыши панель **Диаграмма** и выберите команду **Добавить или удалить таблицы**.  
  
5.  В диалоговом окне **Добавление или удаление таблиц** добавьте в список **Включенные объекты** таблицы **DimSalesReason** и **FactInternetSalesReason** , а затем нажмите кнопку **ОК**.  
  
    Обратите внимание на то, что связи первичного и внешнего ключей между задействованными таблицами создается автоматически, так как эти связи определены в базовой реляционной базе данных. Если эти связи не определены в базовой реляционной базе данных, их следует определить в представлении источника данных.  
  
6.  В меню **Формат** выберите команду **Автоматический макет**и щелкните значок **Диаграмма**.  
  
7.  В окне свойств измените свойство **FriendlyName** таблицы **DimSalesReason** на **SalesReason**, затем измените свойство **FriendlyName** таблицы **FactInternetSalesReason** на **InternetSalesReason**.  
  
8.  На панели **Таблицы** разверните узел **InternetSalesReason (dbo.FactInternetSalesReason)** , щелкните столбец **SalesOrderNumber**и просмотрите в окне свойств свойство **DataType** для этого столбца данных.  
  
    Обратите внимание, что в качестве типа данных для столбца **SalesOrderNumber** указан тип данных string.  
  
9. Просмотрите типы данных для других столбцов таблицы **FactInternetSalesReason** .  
  
    Обратите внимание, что для остальных двух столбцов этой таблицы указаны числовые типы данных.  
  
10. На панели **Таблицы** щелкните правой кнопкой мыши таблицу **InternetSalesReason (dbo.FactInternetSalesReason)** и выберите пункт **Просмотр данных**.  
  
    Обратите внимание, что для каждого номера строки каждого заказа значение ключа указывает причину покупки данной позиции линии, как показано на следующем рисунке.  
  
    ![Ключ значение, определяющее причину продажи](../media/l5-many-to-many-1.gif "ключа значение, определяющее причину продажи")  
  
## <a name="defining-the-intermediate-measure-group"></a>Определение промежуточной группы мер  
  
1.  Переключитесь в конструктор кубов на куб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Tutorial и откройте вкладку **Структура куба** .  
  
2.  Щелкните правой кнопкой мыши панель **Меры** и выберите команду **Создать группу мер**. Дополнительные сведения см. в разделе [Создание мер и групп мер в многомерных моделях](../multidimensional-models/create-measures-and-measure-groups-in-multidimensional-models.md).  
  
3.  В диалоговом окне **Создание группы мер** в списке **Выберите таблицу из представления источников данных** выберите таблицу **InternetSalesReason** и нажмите кнопку **ОК**.  
  
    Обратите внимание, что на панели **Меры** теперь отображается группа мер **Internet Sales Reason** .  
  
4.  Разверните группу мер **Internet Sales Reason** .  
  
    Обратите внимание, что для этой группы мер определена единственная мера, **Internet Sales Reason Count** .  
  
5.  Выберите меру **Internet Sales Reason Count** и просмотрите свойства этой меры в окне свойств.  
  
    Обратите внимание, что свойство **AggregateFunction** для этой меры определено как **Число** , а не **Сумма**. [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Число **Число** , поскольку базовый тип данных — строковый. Другие два столбца в базовой таблице фактов не были выделены как меры, поскольку в службах [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] они определены как числовые ключи, а не фактические меры. Дополнительные сведения см. в разделе [Определение полуаддитивного режима](../multidimensional-models/define-semiadditive-behavior.md).  
  
6.  В окне «Свойства» измените значение свойства **Visible** меры **Internet Sales Reason Count** на **False**.  
  
    Эта мера будет использована только для соединения измерения Sales Reason, которое предстоит определить после группы мер Internet Sales. Пользователи не смогут просматривать эту меру.  
  
    На следующем рисунке демонстрируются свойства меры **Internet Sales Reason Count** .  
  
    ![Свойства меры Internet Sales Reason Count](../media/l5-many-to-many-2.gif "свойства для меры Internet Sales Reason Count")  
  
## <a name="defining-the-many-to-many-dimension"></a>Определение измерения «многие ко многим»  
  
1.  В обозревателе решений щелкните правой кнопкой мыши узел **Измерения**и выберите команду **Создать измерение**.  
  
2.  На странице **Вас приветствует мастер измерений** нажмите кнопку **Далее**.  
  
3.  На странице **Выбор метода создания** выберите параметр **Использовать существующую таблицу** и нажмите кнопку **Далее**.  
  
4.  На странице **Определение исходных сведений** убедитесь, что выбрано представление источника данных [!INCLUDE[ssSampleDBCoShort](../../includes/sssampledbcoshort-md.md)] DW 2012.  
  
5.  В списке **Основная таблица** выберите таблицу **SalesReason**.  
  
6.  Убедитесь, что в списке **Ключевые столбцы** присутствует столбец **SalesReasonKey** .  
  
7.  В списке **Столбец имени** выберите **SalesReasonName**.  
  
8.  Нажмите кнопку **Далее**.  
  
9. На странице **Выбор атрибутов измерения** атрибут **Sales Reason Key** автоматически выбран, поскольку он является ключевым. Установите флажок рядом с атрибутом **Sales Reason Reason Type** , измените его имя на **Sales Reason Type**и нажмите кнопку **Далее**.  
  
10. На странице **Завершение работы мастера** нажмите кнопку **Готово** , чтобы создать измерение Sales Reason.  
  
11. В меню **Файл** выберите команду **Сохранить все**.  
  
12. На панели **Атрибуты** конструктора измерений для измерения **Sales Reason** выберите **Sales Reason Key**и в окне свойств задайте для свойства **Name** значение **Sales Reason**.  
  
13. На панели **Иерархии** конструктора измерений создайте пользовательскую иерархию **Sales Reasons** , которая будет содержать уровни **Sales Reason Type** и **Sales Reason** (в указанном порядке).  
  
14. В окне свойств задайте значение **Все причины покупки** для свойства **AllMemberName** иерархии Sales Reason.  
  
15. Укажите значение **Все причины покупки** для свойства **AttributeAllMemberName** измерения Sales Reason.  
  
16. Чтобы добавить созданное измерение в куб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Tutorial, переключитесь в **Конструктор кубов**. На вкладке **Структура куба** щелкните правой кнопкой мыши панель **Измерения** и выберите команду **Добавить измерение куба**.  
  
17. В диалоговом окне **Добавление измерения куба** выберите **Sales Reason** и нажмите кнопку **ОК**.  
  
18. В меню **Файл** выберите команду **Сохранить все**.  
  
## <a name="defining-the-many-to-many-relationship"></a>Определение связи «многие ко многим»  
  
1.  Переключитесь в конструкторе кубов на куб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Tutorial и откройте вкладку **Использование измерений** .  
  
    Обратите внимание, что измерение **Sales Reason** имеет обычную связь, определенную группой мер **Internet Sales Reason** , но не имеет связи, определенной группами мер **Internet Sales** или **Reseller Sales** . Обратите внимание, что измерение **Подробности заказа через Интернет** имеет обычную связь, определенную измерением **Причина продажи через Интернет** , которое в свою очередь имеет **Fact Relationship** с группой мер **Internet Sales** . Если измерение не найдено (или не найдено другое измерение со связью с обеими группами мер: **Причина покупки через Интернет** и **Продажи через Интернет** ), не получится определить связь "многие ко многим".  
  
2.  Щелкните ячейку на пересечении группы мер **Продажи через Интернет** и измерения **Причина покупки** , а затем нажмите кнопку обзора ( **...** ).  
  
3.  В диалоговом окне **Задание связи** в списке **Выберите тип связи** укажите значение **Многие ко многим** .  
  
    Требуется определить промежуточную группу мер, соединяющую измерение Sales Reason и группу мер Internet Sales.  
  
4.  В списке **Промежуточная группа мер** выберите значение **Internet Sales Reason**.  
  
    На следующем рисунке отражены изменения, сделанные в диалоговом окне **Задание связи** .  
  
    ![Диалоговое окно Определение связи](../media/l5-many-to-many-3.gif "диалоговое окно «Задание связи»")  
  
5.  Нажмите кнопку **ОК**.  
  
    Обратите внимание на значок «многие ко многим», который отражает связь между измерением Sales Reason и группой мер Internet Sales.  
  
## <a name="browsing-the-cube-and-the-many-to-many-dimension"></a>Просмотр куба и измерения «многие ко многим»  
  
1.  В меню **Сборка** выберите команду **Развернуть Analysis Services Tutorial**.  
  
2.  После успешного завершения развертывания перейдите на вкладку **Браузер** в конструкторе кубов [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Tutorial и нажмите кнопку **Повторное соединение**.  
  
3.  В область данных панели "Данные" добавьте меру **Продажи через Интернет — объем продаж** .  
  
4.  Добавьте определенную пользователем иерархию **Причины покупки** из измерения **Причина покупки** в область строк панели данных.  
  
5.  На панели метаданных разверните узлы **Заказчик**, **Расположение**, **География заказчика**, **Члены**, **Все заказчики**, **Австралия**, щелкните правой кнопкой мыши элемент **Квинсленд**и выберите команду **Добавить в фильтр**.  
  
6.  Раскройте каждый из элементов уровня **Sales Reason Type** , чтобы просмотреть суммы в долларах для каждой из причин, которые выдвинул заказчик из штата Квинсленд (Queensland) в обоснование покупки товара [!INCLUDE[ssSampleDBCoShort](../../includes/sssampledbcoshort-md.md)] через Интернет.  
  
    Обратите внимание, что итоговые суммы по каждой из причин покупки в совокупности больше, чем общая сумма продаж. Это вызвано тем, что некоторые заказчики указали несколько причин покупки.  
  
    На следующем рисунке показаны панели конструктора кубов **Фильтр** и **Данные** .  
  
    ![Фильтрация и данных панели конструктора кубов](../media/l5-many-to-many-5.gif "фильтр и данные панели конструктора кубов")  
  
## <a name="next-task-in-lesson"></a>Следующая задача занятия  
[Определение степени гранулярности измерения в группе мер](lesson-5-4-defining-dimension-granularity-within-a-measure-group.md)  
  
## <a name="see-also"></a>См. также  
[Работа с диаграммами в конструкторе представлений источника данных (службы Analysis Services)](../multidimensional-models/work-with-diagrams-in-data-source-view-designer-analysis-services.md)  
[Связи измерений](../multidimensional-models-olap-logical-cube-objects/dimension-relationships.md)  
[Определение связей "многие ко многим" и свойств связей "многие ко многим"](../multidimensional-models/define-a-many-to-many-relationship-and-many-to-many-relationship-properties.md)  
  
  
  
