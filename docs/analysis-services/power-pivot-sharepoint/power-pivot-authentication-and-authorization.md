---
title: Power Pivot Authentication and Authorization | Документация Майкрософт
ms.date: 05/02/2018
ms.prod: sql
ms.technology: analysis-services
ms.custom: ppvt-sharepoint
ms.topic: conceptual
ms.author: owend
ms.reviewer: owend
author: minewiskan
manager: kfile
ms.openlocfilehash: c4f72522c1803a364d9a309b5fa2d21fd9f2fe18
ms.sourcegitcommit: e366f702c49d184df15a9b93c2c6a610e88fa0fe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67826493"
---
# <a name="power-pivot-authentication-and-authorization"></a>Проверка подлинности и авторизация PowerPivot
[!INCLUDE[ssas-appliesto-sqlas](../../includes/ssas-appliesto-sqlas.md)]
  Развертывание [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint, работающее в пределах фермы SharePoint 2010, использует подсистему проверки подлинности и модель авторизации, предоставляемые серверами SharePoint. Инфраструктура безопасности SharePoint распространяется на содержимое и операции [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , поскольку все содержимое [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)]хранится в базах данных содержимого SharePoint, а все операции, связанные с [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)], выполняются общими службами [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] в ферме. Перед запросом книги, содержащей данные [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , пользователь должен пройти проверку подлинности с помощью удостоверения пользователя SharePoint, которое основано на учетных данных пользователя Windows. Разрешения на просмотр книги определяют, возможно ли выполнение запроса.  
  
 Поскольку интеграция со службами Excel необходима для анализа данных в режиме самообслуживания, для понимания принципов безопасности сервера [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] необходимо знание основ безопасности служб Excel. Когда пользователь запрашивает сводную таблицу, имеющую подключение к данным [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , службы Excel перенаправляют запрос подключения к данным на сервер [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] в ферме для загрузки данных. Такое взаимодействие между серверами требует понимания принципов настройки параметров безопасности для обоих серверов.  
  
 Перейдите по одной из следующих ссылок к соответствующему подразделу:  
  
 [Проверка подлинности Windows с использованием классического режима входа](../../analysis-services/power-pivot-sharepoint/power-pivot-authentication-and-authorization.md#bkmk_auth)  
  
 [Операции PowerPivot, требующие авторизации пользователей](#UserConnections)  
  
 [Разрешения SharePoint для доступа к данным PowerPivot](#Permissions)  
  
 [Вопросы безопасности служб Excel для книг PowerPivot](#excel)  
  
##  <a name="bkmk_auth"></a> Проверка подлинности Windows с использованием классического режима входа  
 [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint поддерживает часть параметров проверки подлинности, доступных в SharePoint. При развертывании [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint из доступных вариантов проверки подлинности поддерживается только проверка подлинности Windows. Кроме того, веб-приложение, через которое выполняется вход, должно быть настроено на классический режим.  
  
 Проверка подлинности Windows является обязательной, поскольку при развертывании [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint подсистема обработки данных служб Analysis Services поддерживает только проверку подлинности Windows. Службы Excel устанавливают соединения со службами Analysis Services через поставщик OLE DB MSOLAP, используя удостоверение пользователя, подлинность которого была проверена через NTLM или по протоколу Kerberos.  
  
 Второе требование: чтобы гарантировать работоспособность работы веб-службы [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , требуется проверка подлинности в классическом режиме. Веб-служба — это компонент, который запускается на веб-сервере и обеспечивает перенаправление HTTP-запросов на сервер [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint в ферме. Веб-служба поддерживает утверждения в маркере безопасности для связи между службами, но не поддерживает их для запросов подключения к данным, которые перенаправляются в общую службу [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] в ферме. Запросы на загрузку данных [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] поддерживаются только для проверенных соединений, поступающих из IIS с удостоверением Windows. Классический режим входа в веб-приложение обеспечивает успешное подключение веб-службы [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] к общим службам [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] в ферме.  
  
 Хотя классический режим входа не требуется для более распространенного способа доступа к данным (когда данные [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] извлекаются из той же книги Excel, где производится подготовка к просмотру), не пытайтесь использовать [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint с веб-приложениями SharePoint, для которых настроены другие поставщики проверки подлинности. Подобные действия приведут к сбою соединения при каждой попытке пользователя подключиться к книге [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] как к внешнему источнику данных.  
  
 Без классического входа в систему следующие типы запросов, обрабатываемые веб-службой [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , завершатся ошибкой:  
  
-   любой запрос данных [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , поступивший из-за пределов фермы (например, создание отчетов в конструкторе или построителе отчетов, где источник данных — URL-адрес SharePoint для подключения к книге [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] );  
  
-   запросы внутри фермы от клиентского приложения или отчета, которые используют книгу [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] в качестве внешнего источника данных (например, создание книги в приложении Excel, когда в качестве источника данных используется вторая опубликованная книга Excel с данными [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] ).  
  
### <a name="how-to-check-the-authentication-provider-for-your-application"></a>Проверка поставщика проверки подлинности для приложения  
 При создании новых веб-приложений следует обязательно выбирать параметр **Классический режим проверки подлинности** на странице «Создание нового веб-приложения».  
  
 Для существующих веб-приложений выполните следующие инструкции, чтобы проверить, настроено ли веб-приложение на использование проверки подлинности Windows.  
  
1.  В разделе «Управление приложениями» центра администрирования выберите **Управление веб-приложениями**.  
  
2.  Выберите веб-приложение.  
  
3.  Нажмите кнопку **Поставщики проверки подлинности**.  
  
4.  Проверьте, что для каждой зоны есть только один поставщик, а для зоны, используемой по умолчанию, поставщиком проверки подлинности является Windows.  
  
##  <a name="UserConnections"></a> Операции PowerPivot, требующие авторизации пользователей  
 Для всех уровней доступа к обработке запросов и данных [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] используется исключительно авторизация SharePoint.  
  
 Авторизация на основе ролей служб Analysis Services не поддерживается. Авторизация на основе ролей для данных [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] на уровне ячеек, строк или таблиц отсутствует. Невозможна частичная защита книги, позволяющая предоставлять или запрещать доступ отдельных пользователей к конфиденциальным данным, содержащимся в книге. Внедренные данные [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] в полном объеме доступны пользователям, имеющим разрешения на просмотр книг Excel в библиотеке SharePoint.  
  
 [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint будет олицетворять пользователя SharePoint в перечисленных ниже случаях.  
  
-   Запросы к сводным таблицам или диаграммам, которые имеют соединения с базой данных [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , когда приложение службы [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] от имени пользователя устанавливает соединения с конкретной общей службой [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , обрабатывающей данные.  
  
-   Загрузка данных [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] из кэша или библиотеки, если доступ к данным нельзя получить другими способами. Если подключение к данным производится для данных [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , еще не загруженных в систему, то экземпляр [!INCLUDE[ssGeminiSrv](../../includes/ssgeminisrv-md.md)] пользуется удостоверением пользователя SharePoint для получения источника данных из библиотеки содержимого и его загрузки в память.  
  
-   Операции обновления данных, которые сохраняют обновленную копию источника данных в книге в библиотеке содержимого. В этом случае фактическая операция входа выполняется с использованием имени пользователя и пароля, полученных из целевого приложения в службе Secure Store. Учетные данные могут представлять учетную запись автоматического обновления данных [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] или учетные данные, сохраненные вместе с расписанием обновления данных во время создания. Дополнительные сведения см. в разделах [Настройка сохраненных учетных данных для обновления данных PowerPivot (PowerPivot для SharePoint)](http://msdn.microsoft.com/987eff0f-bcfe-4bbd-81e0-9aca993a2a75) и [Настройка учетной записи автоматического обновления данных PowerPivot (PowerPivot для SharePoint)](http://msdn.microsoft.com/81401eac-c619-4fad-ad3e-599e7a6f8493).  
  
##  <a name="Permissions"></a> Разрешения SharePoint для доступа к данным PowerPivot  
 Публикация и защита книги [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] и управление ею поддерживаются только через интеграцию с SharePoint. Серверы SharePoint имеют подсистемы проверки подлинности и авторизации, обеспечивающие санкционированный доступ к данным. Не существует поддерживаемых сценариев для безопасного развертывания книги [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] за пределами фермы SharePoint.  
  
 Имея разрешения на просмотр или выше, пользователи могут получать доступ к данным [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] на сервере только для чтения. Разрешения на участие позволяют добавлять и изменять файлы. Чтобы изменить данные [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , необходимо загрузить книгу в классическое приложение Excel, в котором установлена надстройка [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для Excel. Разрешения на участие для файла определяют, может ли пользователь загрузить файл в свою систему, а затем сохранить изменения в SharePoint.  
  
 Таким образом, уровни "Участие" и "Только просмотр" определяют эффективный набор разрешений для доступа пользователя к данным [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] . Другие уровни разрешений тоже будут работать в той степени, в какой им предоставлены те же разрешения, что и для уровней «Участие» и «Только просмотр» (например, поскольку уровень «Чтение» включает разрешения уровня «Только просмотр», пользователь с уровнем «Чтение» будет иметь тот же уровень доступа, что и пользователь с уровнем «Только просмотр»).  
  
 В следующей таблице обобщены сведения об уровнях разрешений, которые определяют доступ к данным [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] и операциям сервера.  
  
|Уровень разрешений|Разрешает следующие задачи|  
|----------------------|------------------------|  
|Администратор фермы или службы|Установка, включение и настройка служб и приложений.<br /><br /> Использование панели мониторинга управления [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] и просмотр административных отчетов.|  
|Полный доступ|Активация интеграции функции [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] на уровне семейств веб-сайтов.<br /><br /> Создание библиотеки галереи [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] .<br /><br /> Создание библиотеки веб-каналов данных.|  
|Участие|Добавление, изменение, удаление и скачивание книг [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] .<br /><br /> Настройка обновления данных.<br /><br /> Создание новых отчетов и книг на основе книг [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , расположенных на сайте SharePoint.<br /><br /> Создание сервисных документов данных в библиотеке веб-каналов данных.|  
|Чтение|Доступ [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] книги в качестве внешнего источника данных, когда URL-адрес книги вводится явным образом в диалоговом окне подключения (например, в мастер подключения данных для Excel).|  
|Только просмотр|Просмотр книг [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] .<br /><br /> Просмотр журнала обновления данных.<br /><br /> Подключение локальной книги к книге [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] на сайте SharePoint для повторного использования ее данных в других целях.<br /><br /> Загрузите моментальный снимок книги. Моментальный снимок является статической копией данных, без срезов, фильтров, формул или подключений к данным. Содержимое моментального снимка аналогично копии значений ячеек из окна браузера.|  
  
##  <a name="excel"></a> Вопросы безопасности служб Excel для книг PowerPivot  
 [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] Обработка запросов на сервере тесно связана со службами Excel. Интеграция продуктов начинается с уровня документов, поскольку книги [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] представляют собой файлы книг Excel (XLSX-файлы), в которых содержатся данные [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] или ссылки на них. Отдельного расширения файла для книги [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] не существует.  
  
 Когда книга [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] открывается на сайте SharePoint, службы Excel считывают внедренную в нее строку подключения к данным [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] и передают запрос локальному поставщику OLE DB для служб SQL Server Analysis Services. Затем этот поставщик передает сведения о соединении серверу [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] в ферме. Для беспрепятственного обмена запросами между двумя серверами в службах Excel должны быть настроены параметры, необходимые [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint.  
  
 В службах Excel параметры конфигурации, связанные с безопасностью, указываются в надежных расположениях, у надежных поставщиков данных и в надежных библиотеках подключения к данным. В приведенной ниже таблице описаны параметры, включающие или улучшающие доступ к данным [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] . Параметры, которых нет в этом списке, не влияют на подключения к серверу [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] . Пошаговые инструкции по настройке этих параметров см. в разделе "Включение служб Excel" статьи [Первоначальная настройка (PowerPivot для SharePoint)](http://msdn.microsoft.com/3a0ec2eb-017a-40db-b8d4-8aa8f4cdc146).  
  
> [!NOTE]  
>  Большинство параметров безопасности применяется к надежным расположениям. Если необходимо сохранить значения по умолчанию или использовать разные значения для разных сайтов, можно создать дополнительное надежное расположение для сайтов, которые содержат данные [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , а затем настроить следующие параметры только для этих сайтов. Дополнительные сведения см. в разделе [Создание надежного расположения для сайтов PowerPivot в центре администрирования](../../analysis-services/power-pivot-sharepoint/create-a-trusted-location-for-power-pivot-sites-in-central-administration.md).  
  
|Область|Параметр|Описание|  
|----------|-------------|-----------------|  
|Веб-приложение|Поставщик проверки подлинности Windows|[!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] преобразует токен утверждений, получаемый от служб Excel, в удостоверение пользователя Windows. Каждое веб-приложение, которое использует службы Excel в качестве ресурса, должно быть настроено для использования поставщика проверки подлинности Windows.|  
|Надежное расположение|Тип расположения|Это значение должно быть равно **Microsoft SharePoint Foundation**. [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] получают копию XLSX-файла и загружают ее на сервер служб Analysis Services в ферме. Этот сервер может получить XLSX-файл только из библиотеки содержимого.|  
||Разрешить внешние данные|Это значение должно быть установлено равным **Надежные библиотеки подключений к данным и внедренные**. [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] внедряются в книгу. Если запретить внедренные соединения, то пользователи смогут просматривать кэш [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] , но не смогут взаимодействовать с данными [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] .|  
||Предупреждать при обновлении|Этот параметр должен быть отключен, если галерея [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] используется для хранения книг и отчетов. [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] имеет функцию предварительного просмотра документов, которая работает лучше, если отключены оба предупреждения при открытии и обновлении.|  
|Надежные поставщики данных|MSOLAP.4<br /><br /> MSOLAP.5|MSOLAP.4 включается по умолчанию, но для доступа к [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] поставщиком MSOLAP.4 должна быть версия SQL Server 2008 R2.<br /><br /> Поставщик MSOLAP.5 устанавливается с [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] для SharePoint версии [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] .<br /><br /> Не удаляйте эти поставщики из списка надежных поставщиков данных. В некоторых случаях может потребоваться установка дополнительных копий этого поставщика на других серверах SharePoint на ферме. Дополнительные сведения см. в статье [Установка поставщика OLE DB служб Analysis Services на серверах SharePoint](http://msdn.microsoft.com/2c62daf9-1f2d-4508-a497-af62360ee859).|  
|Надежные библиотеки подключений к данным|Необязательный параметр.|Можно использовать файлы подключения к данным Office (ODC), хранящиеся в книгах [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] . Если сведения о подключении к локальным книгам [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] поставляются из ODC-файла, то эти же ODC-файлы можно добавить в данную библиотеку.|  
|Определяемая пользователем сборка функций|Неприменимо.|[!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] для SharePoint игнорирует сборки пользовательских функций, созданные и развернутые для служб Excel. Если пользовательские сборки необходимы для каких-то операций, помните, что подсистема обработки запросов [!INCLUDE[ssGemini](../../includes/ssgemini-md.md)] не будет использовать созданные функции, определяемые пользователем.|  
  
## <a name="see-also"></a>См. также  
 [Настройка учетных записей служб Power Pivot](../../analysis-services/power-pivot-sharepoint/configure-power-pivot-service-accounts.md)   
 [Настройка учетной записи автоматического обновления данных PowerPivot (PowerPivot для SharePoint)](http://msdn.microsoft.com/81401eac-c619-4fad-ad3e-599e7a6f8493)   
 [Создание надежного расположения для сайтов PowerPivot в центре администрирования](../../analysis-services/power-pivot-sharepoint/create-a-trusted-location-for-power-pivot-sites-in-central-administration.md)   
 [Архитектура безопасности PowerPivot](http://go.microsoft.com/fwlink/?linkID=220970)  
  
  
