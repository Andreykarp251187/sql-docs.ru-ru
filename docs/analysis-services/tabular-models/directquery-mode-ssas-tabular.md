---
title: Режим DirectQuery в службах Analysis Services | Документация Майкрософт
ms.date: 05/07/2018
ms.prod: sql
ms.technology: analysis-services
ms.custom: tabular-models
ms.topic: conceptual
ms.author: owend
ms.reviewer: owend
author: minewiskan
manager: kfile
ms.openlocfilehash: a51b38dacf5a1ebaf67a19bf8b3761800425a347
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "68207683"
---
# <a name="directquery-mode"></a>Режим DirectQuery
[!INCLUDE[ssas-appliesto-sqlas-aas](../../includes/ssas-appliesto-sqlas-aas.md)]
  В этой статье описывается *режим DirectQuery* для табличных моделей служб Analysis Services на уровнях совместимости 1200 и выше. Режим DirectQuery можно включить для моделей, разрабатываемых в среде SSDT. Для уже развернутых табличных моделей можно переключиться в режим DirectQuery в среде SSMS. Перед выбором режима DirectQuery важно понять его преимущества и ограничения.
  
##  <a name="bkmk_Benefits"></a> Преимущества
 По умолчанию табличные модели используют кэш в памяти для хранения данных и отправки запросов к данным. Если табличные модели запрашивают данные, находящиеся в памяти, даже сложные запросы могут выполняться очень быстро. Однако есть некоторые недостатки использования кэшированных данных. А именно: для больших наборов данных может не хватать выделенного объема памяти. В этом случае процесс выполнения запросов на обновление данных по расписанию может быть сложным или вообще невозможным.  
  
 Режим DirectQuery обходит эти ограничения, а также применяет функции реляционных СУБД, что позволяет повысить эффективность выполнения запросов. Ниже приведены преимущества режима DirectQuery.  
  
-   Данные всегда будут обновленными, при этом нет необходимости хранить и поддерживать отдельную копию данных (в кэше в памяти). Изменения данных базового источника могут быть сразу же отражены в запросах к модели данных.  
  
-   Объемы наборов данных могут превышать объем памяти сервера Analysis Services.  
  
-   DirectQuery может воспользоваться ускорением запросов на стороне поставщика, например за счет индексов столбцов оптимизированной для памяти.  
  
-   Безопасность можно обеспечить с помощью серверной базы данных путем использования функций безопасности на уровне строк (кроме того, в модели можно реализовать безопасность на уровне строк посредством DAX).  
  
-   Если модель содержит сложные формулы, которым могут потребоваться несколько запросов, службы Analysis Services могут выполнять оптимизацию для того, чтобы план запроса к серверной базе данных был как можно более эффективным.  
  
##  <a name="bkmk_prereq"></a>Ограничения
Табличные модели в режиме DirectQuery имеют некоторые ограничения. Перед изменением режима обязательно определите, превышают ли преимущества выполнения запросов на внутреннем сервере проблемы, связанные со снижением функциональных возможностей.  
  
 При изменении режима существующей табличной модели в [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)]конструктор моделей уведомит о функциях модели, несовместимых с режимом DirectQuery.  
  
 В следующем списке перечислены основные функциональные ограничения, о которых следует помнить.  
  
|||  
|-|-|  
|**Область функций**|**Ограничение**|  
|**Источники данных**|Модели DirectQuery могут использовать только данные из одной реляционной базы данных из следующих типов: SQL Server, база данных Azure SQL, Oracle и Teradata.  Сведения о версии и поставщике см. далее в подразделе "Поддерживаемые источники данных для DirectQuery".| 
|**Хранимые процедуры для работы с SQL**|Для моделей DirectQuery при использовании мастера импорта данных нельзя указывать хранимые процедуры в инструкции SQL для определения таблиц. |   
|**Вычисляемые таблицы**|Вычисляемые таблицы не поддерживаются для табличных моделей в режиме DirectQuery, но вычисляемые столбцы поддерживаются. Попытка преобразовать табличную модель с вычисляемой таблицей завершится ошибкой, указывающей, что данная модель не может содержать вставленные данные.|  
|**Ограничения запросов**|Ограничением строк по умолчанию является один миллион строк. Это значение можно увеличить, указав **MaxIntermediateRowSize** в файле msmdsrv.ini. Дополнительные сведения см. в разделе [Свойства DAX](../../analysis-services/server-properties/dax-properties.md) .
|**Формулы DAX**|При отправке запросов к табличной модели в режиме DirectQuery [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] преобразуют все DAX-формулы и определения мер в инструкции SQL. Формулы DAX, содержащие элементы, которые не могут быть преобразованы в синтаксис SQL, вызовут ошибку проверки в модели.<br /><br /> Это ограничение в основном относится к некоторым функциям DAX. DAX-формулы для мер преобразовываются в операции на основе наборов, выполняемые с реляционным хранилищем данных. Это означает, что все неявно созданные меры поддерживаются. <br /><br /> При возникновении ошибки проверки необходимо переписать формулу, заменяющую функцию, или устранить проблему с помощью производных столбцов в источнике данных.  Если табличная модель содержит формулы с несовместимыми функциями, при переключении в режим DirectQuery в конструкторе будет выведено соответствующее сообщение. <br /><br />**Примечание.**  Некоторые формулы в модели могут проходить проверку при переводе модели в режим DirectQuery, но при этом возвращать другие результаты при обращении к кэшу по сравнению с реляционным хранилищем данных. Это происходит потому, что вычисления для кэша используют семантику подсистемы выполняющейся в памяти аналитики, которая содержит функции, предназначенные для моделирования поведения Excel, в то время как запросы к данным, хранимым в реляционном источнике данных, всегда используют семантику SQL Server.<br /><br />Дополнительные сведения см. в разделе [совместимость формул в режиме DirectQuery](../../analysis-services/tabular-models/dax-formula-compatibility-in-directquery-mode-ssas-2016.md).|  
|**Согласованность формул**|В некоторых случаях одна и та же формула может возвращать разные результаты в кэшированной модели по сравнению с моделью DirectQuery, которая использует только реляционное хранилище данных. Эти отличия являются следствием семантических отличий между подсистемой выполняющейся в памяти аналитики и SQL Server.<br /><br /> Полный список проблем несовместимости, в том числе функции, которые могут возвращать разные результаты при развертывании модели в режиме реального времени, см. в разделе [совместимость формул в режиме DirectQuery (SQL Server Analysis Services)](http://msdn.microsoft.com/981b6a68-434d-4db6-964e-d92f8eb3ee3e).|  
|**Ограничения для многомерных выражений**|Нельзя использовать относительные имена объектов. Необходимо указывать полные имена.<br /><br /> Нельзя изменять инструкции многомерных выражений для области сеанса (именованные наборы, вычисляемые элементы, вычисляемые ячейки, визуальные итоги, элементы по умолчанию и т. д.), но можно использовать конструкции области запросов, такие как предложение WITH.<br /><br /> Отсутствуют кортежи с элементами различных уровней в предложениях подзапроса выборки многомерных выражений.<br /><br /> Отсутствуют пользовательские иерархии.<br /><br /> Отсутствуют собственные SQL-запросы (как правило, службы Analysis Services поддерживают подмножество T-SQL, но не для моделей DirectQuery).|  

## <a name="data-sources-supported-for-directquery"></a>Поддерживаемые источники данных для DirectQuery
Табличные модели DirectQuery при уровне совместимости 1200 и выше совместимы с следующие источники данных и поставщики:

Источник данных   |Версии  |Поставщики
---------|---------|---------
Microsoft SQL Server    |  2008 и более поздних версий      |       Поставщик OLE DB для SQL Server, поставщик OLE DB для собственного клиента SQL Server, поставщик данных .NET Framework для клиента SQL Server  
База данных Microsoft Azure SQL    |   All      |  Поставщик OLE DB для SQL Server, поставщик OLE DB для собственного клиента SQL Server, поставщик данных .NET Framework для клиента SQL Server            
Хранилище данных SQL Microsoft Azure     |   All     |  Поставщик данных .NET Framework для клиента SQL       
Системы платформы аналитики Microsoft SQL (APS)     |   All      |  Поставщик OLE DB для SQL Server, поставщик OLE DB для собственного клиента SQL Server, поставщик данных .NET Framework для клиента SQL Server       
Реляционные базы данных Oracle     |  Oracle 9i и более поздних версий       |  Поставщик OLE DB для Oracle       
Реляционные базы данных Teradata    |  Teradata V2R6 и более поздних версий     | Поставщик данных .NET для Teradata        

## <a name="connecting-to-a-data-source"></a>Подключение к источнику данных
При разработке модели DirectQuery в SSDT соединение с источником данных и выбор таблиц и полей для включения в модель выполняется практически так же, как в моделях в памяти. 

Если вы уже включили DirectQuery, но не подключились к источнику данных, воспользуйтесь мастером импорта таблиц для подключения к источнику данных, выбора таблиц и поля, указания запросов SQL и т. д. Разницу вы заметите по окончании — данные не будут импортированы в кэш в памяти. 

![Успешное завершение импорта DirectQuery](../../analysis-services/tabular-models/media/directquery-import-success.png)

Если вы уже использовали мастер импорта таблиц для импорта данных, но еще не включили режим DirectQuery, то когда вы сделаете это, кэш в памяти будет очищен.

  
## <a name="additional-articles-in-this-section"></a>Дополнительные статьи в этом разделе
[Включение режима DirectQuery в SSDT](../../analysis-services/tabular-models/enable-directquery-mode-in-ssdt.md)

[Включение режима DirectQuery в SSMS](../../analysis-services/tabular-models/enable-directquery-mode-in-ssms.md)

[Добавление демонстрационных данных в модель DirectQuery в режиме конструктора](../../analysis-services/tabular-models/add-sample-data-to-a-directquery-model-in-design-mode.md)

[Определение секций в моделях DirectQuery](../../analysis-services/tabular-models/define-partitions-in-directquery-models-ssas-tabular.md)
  
[Тестирование модели в режиме DirectQuery](../../analysis-services/tabular-models/test-a-model-in-directquery-mode.md)

[Совместимость формул в режиме DirectQuery](../../analysis-services/tabular-models/dax-formula-compatibility-in-directquery-mode-ssas-2016.md)
  
