---
title: Включить в режиме Analysis Services DirectQuery в среде SSMS | Документация Майкрософт
ms.date: 05/07/2018
ms.prod: sql
ms.technology: analysis-services
ms.custom: tabular-models
ms.topic: conceptual
ms.author: owend
ms.reviewer: owend
author: minewiskan
manager: kfile
ms.openlocfilehash: 27e704e6274910e2c9e3f77fe235e02918d95425
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "68207663"
---
# <a name="enable-directquery-mode-in-ssms"></a>Включение режима DirectQuery в SSMS
[!INCLUDE[ssas-appliesto-sqlas-aas](../../includes/ssas-appliesto-sqlas-aas.md)]
  Вы можете изменить свойства доступа к данным в уже развернутой табличной модели, включив режим DirectQuery, при котором запросы выполняются для источника реляционных данных серверной части, а не для кэшированных данных, находящихся в памяти.  
  
 В [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]действия, необходимые для настройки DirectQuery, различаются в зависимости от уровня совместимости модели. Ниже описаны шаги, которые подойдут для всех уровней совместимости.  
  
 В этой статье предполагается, что вы уже создана и проверена в памяти табличная модель на уровне совместимости 1200 или выше, а также необходимость включить доступ в режиме DirectQuery и обновить строки подключения. Если вы начинаете работу с более низкого уровня совместимости, необходимо сначала обновить его вручную. Соответствующие шаги описаны в разделе [Обновление служб Analysis Services](../../database-engine/install-windows/upgrade-analysis-services.md) .  
  
> [!IMPORTANT]  
>  Мы рекомендуем использовать [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)] вместо Management Studio для переключения между режимами хранения данных. При изменении модели с помощью  [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)] и последующем развертывании на сервере модель и база данных остаются синхронизированными. Кроме того, при изменении режимов хранения в модели вы сможете просматривать любые возникающие ошибки проверки. При использовании [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] , как описано в этой статье, ошибки проверки не отображаются.  
  
## <a name="requirements"></a>Требования  
 Включение режима Direct Query для табличной модели состоит из нескольких шагов.  
  
-   Убедитесь, что модель не имеет функций, которые могут вызвать ошибки проверки в режиме DirectQuery, и затем измените режим хранения данных в модели с хранения в памяти на DirectQuery.  
  
     Список функциональных ограничений описан в [режим DirectQuery](../../analysis-services/tabular-models/directquery-mode-ssas-tabular.md).  
  
-   Проверьте строку соединения и учетные данные, используемые в развернутой базе данных для получения данных из внешней базы данных серверной части. Убедитесь, что подключение только одно и что его параметры подходят для выполнения запроса.  
  
     Табличные базы данных, которые не были предназначены специально для DirectQuery, могут иметь несколько подключений. Для режима DirectQuery количество подключений нужно сократить до одного.  
  
     Учетные данные, которые ранее использовались для обработки данных, теперь будут использоваться для выполнения запросов к данным. В рамках настройки DirectQuery просмотрите и при необходимости измените учетную запись, если для отдельных операций используются различные учетные записи.  
  
     Режим DirectQuery — единственный сценарий, в котором службы Analysis Services выполняют доверенное делегирование. Если в решении необходимо использовать делегирование для получения результатов запроса для конкретного пользователя, то учетная запись, используемая для подключения к базе данных серверной части, должна иметь разрешение на делегирование удостоверения пользователя, выполняющего запрос, и удостоверения пользователей должны иметь разрешения на чтение базы данных серверной части.  
  
-   В качестве последнего шага выполните запрос, чтобы убедиться, что режим DirectQuery работает.  
  
## <a name="step-1-check-the-compatibility-level"></a>Шаг 1. Проверка уровня совместимости  
 Свойства, которые определяют доступ к данным, различаются на разных уровнях совместимости. Прежде всего нужно проверить, на каком уровне совместимости находится база данных.  
  
1.  В [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]подключитесь к экземпляру, имеющему табличную модель.  
  
2.  В обозревателе объектов щелкните правой кнопкой мыши базу данных и выберите **Свойства** > **Уровень совместимости**.  
  
     Вы увидите значение **SQL Server 2016 (1200)** или **SQL Server 2012 SP1 и более поздней версии (1103)** (более ранний уровень). На следующем шаге следуйте инструкциям, соответствующим уровню совместимости.  
  
 При изменении табличной модели на режим DirectQuery новый режим хранения данных вступает в силу немедленно.  
  
## <a name="step-2a-switch-a-tabular-1200-database-to-directquery-mode"></a>Шаг 2а. Переключение табличной базы данных 1200 в режим DirectQuery  
  
1.  В обозревателе объектов щелкните правой кнопкой мыши базу данных и выберите **Свойства** > **Модель** > **Режим по умолчанию**.  
  
2.  Установите режим **DirectQuery**.  
  
    |||  
    |-|-|  
    |**Допустимые значения**|**Описание**|  
    |**DirectQuery**|Запросы выполняются для реляционной базы данных серверной части с использованием подключения к источнику данных, определенному для модели.<br /><br /> Запросы к модели преобразуются в собственные запросы к базе данных и перенаправляются к источнику данных.<br /><br /> При обработке модели в режиме DirectQuery компилируются и развертываются только метаданные. Сами данные являются внешними по отношению к модели и размещаются в файлах базы данных для рабочего источника данных.|  
    |**Импорт**|Запросы выполняются для табличной базы данных в виде многомерных выражений или DAX.<br /><br /> При обработке модели в режиме импорта данные извлекаются из источника данных серверной части и сохраняются на диске. При загрузке базы данных данные копируются целиком в память для быстрого сканирования таблиц и выполнения запросов.<br /><br /> Этот режим используется по умолчанию для табличных моделей и является единственным режимом для некоторых (нереляционных) источников данных.|  
  
## <a name="step-2b-switch-a-tabular-1100-1103-database-to-directquery-mode"></a>Шаг 2b. Переключение базы данных табличной 1100 – 1103 в режим DirectQuery  
  
1.  В обозревателе объектов щелкните правой кнопкой мыши базу данных и выберите **Свойства** > **База данных** > **Режим DirectQuery**.  
  
2.  Установите режим **DirectQuery**.  
  
     Свойства режима по умолчанию включают следующие:  
  
    |||  
    |-|-|  
    |**Допустимые значения**|**Описание**|  
    |**InMemory**|Запросы используют только кэшированные данные в памяти.|  
    |**InMemorywithDirectQuery**|По умолчанию запросы используют кэш, если иное не указано в строке подключения клиента.<br /><br /> Это гибридный режим, в котором секции по отдельности настраиваются для использования в режиме хранения в памяти или режиме DirectQuery.|  
    |**DirectQuery**|Запросы используют только реляционный источник данных.|  
    |**DirectQuerywithInMemory**|По умолчанию запросы используют реляционный источник данных, если иное не указано в строке подключения клиента.<br /><br /> Это гибридный режим, в котором секции по отдельности настраиваются для использования в режиме хранения в памяти или режиме DirectQuery.|  
  
 **Гибридное хранилище данных**  
  
 При использовании сочетания доступа в памяти и дискового доступа кэш остается доступным и может использоваться для запросов. Гибридный режим предоставляет множество вариантов.  
  
-   Если доступны как кэш, так и реляционный источник данных, можно задать предпочтительный метод подключения, но в конечном счете именно клиент выбирает используемый источник с помощью свойства DirectQueryMode строки подключения.  
  
-   Секции в кэше можно настроить таким образом, чтобы первичная секция, используемая для режима DirectQuery, никогда не обрабатывалась и всегда ссылалась на реляционный источник. Есть много способов использования секций для оптимизации проектирования моделей и составления отчетов. Дополнительные сведения см. в разделе [определение секций в моделях DirectQuery](../../analysis-services/tabular-models/define-partitions-in-directquery-models-ssas-tabular.md).  
  
-   После развертывания модели можно изменить предпочтительный метод подключения. Например, можно использовать гибридную модель для тестирования и переключать модель в режим **Только DirectQuery** лишь после тщательного тестирования отчетов или запросов, использующих модель. Дополнительные сведения см. в разделе [Установка или изменение предпочтительного метода подключения для DirectQuery](http://msdn.microsoft.com/library/f10d5678-d678-4251-8cce-4e30cfe15751).  
  
## <a name="step-3-check-the-connection-properties-on-the-database"></a>Шаг 3. Проверка свойств подключения в базе данных  
 В зависимости того, как настроено подключение к источнику данных, при переключении в режим DirectQuery может измениться контекст безопасности подключения. При изменении режима доступа к данным просмотрите свойства для строк олицетворения и подключения, чтобы проверить, что используемое имя входа допустимо для исходящих подключений к базе данных серверной части.  
  
 Дополнительные сведения о делегировании удостоверения пользователя для сценариев DirectQuery приведены в разделе **Настройка служб Analysis Services для доверенного делегирования** статьи [Configure Analysis Services for Kerberos constrained delegation](../../analysis-services/instances/configure-analysis-services-for-kerberos-constrained-delegation.md) .  
  
1.  В обозревателе объектов разверните **Подключения** и дважды щелкните подключение, чтобы просмотреть его свойства.  
  
     Для моделей DirectQuery должно быть определено только одно подключение к базе данных. Источник данных должен быть реляционным и поддерживать тип базы данных. См. в разделе [источники данных, поддерживаемые](../../analysis-services/tabular-models/data-sources-supported-ssas-tabular.md).  
  
2.  В**строке подключения** следует указать сервер, имя базы данных и метод проверки подлинности, используемый в операциях DirectQuery. Если используется проверка подлинности SQL Server, в строке подключения можно указать имя входа для базы данных.  
  
3.  **Сведения об олицетворении** используются для проверки подлинности Windows. Для табличных моделей в режиме DirectQuery допустимы следующие варианты использования:  
  
    -   **Использовать учетную запись службы**. Этот вариант можно выбрать, если учетная запись службы Analysis Services имеет разрешения на чтение для реляционной базы данных.  
  
    -   **Использовать указанные имя пользователя и пароль**. Укажите учетную запись пользователя Windows, у которого есть разрешения на чтение для реляционной базы данных.  
  
 Обратите внимание, что эти учетные данные используются только для ответа на запросы к реляционному хранилищу данных. Они отличаются от учетных данных, используемых для обработки кэша гибридной модели.  
  
 Олицетворение не может использоваться, когда модель находится только в памяти. Параметр **ImpersonateCurrentUser**недействителен, если модель не использует режим DirectQuery.  
  
## <a name="step-4-validate-directquery-access"></a>Шаг 4. Проверки доступа в режиме DirectQuery  
  
1.  Запустите трассировку с помощью SQL Server Profiler или xEvents в среде Management Studio, подключенной к реляционной базе данных на сервере SQL Server.  
  
     При использовании Oracle или Teradata используйте средства трассировки для этих платформ баз данных.  
  
2.  В среде Management Studio введите и выполните простой запрос многомерных выражений, например `select <some measure> on 0 from model.`.  
  
3.  Изучив трассировку, вы увидите свидетельство выполнения запроса к реляционной базе данных.  
  
## <a name="see-also"></a>См. также  
 [Уровень совместимости](../../analysis-services/tabular-models/compatibility-level-for-tabular-models-in-analysis-services.md)   
 [Поддерживаемые источники данных](../../analysis-services/tabular-models/data-sources-supported-ssas-tabular.md)   
 [Расширенные события](../../relational-databases/extended-events/extended-events.md)   

  
  
