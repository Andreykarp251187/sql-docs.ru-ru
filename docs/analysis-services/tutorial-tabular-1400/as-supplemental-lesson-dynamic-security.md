---
title: 'Analysis Services дополнительное занятие для учебника по: Динамическая безопасность | Документация Майкрософт'
ms.date: 03/08/2019
ms.prod: sql
ms.technology: analysis-services
ms.custom: tabular-models
ms.topic: tutorial
ms.author: owend
ms.reviewer: owend
author: minewiskan
manager: kfile"
monikerRange: '>= sql-server-2017 || = sqlallproducts-allversions'
ms.openlocfilehash: 9fbc474dbf7621b0da68edb7b310bb55ffcde7d5
ms.sourcegitcommit: d5cd4a5271df96804e9b1a27e440fb6fbfac1220
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64776088"
---
# <a name="supplemental-lesson---dynamic-security"></a>Дополнительный урок. Динамическая безопасность

[!INCLUDE[ssas-appliesto-sql2017-later-aas](../../includes/ssas-appliesto-sql2017-later-aas.md)]

В этом дополнительном занятии создается дополнительная роль, реализующую динамическую безопасность. Динамическая безопасность позволяет определять защиту на уровне строк с учетом имени или идентификатор входа пользователя, который находится в системе в данный момент. 
  
Для реализации динамической безопасности, добавлении таблицы в модель, содержащая имена тех пользователей, которые могут подключаться к модели и просматривать объекты и данные модели. Модели, созданные с помощью этого учебника, — это в контексте Adventure Works; Тем не менее для этого занятия необходимо добавить таблицу, содержащую пользователей из собственного домена. Не обязательно пароли для добавляемых имен пользователей. Чтобы создать таблицу EmployeeSecurity с небольшой выборкой пользователей из собственного домена, используйте функцию вставки, вставляя данные из электронной таблицы Excel. В реальном сценарии таблица, содержащая имена бы таблицу из фактической базы данных как источник данных; Например, реальную таблицу DimEmployee.  
  
Для реализации динамической безопасности используйте две функции DAX: [Функция USERNAME (DAX)](http://msdn.microsoft.com/22dddc4b-1648-4c89-8c93-f1151162b93f) и [функция LOOKUPVALUE (DAX)](http://msdn.microsoft.com/73a51c4d-131c-4c33-a139-b1342d10caab). Эти функции, примененные к формуле фильтра строк, определяются в новой роли. С помощью функции LOOKUPVALUE формула указывает значение из таблицы EmployeeSecurity. Формула передает значение функции USERNAME, которая указывает имя пользователя, выполнившего вход пользователя принадлежит этой роли. Пользователь может просматривать только данные, указанные в фильтрах строк роли. В этом случае можно указать, что сотрудники отдела продаж могут просматривать только те данные Интернет-продаж для территории продаж, в которых они являются членами.  
  
Эти задачи являются уникальными для сценария табличной модели Adventure Works, но они не могут иметь прямого отношения к реальному сценарию. Каждое задание включает дополнительные сведения, описывающие цель задания.  
  
Предполагаемое время для выполнения этого занятия: **30 минут**  
  
## <a name="prerequisites"></a>предварительные требования  

В этой статье дополнительное занятие входит в учебник по табличному моделированию, который следует изучать в порядке. Прежде чем выполнять задания в этом дополнительном занятии, необходимо завершить все предыдущие занятия.  
  
## <a name="add-the-dimsalesterritory-table-to-the-aw-internet-sales-tabular-model-project"></a>Добавление таблицы dimSalesTerritory в проект табличной модели интернет-продаж AW  

Для реализации динамической безопасности для этого сценария Adventure Works, необходимо добавить в модель две дополнительные таблицы. Первая добавляемая таблица — DimSalesTerritory (Территория сбыта) из той же базы данных AdventureWorksDW. Применен фильтр строк к таблице SalesTerritory, определяющий данные, которые может просматривать вошедший пользователь.  
  
#### <a name="to-add-the-dimsalesterritory-table"></a>Добавление таблицы dimSalesTerritory  
  
1.  В обозревателе табличных моделей > **источников данных**, щелкните правой кнопкой мыши подключение и нажмите кнопку **импортировать новые таблицы**.  

    Если появится диалоговое окно учетных данных олицетворения, введите учетные данные олицетворения, которая использовалась в занятии 2: Добавление данных.
  
2.  В навигаторе выберите **DimSalesTerritory** таблицы, а затем нажмите кнопку **ОК**.    
  
3.  В редакторе запросов щелкните **DimSalesTerritory** запроса, а затем удалите **SalesTerritoryAlternateKey** столбца.  
  
7.  нажмите кнопку **Импортировать**;  
  
    Новая таблица добавляется в рабочую область модели. Объекты и данные из исходной таблицы DimSalesTerritory будут импортированы в табличной модели AW Internet Sales.  
  
9. После успешного импорта таблицы, нажмите кнопку **закрыть**.  

## <a name="add-a-table-with-user-name-data"></a>Добавление таблицы с именами пользователей  

Таблица DimEmployee в образце базы данных AdventureWorksDW содержит пользователей из домена AdventureWorks. Эти имена пользователей не существуют в вашей среде. Необходимо создать таблицу в модели, содержащей небольшую выборку (по крайней мере трех) фактических пользователей из вашей организации. Затем вы добавьте этих пользователей членами новой роли. Нет необходимости пароли для выбранных имен пользователей, но вам нужен фактические имена пользователей Windows из собственного домена.  
  
#### <a name="to-add-an-employeesecurity-table"></a>Добавление таблицы EmployeeSecurity  
  
1.  Откройте Microsoft Excel и создайте лист.  
  
2.  Скопируйте следующую таблицу, включая строку заголовка, и вставьте ее в электронную таблицу.  

    ```
      |EmployeeId|SalesTerritoryId|FirstName|LastName|LoginId|  
      |---------------|----------------------|--------------|-------------|------------|  
      |1|2|<user first name>|<user last name>|\<domain\username>|  
      |1|3|<user first name>|<user last name>|\<domain\username>|  
      |2|4|<user first name>|<user last name>|\<domain\username>|  
      |3|5|<user first name>|<user last name>|\<domain\username>|  
    ```

3.  Замените имя, фамилию и домен\имя_пользователя имена и идентификаторы входа трех пользователей в вашей организации. Укажите того же пользователя в первые две строки, EmployeeId 1, в том, что пользователь относится к более чем с одной территорией продаж. Оставьте все поля EmployeeId и SalesTerritoryId, так как они являются.  
  
4.  Сохраните лист как **SampleEmployee**.  
  
5.  На листе выберите все ячейки с данными о сотрудниках, включая заголовки, а затем щелкните правой кнопкой мыши выбранные данные и нажмите кнопку **копирования**.  
  
6.  В SSDT откройте **изменить** меню, а затем щелкните **вставить**.  
  
    Если вставки неактивна, щелкните любой столбец в любой таблице в окне конструктора моделей и повторите попытку.  
  
7.  В **Просмотр вставки** отображаемое в диалоговом окне **имя таблицы**, тип **EmployeeSecurity**.  
  
8.  В **вставляемые данные**, проверьте данные включают все пользовательские данные и заголовки с листа SampleEmployee.  
  
9. Убедитесь в том, что установлен флажок **Использовать первую строку в качестве заголовков столбцов** , и нажмите кнопку **ОК**.  
  
    Будет создана новая таблица с именем EmployeeSecurity с данными о сотрудниках скопировать с листа SampleEmployee.  
  
## <a name="create-relationships-between-factinternetsales-dimgeography-and-dimsalesterritory-table"></a>Создание связей между таблицами FactInternetSales DimGeography и DimSalesTerritory  

Все таблицы FactInternetSales DimGeography и DimSalesTerritory содержат общий столбец SalesTerritoryId. Столбец SalesTerritoryId таблицы DimSalesTerritory содержит значения с другим идентификатором для каждой территории продаж.  
  
#### <a name="to-create-relationships-between-the-factinternetsales-dimgeography-and-the-dimsalesterritory-table"></a>Для создания связей между таблицами FactInternetSales DimGeography и DimSalesTerritory таблицы  
  
1.  В представлении диаграммы в **DimGeography** таблицы, нажмите и удерживайте **SalesTerritoryId** столбец, затем перетащите курсор **SalesTerritoryId** столбца в **DimSalesTerritory** таблицы, а затем отпустите.  
  
2.  В **FactInternetSales** таблицы, нажмите и удерживайте **SalesTerritoryId** столбец, затем перетащите курсор **SalesTerritoryId** столбец в  **DimSalesTerritory** таблицы, а затем отпустите.  
  
    Обратите внимание, что свойство "Active" для этой связи имеет значение False, то есть оно неактивно. Таблица FactInternetSales уже имеет другую активную связь.  
  
## <a name="hide-the-employeesecurity-table-from-client-applications"></a>Скрытие таблицы EmployeeSecurity в клиентских приложениях  

В этой задаче вы скрытие таблицы EmployeeSecurity, оставив его отображение в списке полей клиентского приложения. Имейте в виду, что скрытие таблицы не защищает. Пользователи по-прежнему могут запрашивать данные из таблицы EmployeeSecurity, если они знают, как. Для защиты данных из таблицы EmployeeSecurity, запретив пользователям запрашивать любые ее данные, применить фильтр в одной из следующих задач.  
  
#### <a name="to-hide-the-employeesecurity-table-from-client-applications"></a>Скрытие таблицы EmployeeSecurity в клиентских приложениях  
  
-   В конструкторе моделей в представлении диаграммы щелкните правой кнопкой мыши заголовок таблицы **Сотрудник** и выберите команду **Скрыть из набора клиентских средств**.  
  
## <a name="create-a-sales-employees-by-territory-user-role"></a>Создание пользовательской роли «Сотрудники отдела продаж по территории»  

В этой задаче вы создадите роль пользователя. Эта роль включает фильтр строк, определяющий, какие строки таблицы DimSalesTerritory видны пользователям. Фильтр применяется в направлении "один к многим" ко всем остальным таблицам, связанным с DimSalesTerritory. Применить фильтр, который защищает всю таблицу EmployeeSecurity, запрещая любым пользователям, являющимся членом этой роли.  
  
> [!NOTE]  
> Роль «Сотрудники отдела продаж по территории», создаваемая на этом занятии, ограничивает возможность членов, просматривающих данные продаж, территорией, к которой они относятся. При добавлении пользователя как члена сотрудники отдела продаж по территориям также существует как члена в роль создана в [занятие 11: Создание ролей](../tutorial-tabular-1400/as-lesson-11-create-roles.md), вы получаете сочетание разрешений. Когда пользователь является членом нескольких ролей, он обладает всеми разрешениями, определенными для каждой из них. То есть пользователь имеет больше разрешений, определяемых сочетанием ролей.  
  
#### <a name="to-create-a-sales-employees-by-territory-user-role"></a>Создание пользовательской роли «Сотрудники отдела продаж по территории»  
  
1.  В SSDT откройте **модели** меню, а затем щелкните **ролей**.  
  
2.  В **диспетчер ролей**, нажмите кнопку **New**.  
  
    В список будет добавлена новая роль с разрешением «Нет».  
  
3.  Щелкните новую роль, а затем в **имя** столбец, переименуйте роль в **сотрудники отдела продаж по территории**.  
  
4.  В столбце **Разрешения** щелкните раскрывающийся список и выберите разрешение **Чтение** .  
  
5.  Нажмите кнопку **члены** , а затем щелкните **добавить**.  
  
6.  В **Выбор пользователя или группы** отображаемое в диалоговом окне **введите имя объекта для выбора**, введите имя пользователя первый пример, который использовался при создании таблицы EmployeeSecurity. Щелкните **Проверить имена** , чтобы убедиться в том, что имя является действительным, и нажмите кнопку **ОК**.  
  
    Повторите этот шаг, добавляя другие выборки имен пользователей, использованные при создании таблицы EmployeeSecurity.  
  
7.  Нажмите кнопку **фильтры строк** вкладки.  
  
8.  Для **EmployeeSecurity** таблицы, в **DAX-фильтр** столбца, введите следующую формулу:  
  
    ```
      =FALSE()  
    ```
  
    Эта формула указывает, что все столбцы решаются в логическое условие false. Столбцы из таблицы EmployeeSecurity не могут запрашиваться членами сотрудники отдела продаж по роли пользователя «Территория».  
  
9. Для **DimSalesTerritory** таблицы, введите следующую формулу:  

    ```  
    ='DimSalesTerritory'[SalesTerritoryKey]=LOOKUPVALUE('EmployeeSecurity'[SalesTerritoryId], 
      'EmployeeSecurity'[LoginId], USERNAME(), 
      'EmployeeSecurity'[SalesTerritoryId], 'DimSalesTerritory'[SalesTerritoryKey]) 
    ```
  
    В этой формуле функция LOOKUPVALUE возвращает все значения для столбца DimEmployeeSecurity [SalesTerritoryId], где EmployeeSecurity [LoginId] совпадает со значением текущего имени пользователя Windows, а EmployeeSecurity [SalesTerritoryId] — совпадает с DimSalesTerritory [SalesTerritoryId].  
  
    Набор территории продаж, идентификаторы, возвращенные функцией LOOKUPVALUE затем используется для ограничения строк, отображаемых в таблице DimSalesTerritory. Отображаются только строки, где SalesTerritoryID для строки входит в набор идентификаторов, возвращенных функцией LOOKUPVALUE.  
  
10. В диспетчере ролей нажмите кнопку **ОК**.  
  
## <a name="test-the-sales-employees-by-territory-user-role"></a>Тестирование пользовательской роли «Сотрудники отдела продаж по территории»  

В этой задаче вы использования функции анализ в Excel в SSDT, чтобы протестировать эффективность сотрудники отдела продаж по территории роли пользователя. Можно указать одно из имен пользователей, добавленных в таблицу EmployeeSecurity и как член роли. Это имя пользователя затем используется в качестве действующего имени пользователя в соединении между Excel и моделью.  
  
#### <a name="to-test-the-sales-employees-by-territory-user-role"></a>Тестирование пользовательской роли «Сотрудники отдела продаж по территории»  
  
1.  В SSDT откройте **модели** меню, а затем щелкните **анализ в Excel**.  
  
2.  В диалоговом окне **Анализ в Excel** в поле **Укажите имя пользователя или роль для подключения к модели**выберите вариант **Другой пользователь Windows**и нажмите кнопку **Обзор**.  
  
3.  В **Выбор пользователя или группы** отображаемое в диалоговом окне **введите имена выбираемых объектов**, введите имя пользователя, добавленных в таблицу EmployeeSecurity и нажмите кнопку **проверить имена**.  
  
4.  Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно **Выбор пользователя или группы** , а затем кнопку **ОК** , чтобы закрыть диалоговое окно **Анализ в Excel** .  
  
    Excel открывается новая книга. Сводная таблица создается автоматически. Список полей сводной таблицы включает большинство полей данных, доступных в новой модели.  
  
    Обратите внимание, что таблица EmployeeSecurity не отображается в списке полей сводной таблицы. Вы скрыли ее от клиентских средств в предыдущей задаче.  
  
5.  В **поля** раздела **∑ Интернет-продаж** (меры) выберите **InternetTotalSales** мер. Она вводится в **значения** поля.  
  
6.  Выберите **SalesTerritoryId** столбец из **DimSalesTerritory** таблицы. Он вводится в **метки строк** поля.  
  
    Обратите внимание, что цифры продаж появятся только для того региона, к которому относится имя пользователя. Если выбрать другой столбец, например города из таблицы DimGeography поле метки строки, отображаются только города на территории сбыта, к которой относится действующий пользователь.  
    Этот пользователь не может просмотреть или запросить данных Интернет-продаж для территорий, к которым они принадлежат. Это ограничение обусловлено определенный фильтр строк для таблицы DimSalesTerritory в сотрудники отдела продаж по территории роли пользователя, защищает все данные, относящиеся к другим территориям сбыта.  
  
## <a name="see-also"></a>См. также  

[функция USERNAME (DAX)](https://msdn.microsoft.com/library/hh230954.aspx)  
[функция LOOKUPVALUE (DAX)](https://msdn.microsoft.com/library/gg492170.aspx)  
[CUSTOMDATA, функция (DAX)](https://msdn.microsoft.com/library/hh213140.aspx)  
