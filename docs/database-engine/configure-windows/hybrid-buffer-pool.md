---
title: Гибридный буферный пул | Документация Майкрософт
ms.custom: ''
ms.date: 05/22/2019
ms.prod: sql
ms.prod_service: high-availability
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
ms.assetid: ''
author: DBArgenis
ms.author: argenisf
manager: jroth
ms.openlocfilehash: ce63196cb8a5c8791eb6440f69cf06194591f422
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "66785287"
---
# <a name="hybrid-buffer-pool"></a>Гибридный буферный пул
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

Гибридный буферный пул предоставляет ядру СУБД прямой доступ к страницам данных в файлах базы данных, хранимых на устройствах с постоянной памятью (PMEM). Эта функция появилась в [!INCLUDE[sqlv15](../../includes/sssqlv15-md.md)].

В традиционной системе без постоянной памяти SQL Server кэширует страницы данных в буферном пуле DRAM. С помощью гибридного буферного пула SQL Server пропускает копирование страницы в часть буферного пула на основе DRAM. Вместо этого он обращается к странице непосредственно в файле базы данных, которая находится на устройстве PMEM. Доступ к файлам данных на PMEM-устройствах для гибридного буферного пула выполняется с использованием режима MMIO. Это также называется *компонентом паравиртуализации* для файлов данных в SQL Server.

На PMEM-устройстве напрямую можно обратиться только к "чистым" страницам. Когда страница помечается как "грязная", она копируется в буферный пул DRAM, а затем записывается обратно на PMEM-устройство и снова помечается как "чистая". Этот процесс происходит во время регулярной операции создания контрольной точки.

Функция гибридного буферного пула доступна в Windows и Linux. PMEM-устройства должны быть отформатированы с использованием файловой системы, поддерживающей DAX (DirectAccess). DAX поддерживают файловые системы XFS, EXT4 и NTFS. SQL Server автоматически определит, если файлы данных находятся на соответствующим образом отформатированном устройстве с PMEM, и выполнит сопоставление памяти в пространстве пользователя. Такое сопоставление выполняется при запуске, при присоединении, восстановлении, создании новой базы данных или когда для базы данных включается гибридный буферный пул.

Дополнительные сведения о поддержке PMEM в Windows Server см. в описании [развертывания постоянной памяти в Windows Server](/windows-server/storage/storage-spaces/deploy-pmem/).

Дополнительные сведения о настройке SQL Server в Linux для PMEM-устройств см. в описании [развертывания постоянной памяти](../../linux/sql-server-linux-configure-pmem.md).

## <a name="enable-hybrid-buffer-pool"></a>Включение гибридного буферного пула

[!INCLUDE[sqlv15](../../includes/sssqlv15-md.md)] представляет язык DDL для управления гибридным буферным пулом.

В следующем примере гибридный буферный пул включается для экземпляра SQL Server:

```sql
ALTER SERVER CONFIGURATION SET MEMORY_OPTIMIZED HYBRID_BUFFER_POOL = ON;
```

По умолчанию гибридный буферный пул отключается на уровне экземпляра. Обратите внимание на то, чтобы изменения параметра вступили в силу, необходимо перезапустить экземпляр SQL Server. Перезапуск необходим для упрощения выделения достаточного числа хэш-страниц, чтобы учесть общую емкость PMEM на сервере.

В следующем примере гибридный буферный пул включается для конкретной базы данных.

```sql
ALTER DATABASE <databaseName> SET MEMORY_OPTIMIZED = ON;
```

По умолчанию гибридный буферный пул включается на уровне базы данных.

## <a name="disable-hybrid-buffer-pool"></a>Отключение гибридного буферного пула

В следующем примере гибридный буферный пул отключается для экземпляра SQL Server:

```sql
ALTER SERVER CONFIGURATION SET MEMORY_OPTIMIZED HYBRID_BUFFER_POOL = OFF;
```

По умолчанию гибридный буферный пул отключается на уровне экземпляра. Обратите внимание на то, чтобы изменения параметра вступили в силу, необходимо перезапустить экземпляр SQL Server. Перезапуск необходим, чтобы предотвратить выделение хэш-страниц, так как емкость PMEM на сервере не нужно учитывать.

В следующем примере гибридный буферный пул отключается для конкретной базы данных.

```sql
ALTER DATABASE <databaseName> SET MEMORY_OPTIMIZED = OFF;
```

По умолчанию гибридный буферный пул включается на уровне базы данных.

## <a name="view-hybrid-buffer-pool-configuration"></a>Просмотр конфигурации гибридного буферного пула

Следующий пример возвращает текущее состояние конфигурации системы гибридного буферного пула для экземпляра SQL Server.

```sql
SELECT *
FROM sys.configurations
WHERE
    name = 'hybrid_buffer_pool';
```

В следующем примере возвращаются две таблицы:

- Первая показывает текущее состояние конфигурации системы гибридного буферного пула для экземпляра SQL Server.
- Во второй перечислены базы данных и параметр уровня базы данных для гибридного буферного пула (`is_memory_optimized_enabled`).

```sql
SELECT * FROM sys.configurations WHERE name = 'hybrid_buffer_pool';

SELECT name, is_memory_optimized_enabled FROM sys.databases;
```

## <a name="best-practices-for-hybrid-buffer-pool"></a>Рекомендации по использованию гибридного буферного пула

Не рекомендуется включать гибридный буферный пул в экземплярах менее чем с 16 ГБ ОЗУ.

При форматировании PMEM-устройства в Windows используйте максимальный размер единицы размещения, доступный для файловой системы NTFS (2 МБ в Windows Server 2019), и отформатируйте устройство для DAX (Direct Access).

Размеры файлов должны быть кратны 2 МБ (деление по модулю на 2 МБ должно давать ноль).

Если параметр области сервера для гибридного буферного пула отключен, гибридный буферный пул не будет использоваться какой-либо пользовательской базой данных.

Если параметр области сервера для гибридного буфера включен, вы можете отключить использование гибридного буферного пула для отдельных пользовательских баз данных, выполнив для них действия по отключению гибридного буферного пула на уровне области базы данных.
