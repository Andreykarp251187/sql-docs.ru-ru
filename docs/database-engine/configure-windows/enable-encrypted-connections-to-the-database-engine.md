---
title: Включение зашифрованных соединений для ядра СУБД | Документы Майкрософт
ms.custom: ''
ms.date: 04/09/2019
ms.prod: sql
ms.prod_service: security
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- connections [SQL Server], encrypted
- SSL [SQL Server]
- Secure Sockets Layer (SSL)
- encryption [SQL Server], connections
- cryptography [SQL Server], connections
- certificates [SQL Server], installing
- requesting encrypted connections
- installing certificates
- security [SQL Server], encryption
ms.assetid: e1e55519-97ec-4404-81ef-881da3b42006
author: VanMSFT
ms.author: vanto
manager: jroth
ms.openlocfilehash: 210572e30dc1115fa52cfab4da293533a051d634
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "66767431"
---
# <a name="enable-encrypted-connections-to-the-database-engine"></a>Включение зашифрованных соединений для ядра СУБД
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

  В этом разделе описано, как активировать зашифрованные соединения для экземпляра компонента [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] , указав сертификат для компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] с помощью диспетчера конфигурации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Компьютеру сервера должен быть назначен сертификат, а компьютер клиента должен доверять корневому центру сертификации. Провизионирование — это процесс установки сертификата путем импорта сертификата в систему Windows.  
  
 Сертификат должен быть включен для **проверки подлинности сервера**. Имя сертификата должно быть полным доменным именем (FQDN) компьютера.  
  
 Сертификаты хранятся локально на пользовательских компьютерах. Чтобы установить сертификат для использования в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], необходимо запустить [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Configuration Manager с помощью учетной записи, обладающей правами локального администратора.

 Клиент должен уметь проверить принадлежность сертификата, используемого сервером. Если у клиента есть сертификат открытого ключа центра сертификации, который подписал сертификат сервера, то дальнейшее конфигурирование не требуется. [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows включает сертификаты открытого ключа нескольких центров сертификации. Если сертификат сервера был подписан общедоступным или частным центром сертификации, для которого у клиента нет сертификата открытого ключа, необходимо установить сертификат открытого ключа того центра сертификации, который подписал сертификат сервера.  
  
> [!NOTE]  
> Чтобы использовать шифрование в отказоустойчивом кластере, необходимо установить сертификат сервера с полным именем DNS виртуального сервера на все узлы отказоустойчивого кластера. Например, для кластера с двумя узлами — test1. *\<ваша организация>* .com и test2. *\<ваша организация>* .com — и виртуального сервера virtsql необходимо установить сертификат для virtsql. *\<ваша организация>* .com на оба узла. Параметру **ForceEncryption** можно присвоить значение **Да**.

> [!NOTE]
> При создании зашифрованного подключения для индексатора поиска Azure к SQL Server на виртуальной машине Azure см. раздел [Настройка подключения индексатора поиска Azure к SQL Server на виртуальной машине Azure](https://azure.microsoft.com/documentation/articles/search-howto-connecting-azure-sql-iaas-to-azure-search-using-indexers/). 

## <a name="certificate-requirements"></a>Требования к сертификатам

Для загрузки в SQL Server SSL-сертификат должен соответствовать следующим условиям:

- Сертификат должен находиться в хранилище сертификатов локального компьютера или текущего пользователя.
- Учетная запись службы SQL Server должна предоставлять соответствующие разрешения для доступа к SSL-сертификату.
- Текущее системное время должно превышать значение свойства сертификата **Действителен с** и не превышать значение свойства "Действителен до".
- Сертификат должен быть предназначен для проверки подлинности сервера. Для этого требуется задать свойству сертификата **Улучшенный ключ** значение **Проверка подлинности сервера (1.3.6.1.5.5.7.3.1)** .
- Сертификат должен быть создан с помощью параметра **KeySpec** свойства **AT_KEYEXCHANGE**. Обычно в свойстве применения ключа сертификата (**KEY_USAGE**) также предусмотрено шифрование ключа (**CERT_KEY_ENCIPHERMENT_KEY_USAGE**).
- Свойство **Субъект** сертификата должно указывать, что общее имя (CN) совпадает с именем узла или полным доменным именем (FQDN) сервера. Если SQL Server выполняется в отказоустойчивом кластере, то общее имя должно совпадать с именем узла или именем FQDN виртуального сервера, а сертификаты нужно предоставить всем узлам отказоустойчивого кластера.
- В SQL Server 2008 R2 и SQL Server 2008 R2 Native Client поддерживаются шаблоны сертификатов. Другие клиенты могут их не поддерживать. Дополнительные сведения см. в документации клиента и статье базы знаний [KB258858](http://support.microsoft.com/kb/258858).

## <a name="to-provision-install-a-certificate-on-the-server"></a>Назначение (установка) сертификата на сервер  

> [!NOTE]
> Сведения о добавлении сертификата на одном сервере см. в статье [Управление сертификатами (диспетчер конфигурации SQL Server)](manage-certificates.md).
  
1. В меню **Пуск** выберите команду **Выполнить**, в окне **Открыть** введите **MMC** и нажмите кнопку **ОК**.  
  
2. На консоли MMC в меню **Файл** выберите **Добавить или удалить оснастку**.  
  
3. В диалоговом окне **Добавление или удаление оснастки** нажмите кнопку **Добавить**.  
  
4. В диалоговом окне **Добавить изолированную оснастку** выберите **Сертификаты**и нажмите кнопку **Добавить**.  
  
5. В диалоговом окне **Оснастка диспетчера сертификатов** выберите **Учетная запись компьютера**и нажмите кнопку **Готово**.  
  
6. В диалоговом окне **Добавить изолированную оснастку** нажмите кнопку **Закрыть**.  
  
7. В диалоговом окне **Добавление или удаление оснастки** нажмите кнопку **ОК**.  
  
8. В оснастке **Сертификаты** последовательно разверните узлы **Сертификаты**и **Личное**, а затем правой кнопкой мыши щелкните **Сертификаты**, выберите **Все задачи**и нажмите кнопку **Импорт**.  

9. Щелкните правой кнопкой мыши импортированный сертификат, выберите пункт **Все задачи**, а затем нажмите кнопку **Управление закрытыми ключами**. В диалоговом окне **Безопасность** добавьте разрешение на чтение для учетной записи пользователя, используемой учетной записью службы SQL Server.  
  
10. Чтобы добавить сертификат на компьютер, выполните **Мастер импорта сертификатов**и закройте консоль MMC. Дополнительные сведения о добавлении сертификатов на компьютер см. в документации по Windows.  
  
## <a name="to-provision-install-a-certificate-across-multiple-servers"></a>Подготовка (установка) сертификата на нескольких серверах

> [!NOTE]
> Сведения о добавлении сертификата на нескольких серверах см. в статье [Управление сертификатами (диспетчер конфигурации SQL Server)](manage-certificates.md).

## <a name="to-export-the-server-certificate"></a>Экспорт сертификата сервера  
  
1. В оснастке **Сертификаты** найдите сертификат в папке **Сертификаты** / **Личное**, правой кнопкой мыши щелкните **Сертификат**, выберите **Все задачи** и нажмите **Экспорт**.  
  
2. Чтобы сохранить файл сертификата в удобном расположении, выполните **мастер экспорта сертификатов**.  
  
## <a name="to-configure-the-server-to-force-encrypted-connections"></a>Настройка принудительного использования зашифрованных соединений на сервере  
  
1. В **диспетчере конфигурации SQL Server** разверните узел **Сетевая конфигурация SQL Server**, щелкните правой кнопкой мыши элемент **Протоколы для** _\<экземпляр сервера>_ и выберите пункт **Свойства**.  
  
2. В диалоговом окне **Свойства** **протоколов для** _\<имя_экземпляра>_ на вкладке **Сертификат** выберите необходимый сертификат из раскрывающегося списка **Сертификат** и нажмите кнопку **ОК**.  
  
3. На вкладке **Флаги** в поле **ForceEncryption** выберите **Да**, затем нажмите кнопку **ОК** , чтобы закрыть диалоговое окно.  
  
4. Перезапустите службу [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  

> [!NOTE]
> Чтобы обеспечить безопасный обмен данными между клиентом и сервером, настройте клиент так, чтобы он запрашивал зашифрованные соединения. Дополнительные сведения приводятся [далее в этой статье](#to-configure-the-client-to-request-encrypted-connections).

### <a name="wildcard-certificates"></a>Групповые сертификаты

Начиная с версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 2008, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client поддерживают групповые сертификаты. Другие клиенты могут их не поддерживать. Дополнительные сведения см. в документации клиента. Групповые сертификаты не выбираются с помощью [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Configuration Manager. Чтобы использовать групповой сертификат, нужно изменить раздел реестра `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQLServer\SuperSocketNetLib` и ввести отпечаток сертификата без пробелов в качестве значения **Сертификат**.  

> [!WARNING]  
> [!INCLUDE[ssnoteregistry_md](../../includes/ssnoteregistry-md.md)]  

## <a name="to-configure-the-client-to-request-encrypted-connections"></a>Настройка клиента на прием зашифрованных соединений  

1. Скопируйте на компьютер клиента исходный сертификат или экспортированный файл сертификата.  
  
2. Чтобы установить корневой сертификат или экспортированный файл сертификата на клиентском компьютере, используйте оснастку **Сертификаты** .  
  
3. На панели консоли щелкните правой кнопкой мыши элемент **Конфигурация собственного клиента SQL Server**, затем нажмите **Свойства**.  
  
4. На странице **Флаги** в диалоговом окне **Принудительное шифрование протокола** выберите **Да**.  
  
## <a name="to-encrypt-a-connection-from-sql-server-management-studio"></a>Шифрование соединения из среды SQL Server Management Studio  
  
1. На панели инструментов обозревателя объектов нажмите кнопку **Соединить**и выберите **Компонент Database Engine**.  
  
2. В диалоговом окне **Соединение с сервером** введите все данные, необходимые для подключения, а затем нажмите **Параметры**.  
  
3. На вкладке **Свойства соединения** щелкните **Шифровать соединение**.  
  
## <a name="see-also"></a>См. также:

[Поддержка TLS 1.2 для Microsoft SQL Server](https://support.microsoft.com/kb/3135244)