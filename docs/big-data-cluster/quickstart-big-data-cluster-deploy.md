---
title: Скрипт развертывания
titleSuffix: SQL Server big data clusters
description: Пошаговое руководство по развертыванию кластеров больших данных SQL Server 2019 (Предварительная версия) в службе Azure Kubernetes (AKS).
author: MikeRayMSFT
ms.author: mikeray
ms.reviewer: mihaelab
ms.date: 07/24/2019
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: 7ff1ec3672fbcf101d98ad30913742186dea574d
ms.sourcegitcommit: 1f222ef903e6aa0bd1b14d3df031eb04ce775154
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2019
ms.locfileid: "68419403"
---
# <a name="deploy-sql-server-big-data-cluster-on-azure-kubernetes-service-aks"></a>Развертывание SQL Server кластера больших данных в службе Azure Kubernetes (AKS)

[!INCLUDE[tsql-appliesto-ssver15-xxxx-xxxx-xxx](../includes/tsql-appliesto-ssver15-xxxx-xxxx-xxx.md)]

В этом руководстве используется пример скрипта развертывания для развертывания кластера больших данных (Предварительная версия) SQL Server 2019 в службе Azure Kubernetes (AKS). 

> [!TIP]
> AKS — это только один вариант размещения Kubernetes для кластера больших данных. Дополнительные сведения о других вариантах развертывания, а также о настройке параметров развертывания см. в статье [развертывание SQL Server больших кластеров данных в Kubernetes](deployment-guidance.md).

Используемое по умолчанию развертывание кластера больших данных состоит из экземпляра SQL Server master, одного экземпляра пула вычислений, двух экземпляров пула данных и двух экземпляров пула носителей. Данные сохраняются с помощью постоянных томов Kubernetes, использующих классы хранения AKS по умолчанию. Конфигурация по умолчанию, используемая в этом руководстве, подходит для сред разработки и тестирования.

[!INCLUDE [Limited public preview note](../includes/big-data-cluster-preview-note.md)]

## <a name="prerequisites"></a>предварительные требования

- Подписка Azure.
- [Инструменты для обработки больших данных](deploy-big-data-tools.md):
   - **аздата**
   - **kubectl**
   - **Azure Data Studio**
   - **Расширение SQL Server 2019**
   - **Azure CLI**

## <a name="log-in-to-your-azure-account"></a>Вход в учетную запись Azure

Скрипт использует Azure CLI для автоматизации создания кластера AKS. Перед выполнением скрипта необходимо войти в учетную запись Azure с Azure CLI по крайней мере один раз. В командной строке выполните следующую команду.

```
az login
```

## <a name="download-the-deployment-script"></a>Скачать скрипт развертывания

Это руководство автоматизирует создание кластера больших данных на AKS с помощью **deploy-SQL-Big-Data-AKS.py**сценария Python. Если вы уже установили Python для **аздата**, вы можете успешно запустить сценарий в этом руководстве. 

В командной строке Bash Windows PowerShell или Linux выполните следующую команду, чтобы скачать скрипт развертывания из GitHub.

```
curl -o deploy-sql-big-data-aks.py "https://raw.githubusercontent.com/Microsoft/sql-server-samples/master/samples/features/sql-big-data-cluster/deployment/aks/deploy-sql-big-data-aks.py"
```

## <a name="run-the-deployment-script"></a>Запуск скрипта развертывания

Выполните следующие действия, чтобы запустить скрипт развертывания. Этот скрипт создаст службу AKS в Azure, а затем развернет кластер больших данных SQL Server 2019 в AKS. Можно также изменить скрипт с другими переменными [среды](deployment-guidance.md#configfile) , чтобы создать пользовательское развертывание.

1. Выполните сценарий с помощью следующей команды:

   ```
   python deploy-sql-big-data-aks.py
   ```

   > [!NOTE]
   > При наличии и python3, и python2 на клиентском компьютере и в пути необходимо выполнить команду с помощью python3: `python3 deploy-sql-big-data-aks.py`.

1. При появлении запроса введите следующие сведения.

   | Значение | Описание |
   |---|---|
   | **Идентификатор подписки Azure** | Идентификатор подписки Azure, используемый для AKS. Чтобы вывести список всех подписок и их идентификаторов, запустите `az account list` из другой командной строки. |
   | **Группа ресурсов Azure** | Имя группы ресурсов Azure, создаваемой для кластера AKS. |
   | **Регион Azure** | Регион Azure для нового кластера AKS (по умолчанию **westus**). |
   | **Размер компьютера** | [Размер компьютера](https://docs.microsoft.com/azure/virtual-machines/windows/sizes) , используемый для узлов в кластере AKS (по умолчанию **Standard_L8s**). |
   | **Рабочие узлы** | Число рабочих узлов в кластере AKS (по умолчанию **1**). |
   | **Имя кластера** | Имя кластера AKS и кластера больших данных. Имя кластера больших данных должно содержать только строчные буквы и цифры в нижнем регистре и без пробелов. (по умолчанию **склбигдата**). |
   | **Пароль** | Пароль для контроллера, шлюза HDFS/Spark и главного экземпляра (по умолчанию **MySQLBigData2019**). |
   | **Пользователь контроллера** | Имя пользователя контроллера (по умолчанию: **Admin**). |

Для участников программы раннего внедрения кластера больших данных SQL Server 2019 требуются следующие параметры: **Имя пользователя DOCKER**и **пароль DOCKER**. По мере выпуска CTP 3,2 они больше не требуются.

   > [!IMPORTANT]
   > Размер машины **Standard_L8s** по умолчанию может быть недоступен в каждом регионе Azure. Если вы выберете другой размер компьютера, убедитесь, что общее число дисков, которые могут быть подключены к узлам в кластере, больше или равно 24. Каждому утверждению постоянного тома в кластере требуется подключенный диск. В настоящее время для кластера больших данных требуется 24 постоянного объема утвержденных томов. Например, размер машины [Standard_L8s](https://docs.microsoft.com/azure/virtual-machines/windows/sizes-storage#lsv2-series) поддерживает 32 подключенных дисков, поэтому вы можете оценивать кластеры больших данных с одним узлом этого размера.

   > [!NOTE]
   > `sa` Учетная запись является системным администратором на экземпляре SQL Server master, который создается во время установки. После создания развертывания `MSSQL_SA_PASSWORD` переменную среды можно обнаружить, запустив `echo $MSSQL_SA_PASSWORD` в контейнере главного экземпляра. В целях безопасности измените `sa` пароль на главном экземпляре после развертывания. Дополнительные сведения см. [в разделе Изменение пароля SA](../linux/quickstart-install-connect-docker.md#sapassword).

1. Сценарий начнется с создания кластера AKS с указанными параметрами. Этот шаг займет несколько минут.

   <img src="./media/quickstart-big-data-cluster-deploy/script-parameters.png" width="800px" alt="Script parameters and AKS cluster creation"/>

## <a name="monitor-the-status"></a>Мониторинг состояния

После того как сценарий создаст кластер AKS, он будет устанавливать необходимые переменные среды с параметрами, указанными ранее. Затем он вызывает **аздата** для развертывания кластера больших данных в AKS.

В командном окне клиента будет выведено состояние развертывания. В процессе развертывания вы увидите ряд сообщений, в которых он ожидает модуль контроллера:

```output
2018-11-15 15:42:02.0209 UTC | INFO | Waiting for controller pod to be up...
```

Через 10 – 20 минут вы получите уведомления о том, что модуль контроллера работает:

```output
2018-11-15 15:50:50.0300 UTC | INFO | Controller pod is running.
2018-11-15 15:50:50.0585 UTC | INFO | Controller Endpoint: https://111.111.111.111:30080
```

> [!IMPORTANT]
> Полное развертывание может занять много времени из-за времени, необходимого для загрузки образов контейнеров для компонентов кластера больших данных. Однако это не должно занять несколько часов. При возникновении проблем с развертыванием см. статью [мониторинг и устранение неполадок SQL Server кластеров больших данных](cluster-troubleshooting-commands.md).

## <a name="inspect-the-cluster"></a>Проверка кластера

В любой момент во время развертывания можно использовать **kubectl** или **аздата** для проверки состояния и сведений о работающем кластере больших данных.

### <a name="use-kubectl"></a>Использование kubectl

Откройте новое командное окно, чтобы использовать **kubectl** в процессе развертывания.

1. Чтобы получить сводку состояния всего кластера, выполните следующую команду:

   ```
   kubectl get all -n <your-big-data-cluster-name>
   ```

   > [!TIP]
   > Если вы не изменили имя кластера больших данных, по умолчанию используется сценарий **склбигдата**.

1. Проверьте службы kubernetes и их внутренние и внешние конечные точки с помощью следующей команды **kubectl** :

   ```
   kubectl get svc -n <your-big-data-cluster-name>
   ```

1. Вы также можете проверить состояние модулей kubernetes с помощью следующей команды:

   ```
   kubectl get pods -n <your-big-data-cluster-name>
   ```

1. Ознакомьтесь с дополнительными сведениями о конкретном Pod с помощью следующей команды:

   ```
   kubectl describe pod <pod name> -n <your-big-data-cluster-name>
   ```

> [!TIP]
> Дополнительные сведения о мониторинге и устранении неполадок при развертывании см. в разделе [мониторинг и устранение неполадок SQL Server кластерах больших данных](cluster-troubleshooting-commands.md).

## <a name="connect-to-the-cluster"></a>Подключение к кластеру

После завершения скрипта развертывания выходные данные будут уведомлены об успешном выполнении:

```output
2018-11-15 16:10:25.0583 UTC | INFO | Cluster state: Ready
2018-11-15 16:10:25.0583 UTC | INFO | Cluster deployed successfully.
```

SQL Server кластер больших данных теперь развернут в AKS. Теперь для подключения к кластеру можно использовать Azure Data Studio. Дополнительные сведения см. в статье [Подключение к SQL Server кластеру больших данных с помощью Azure Data Studio](connect-to-big-data-cluster.md).

## <a name="clean-up"></a>Очистить

При тестировании SQL Server кластеров больших данных в Azure следует удалить кластер AKS по завершении, чтобы избежать непредвиденных расходов. Не удаляйте кластер, если планируется продолжать его использовать.

> [!WARNING]
> Следующие шаги слезами кластер AKS, который также удаляет SQL Server кластер больших данных. Если у вас есть базы данных или данные HDFS, которые необходимо удерживать, перед удалением кластера их следует вернуть.

Выполните следующую команду Azure CLI, чтобы удалить кластер больших данных и службу AKS в Azure (замените `<resource group name>` **группой ресурсов Azure** , указанной в скрипте развертывания):

```azurecli
az group delete -n <resource group name>
```

## <a name="next-steps"></a>Следующие шаги

В скрипте развертывания настроена служба Kubernetes Azure, а также развернут кластер больших данных SQL Server 2019. Можно также настроить будущие развертывания с помощью ручных установок. Дополнительные сведения о развертывании кластеров больших данных, а также о настройке развертываний см. в статье [развертывание SQL Server кластеров больших данных в Kubernetes](deployment-guidance.md).

Теперь, когда развернут SQL Server кластер больших данных, вы можете загрузить демонстрационные данные и изучить учебники:

> [!div class="nextstepaction"]
> [Учебник. Загрузка демонстрационных данных в кластер больших данных SQL Server 2019](tutorial-load-sample-data.md)