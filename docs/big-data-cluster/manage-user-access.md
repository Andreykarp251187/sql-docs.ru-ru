---
title: Управление доступом к кластеру больших данных в режиме AD DS
description: Управление доступом к кластеру больших данных
author: NelGson
ms.author: negust
ms.reviewer: mikeray
ms.date: 12/06/2019
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: 9f9cca7e761b8f8ec3f5b87e9a195a0eb8b5da6d
ms.sourcegitcommit: ff82f3260ff79ed860a7a58f54ff7f0594851e6b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2020
ms.locfileid: "76259462"
---
# <a name="manage-big-data-cluster-access-in-active-directory-mode"></a>Управление доступом к кластеру больших данных в режиме AD DS

[!INCLUDE[tsql-appliesto-ssver15-xxxx-xxxx-xxx](../includes/tsql-appliesto-ssver15-xxxx-xxxx-xxx.md)]

В этой статье описывается, как обновить группы AD DS, предоставляемые во время развертывания для clusterAdmins и clusterUsers.

## <a name="two-overarching-roles-in-the-big-data-cluster"></a>Две ключевые роли в кластере больших данных

Группы AD DS предоставляются в разделе безопасности профиля развертывания как часть двух ключевых ролей для авторизации в кластере больших данных:

* `clusterAdmins`: этот параметр принимает одну группу AD DS. Члены этой группы получают разрешения администратора для всего кластера. Они имеют разрешения *sysadmin* в SQL Server, *superuser* в распределенной файловой системе Hadoop (HDFS) и Spark, а также права *администратора* в контроллере.

* `clusterUsers`: эти группы AD DS являются обычными пользователями без прав администратора в кластере. У них есть разрешения на вход в главный экземпляр SQL Server, но по умолчанию они не имеют разрешений на доступ к объектам или данным.

Один из способов предоставления группам AD DS дополнительных разрешений на кластер больших данных после развертывания — добавить пользователей и группы в уже назначенные группы во время развертывания. 

Однако администраторы не всегда могут изменять членство в группах в AD DS. Чтобы предоставить группам AD DS дополнительные разрешения без изменения членства в группах в AD DS, выполните процедуры, описанные в следующих разделах.

## <a name="grant-administrator-permissions-to-additional-active-directory-groups"></a>Предоставление разрешений администратора для дополнительных групп AD DS

>[!IMPORTANT]
>Эта процедура не предоставляет дополнительным группам AD DS доступ администратора к компонентам Hadoop, таким как HDFS и Spark, в кластере больших данных. Эти компоненты разрешают только одну группу AD DS в качестве группы суперпользователя. Это ограничение означает, что группа, указанная в `clusterAdmins` во время развертывания, остается группой суперпользователя даже после этого шага.

Выполнив процедуры, описанные в этом разделе, можно предоставить доступ администратора к контроллеру и главному экземпляру SQL Server.

### <a name="create-a-login-for-the-active-directory-user-or-group-in-the-sql-server-master-instance"></a>Создание имени входа для пользователя AD DS или группы в главном экземпляре SQL Server 

1. Подключитесь к главной конечной точке SQL с использованием избранного клиента SQL. Используйте любое имя входа администратора (например `AZDATA_USERNAME`, которое было предоставлено во время развертывания). Кроме того, это может быть любая учетная запись AD DS, которая входит в группу AD DS, предоставленную как `clusterAdmins` в конфигурации безопасности.

1. Чтобы создать имя входа для пользователя или группы AD DS, выполните следующую команду TSQL:

   ```sql
   CREATE LOGIN [<domain>\<principal>] FROM WINDOWS;
   ```

   При предоставлении разрешений администратора в экземпляре SQL Server также предоставьте следующее разрешение:

   ```sql
   ALTER SERVER ROLE sysadmin ADD MEMBER [<domain>\<principal>];
   GO
   ```

### <a name="add-the-active-directory-user-or-group-to-the-roles-table-in-the-controller-database"></a>Добавление пользователя или группы AD DS в таблицу ролей в базе данных контроллера 

1. Получите учетные данные SQL Server контроллера, выполнив следующие команды:

   а. Выполните эту команду от имени администратора Kubernetes:

   ```bash
   kubectl get secret controller-sa-secret -n <cluster name> -o yaml | grep password
   ```

   b. Декодируйте секрет из кодировки Base64.

   ```bash
   echo <password from kubectl command>  | base64 --decode && echo
   ```

1. В отдельном командном окне предоставьте порт сервера базы данных контроллера:

   ```bash
   kubectl port-forward controldb-0 1433:1433 --address 0.0.0.0 -n <cluster name>
   ```

1. Используйте предыдущее подключение для вставки строки в таблицу ролей. Введите значение *REALM* в формате верхнего регистра.

   Если вы предоставляете разрешения администратора, используйте роль *bdcAdmin* в *\<имя роли>* . Для пользователей, не являющихся администраторами, используйте роль *bdcUser*.

   ```sql
   USE controller;
   GO

   INSERT INTO [controller].[auth].[roles] VALUES (N'<user or group name>@<REALM>', N'<role name>')
   GO
   ```

1. Убедитесь, что добавленные члены группы имеют разрешения администратора для кластера больших данных, войдя в конечную точку контроллера и выполнив следующую команду:

   ```bash
   azdata bdc config show
   ```

1. Для пользователей, не являющихся администраторами, доступ можно проконтролировать, проверив подлинность в главном экземпляре SQL или контроллере с помощью `azdata login`.

## <a name="next-steps"></a>Дальнейшие действия

- [Основные понятия безопасности для работы с кластерами больших данных SQL Server 2019](concept-security.md)
