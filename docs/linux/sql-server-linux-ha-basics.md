---
title: Основные сведения о доступности SQL Server для Linux развертываний
description: ''
author: MikeRayMSFT
ms.author: mikeray
ms.reviewer: vanto
manager: jroth
ms.date: 11/27/2017
ms.topic: conceptual
ms.prod: sql
ms.technology: linux
ms.openlocfilehash: 203fad6aa3c39d57446738b9c74631fe114c609e
ms.sourcegitcommit: 93d1566b9fe0c092c9f0f8c84435b0eede07019f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67833566"
---
# <a name="sql-server-availability-basics-for-linux-deployments"></a>Основные сведения о доступности SQL Server для Linux развертываний

[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-linuxonly](../includes/appliesto-ss-xxxx-xxxx-xxx-md-linuxonly.md)]

Начиная с [!INCLUDE[sssql17-md](../includes/sssql17-md.md)], [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] поддерживается в Windows и Linux. На базе Windows, такие как [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] развертываний, [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] баз данных и экземпляров должны быть высокодоступной под Linux. В этой статье рассматриваются технические аспекты планирование и развертывание высокой доступности на платформе Linux [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] баз данных и экземпляров, а также некоторые отличия от установок на основе Windows. Так как [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] могут быть новыми для специалистов по Linux и Linux могут быть новыми для [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] -специалистов, в этой статье, в некоторых случаях представлены основные понятия, которые могут быть знакомы некоторые и не знакомы с другими.

## <a name="includessnoversion-mdincludesssnoversion-mdmd-availability-options-for-linux-deployments"></a>[!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] Параметры доступности для развертывания Linux
Помимо резервного копирования и восстановления те же три функции доступности доступны в Linux для развертывания на основе Windows.
-   Группах доступности AlwaysOn (группами доступности)
-   Экземпляры отказоустойчивого кластера (FCI) AlwaysOn
-   [Доставка журналов](sql-server-linux-use-log-shipping.md)

В Windows экземпляры отказоустойчивого кластера всегда требуется базовый кластер отработки отказа Windows Server (WSFC). В зависимости от сценария развертывания, группе Доступности обычно требуется базовый кластер WSFC, за исключением, что новый None variant в [!INCLUDE[sssql17-md](../includes/sssql17-md.md)]. WSFC не существует в Linux. Кластеризация реализации в Linux см. в разделе [экземпляров Pacemaker для групп доступности AlwaysOn и отказоустойчивые кластеры в Linux](#pacemaker-for-always-on-availability-groups-and-failover-cluster-instances-on-linux).

## <a name="a-quick-linux-primer"></a>Краткое руководство Linux
Хотя в некоторых установках Linux могут устанавливаться с интерфейсом, большинство не, это означает, что почти все, что на уровне операционной системы выполняется с помощью командной строки. Общий термин для этой командной строки в мире Linux *оболочку bash*.

В Linux многие команды необходимо выполнить с повышенными привилегиями, примерно так же, что многие задачи необходимо выполнить в Windows Server с правами администратора. Существует два основных метода для выполнения с повышенными привилегиями:
1. Выполняются в контексте пользователя, правильное. Чтобы изменить на другого пользователя, используйте команду `su`. Если `su` выполняться сама по себе без имени пользователя, до тех пор, пока вы знаете пароль, теперь можно в оболочку *корневой*.
   
2. Дополнительные общие и безопасности понимали, каким способом запуска действия является использование `sudo` перед выполнением ничего. Во многих примерах в этой статье используется `sudo`.

Некоторые распространенные команды, каждый из которых имеют различные параметры и параметры, которые могут быть изучены через Интернет:
-   `cd` -Перейдите в каталог
-   `chmod` -Измените разрешения файла или каталога
-   `chown` -сменить владельца файла или каталога
-   `ls` -Показать содержимое каталога
-   `mkdir` -Создайте папку (каталог) на диске
-   `mv` -Перемещение файла из одного расположения в другое
-   `ps` -Показать все процессы работы
-   `rm` — удалить файл локально на сервере
-   `rmdir` -удалить папку (каталог)
-   `systemctl` — Запуск, остановка или включить службы
-   Текст команд редактора. В Linux существуют различные параметры текстового редактора, например vi, emacs.

## <a name="common-tasks-for-availability-configurations-of-includessnoversion-mdincludesssnoversion-mdmd-on-linux"></a>Распространенные задачи по конфигурации доступности [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] на платформе Linux
В этом разделе рассматриваются задачи, которые являются общими для всех под управлением Linux [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] развертываний.

### <a name="ensure-that-files-can-be-copied"></a>Убедитесь, что можно скопировать файлы
Копирование файлов с одного сервера на другой — это задача, необходимая любому пользователю с помощью [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] в Linux должен иметь возможность сделать. Эта задача очень важно для конфигураций группы Доступности.

Например проблем с разрешениями могут существовать в Linux, а также на установок на основе Windows. Тем не менее если вы знакомы с тем, как копировать с одного сервера на Windows может не быть знакомы с как это делается в Linux. Распространенный способ — использовать программу командной строки `scp`, который обозначает безопасного копирования. На самом деле `scp` использует OpenSSH. SSH — это безопасное оболочки. В зависимости от дистрибутива Linux OpenSSH, сам не могут быть установлены. Если это не так, необходимо сначала установить OpenSSH. Дополнительные сведения о настройке OpenSSH см. сведения в статье приведены ссылки на каждое распределение:
-   [Red Hat Enterprise Linux (RHEL)](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/deployment_guide/ch-openssh)
-   [SUSE Linux Enterprise Server (SLES)](https://en.opensuse.org/SDB:Configure_openSSH)
-   [Ubuntu](https://help.ubuntu.com/community/SSH/OpenSSH/Configuring)

При использовании `scp`, необходимо указать учетные данные сервера, если это не источник или назначение. Например с помощью

```bash
scp MyAGCert.cer username@servername:/folder/subfolder
```

копирует файл MyAGCert.cer папка, указанная на другом сервере. Обратите внимание, что необходимо иметь разрешения — и, возможно, владение - файл, чтобы скопировать его, поэтому `chown` может также необходимо применять перед копированием. Аналогичным образом на принимающей стороне нужному пользователю требуется доступ к работы файлом. Например, чтобы восстановить этот файл сертификата `mssql` пользователь должен быть получить к ним доступ.

Samba, которая является вариант блок сообщений сервера (SMB) для Linux, можно также использовать для создания общих ресурсов, таких как доступ к UNC-пути `\\SERVERNAME\SHARE`. Дополнительные сведения о настройке Samba см. сведения в статье приведены ссылки на каждое распределение:
-   [RHEL](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Managing_Confined_Services/chap-Managing_Confined_Services-Samba.html)
-   [SLES](https://www.suse.com/documentation/sles11/book_sle_admin/data/cha_samba.html)
-   [Ubuntu](https://help.ubuntu.com/community/Samba)

Также можно использовать общие папки SMB на базе Windows; Общие ресурсы SMB не обязательно должны быть под управлением Linux, до тех пор, пока клиентская часть Samba правильно настроены на сервере Linux, где размещен [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] и общей папки имеет права доступа. Для тех, в смешанной среде, это будет один из способов использовать существующую инфраструктуру для под управлением Linux [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] развертываний.

Одну вещь, важно — что версию Samba развертывания должно быть совместимым SMB 3.0. При добавлении поддержки SMB в [!INCLUDE[sssql11-md](../includes/sssql11-md.md)], требовалось, чтобы все общие папки для поддержки SMB 3.0. Если с помощью Samba для общего ресурса и не Windows Server, под управлением Samba общей папки следует использовать Samba 4.0 или более поздней версии и в идеале 4.3 или более поздней версии, который поддерживает SMB 3.1.1. Хорошим источником информации о SMB и Linux будет [SMB3 в Samba](https://events.linuxfoundation.org/sites/events/files/slides/smb3-in-samba.pr__0.pdf).

Наконец с помощью общей сетевой папки системы (NFS) — это вариант. С помощью NFS не подходит для развертываний на основе Windows из [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]и может использоваться только для развертываний на основе Linux.

### <a name="configure-the-firewall"></a>Настройка брандмауэра
Как и в Windows, дистрибутивы Linux имеет встроенный брандмауэр. Если ваша организация использует внешнего брандмауэра на серверах, отключение брандмауэры в Linux может быть приемлемым. Тем не менее независимо от того, где включен брандмауэр, порты необходимо открыть. В следующей таблице приведены общие порты, необходимые для высокой доступности [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] развертываний на платформе Linux.

| Номер порта | Type     | Описание                                                                                                                 |
|-------------|----------|-----------------------------------------------------------------------------------------------------------------------------|
| 111         | TCP/UDP  | NFS- `rpcbind/sunrpc`                                                                                                    |
| 135         | TCP      | Samba (если используется) - конечных точек                                                                                          |
| 137         | UDP      | Samba (если используется) - службы NetBIOS-имя                                                                                      |
| 138         | UDP      | Samba (если используется) - датаграмм NetBIOS                                                                                          |
| 139         | TCP      | Samba (если используется) - сеанса NetBIOS                                                                                           |
| 445         | TCP      | Samba (если используется) - SMB через TCP                                                                                              |
| 1433        | TCP      | [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] — порт; по умолчанию При необходимости можно изменить с помощью `mssql-conf set network.tcpport <portnumber>`                       |
| 2049        | TCP, UDP | NFS (если используется)                                                                                                               |
| 2224        | TCP      | Pacemaker — используемый `pcsd`                                                                                                |
| 3121        | TCP      | Pacemaker — требуется, если есть Pacemaker удаленным узлам                                                                    |
| 3260        | TCP      | Инициатор (если используется) - iSCSI может быть изменен в `/etc/iscsi/iscsid.config` (RHEL), но должен совпадать с портом цели iSCSI |
| 5022        | TCP      | [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] -по умолчанию порт, используемый для конечной точки группы Доступности; можно изменить при создании конечной точки                                |
| 5403        | TCP      | Pacemaker                                                                                                                   |
| 5404        | UDP      | Pacemaker — необходимые Corosync при использовании многоадресной рассылки UDP                                                                     |
| 5405        | UDP      | Pacemaker — необходимый Corosync                                                                                            |
| 21064       | TCP      | Pacemaker — необходимые ресурсы, используя диспетчер загрузки                                                                                 |
| Переменная    | TCP      | Порт конечной точки группы Доступности; значение по умолчанию — 5022                                                                                           |
| Переменная    | TCP      | NFS - порт для `LOCKD_TCPPORT` (в `/etc/sysconfig/nfs` на RHEL)                                              |
| Переменная    | UDP      | NFS - порт для `LOCKD_UDPPORT` (в `/etc/sysconfig/nfs` на RHEL)                                              |
| Переменная    | TCP/UDP  | NFS - порт для `MOUNTD_PORT` (в `/etc/sysconfig/nfs` на RHEL)                                                |
| Переменная    | TCP/UDP  | NFS - порт для `STATD_PORT` (в `/etc/sysconfig/nfs` на RHEL)                                                 |

Дополнительные порты, которые могут использоваться Samba, см. в разделе [использование порта Samba](https://wiki.samba.org/index.php/Samba_Port_Usage).

И наоборот имя службы в соответствии с Linux можно также добавить исключение, а не порта; например `high-availability` для Pacemaker. Ссылаться на распределение для имен, если это направление, в которую вы хотите продолжить. Например является команда, добавляемая в Pacemaker на RHEL

```bash
sudo firewall-cmd --permanent --add-service=high-availability
```

**Документации по брандмауэру:**
-   [RHEL](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/high_availability_add-on_reference/s1-firewalls-haar)
-   [SLES](https://www.suse.com/documentation/sle-ha-12/singlehtml/book_sleha/book_sleha.html)

### <a name="install-includessnoversion-mdincludesssnoversion-mdmd-packages-for-availability"></a>Установка [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] пакетов для обеспечения доступности
На основе Windows [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] установки, некоторые компоненты установлены даже при установке базовый механизм, а другие нет. Под Linux, только [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] engine устанавливается как часть процесса установки. Все остальное не является обязательным. Для высокой доступности [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] экземпляры под Linux должен устанавливаться два пакета с [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]: [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] Агент (*mssql-server-agent*) и высокий уровень доступности (HA) пакет (*mssql-server-ha*). Хотя [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] агента — это технически необязательно, это [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]в планировщик заданий и необходим при доставке журналов, поэтому рекомендуется выбирать установку. Для установок на основе Windows [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] агента не является необязательным.

>[!NOTE]
>Для тех, Кому [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)], [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] агент [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]встроенные задания планировщика. Он является стандартным способом для администраторов баз данных запланировать резервное копирование и другие [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] обслуживания. В отличие от установки на основе Windows из [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] где [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] — это совершенно разные служба на платформе Linux, [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] агент выполняется в контексте [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] сам.

При настройке групп доступности или экземпляры отказоустойчивого кластера в конфигурации на основе Windows, они являются кластеры. Поддержка кластеров означает, что [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] имеет конкретный ресурс библиотеки DLL, которые известны кластере WSFC (файл sqagtres.dll и sqsrvres.dll для экземпляров отказоустойчивого кластера, hadrres.dll для групп доступности) и используемых WSFC, чтобы убедиться, что [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] кластеризованный функциональные возможности, запущена, и работает ли надлежащим образом. Так как кластеризация внешних не только к [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] , но сам Linux, Майкрософт требовалось закодировать эквивалент библиотеку DLL ресурсов для развертывания на платформе Linux группы Доступности и экземпляра отказоустойчивого Кластера. Это *mssql-server-ha* пакет, также известный как [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] агент ресурсов для Pacemaker. Чтобы установить *mssql-server-ha* пакета, см. в разделе [установить пакеты высокий уровень ДОСТУПНОСТИ и агента SQL Server](sql-server-linux-deploy-pacemaker-cluster.md#install-the-sql-server-ha-and-sql-server-agent-packages).

Дополнительные пакеты для [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] в Linux, [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] Full-Text Search (*mssql-server-fts*) и [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] служб Integration Services (*mssql-server находится*), не являются требуется для обеспечения высокой доступности, для экземпляра отказоустойчивого Кластера или группе Доступности.

## <a name="pacemaker-for-always-on-availability-groups-and-failover-cluster-instances-on-linux"></a>Pacemaker для групп доступности AlwaysOn и экземпляров отказоустойчивых кластеров в Linux
Как в предыдущих отмечалось, Pacemaker с использованием Corosync — это единственный механизм кластеризации, в настоящее время поддерживается корпорацией Майкрософт для групп доступности и экземпляров отказоустойчивого кластера. В этом разделе рассматриваются основные сведения, чтобы понять решения, а также о планировании и развернуть его для [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] конфигураций.

### <a name="ha-add-onextension-basics"></a>Основы add on/расширение высокого уровня ДОСТУПНОСТИ
Все поддерживаемые в настоящее время дистрибутивы поставлять высокого уровня доступности add-on/расширение, основанное на Pacemaker, кластеризация стека. Этот стек включает два ключевых компонента: Pacemaker и Corosync. Ниже перечислены все компоненты стека.
-   Pacemaker - core, кластеризация компонент, который выполняет действия, например координат кластеризованных компьютеров.
-   Corosync - инфраструктуру и набор API, которые предоставляет такие объекты, например кворума, возможность Сбой перезапуска процессов и т. д.
-   libQB - предоставляет такие объекты, такие как ведение журнала.
-   Агент ресурсов — конкретные функции, обеспечиваемые таким образом, чтобы приложение можно интегрировать с Pacemaker.
-   Забора агента - сценариев и функций, которые дали узлов и работать с ними, если они возникают проблемы.
    
> [!NOTE]
> Стек кластера часто называют Pacemaker в Linux мире.

Это решение является в некотором роде сходно, но во многих отношениях отличается от процесса развертывания кластеризованных конфигураций, с помощью Windows. В Windows форма доступности — кластеризация, вызывается отказоустойчивый кластер Windows Server (WSFC), встроены в операционную систему и функцию, которая позволяет создавать WSFC, отказоустойчивой кластеризацией, по умолчанию отключена. В Windows, устанавливаются поверх WSFC групп доступности и экземпляров отказоустойчивого кластера и совместно использовать тесную интеграцию из-за определенного ресурса библиотеки DLL, которая обеспечивается [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]. Это решение тесно связанные возможна в общем и целом, так как это все, от одного поставщика.

![](./media/sql-server-linux-ha-basics/image1.png)

В Linux хотя каждый поддерживаемый дистрибутив имеет доступные, Pacemaker каждого распределения можно настраивать и вариантов реализации и версий. Некоторые различия будут отражены в инструкциях в этой статье. Кластеризации слой имеет открытый исходный код, поэтому несмотря на то, что она поставляется с распределениями, оно не интегрировано тесно таким же образом WSFC в Windows. Именно поэтому корпорация Майкрософт предоставляет *mssql-server-ha*, так что [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] и Pacemaker стека может предоставить близко к, но не совсем так же, взаимодействие с группами доступности и экземпляров отказоустойчивого кластера в группе Windows.

Полную документацию по Pacemaker в том числе более подробное объяснение того, что все, что с Полные справочные сведения для RHEL и SLES:
-   [RHEL](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/ch-overview-HAAR.html)
-   [SLES](https://www.suse.com/documentation/sle_ha/book_sleha/data/book_sleha.html)

Ubuntu имеет структуру для доступности.

Дополнительные сведения о стеке целиком, также доступны на официальном [страницы документации Pacemaker](https://clusterlabs.org/doc/) на сайте Clusterlabs.

### <a name="pacemaker-concepts-and-terminology"></a>Pacemaker основные понятия и терминология
В этом разделе описываются общие понятия и терминология для реализации Pacemaker.

#### <a name="node"></a>Узел
Узел — это сервер, участвующих в кластере. Кластер Pacemaker изначально поддерживает до 16 узлов. Это число может быть превышено, если Corosync не запущена на дополнительных узлах, но требуется для Corosync [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]. Таким образом, максимальное количество узлов, кластер может иметь для любого [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]-на основе конфигурации — 16; это ограничение Pacemaker и не имеет ничего общего с максимальные ограничения для групп доступности или экземпляры отказоустойчивого кластера, накладываемые [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]. 

#### <a name="resource"></a>Resource
WSFC и Pacemaker кластера существует понятие ресурса. Ресурс — определенные функции, который выполняется в контексте кластера, например диск или IP-адресом. Например в разделе Pacemaker можно создаются ресурсы отказоустойчивого Кластера и группы Доступности. Это не аспектах что происходит в кластере WSFC, где встречается [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] ресурсов либо экземпляра отказоустойчивого кластера или ресурс группы Доступности, при настройке группы Доступности, но будет отличаться из-за базовых различий в том, как [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] интегрируется с Pacemaker.

Pacemaker имеет ресурсы "стандартный" и клона. Ресурсы клон — это приложения, выполняемых одновременно на всех узлах. Примером может служить IP-адресом, который выполняется на нескольких узлах для балансировки нагрузки. Любой ресурс, который создается для FCI использует стандартный ресурс, так, как только один узел может содержать экземпляр отказоустойчивого Кластера в любой момент времени.

При создании группы Доступности, требуется специализированной разновидностью клонирования ресурсу с именем ресурса несколькими состояниями. Хотя группа Доступности имеет только одну первичную реплику, группы Доступности, сама выполняется на всех узлах, на котором он настроен для работы на и позволяет такие вещи, такие как доступ только для чтения. Так как это «live» use узла, ресурсы имеют концепцию два состояния: главный и подчиненный. Дополнительные сведения см. в разделе [несколькими состояниями ресурсы: Ресурсы, которые имеют несколько режимов](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Configuring_the_Red_Hat_High_Availability_Add-On_with_Pacemaker/s1-multistateresource-HAAR.html).

#### <a name="resource-groupssets"></a>Наборы групп ресурсов
Как и ролей в кластере WSFC, кластер Pacemaker использует концепцию группу ресурсов. Группа ресурсов (называется набором в SLES) — это коллекция ресурсов, которые работать вместе и выполнить отработку отказа с одного узла на другой как единое целое. Группы ресурсов не может содержать ресурсы, которые настроены как ведущий/ведомый; Таким образом они не может использоваться для групп доступности. Хотя можно использовать группу ресурсов для экземпляров отказоустойчивого кластера, это не обычно рекомендуемой конфигурацией.

#### <a name="constraints"></a>Ограничения
Кластеров Wsfc имеют различные параметры для ресурсов, а также такие зависимости, которые настраивают WSFC иерархическое отношение между двумя ресурсами на разных. Зависимость — просто это правило, о том WSFC, какой ресурс должен сначала быть в сети.

Кластер Pacemaker не поддерживает концепцию зависимостей, но существуют ограничения. Существует три типа ограничений: совместное размещение, расположение и порядок.
-   Совместное размещение ограничение обеспечивает ли два ресурса должен выполняться на одном узле.
-   Ограничение расположения сообщает кластера Pacemaker, где ресурс может (или не может) выполняться.
-   Ограничения упорядочивания сообщает кластера Pacemaker порядок, в котором следует начать ресурсы.

> [!NOTE]
> Ограничения совместного размещения не являются обязательными для ресурсов в группе ресурсов, так как все они рассматриваются как единое целое.

#### <a name="quorum-fence-agents-and-stonith"></a>Кворум, граница агенты и STONITH
Кворум в Pacemaker подобны WSFC концепцией. Механизм кворума кластера специально чтобы убедиться, что кластер остается приступить к работе. WSFC и надстройки высокого уровня ДОСТУПНОСТИ для дистрибутивов Linux существует понятие голосования, где каждый узел учитывается при подсчете кворума. Необходимо большинство голосов, в противном случае в худшем случае, кластера будет завершена.

В отличие от кластера WSFC отсутствует ресурс следящий сервер для работы с кворумом. Как и в кластере WSFC целью является свести число нечетное избиратели. Конфигурация кворума имеет различные рекомендации для групп доступности, чем экземпляры отказоустойчивого кластера.

Наблюдение за состоянием узлов, участвующих кластеров Wsfc и их обработки при возникновении проблемы. Более поздних версиях кластеров Wsfc обеспечивают такие функции, как помещение в карантин узла, который является неправильным поведением или недоступен (отсутствует на узле, сетевого взаимодействия — вниз и т. д.). На стороне Linux агент разграничения предоставляется функции этого типа. Принцип, иногда называется ограждения. Тем не менее эти агенты граница относятся к развертыванию и часто предоставленный поставщикам оборудования и некоторые поставщики программного обеспечения, например тех, кто предоставляют низкоуровневые оболочки. Например VMware предоставляет агент ограждения, который может использоваться для виртуальных машин Linux, виртуализованных с помощью vSphere.

Кворума ограждения связями в еще одно понятие вызывается STONITH и устранение неисправностей Other Node в заголовке. STONITH необходим для поддерживаемых кластера Pacemaker на всех дистрибутивов Linux. Дополнительные сведения см. в разделе [ограждения в кластере высокой доступности Red Hat](https://access.redhat.com/solutions/15575) (RHEL).

#### <a name="corosyncconf"></a>corosync.conf
`corosync.conf` Файл содержит конфигурацию кластера. Он расположен в `/etc/corosync`. Во время Рутинная эксплуатация этот файл никогда не должны редактироваться, если кластер настроен правильно.

#### <a name="cluster-log-location"></a>Расположение журнала кластера
Расположение журнала для кластеров Pacemaker, зависят от распределения.
-   RHEL и SLES- `/var/log/cluster/corosync.log`
-   Ubuntu: `/var/log/corosync/corosync.log`

Чтобы изменить расположение по умолчанию для ведения журнала, измените `corosync.conf`.

## <a name="plan-pacemaker-clusters-for-includessnoversion-mdincludesssnoversion-mdmd"></a>Планирование кластеров Pacemaker для [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]
В этом разделе рассматриваются важные моменты планирования для кластера Pacemaker.

### <a name="virtualizing-linux-based-pacemaker-clusters-for-includessnoversion-mdincludesssnoversion-mdmd"></a>Кластеры виртуализации под управлением Linux Pacemaker для [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]
С помощью виртуальных машин для развертывания на платформе Linux [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] развертываний для групп доступности и экземпляров отказоустойчивого кластера, связанная с тем же правилам, что и для их аналоги на базе Windows. Имеется базовый набор правил для поддержки виртуализованной [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] развертываний, предоставленных корпорацией Майкрософт в [956893 базы Знаний Майкрософт поддержка](https://support.microsoft.com/help/956893/support-policy-for-microsoft-sql-server-products-that-are-running-in-a-hardware-virtualization-environment). Различные низкоуровневых оболочек, таких как Microsoft Hyper-V и VMware ESXi могут иметь различные дисперсии поверх всего этого, из-за различий в платформах, сами.

Что касается групп доступности и экземпляров отказоустойчивого кластера в условиях виртуализации, убедитесь, что для узлов данного кластера Pacemaker близости. При настройке для обеспечения высокой доступности в конфигурации группы Доступности или экземпляра отказоустойчивого Кластера виртуальных машин, содержащих [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] никогда не должен выполняться на одном узле низкоуровневой оболочки. Например, при развертывании двух узлов отказоустойчивого Кластера, то потребуется *по крайней мере* три узлы низкоуровневой оболочки, поэтому, где-то одной из виртуальных машин, содержащих узел, чтобы перейти в случае сбоя узла, особенно в том случае, если используете функции, такие как Live Миграция или vMotion.

Дополнительные сведения см.:
-   Документация по Hyper-V — [использование гостевой кластеризации для высокой доступности](https://technet.microsoft.com/library/dn440540(v=ws.11).aspx)
-   Технический документ (написанного для развертывания на основе Windows, но большинство концепций будет по-прежнему применяются) - [планирования высокой доступности, критически важных развертываний SQL Server с VMware vSphere](https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/solutions/vmware-vsphere-highly-available-mission-critical-sql-server-deployments.pdf)

>[!NOTE]
>RHEL с кластер Pacemaker с помощью STONITH еще не поддерживается Hyper-V. Пока не поддерживаются, Дополнительные сведения и обновления, обратитесь к [политики поддержки для высокой доступности кластеров RHEL](https://access.redhat.com/articles/29440#3physical_host_mixing).

### <a name="networking"></a>Работа с сетью
В отличие от кластера WSFC Pacemaker не требует выделенного имени или по крайней мере один выделенный IP-адрес для самого кластера Pacemaker. Группы доступности и экземпляров отказоустойчивого кластера потребуют IP-адресов (см. документацию по каждому Дополнительные сведения), но не имена, так как нет ресурса сетевого имени. SLES разрешить конфигурацию IP-адреса для целей администрирования, но он не является обязательным, как можно увидеть в [создание кластера Pacemaker](sql-server-linux-deploy-pacemaker-cluster.md#create).

Как WSFC, Pacemaker предпочли бы реализована избыточность сетевого трафика, то есть различные сетевые карты (сетевых адаптеров или pNICs физический компьютер) с отдельных IP-адресов. С точки зрения конфигурации кластера каждый IP-адрес будет иметь как свой собственный кольцо. Тем не менее как с помощью кластеров Wsfc в настоящее время во многих реализациях являются виртуальными или в общедоступном облаке виртуализированные там, где на самом деле существует только один сетевой Адаптер (vNIC) для сервера. Если все pNICs и виртуальных сетевых адаптеров подключены к одному коммутатору физическим или виртуальным, отсутствует значение true, избыточность на уровне сети, поэтому Настройка нескольких сетевых карт — немного иллюзия к виртуальной машине. Избыточность сети обычно встроен в низкоуровневой оболочки для виртуализированных развертываний и определенно встроена в общедоступном облаке.

Одно различие с несколькими сетевыми картами и Pacemaker и WSFC том, что Pacemaker позволяет несколько IP-адресов в одной и той же подсети, а WSFC не поддерживает. Дополнительные сведения на несколько подсетей и кластеры под управлением Linux см. в статье [Настройка нескольких подсетей](sql-server-linux-configure-multiple-subnet.md).

### <a name="quorum-and-stonith"></a>Кворум и STONITH
Требования к конфигурации кворума и относятся к группе Доступности или экземпляра отказоустойчивого Кластера с определенным развертываниям [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)].

STONITH является обязательным для поддерживаемых кластера Pacemaker. Используйте в документации от распространителя для настройки STONITH. Например, в [ограждения на основе хранилища](https://www.suse.com/documentation/sle_ha/book_sleha/data/sec_ha_storage_protect_fencing.html) для SLES. Имеется ли для сервера VMware vCenter для решений на основе ESXI агент STONITH. Дополнительные сведения см. в разделе [Stonith подключаемый модуль агента для VMWare виртуальных Машин VCenter SOAP ограждения (Unofficial)](https://github.com/olafrv/fence_vmware_soap).

> [!NOTE]
> На момент написания этой статьи, Hyper-V не имеет решения для STONITH. Это верно для локальных развертываниях, а также влияет на развертываний Pacemaker на основе Azure, с помощью определенных дистрибутивов, таких как RHEL.

### <a name="interoperability"></a>Совместимость
В данном разделе описываются способы взаимодействия с WSFC или другие дистрибутивы Linux кластер под управлением Linux.

#### <a name="wsfc"></a>WSFC
В настоящее время нет прямого способа для WSFC, а кластер Pacemaker для совместной работы. Это означает, что нет способа для создания группы Доступности или экземпляра отказоустойчивого Кластера, который поддерживается WSFC и Pacemaker. Тем не менее существует два решения взаимодействия, которые предназначены для групп доступности. Это единственный способ FCI может участвовать в конфигурации платформ — если оно участвует в качестве экземпляра в одном из этих двух сценариев:
-   Группа Доступности с типом кластера нет. Дополнительные сведения см. в разделе Windows [документации для групп доступности](../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md).
-   Распределенные группы Доступности, которая — это специальный тип группы доступности, которая позволяет двух разных групп доступности, должен быть настроен как отдельную группу доступности. Дополнительные сведения о распределенных групп доступности, см. в документации [распределенные группы доступности](../database-engine/availability-groups/windows/distributed-availability-groups.md).

#### <a name="other-linux-distributions"></a>Другие дистрибутивы Linux
В Linux все узлы кластера Pacemaker должны находиться в то же распределение. Например это означает, что узел RHEL не могут входить в кластер Pacemaker с узлом SLES. Основной причиной этого было отмечено ранее,: распределения может иметь различных версий и функциональные возможности, поэтому вещей может работать неправильно. Сочетание дистрибутивов имеет той же статье, что смешивание кластеров Wsfc и Linux: используйте параметр Нет или распределенных групп доступности.

## <a name="next-steps"></a>Следующие шаги
[Развертывание кластера Pacemaker для SQL Server в Linux](sql-server-linux-deploy-pacemaker-cluster.md)
