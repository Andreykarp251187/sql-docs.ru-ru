---
title: Всегда в группах доступности для SQL Server в Linux | Документация Майкрософт
description: ''
author: MikeRayMSFT
ms.author: mikeray
manager: craigg
ms.date: 04/17/2019
ms.topic: conceptual
ms.prod: sql
ms.technology: linux
ms.assetid: e37742d4-541c-4d43-9ec7-a5f9b2c0e5d1
ms.openlocfilehash: e552b1392716625cd2ce3f7927a1554c25bdb8e4
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "66713406"
---
# <a name="always-on-availability-groups-on-linux"></a>Всегда в группах доступности в Linux

[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-linuxonly](../includes/appliesto-ss-xxxx-xxxx-xxx-md-linuxonly.md)]

В этой статье описываются характеристики группы доступности AlwaysOn (группами доступности) под управлением Linux [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] установок. В ней также рассматриваются различия между Linux и отказоустойчивого кластера Windows Server (WSFC) — на основе групп доступности. См. в разделе [документацию на основе Windows](../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) основами и действий, как они работают одинаково в Windows и Linux, за исключением WSFC.

С точки зрения высокого уровня доступности группы, находящиеся под [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] в Linux такие же, как как они находятся в реализациях на основе WSFC. Это означает, что все ограничения и возможности совпадают, за некоторыми исключениями. Ниже перечислены основные различия.

-   Координатор распределенных транзакций (DTC) не поддерживается в Linux в [!INCLUDE[sssql17-md](../includes/sssql17-md.md)]. Если приложения требуют использования распределенных транзакций и вам группе Доступности, развернуть [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] на Windows.
-   Развертывание на основе Linux используйте Pacemaker вместо WSFC.
-   В отличие от большинства конфигураций для групп доступности в Windows за исключением сценария рабочей группы кластера Pacemaker никогда не требуется доменных служб Active Directory (AD DS).
-   Переход на другой группе Доступности с одного узла на другой отличается между Linux и Windows.
-   Некоторые параметры, такие как `required_synchronized_secondaries_to_commit` могут быть изменены только с помощью Pacemaker в Linux, тогда как установка, на основе WSFC используется Transact-SQL.

## <a name="number-of-replicas-and-cluster-nodes"></a>Количество реплик и узлов кластера

Группы Доступности в [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)] могут иметь двух реплик: одна первичная и одна вторичная реплика, которая может использоваться только для обеспечения доступности. Он не может использоваться для любых других, например для чтения запросы. Группы Доступности в [!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)] может иметь до девяти реплик: один первичный и до восьми вторичных реплик, из которых не более трех (включая основные) могут быть синхронными. Если используется базовый кластер, может существовать до 16 узлов общее при Corosync. Группы доступности может занимать не более девяти 16 узлов с [!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)]и две с [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)].

Конфигурации двумя репликами, который должен иметь возможность автоматически переключиться на другую реплику требует использования реплики только для конфигурации, как описано в разделе [только для настройки реплики и кворума](#configuration-only-replica-and-quorum). Только для настройки реплики были введены в [!INCLUDE[sssql17-md](../includes/sssql17-md.md)] накопительный пакет обновления 1 (CU1), которое должно быть минимальные версии, развернутой для этой конфигурации.

Если используется Pacemaker, его необходимо правильно настроить таким образом он остается приступить к работе. Это означает, что кворума и STONITH необходимо реализовать надлежащим образом с точки зрения Pacemaker, помимо любых [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] требования, например реплики только для конфигурации.

Поддерживаются только для чтения вторичных реплик с [!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)].

## <a name="cluster-type-and-failover-mode"></a>Режим тип и отказоустойчивого кластера

Знакомы с [!INCLUDE[sssql17-md](../includes/sssql17-md.md)] является введение типом кластера для групп доступности. Для Linux существует два допустимых значений: Extertal и None. Типа кластера External означает, что будет использоваться Pacemaker под группой Доступности. С помощью внешних для типа кластера требует, что также внешние быть задан режим отработки отказа (еще одна новая возможность в [!INCLUDE[sssql17-md](../includes/sssql17-md.md)]). Автоматическая отработка отказа поддерживается, но в отличие от кластера WSFC, отработки отказа режим внешних, созданы не автоматически, когда используется Pacemaker. В отличие от кластера WSFC Pacemaker часть группы Доступности будет создан после настройки группы Доступности.

Тип кластера None означает, что не требуется для, а также группы Доступности использует, Pacemaker. Даже на серверах настроены Pacemaker Если группа Доступности настроена с типом кластера None, Pacemaker будет см. в разделе и не контролирует этой группы Доступности. Типом кластера нет поддерживает только на другой ресурс вручную с первичной на вторичную реплику. Группе Доступности, созданных с помощью отсутствует ориентирован главным образом для чтения и масштабирования out сценария, а также обновления. Хотя он может работать в сценариях, например аварийного восстановления или локальной доступности, где необходима без автоматической отработки отказа, не рекомендуется. История прослушивателя также является более сложным без Pacemaker.

Тип кластера хранится в [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] динамическое административное представление (DMV) `sys.availability_groups`, в столбцах `cluster_type` и `cluster_type_desc`.

## <a name="requiredsynchronizedsecondariestocommit"></a>требуется\_синхронизированы\_баз данных-получателей\_для\_фиксации

Знакомы с [!INCLUDE[sssql17-md](../includes/sssql17-md.md)] является параметром, который используется с группами доступности называется `required_synchronized_secondaries_to_commit`. Это сообщает число вторичных реплик, которые должны быть одновременно с первичной группы Доступности. Это позволяет таких вещей, как автоматическая отработка отказа (только при интегрирован с Pacemaker с типом кластера внешних) и управляет поведением таких вещей, как доступность базы данных-получателя, если нужное число вторичных реплик в автономном или оперативном режиме. Чтобы получить представление о том, как это работает, см. в разделе [высокий уровень доступности и защиты данных для конфигураций группы доступности](sql-server-linux-availability-group-ha.md). `required_synchronized_secondaries_to_commit` Значение по умолчанию и обслуживается Pacemaker / [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]. Это значение можно переопределить вручную.

Сочетание `required_synchronized_secondaries_to_commit` и новый порядковый номер (который хранится в `sys.availability_groups`) информирует о том, Pacemaker и [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] , например, автоматическая отработка отказа может произойти. В этом случае вторичной реплики будет иметь тот же номер последовательности как основной, это означает, что это в курсе всех последних сведений о конфигурации.

Существует три значения, которые могут устанавливаться для `required_synchronized_secondaries_to_commit`: 0, 1 или 2. Они управляют поведением того, что происходит, когда реплика становится недоступной. Числа соответствуют количество вторичных реплик, которые должны быть синхронизированы с первичной. Под Linux поведение выглядит следующим образом:

-   0 — вторичных реплик не обязательно должны быть в синхронизированном состоянии с первичной. Тем не менее если вторичные реплики не синхронизированы, будет существовать без автоматической отработки отказа. 
-   1 — один вторичная реплика должна быть в синхронизированном состоянии с первичной; возможна автоматическая отработка отказа. База данных-источник недоступна, пока не станет доступна вторичная синхронная реплика.
-   2 - обеих вторичных реплик в конфигурации группы Доступности с тремя или более узлами должен быть синхронизирована с первичной репликой; возможна автоматическая отработка отказа.

`required_synchronized_secondaries_to_commit` Управляет не только поведение отработки отказа с синхронной реплики, но потеря данных. Вторичная реплика со значением 1 или 2, всегда является обязательным для синхронизации, поэтому всегда будет избыточности данных. Это означает потерю данных.

Чтобы изменить значение `required_synchronized_secondaries_to_commit`, используйте следующий синтаксис:

>[!NOTE]
>Изменение значения приводит к ресурсов перезапустить, то есть короткий перерыв в работе. Единственный способ избежать этого является установка ресурса не войдут в кластер временно.

**Red Hat Enterprise Linux (RHEL) и Ubuntu**

```bash
sudo pcs resource update <AGResourceName> required_synchronized_secondaries_to_commit=<Value>
```

**SUSE Linux Enterprise Server (SLES)**

```bash
sudo crm resource param ms-<AGResourceName> set required_synchronized_secondaries_to_commit <value>
```

где *AGResourceName* — это имя ресурса, настроенные для группы Доступности, и *значение* равно 0, 1 или 2. Чтобы установить его по умолчанию управление параметра Pacemaker, выполнение одной и той же инструкции и не имеет значения.

Автоматическая отработка отказа группы доступности возможно при соблюдении следующих условий:

-   Первичной и вторичной реплике присваивается синхронное перемещение данных.
-   Сервер-получатель находится в состоянии синхронизации (не синхронизировано), это означает, что они в той же точке данных.
-   Тип кластера имеет значение "внешний". Автоматическая отработка отказа не поддерживается с типом кластера нет.
-   `sequence_number` Вторичная реплика становится первичной имеет наибольший порядковый номер — другими словами, данных вторичной реплики `sequence_number` совпадает со значением из исходной первичной реплике.

Если эти условия выполняются, происходит сбой сервера, на котором размещена первичная реплика группы Доступности меняют владельца синхронной реплики. Поведение для синхронных реплик (из которой может быть три общее: основной и двумя вторичными репликами) дополнительно может управляться `required_synchronized_secondaries_to_commit`. Это работает с группами доступности в Windows и Linux, но настраивается совершенно по-разному. В Linux значение настраивается автоматически в кластере на сам ресурс группы Доступности.

## <a name="configuration-only-replica-and-quorum"></a>Только для настройки реплики и кворума

Еще одна новая возможность в [!INCLUDE[sssql17-md](../includes/sssql17-md.md)] по состоянию на CU1 — это реплика только для конфигурации. Так как Pacemaker отличается от кластера WSFC, особенно в том случае, когда дело доходит до кворума и требование STONITH, просто конфигурации двух узлов будет работать не когда дело доходит до группе Доступности. Экземпляра отказоустойчивого кластера кворума механизмов, предоставляемых средой Pacemaker может быть нормально, так как все арбитраж отработки отказа FCI происходит на уровне кластера. Для группы Доступности, разрешение конфликтов под Linux осуществляется в [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)], где хранятся все метаданные. Это где реплики только для конфигурации вступает в действие.

Без ничего третий узел и по крайней мере один синхронизированной реплики не требуются. Реплики только для конфигурации сохраняет конфигурацию группы Доступности в базе данных master, так же, как других реплик в конфигурации группы Доступности. Нет пользовательских баз данных, участвующих в группе Доступности для реплики только для конфигурации. Данные конфигурации передается синхронно с сервера-источника. Эти данные конфигурации используется во время отработки отказа, являются ли они автоматически или вручную.

Для группы Доступности для поддержки кворума и включения автоматической отработки отказа с типом кластера внешних объектов либо необходимо:

-   У трех синхронных реплик ([!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)] только); или
-   У двух реплик (первичный и вторичный), а также репликой только для конфигурации.

Ручная отработка отказа может произойти ли внешняя или нет типы, для конфигураций группы Доступности кластеров. Хотя можно настроить только для настройки реплики в группе Доступности с типом кластера нет, не рекомендуется, так как это усложняет развертывание. Для этих конфигураций вручную изменить `required_synchronized_secondaries_to_commit` должен иметь значение по крайней мере 1, таким образом, что по крайней мере один синхронизированной реплики.

Только для настройки реплики могут размещаться в любом выпуске [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)], в том числе [!INCLUDE[ssexpress-md](../includes/ssexpress-md.md)]. Это позволит сократить затраты на лицензирование и обеспечивает его работу с группами доступности в [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)]. Это означает, что третий требуется только сервер должен соответствовать минимальным для [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)], поскольку ее не поступает трафик транзакции пользователя для группы Доступности.

Если используется только для настройки реплики, он имеет следующие особенности:

-   По умолчанию `required_synchronized_secondaries_to_commit` имеет значение 0. Можно вручную изменить значение 1 при необходимости.
-   При сбое первичной и `required_synchronized_secondaries_to_commit` равно 0, вторичная реплика станет новой первичной реплике и будут доступны для чтения и записи. Если значение равно 1, автоматическая отработка отказа будет выполняться, а не будет принимать новые транзакции, пока другая реплика находится в сети.
-   В случае сбоя вторичной реплики и `required_synchronized_secondaries_to_commit` равно 0, первичная реплика по-прежнему принимает транзакции, но при сбое на этом этапе первичной, нет защиты для данных, ни отработка отказа возможна (ручной или автоматический), так как вторичная реплика недоступна.
-   В случае сбоя реплики только для настройки группы Доступности будет работать нормально, но без автоматической отработки отказа возможна.
-   Если произойдет сбой синхронной вторичной реплики и реплики только для конфигурации, источник не может принимать транзакции и негде для сервера-источника, не смогут.

В CU1 есть известная ошибка в сборе данных в файле corosync.log, который создается с помощью `mssql-server-ha`. Если вторичная реплика не сможет стать первичной репликой, из-за количества доступных требуется реплик, текущее сообщение об ошибке «ожидалось получение порядковых номеров, 1, но только получил 2. Недостаточно реплик подключены к сети для безопасного повышения уровня локальная реплика.» Должно быть обратным номера, и оно должно быть указано «ожидалось получение порядковых номеров, 2, но только получил 1. Недостаточно реплик подключены к сети для безопасного повышения уровня локальная реплика.» 

## <a name="multiple-availability-groups"></a>Несколько групп доступности 

Каждого кластера Pacemaker или набор серверов можно создавать более одной группы Доступности. Единственным ограничением является системным ресурсам. При этом отображается владельца группы Доступности. Различные группы доступности может принадлежать разных узлов; не все они обязательно должны выполняться на одном узле.

## <a name="drive-and-folder-location-for-databases"></a>Диск и местоположение папки для баз данных

На основе Windows и действий, диск и папку структуры для пользовательских баз данных, участвующих в группе Доступности должны быть идентичны. Например, если пользователь базы данных в `/var/opt/mssql/userdata` на сервере A, этой же папке должны существовать на сервере B. Единственным исключением из этого, записанной в разделе [взаимодействие с группами доступности на основе Windows и реплик](#interoperability-with-windows-based-availability-groups-and-replicas).

## <a name="the-listener-under-linux"></a>Прослушиватель под Linux

Что прослушиватель имеет дополнительные функциональные возможности для группы Доступности. Он предоставляет единую точку входа для всех подключений (чтение и запись для первичной реплики и/или только для чтения для вторичной реплики), таким образом, приложениям и пользователям не нужно знать, какой сервер размещение данных. В кластере WSFC а также DNS это сочетание ресурс сетевого имени и ресурсом IP-адрес, который затем регистрируется в AD DS (при необходимости). В сочетании с сам ресурс группы Доступности он предоставляет абстракции. Дополнительные сведения о прослушиватель, см. в разделе [прослушиватели, подключение клиентов и отработка отказа приложений](../database-engine/availability-groups/windows/listeners-client-connectivity-application-failover.md).

Под Linux он настраивается по-разному, но его функциональные возможности. Отсутствует понятие ресурса сетевого имени в Pacemaker, а также создается объект в AD DS; есть только ресурс IP-адреса в Pacemaker, который может работать на любом из узлов. Запись, связанную с ресурсом IP-адрес для прослушивателя в DNS с помощью «понятное имя» должна быть создана. Ресурс IP-адрес для прослушивателя будет отображаться только на сервере, на котором размещена первичная реплика этой группы доступности.

Если используется Pacemaker и создается ресурс IP-адреса, который связан с прослушивателем, будет существовать кратковременную IP-адрес останавливает на одном сервере и запускает на другой, будь то автоматический или ручной отработки отказа. Хотя это обеспечивает абстракцию через сочетание одно имя и IP-адрес, он не устанавливает маску сбоя. Приложения должен уметь обрабатывать отключение благодаря наличию какую-либо функциональные возможности для его обнаружения и восстановления.

Тем не менее сочетание DNS-имя и IP-адрес по-прежнему не хватает для предоставления всех функций, предоставляемых прослушивателя в кластере WSFC, таких как маршрутизация только для чтения для вторичных реплик. При настройке группы Доступности, «прослушиватель» по-прежнему должен быть настроен в [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)]. Это можно увидеть в мастере, а также синтаксис Transact-SQL. Существует два способа, что это можно настроить функционировать так же, как и на Windows:

-   Для группы Доступности с типом кластера внешних IP-адрес, связанный с «прослушиватель», созданный на [!INCLUDE[ssnoversion-md](../includes/ssnoversion-md.md)] должен быть IP-адрес ресурса, созданного в Pacemaker.
-   Для группы Доступности, созданных с типом кластера нет используйте IP-адрес, связанный с первичной репликой.

Экземпляр, связанный с указанный IP-адрес, затем становится координатора для таких вещей, как только для чтения маршрутизации запросов приложений.

## <a name="interoperability-with-windows-based-availability-groups-and-replicas"></a>Взаимодействие с группами доступности на основе Windows и реплик 

Группа Доступности с типом кластера External или входящую в WSFC не может иметь ее реплик кроссплатформенная поддержка. Это верно, является ли группы Доступности [!INCLUDE[ssstandard-md](../includes/ssstandard-md.md)] или [!INCLUDE[ssenterprise-md](../includes/ssenterprise-md.md)]. Это значит, что в традиционных конфигурации группы Доступности с базовый кластер, одна реплика не может быть на WSFC, а другой — на Linux с помощью Pacemaker.

Группа Доступности с типом кластера нет может иметь ее реплик относящиеся к разным операционной системы, поэтому в той же группе Доступности может представлять обе реплики на основе Linux и Windows. Пример приведен ниже, где первичная реплика находится на базе Windows, когда получатель установлен на одном из дистрибутивов Linux.

![Гибридные None](./media/sql-server-linux-availability-group-overview/image1.png)

Распределенная группа Доступности также может пересекать границы операционной системы. Базовые группы доступности связаны правилами сбора данных для их настройки, например с внешнего, только для Linux, но группы Доступности, которая соединяется с может настраиваться с помощью WSFC. Рассмотрим следующий пример.

![Гибридные Dist AG](./media/sql-server-linux-availability-group-overview/image2.png)

<!-- Distributed AGs are also supported for upgrades from [!INCLUDE[sssql15-md](../includes/sssql15-md.md)] to [!INCLUDE[sssql17-md](../includes/sssql17-md.md)]. For more information on how to achieve this, see [the article "x"].

If using automatic seeding with a distributed availability group that crosses OSes, it can handle the differences in folder structure. How this works is described in [the documentation for automatic seeding].
-->
 
## <a name="next-steps"></a>Следующие шаги
[Настройка группы доступности для SQL Server в Linux](sql-server-linux-availability-group-configure-ha.md)

[Настройка группы доступности для чтения и масштабирования для SQL Server в Linux](sql-server-linux-availability-group-configure-rs.md)

[Добавление группы доступности ресурса кластера в RHEL](sql-server-linux-availability-group-cluster-rhel.md)

[Добавление группы доступности ресурса кластера на SLES](sql-server-linux-availability-group-cluster-sles.md)

[Добавление группы доступности ресурса кластера в Ubuntu](sql-server-linux-availability-group-cluster-ubuntu.md)

[Настройка группы доступности между различными платформами](sql-server-linux-availability-group-cross-platform.md)

