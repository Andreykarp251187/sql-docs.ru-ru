---
title: Полнотекстовый поиск | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- full-text search [SQL Server]
ms.assetid: a0ce315d-f96d-4e5d-b4eb-ff76811cab75
author: MikeRayMSFT
ms.author: mikeray
manager: craigg
ms.openlocfilehash: 6d56a6e32818296343b711769ad594bf7cadce57
ms.sourcegitcommit: 45a9d7ffc99502c73f08cb937cbe9e89d9412397
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/22/2019
ms.locfileid: "66011240"
---
# <a name="full-text-search"></a>Компонент Full-text Search
  Полнотекстовый поиск в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и [!INCLUDE[ssSDSfull](../../includes/sssdsfull-md.md)] позволяет пользователям и приложениям выполнять полнотекстовые запросы к символьным данным в таблицах [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Перед выполнением полнотекстовых запросов на данной таблице администратор базы данных должен создать в таблице полнотекстовый индекс. В полнотекстовый индекс включается один или несколько символьных столбцов в таблице. Эти столбцы могут содержать любой из следующих типов данных: `char`, `varchar`, `nchar`, `nvarchar`, `text`, `ntext`, `image`, `xml` или `varbinary(max)` и FILESTREAM. Каждый полнотекстовый индекс индексирует один или несколько столбцов таблицы, а каждому столбцу может соответствовать определенный язык.  
  
 Полнотекстовые запросы выполняют лингвистический поиск в текстовых данных в полнотекстовых индексах путем обработки слов и фраз в соответствии с правилами данного языка, например английского или японского. Полнотекстовые запросы могут включать простые слова и фразы или несколько форм слова или фразы. Полнотекстовый запрос возвращает все документы, которые содержат как минимум одно совпадение (известное также как *попадание*). Совпадение возникает в том случае, когда целевой документ содержит все термины, указанные в полнотекстовом запросе, и соответствует всем остальным условиям поиска, например расстояние между совпадающими терминами.  
  
> [!NOTE]  
>  Full-Text Search является необязательным компонентом компонента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Database Engine. Дополнительные сведения см. в разделе [Установка SQL Server 2014](../../database-engine/install-windows/install-sql-server.md).  
  
##  <a name="benefits"></a> Что можно делать с Full-Text Search  
 Компонент Full-text search применима к широкий спектр бизнес-сценариях e компаний-для поиска элементов на веб-сайта; Закон фирм — для поиска историй в репозитории юридических данных; или отдела кадров отделов сопоставления описаний работы с хранимыми резюме. Основные административные задачи и задачи разработки полнотекстового поиска одинаковы независимо от бизнес-сценариев. Однако в конкретном бизнес-сценарии полнотекстовые запросы и индекс могут настраиваться с учетом той или иной специфики. Например, для электронного бизнеса повышение производительности может быть более важным, чем ранжирование результатов, точность повторного вызова (количество существующих совпадений, фактически возвращенных полнотекстовым запросом) или поддержка нескольких языков. Для юридической фирмы наиболее важным может быть возвращение каждого возможного совпадения (*общая выборка* информации).  
  
 [В этом разделе](#top)  
  
###  <a name="queries"></a> Запросы полнотекстового поиска  
 После добавления столбцов в полнотекстовый индекс, приложения и пользователи смогут выполнять полнотекстовые запросы к тексту из столбцов. Эти запросы могут вести поиск любых приведенных ниже элементов.  
  
-   Одно или несколько конкретных слов или фраз (*простое выражение*)  
  
-   Слова, начинающиеся заданным текстом, или фразы с такими словами (*префиксные выражения*)  
  
-   Словоформы конкретного слова (*производное выражение*)  
  
-   Слова или фразы, находящиеся рядом с другими словами или фразами (*выражения с учетом расположения*)  
  
-   Синонимические формы конкретного слова (*тезаурус*)  
  
-   Слова или фразы со взвешенными значениями (*взвешенное выражение*)  
  
 В полнотекстовых запросах не учитывается регистр букв. Например, поиск значения «Алюминий» или «алюминий» вернет одинаковые результаты.  
  
 Все полнотекстовые запросы используют небольшой набор предикатов [!INCLUDE[tsql](../../../includes/tsql-md.md)] (CONTAINS и FREETEXT) и функций (CONTAINSTABLE и FREETEXTTABLE). Однако точная структура полнотекстовых запросов определяется целями поиска данного бизнес-сценария. Пример:  
  
-   Электронный бизнес — поиск продукта на веб-сайте:  
  
    ```  
    SELECT product_id   
    FROM products   
    WHERE CONTAINS(product_description, "Snap Happy 100EZ"  
        OR FORMSOF(THESAURUS,'Snap Happy')  
        OR '100EZ')   
    AND product_cost < 200 ;  
    ```  
  
-   Сценарий комплектования штата — поиск кандидатов, имеющих опыт работы с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:  
  
    ```  
    SELECT candidate_name,SSN   
    FROM candidates   
    WHERE CONTAINS(candidate_resume,"SQL Server") AND candidate_division = 'DBA';  
    ```  
  
 Дополнительные сведения см. в разделе [Запросы с полнотекстовым поиском](query-with-full-text-search.md).  
  
 [В этом разделе](#top)  
  
###  <a name="like"></a> Сравнение LIKE с Full-Text Search  
 В отличие от полнотекстового поиска предикат [LIKE](/sql/t-sql/language-elements/like-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] работает только с комбинациями символов. Кроме того, предикат LIKE нельзя использовать в запросах к форматированным двоичным данным. Более того, запрос с предикатом LIKE к большому количеству неструктурированных текстовых данных выполняется гораздо медленнее, чем эквивалентный полнотекстовый запрос к тем же данным. Выполнение запроса LIKE к нескольким миллионам строк текстовых данных может занять несколько минут, в то время как полнотекстовый запрос к тем же данным занимает всего несколько секунд или даже меньше, в зависимости от количества возвращаемых строк.  
  
 [В этом разделе](#top)  
  
##  <a name="architecture"></a> Компоненты и архитектура полнотекстового поиска  
 Архитектура полнотекстового поиска состоит из следующих процессов.  
  
-   Процесс [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (sqlservr.exe).  
  
-   Процесс узла управляющей программы фильтрации (fdhost.exe).  
  
     По соображениям безопасности фильтры загружаются отдельными процессами, которые называются узлами управляющей программы фильтрации. Процессы fdhost.exe создаются службой запуска FDHOST (MSSQLFDLauncher) и выполняются под учетными данными безопасности учетной записи службы запуска FDHOST. Следовательно, чтобы работало полнотекстовое индексирование и выполнялись полнотекстовые запросы, должна быть запущена служба FDHOST. Сведения о настройке учетной записи службы для этой службы см. в разделе [Настройка учетной записи службы средства запуска управляющей программы полнотекстовой фильтрации](set-the-service-account-for-the-full-text-filter-daemon-launcher.md).  
  
 Эти два процесса содержат компоненты архитектуры полнотекстового поиска. Эти компоненты и их связи приведены на следующей иллюстрации. Описание компонентов приведено после иллюстрации.  
  
 ![Архитектура полнотекстового поиска](../../database-engine/media/ifts-arch.gif "Архитектура полнотекстового поиска")  
  
 [В этом разделе](#top)  
  
###  <a name="sqlprocess"></a> Процесс SQL Server  
 В полнотекстовом поиске используются следующие компоненты процесса [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .  
  
-   **Пользовательские таблицы.** В этих таблицах содержатся данные, по которым осуществляется полнотекстовое индексирование.  
  
-   **Средство сбора полнотекстовых данных.** Средство сбора полнотекстовых данных работает с потоками полнотекстового сканирования. Оно отвечает за планирование заполнения полнотекстовых индексов и управление им, а также за наблюдение за полнотекстовыми каталогами.  
  
-   **Файлы тезауруса.** Эти файлы содержат синонимы искомых терминов. Дополнительные сведения см. в разделе [Настройка файлов тезауруса для полнотекстового поиска и управление ими](configure-and-manage-thesaurus-files-for-full-text-search.md).  
  
-   **Объекты списка стоп-слов.** Объекты списка стоп-слов содержат список часто встречающихся слов, бесполезных при поиске. Дополнительные сведения см. в разделе [Настройка стоп-слов и списков стоп-слов для полнотекстового поиска и управление ими](configure-and-manage-stopwords-and-stoplists-for-full-text-search.md).  
  
-   **[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] обработчик запросов.** Обработчик запросов компилирует и выполняет SQL-запросы. Если SQL-запрос включает запрос полнотекстового поиска, то запрос направляется в средство полнотекстового поиска как в процессе компиляции, так и при выполнении. Результат запроса сопоставляется с полнотекстовым индексом.  
  
-   **Средство полнотекстового поиска.** Средство полнотекстового поиска в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] полностью интегрировано с обработчиком запросов. Средство полнотекстового поиска компилирует и выполняет полнотекстовые запросы. Как часть выполнения запроса средство полнотекстового поиска может получать входные данные из тезауруса и списка стоп-слов.  
  
-   **Модуль записи индекса (индексатор).** Модуль записи индекса строит структуру, используемую для хранения индексированных токенов.  
  
-   **Диспетчер управляющей программы фильтрации.** Диспетчер управляющей программы фильтрации отвечает за наблюдение за состоянием узла управляющей программы фильтрации для полнотекстового поиска.  
  
 [В этом разделе](#top)  
  
###  <a name="fdhostprocess"></a> Процесс узла управляющей программы фильтрации  
 Узел управляющей программы фильтрации представляет собой процесс, запускаемый средством полнотекстового поиска. Он запускает следующие компоненты полнотекстового поиска, которые отвечают за доступ, фильтрацию и разбиение по словам данных из таблиц, а также разбиение по словам и морфологический поиск во входных данных запроса.  
  
 Существуют следующие компоненты узла управляющей программы фильтрации.  
  
-   **Обработчик протокола.** Этот компонент запрашивает данные из памяти для дальнейшей обработки и обращается к данным из пользовательской таблицы в указанной базе данных. Одной из его задач является сбор данных из столбцов с полнотекстовой индексацией и передача этих данных в узел управляющей программы фильтрации, в котором требуемым образом применяется фильтрация и средство разбиения по словам.  
  
-   **Фильтры.** Для некоторых типов данных требуется фильтрация перед полнотекстовой индексацией данных в документе, в том числе для данных в столбцах `varbinary`, `varbinary(max)`, `image` или `xml`. Фильтр, используемый для данного документа, зависит от типа этого документа. Например, для документов Microsoft Word (DOC), Microsoft Excel (XLS) и XML-документов (XML) используются разные фильтры. Затем фильтр выделяет из документа фрагменты данных, при этом удаляется внедренное форматирование, остается текст и, возможно, сведения о положении текста. Результатом является поток текстовых данных. Дополнительные сведения см. в разделе [Настройка фильтров для поиска и управление ими](configure-and-manage-filters-for-search.md).  
  
-   **Средства разбиения по словам и парадигматические модули.** Работа средства разбиения по словам зависит от конкретного языка: компонент находит границы слов в соответствии с лексическими правилами данного языка (*разбиение по словам*). Каждое средство разбиения по словам связано с зависящим от языка компонентом парадигматического модуля, который спрягает глаголы и добавляет флексии. Во время индексирования узел управляющей программы фильтрации использует средство разбиения по словам и парадигматический модуль для выполнения лингвистического анализа текстовых данных из указанного столбца таблицы. Язык, связанный со столбцом таблицы в полнотекстовом индексе, определяет, какое средство разбиения по словам и какой парадигматический модуль будут использоваться для индексирования столбца. Дополнительные сведения о парадигматических модулях см. в разделе [Настройка средств разбиения на слова и парадигматические модули для поиска и управление ими](configure-and-manage-word-breakers-and-stemmers-for-search.md).  
  
 [В этом разделе](#top)  
  
##  <a name="processing"></a> Обработка полнотекстового поиска  
 Полнотекстовый поиск работает на базе средства полнотекстового поиска. Средство полнотекстового поиска имеет две роли: поддержка индексирования и поддержка запросов.  
  
###  <a name="indexing"></a> Процесс индексирования полнотекстового поиска  
 При инициации заполнения полнотекстового индекса (который также называют «сканированием») средство полнотекстового поиска помещает большие пакеты данных в память и оповещает управляющую программу полнотекстовой фильтрации. Управляющая программа выполняет фильтрацию и разбиение по словам, а также преобразует конвертированные данные в инвертированный список слов. Затем средство полнотекстового поиска запрашивает конвертированные данные из списка слов, удаляет стоп-слова и сохраняет списки слов в виде пакета в один или несколько инвертированных индексов.  
  
 При индексировании данных, хранящихся в `varbinary(max)` или `image` столбец, фильтр, который реализует **IFilter** интерфейса извлекает текст в зависимости от указанного файла формата для этих данных (например, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Word). В некоторых случаях компонентов-фильтров необходимо `varbinary(max)`, или `image` данные были записаны в папку filterdata, а принудительно отправлены в память.  
  
 Одним из этапов обработки собранных текстовых данных является их анализ средством разбиения по словам, которое разделяет текст на отдельные токены, или ключевые слова. Язык, используемый при разметке, задается на уровне столбца или может быть определен компонентом-фильтром по данным типа `varbinary(max)`, `image` или `xml`.  
  
 Для удаления стоп-слов и нормализации токенов перед их сохранением в полнотекстовом индексе или фрагменте индекса может быть проведена дополнительная обработка.  
  
 После завершения операции заполнения инициируется заключительный процесс слияния фрагментов индекса в один главный полнотекстовый индекс. Это повышает производительность запросов за счет использования одного главного индекса вместо нескольких фрагментов индексов и позволяет использовать более точные количественные оценки для ранжирования данных по релевантности.  
  
 [В этом разделе](#top)  
  
###  <a name="querying"></a> Обработка запросов полнотекстового поиска  
 Обработчик запросов передает для обработки полнотекстовые части запроса средству полнотекстового поиска. Средство полнотекстового поиска выполняет разбиение по словам и при необходимости расширения тезауруса, морфологический поиск и обработку стоп-слов (пропускаемых слов). Затем полнотекстовые части запроса представляются в форме операторов SQL, в основном как потоковые функции, возвращающие табличные значения. Во время выполнения запроса эти потоковые функции для получения правильных результатов обращаются к инвертированному индексу. Результаты возвращаются клиенту в этой точке, либо перед возвращением клиенту они подвергаются дополнительной обработке.  
  
 [В этом разделе](#top)  
  
##  <a name="components"></a> Лингвистические компоненты и поддержка языков в Full-Text Search  
 Полнотекстовый поиск поддерживает почти 50 разных языков, в том числе английский, испанский, китайский, японский, арабский, бенгальский и хинди. Полный список поддерживаемых языков полнотекстового поиска см. в разделе [sys.fulltext_languages (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-fulltext-languages-transact-sql). Каждый из столбцов в полнотекстовом индексе связан с идентификатором локали Microsoft Windows, который соответствует языку, поддерживаемому полнотекстовым поиском. Например, код языка 1033 соответствует языку «Английский (США)», а код 2057 соответствует языку «Английский (Великобритания)». Для каждого поддерживаемого языка полнотекстового поиска [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предусмотрены лингвистические компоненты, которые поддерживают индексирование полнотекстовых данных и выполнение запросов к полнотекстовым данным на этом языке.  
  
 Компоненты, связанные с конкретным языком, включают следующие компоненты.  
  
-   **Средства разбиения по словам и парадигматические модули.** Средство разбиения по словам находит границы слов на основании лексических правил данного языка (*разбиение по словам*). Каждое средство разбиения по словам связано с парадигматическим модулем, который спрягает глаголы этого языка и т. п. Дополнительные сведения о парадигматических модулях см. в разделе [Настройка средств разбиения на слова и парадигматические модули для поиска и управление ими](configure-and-manage-word-breakers-and-stemmers-for-search.md).  
  
-   **Списки стоп-слов.** Предоставляется список стоп-слов с основным набором стоп-слов (называемых также пропускаемыми словами). *Стоп-словом* является слово, которое бесполезно при поиске и пропускается при выполнении полнотекстовых запросов. Примерами стоп-слов для английской локали могут служить слова «a», «and», «is» и «the». Обычно бывает нужно настроить один или несколько файлов тезауруса и списков стоп-слов. Дополнительные сведения см. в разделе [Настройка стоп-слов и списков стоп-слов для полнотекстового поиска и управление ими](configure-and-manage-stopwords-and-stoplists-for-full-text-search.md).  
  
-   **Файлы тезауруса.** [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] устанавливает файл тезауруса для каждого полнотекстового языка, а также файл глобального тезауруса. Устанавливаемые файлы тезауруса в основном пустые, но их можно изменять, добавляя туда определения синонимов для конкретного языка или бизнес-сценария. Подготовив тезаурус, ориентированный на пользовательские полнотекстовые данные, можно эффективно расширить область полнотекстовых запросов к этим данным. Дополнительные сведения см. в разделе [Настройка файлов тезауруса для полнотекстового поиска и управление ими](configure-and-manage-thesaurus-files-for-full-text-search.md).  
  
-   **Фильтры (iFilters).**  Индексирование документа в столбце типов данных `varbinary(max)`, `image` или `xml` требует наличия фильтра для выполнения дополнительной обработки. Фильтр должен соответствовать типу документа (DOC, PDF, XLS, XML и т.д.). Дополнительные сведения см. в разделе [Настройка фильтров для поиска и управление ими](configure-and-manage-filters-for-search.md).  
  
 Средства разбиения по словам (и парадигматические модули), а также фильтры выполняются в процессе управляющей программы фильтрации (fdhost.exe).  
  
 [В этом разделе](#top)  
  
##  <a name="reltasks"></a> Связанные задачи  
  
-   [Начало работы с компонентом Full-Text Search](get-started-with-full-text-search.md)  
  
-   Написание полнотекстовых запросов  
  
    -   [Запросы с полнотекстовым поиском](query-with-full-text-search.md)  
  
    -   [Поиск слов, близких к другим словам, с помощью оператора NEAR](search-for-words-close-to-another-word-with-near.md)  
  
    -   [Ограничение количества результатов поиска с помощью RANK](limit-search-results-with-rank.md)  
  
    -   [Повышение производительности полнотекстовых запросов](improve-the-performance-of-full-text-queries.md)  
  
    -   [Поиск свойств документа с помощью списков свойств поиска](search-document-properties-with-search-property-lists.md)  
  
    -   [Поиск идентификаторов GUID для наборов свойств и целочисленных идентификаторов свойств для свойств поиска](find-property-set-guids-and-property-integer-ids-for-search-properties.md)  
  
-   Управление каталогами и индексами  
  
    -   [Создание и управление полнотекстовыми каталогами](create-and-manage-full-text-catalogs.md)  
  
    -   [Создание полнотекстовых индексов и управление ими](create-and-manage-full-text-indexes.md)  
  
    -   [Выбор языка при создании полнотекстового индекса](choose-a-language-when-creating-a-full-text-index.md)  
  
    -   [Заполнение полнотекстовых индексов](populate-full-text-indexes.md)  
  
    -   [Управление полнотекстовыми индексами](../../database-engine/manage-full-text-indexes.md)  
  
    -   [Повышение производительности полнотекстовых индексов](improve-the-performance-of-full-text-indexes.md)  
  
    -   [Устранение неполадок полнотекстового индексирования](troubleshoot-full-text-indexing.md)  
  
    -   [Создание резервных копий и восстановление полнотекстовых каталогов и индексов](back-up-and-restore-full-text-catalogs-and-indexes.md)  
  
-   Управление лингвистическими компонентами  
  
    -   [Настройка и управление фильтрами для поиска](configure-and-manage-filters-for-search.md)  
  
    -   [Настройка и управление средством разбиения на слова и парадигматические модули для поиска](configure-and-manage-word-breakers-and-stemmers-for-search.md)  
  
    -   [Просмотр или изменение зарегистрированных фильтров и средств разбиения текста на слова](view-or-change-registered-filters-and-word-breakers.md)  
  
    -   [Восстановление предыдущих версий средств разбиения текста на слова, используемых поиском](revert-the-word-breakers-used-by-search-to-the-previous-version.md)  
  
    -   [Изменение средства разбиения текста на слова, используемого для английского языка (США и Соединенное Королевство)](change-the-word-breaker-used-for-us-english-and-uk-english.md)  
  
    -   [Настройка поведения средств разбиения текста на слова с помощью пользовательского словаря](customize-the-behavior-of-word-breakers-with-a-custom-dictionary.md)  
  
    -   [Настройка стоп-слов, списков стоп-слов и управление ими для полнотекстового поиска](configure-and-manage-stopwords-and-stoplists-for-full-text-search.md)  
  
    -   [Настройка файлов тезауруса и управление ими для полнотекстового поиска](configure-and-manage-thesaurus-files-for-full-text-search.md)  
  
-   Управление полнотекстовым поиском  
  
    -   [Управление полнотекстовым поиском и наблюдение за ним для экземпляра сервера](manage-and-monitor-full-text-search-for-a-server-instance.md)  
  
    -   [Настройка учетной записи службы средства запуска управляющей программы полнотекстовой фильтрации](set-the-service-account-for-the-full-text-filter-daemon-launcher.md)  
  
-   [Обновление полнотекстового поиска](upgrade-full-text-search.md)  
  
 [В этом разделе](#top)  
  
##  <a name="relcontent"></a> См. также  
  
-   [Инструкции DDL, функции, хранимые процедуры и представления для полнотекстового поиска](../views/views.md)  
  
 [В этом разделе](#top)  
  
  
