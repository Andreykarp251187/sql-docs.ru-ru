---
title: Использование резервных копий журнала транзакций (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- restoring [SQL Server], log backups
- transaction log backups [SQL Server], applying backups
- online restores [SQL Server], log backups
- transaction log backups [SQL Server], quantity needed for restore sequence
- backups [SQL Server], log backups
ms.assetid: 9b12be51-5469-46f9-8e86-e938e10aa3a1
author: MikeRayMSFT
ms.author: mikeray
manager: craigg
ms.openlocfilehash: 7532f2a6f2c50f53e5af01c2cec979170b493147
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "62922939"
---
# <a name="apply-transaction-log-backups-sql-server"></a>Применение резервных копий журналов транзакций (SQL Server)
  Этот раздел относится только к модели полного восстановления и модели восстановления с неполным протоколированием.  
  
 В этом разделе описано применение резервных копий журнала транзакции в процессе восстановления базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
 **В этом разделе:**  
  
-   [Требования к восстановлению резервных копий журналов транзакций](#Requirements)  
  
-   [Журналы восстановления и транзакций](#RecoveryAndTlogs)  
  
-   [Использование резервных копий журнала для восстановления до точки сбоя](#PITrestore)  
  
-   [Связанные задачи](#RelatedTasks)  
  
##  <a name="Requirements"></a>Требования к восстановлению резервных копий журналов транзакций  
 Для применения резервной копии журнала транзакций необходимо выполнить следующие требования.  
  
-   **Достаточно резервных копий журналов для последовательности восстановления:** Необходимо создать достаточное количество записей журнала для завершения последовательности восстановления. Необходимые резервные копии журнала, включая при необходимости [резервные копии конца журнала](tail-log-backups-sql-server.md) , должны быть доступны перед запуском последовательности восстановления.  
  
-   **Правильный порядок восстановления:**  Сначала необходимо восстановить предыдущую полную резервную копию базы данных или разностную резервную копию базы данных. После этого в хронологическом порядке необходимо восстановить все журналы транзакций, созданные после указанной полной или разностной резервной копии. Если резервная копия журнала транзакций в этой цепочке журналов утрачена или повреждена, то восстановить можно только журналы транзакций до отсутствующего журнала.  
  
-   **База данных еще не восстановлена:**  База данных не может быть восстановлена до тех пор, пока не применен последний журнал транзакций. Если база данных восстанавливается после восстановления одной из промежуточных резервных копий журнала транзакций, расположенной перед концом цепочки журналов, базу данных после этой точки можно восстановить без перезапуска всей последовательности восстановления, начинающейся с полной резервной копии базы данных.  
  
    > [!TIP]  
    >  Лучше всего восстановить все резервные журналы (RESTORE LOG *имя_базы_данных* WITH NORECOVERY). После восстановления последней резервной копии журнала восстановите базу данных отдельной операцией (RESTORE DATABASE *имя_базы_данных* WITH RECOVERY).  
  
##  <a name="RecoveryAndTlogs"></a>Журналы восстановления и транзакций  
 По завершении операции восстановления и восстановления базы данных будет произведен откат всех незавершенных транзакций. Этот шаг называется *стадией отката*. Откат требуется для восстановления целостности базы данных. После отката база данных включается в режим «в сети», и больше никакие резервные копии журнала транзакций не могут быть применены.  
  
 Например, серия резервных копий журнала транзакций содержит долго выполняющуюся транзакцию. Начало транзакции записано в первой резервной копии журнала транзакций, а конец транзакции записан во второй резервной копии журнала транзакций. В первой резервной копии журнала транзакций нет записи об операции фиксации или отката. Если операция восстановления запускается при применении первой резервной копии журнала транзакций, то долго выполняющаяся транзакция рассматривается как незавершенная, а изменения в данных, записанные в первой резервной копии журнала транзакций, будут отменены. 
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не позволяет применять вторую резервную копию журнала транзакций.  
  
> [!NOTE]  
>  В некоторых обстоятельствах при восстановлении журнала можно явно добавить файл.  
  
##  <a name="PITrestore"></a>Использование резервных копий журналов для восстановления до точки сбоя  
 Предполагается такая последовательность событий.  
  
|Time|Событие|  
|----------|-----------|  
|8:00|Создание резервной копии базы данных для создания полной резервной копии базы данных.|  
|Полдень|Резервное копирование журнала транзакций.|  
|16:00|Резервное копирование журнала транзакций.|  
|18:00|Создание резервной копии базы данных для создания полной резервной копии базы данных.|  
|20:00|Резервное копирование журнала транзакций.|  
|21:45|Произошел сбой.|  
  
> [!NOTE]  
>  Объяснение этого примера последовательности резервных копий см. в разделе [Резервные копии журналов транзакций (SQL Server)](transaction-log-backups-sql-server.md).  
  
 Чтобы восстановить базу данных до ее состояния в 21:45 (точка сбоя), может быть использована любая из следующих альтернативных процедур.  
  
 **Альтернатива 1. Восстановление базы данных с использованием последней полной резервной копии базы данных**  
  
1.  Создайте резервную копию заключительного фрагмента активного журнала транзакций на момент точки сбоя.  
  
2.  Не восстанавливайте полную резервную копию базы данных, резервной копии базы данных от 18:00. Вместо этого восстановите последнюю полную резервную копию, созданную в 18:00:00 а затем примените резервную копию журнала и резервную копию заключительного фрагмента журнала, созданные в 20:00:00.  
  
 **Альтернативное 2. Восстановление базы данных с помощью более ранней полной резервной копии базы данных**  
  
> [!NOTE]  
>  Этот вариант можно использовать в том случае, если проблема не позволяет воспользоваться полной резервной копии базы данных от 18:00. Этот процесс занимает больше времени, чем восстановление полной резервной копии базы данных от 18:00.  
  
1.  Создайте резервную копию заключительного фрагмента активного журнала транзакций на момент точки сбоя.  
  
2.  Восстановите полную резервную копию базы данных от 8:00, а затем последовательно восстановите все четыре резервные копии журнала транзакций. Это позволяет произвести накат всех завершенных транзакций вплоть до 21:45.  
  
     Этот вариант указывает на избыточную безопасность, предлагаемую цепочкой резервных копий журнала транзакций в серии полных резервных копий базы данных.  
  
> [!NOTE]  
>  В некоторых случаях журналы транзакций могут также использоваться для восстановления базы данных на определенный момент времени. Дополнительные сведения см. в разделе [Восстановление базы данных SQL Server до определенного момента времени (модель полного восстановления)](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).  
  
##  <a name="RelatedTasks"></a> Связанные задачи  
 **Применение резервной копии журнала транзакций**  
  
-   [Восстановление резервной копии журнала транзакций &#40;SQL Server&#41;](restore-a-transaction-log-backup-sql-server.md)  
  
 **Восстановление в точке восстановления**  
  
-   [Восстановление базы данных до точки сбоя в модели полного восстановления &#40;Transact-SQL&#41;](restore-database-to-point-of-failure-full-recovery.md)  
  
-   [Восстановление SQL Server базы данных на момент времени &#40;модель полного восстановления&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md)  
  
-   <xref:Microsoft.SqlServer.Management.Smo.Restore.SqlRestore%2A>ОБЪЕКТАХ  
  
-   [Восстановление связанных баз данных, которые содержат помеченную транзакцию](recovery-of-related-databases-that-contain-marked-transaction.md)  
  
-   [Восстановление до регистрационного номера в журнале &#40;SQL Server&#41;](recover-to-a-log-sequence-number-sql-server.md)  
  
 **Восстановление базы данных после восстановления резервных копий с параметром WITH NORECOVERY**  
  
-   [Восстановление базы данных без восстановления данных &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md)  
  
## <a name="see-also"></a>См. также:  
 [&#40;SQL Server журнала транзакций&#41;](../logs/the-transaction-log-sql-server.md)  
  
  
