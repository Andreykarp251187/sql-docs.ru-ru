---
title: Управляемое резервное копирование SQL Server в Microsoft Azure. Взаимодействие и совместная работа | Документация Майкрософт
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 78fb78ed-653f-45fe-a02a-a66519bfee1b
author: mashamsft
ms.author: mathoma
manager: craigg
ms.openlocfilehash: d4d883d54a1ad933d4e248f292d9b6a222915a00
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "62842911"
---
# <a name="sql-server-managed-backup-to-windows-azure-interoperability-and-coexistence"></a>Управляемое резервное копирование SQL Server в Microsoft Azure. Возможности взаимодействия и совместной работы
  В этом разделе описываются вопросы взаимодействия и совместной работы [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] с некоторыми функциями в [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)]. К таким средствам относятся: Группы доступности AlwaysOn, зеркальное отображение базы данных, планы обслуживания резервных копий, доставка журналов, Нерегламентированное резервное копирование, отсоединение базы данных и Drop Database.  
  
### <a name="alwayson-availability-groups"></a>Группы доступности AlwaysOn  
 Группы доступности AlwaysOn, которые настроены как решение только в Azure, поддерживается для Windows [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]. Не поддерживаются только локальные либо гибридные конфигурации групп доступности AlwaysOn. Дополнительные сведения и другие требования, см. в разделе [Настройка SQL Server Managed Backup to Windows Azure для групп доступности](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)  
  
### <a name="database-mirroring"></a>Зеркальное отображение базы данных  
 Службы [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] поддерживаются только в основной базе данных. Если использование [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] настроено как на основной, так и на зеркальной базе данных, зеркальная база данных будет пропущена и ее резервное копирование выполнено не будет. Однако в случае отработки отказа [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] запустит процесс резервного копирования, после того как зеркальный сервер завершит переключение ролей и подключится к сети. В этом случае резервные копии будут сохраняться в новом контейнере. Если зеркальный сервер не настроен для использования [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], при отработке отказа резервное копирование производиться не будет. Рекомендуется настраивать [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] и в основной и в зеркальной базе данных, чтобы резервное копирование продолжалось и в случае отработки отказа.  
  
> [!TIP]  
>  При создании зеркальной базы данных на экземпляре с параметрами [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] по умолчанию может быть целесообразно отключить настройки [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] по умолчанию для экземпляра, чтобы они не применялись к зеркальной базе данных, а затем включить настройки по умолчанию для экземпляра после настройки основной и зеркальной баз данных.  
  
### <a name="maintenance-plan"></a>План обслуживания  
 Применение планов обслуживания для создания резервных копий для базы данных при включенном [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] не поддерживается. Планы обслуживания приведут к разрывам цепочки журналов, и [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], возможно, не обеспечит гарантируемую восстанавливаемость базы данных во время восстановления. Это также актуально, если службы [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] включены на уровне экземпляра.  
  
> [!TIP]  
>  Планы обслуживания с резервными копиями только для копирования поддерживаются для [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], настроенного для той же базы данных или экземпляра.  
  
### <a name="log-shipping"></a>Доставка журналов  
 Нельзя настроить одновременно доставку журналов и [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] для одной базы данных. Это может повлиять на восстанавливаемость базы данных с помощью любой из функций.  
  
### <a name="ad-hoc-backups-using-transact-sql-and-sql-server-management-studio"></a>Нерегламентированное резервное копирование с помощью Transact-SQL и SQL Server Management Studio  
 Нерегламентированные или разовые резервные копии, созданные не в [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] с помощью Transact-SQL или SQL Server Management Studio, могут влиять на [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] в зависимости от типа резервной копии и используемого носителя хранения. Создание резервных копий журналов под учетной записью хранения Windows Azure, отличной от используемой [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], либо для любого назначения, кроме службы хранения больших двоичных объектов Windows Azure, приведет к разрыву цепочки журналов. Мы рекомендуем использовать [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41; ](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) хранимую процедуру, чтобы инициировать резервное копирование баз данных, имеющих [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] включена. С помощью этой хранимой процедуры можно инициировать резервное копирование либо всей базы данных, либо только журнала.  
  
### <a name="drop-database-and-detach-database"></a>Удаление и отсоединение базы данных  
 При удалении или отсоединении базы данных с включенным [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] предыдущие резервные копии остаются в хранилище до истечения срока хранения (после чего они удаляются), хотя создание дополнительных резервных копий невозможно.  
  
### <a name="changes-to-recovery-model"></a>Изменение модели восстановления  
  
-   Если вы измените модель восстановления базы данных с **простой** для **полный** или **восстановления с неполным протоколированием**, у вас есть возможность настроить [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] для базы данных. Со стороны [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] это будет рассматриваться как новая база данных.  
  
-   Если вы измените модель восстановления базы данных с **полный** или **восстановления с неполным протоколированием** для **простой**, с [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] больше не будет включен, операции резервного копирования расписание. Параметр срока хранения останется активным, а файлы резервной копии останутся в учетной записи хранения до истечения срока хранения. Если нужно сохранить резервные копии, рекомендуется загрузить файлы в другую учетную запись хранения или в локальное местоположение. Параметры конфигурации сохраняются и могут быть использованы, если модель восстановления снова установить значение **полный** или **восстановления с неполным протоколированием** еще раз.  
  
### <a name="log-backups-using-other-backup-tools-or-custom-scripts"></a>Резервное копирование журнала с применением других средств резервного копирования или пользовательских скриптов  
 Любые две операции резервного копирования, настроенные для выполнения резервного копирования журналов на одной базе данных, вызовут разрыв в цепочке копирования журналов. Безусловно, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] попытается обойти разрыв в цепочке резервного копирования, запланировав полное резервное копирование при его обнаружении, но это не устранит разрывы, периодически возникающие при копировании журнала двумя конкурирующими средствами. Это также может повлиять на восстановимость базы данных, поскольку не гарантируется, что какой-либо из инструментов будет всегда иметь полный набор последовательных резервных копий. Хоть это и относится к любым двум компонентам или инструментам, выполняющим резервное копирование журналов, будет полезно рассмотреть конкретные примеры, описанные ниже. Это также относится к проблемам, связанным с настройкой планов обслуживания или доставкой журналов, которые описаны в предыдущих подразделах данного раздела.  
  
 **Резервные копии на основе Data Protection Manager (DPM):** Microsoft Data Protection Manager позволяет выполнять полного и добавочного резервного копирования. Добавочные резервные копии — это копии журнала, которые выполняют усечение журнала после создания резервной копии T-журнала. Поэтому не поддерживается настройка и DPM и [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] для одной и той же базы данных.  
  
 **Сторонние инструменты и скрипты.** Любое средство стороннего производителя или сценарии, резервные копии журналов журнала с усечением несовместим с [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]и не поддерживается.  
  
 Если у вас есть [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] включен для экземпляра базы данных, и вы хотите воспользоваться Нерегламентированное резервное копирование, можно использовать либо [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41; ](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) хранимой процедуры, как описано ранее в раздел. Если требуется также периодически делать резервные копии вне пределов [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], можно использовать функции резервного копирования только с копированием.  Дополнительные сведения см. в разделе [Резервные копии только для копирования (SQL Server)](../relational-databases/backup-restore/copy-only-backups-sql-server.md).  
  
  
