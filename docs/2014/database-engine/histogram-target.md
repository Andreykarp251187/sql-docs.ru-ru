---
title: Цель гистограммы | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- bucketing target [SQL Server extended events]
- event bucketing target
- targets [SQL Server extended events], bucketing
ms.assetid: 2ea39141-7eb0-4c74-abf8-114c2c106a19
author: mashamsft
ms.author: mathoma
manager: craigg
ms.openlocfilehash: 4a584311061a24d674eed114f37d9cbbbda43909
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "66064702"
---
# <a name="histogram-target"></a>Цель гистограммы
  Цель гистограммы группирует вхождения определенного типа событий на основе данных о событии. Группирование событий основано на определенном столбце событий или действии. Цель гистограммы вы можете использовать для поиска и устранения проблем с производительностью. Найдя наиболее часто происходящие события, можно найти «горячие точки», показывающие потенциальную причину возникновения проблемы производительности.  
  
 В следующей таблице описываются параметры, которые можно использовать для настройки цели гистограммы.  
  
|Параметр|Допустимые значения|Описание|  
|------------|--------------------|-----------------|  
|slots|Любое целочисленное значение. Это значение является необязательным.|Заданное пользователем значение, указывающее максимальное число группирований. При достижении этого значения новые события, не принадлежащие к существующим группам, пропускаются.<br /><br /> Обратите внимание, что для повышение производительности, номер слота округляется до следующей степени числа 2.|  
|filtering_event_name|Любое событие, участвующее в сеансе расширенных событий. Это значение является необязательным.|Пользовательское значение, которое используется для идентификации класса событий. Группируются только экземпляры указанного события. Все остальные события не учитываются.<br /><br /> Если указывается это значение, то следует использовать формат *имя_пакета*.*имя_события*, например `'sqlserver.checkpoint_end'`. Определить имя пакета можно с помощью следующего запроса:<br /><br /> ВЫБЕРИТЕ p.name, se.event_name<br />FROM sys.dm_xe_session_events se<br />Присоединяйтесь к sys.dm_xe_packages p<br />Se_event_package_guid = p.guid<br />ORDER BY p.name, se.event_name<br /><br /> <br /><br /> Если не указывается значение параметра filtering_event_name, то для параметра source_type следует установить значение 1 (значение по умолчанию).|  
|source_type|Тип объекта, на котором основан сегмент. Это значение необязательно. Когда оно не задано, по умолчанию равно 1.|Может иметь одно из следующих значений:<br /><br /> 0 для события<br /><br /> 1 для действия|  
|источник|Имя столбца событий или действия.|Имя столбца событий или действия, которое используется в качестве источника данных.<br /><br /> При указании столбца событий для источника необходимо указать столбец из события, которое указывается в качестве значения для параметра filtering_event_name. Определить потенциальные столбцы можно с помощью следующего запроса:<br /><br /> SELECT name FROM sys.dm_xe_object_columns<br />WHERE object_name = '\<eventname>'<br />AND column_type != 'readonly'<br /><br /> При указании столбца события для источника нет необходимости включать имя пакета в значение источника.<br /><br /> При указании имени действия для источника необходимо использовать одно из действий, которые были настроены для коллекции в сеансе события, для которого используется данная цель. Чтобы найти потенциальные значения для имени действия, можно выполнить запрос к столбцу action_name представления sys.dm_xe_sesssion_event_actions.<br /><br /> Если имя действия используется в качестве источника данных, необходимо указать исходное значение в следующем формате: *имя_пакета*.*имя_действия*.|  
  
 В следующем примере на высоком уровне показывается, как цель гистограммы собирает данные. В данном примере цель гистограммы будет использоваться для подсчета количества возникших случаев ожидания для каждого типа ожидания. Для этого при определении цели гистограммы необходимо указать следующие параметры:  
  
-   filtering_event_name = 'wait_info'  
  
-   source = 'wait_type'  
  
-   source_type = 0 (поскольку wait_type — это столбец события)  
  
 В сценарии примера для источника wait_type записаны следующие данные.  
  
|Фильтрация имени события|Значение столбца источника|  
|--------------------------|-------------------------|  
|wait_info|file_io|  
|wait_info|file_io|  
|wait_info|сеть|  
|wait_info|сеть|  
|wait_info|sleep|  
  
 Значения типа ожидания будут разделены на три слота со следующими значениями и числом слотов.  
  
|Значение|Число слотов|  
|-----------|----------------|  
|file_io|2|  
|сеть|2|  
|sleep|1|  
  
 Цель гистограммы сохраняет только данные о событии для указанного источника. Иногда данные событий могут оказаться слишком большими, чтобы их можно было сохранить полностью, в этих случаях данные усекаются. Если данные событий усекаются, число байт записывается и отображается в виде XML-выхода.  
  
## <a name="adding-the-target-to-a-session"></a>Добавление цели к сеансу  
 Для добавления цели гистограммы в сеанс расширенных событий, в зависимости от нужного типа целевого объекта следует использовать одну из следующих инструкций при создании или изменении сеанса события.  
  
```  
ADD TARGET package0.histogram  
```  
  
 Для задания различных параметров можно использовать инструкцию SET. В приведенном ниже примере показано добавление цели гистограммы, в которой собираются данные для события sqlserver.checkpoint_end.  
  
```  
ADD TARGET package0.histogram  
(SET slots = 32, filtering_event_name = 'sqlserver.checkpoint_end', source_type = 0, source = 'database_id')  
```  
  
 Дополнительные сведения см. в разделах [Поиск объектов, на которые наложено наибольшее число блокировок](../relational-databases/extended-events/find-the-objects-that-have-the-most-locks-taken-on-them.md) и [Отслеживание активности системы с помощью расширенных событий](../relational-databases/extended-events/monitor-system-activity-using-extended-events.md).  
  
## <a name="reviewing-the-target-output"></a>Просмотр целевого вывода  
 Цель гистограммы сериализует данные для вызывающей программы или процедуры в формате XML. Результат цели не соответствует ни одной схеме.  
  
 Для просмотра выходных данных цели гистограммы можно воспользоваться следующим запросом, заменив параметр *session_name* на имя сеанса события:  
  
```  
SELECT name, target_name, CAST(xet.target_data AS xml)  
FROM sys.dm_xe_session_targets AS xet  
JOIN sys.dm_xe_sessions AS xe  
   ON (xe.address = xet.event_session_address)  
WHERE xe.name = 'session_name'  
```  
  
 В следующем примере показан формат вывода цели гистограммы.  
  
```  
<Slots truncated = "0" buckets=[count]>  
    <Slot count=[count] trunc=[truncated bytes]>  
        <value>  
        </value>  
    </Slot>  
</Slots>  
```  
  
## <a name="see-also"></a>См. также  
 [Цели расширенных событий SQL Server](../../2014/database-engine/sql-server-extended-events-targets.md)   
 [sys.dm_xe_session_targets (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql)   
 [CREATE EVENT SESSION (Transact-SQL)](/sql/t-sql/statements/create-event-session-transact-sql)   
 [ALTER EVENT SESSION (Transact-SQL)](/sql/t-sql/statements/alter-event-session-transact-sql)  
  
  
