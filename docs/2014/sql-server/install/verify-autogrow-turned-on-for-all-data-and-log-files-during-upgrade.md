---
title: Проверьте Автоувеличение размера включено для всех файлов данных и журналов во время обновления | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- log files [SQL Server], size
- data files [SQL Server], size
- tempdb [SQL Server], size
- autogrow [SQL Server]
ms.assetid: a5860904-e2be-4224-8a51-df18a10d3fb9
author: mashamsft
ms.author: mathoma
manager: craigg
ms.openlocfilehash: 0217d959759a59e49ce76e4a841c5d52e958e9ce
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "66091219"
---
# <a name="verify-autogrow-is-turned-on-for-all-data-and-log-files-during-the-upgrade-process"></a>Убедитесь, что во время процесса обновления автоувеличение размера включено для всех файлов с данными и файлов журнала
  Помощник по обновлению обнаружил файлы данных или журнала, для которых не установлен параметр «Автоувеличение». Новые и усовершенствованные функции требуют дополнительного места на диске для пользовательских баз данных и **tempdb** системной базы данных. Чтобы обеспечить ресурсы позволяют справиться с увеличением размеров при обновлении и последующих рабочих операциях, рекомендуется Автоувеличение для всех файлов журналов и данных пользователей и **tempdb** файлов данных и журналов, перед обновлением.  
  
 После окончания обновления и тестирования рабочей нагрузки можно отключить автоувеличение или соответствующим образом откорректировать значение приращения FILEGROWTH для файлов журналов и пользовательских данных. Рекомендуется оставить Автоувеличение включенным для **tempdb** системной базы данных. Дополнительные сведения см. в разделе «Планирование загрузки базы данных tempdb» в электронной документации по [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
## <a name="component"></a>Компонент  
 [!INCLUDE[ssDE](../../includes/ssde-md.md)]  
  
## <a name="description"></a>Описание  
 **файлы данных**  
  
 Следующая таблица отображает изменения тех функций [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], которые приводят к росту требований к месту на диске для определяемых пользователем файлов данных.  
  
|Компонент|Изменения, появившиеся в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]|  
|-------------|-----------------------------------------------------|  
|Полнотекстовый|Вместо полнотекстового каталога в файле данных сохраняется схема идентификаторов документов.|  
|Столбцы типа `text`, `ntext` и `image`|Столбцы больших объектов (LOB), определенные как данные типа `text`, `ntext` или `image`, дополнительно требуют 40 байт места на диске на каждый столбец. Это единовременное увеличение необходимого пространства происходит при первом обновлении каждого столбца LOB.|  
|метаданные|В файловой группе PRIMARY каждой пользовательской базы данных создаются и поддерживаются дополнительные системные метаданные для объектов базы данных и разрешений пользователей. Например, в более ранних версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] разрешения, связанные с объектами, предоставляющими или получающими разрешения, хранились в одной строке в виде битовой карты. Битовая карта расширена до нескольких строк.<br /><br /> Для того чтобы в ходе обновления сохранились как старые, так и новые метаданные, необходимо, чтобы было достаточно места на диске. Старые метаданные удаляются после завершения обновления.|  
  
 **Файлы журнала транзакций**  
  
 Следующая таблица отображает изменения тех функций [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], которые приводят к росту требований к месту на диске для определяемых пользователем файлов журнала транзакций.  
  
|Компонент|Изменения, появившиеся в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]|  
|-------------|-----------------------------------------------------|  
|Восстановление из резервной копии или по журналу транзакций|Во время стадии отката при восстановлении после сбоя [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] дает возможность пользователям производить доступ к базе данных. Это возможно потому, что транзакции, не зафиксированные на момент возникновения сбоя, повторно получают все блокировки, которыми они владели перед сбоем. При откате транзакций эти блокировки защищают транзакции от вмешательства пользователей. Эти дополнительные данные о блокировках должны сохраняться в журнале транзакций.|  
  
 **файлы данных и журналов tempdb**  
  
 В более ранних версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], **tempdb** база данных используется для хранения следующих объектов:  
  
-   явно создаваемые временные объекты: таблицы, хранимые процедуры, табличные переменные и курсоры;  
  
-   внутренние рабочие таблицы, создаваемые компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)];  
  
-   результаты временных сортировок при создании или перестроении индексов, если указан параметр SORT_IN_TEMPDB.  
  
 Дополнительные объекты также используют **tempdb** базы данных. В следующей таблице перечислены изменения или дополнения [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] функции, которые требуют увеличения места на диске для **tempdb** файлов данных и журналов.  
  
|Компонент|Изменения, появившиеся в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]|  
|-------------|-----------------------------------------------------|  
|Управление версиями строк|Управление версиями строк — это стандартная структура в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], используемая для следующих действий.<br /><br /> Поддерживаются триггеры: Создание таблиц inserted и deleted в триггерах. Предусмотрено управление версиями для всех строк, изменяемых триггером, в том числе строк, измененных инструкцией, которая инициировала триггер, а также всех изменений данных, выполненных триггером; Триггеры AFTER используют хранилище версий **tempdb** для сохранения предыдущих образов строк, измененных триггером. При массовой загрузке данных с включенными триггерами копия каждой строки добавляется в хранилище версий.<br /><br /> Поддержка режима MARS. Если в ходе сеанса MARS выдается инструкция изменения данных (например, INSERT, UPDATE или DELETE) в момент, когда есть активный результирующий набор, выполняется управление версиями строк, которых коснулось изменение.<br /><br /> поддержки операций с индексами, в которых задан параметр ONLINE; Для действий с индексами в оперативном режиме применяется управление версиями строк, позволяющее изолировать действия с индексами от воздействия изменений, внесенных другими транзакциями. Это исключает необходимость запрашивать общую блокировку уже считанных записей. Кроме того, пользователь одновременных операций обновления и удаления во время индексами в сети операции требуют места для сохранения записей версий в **tempdb**.<br /><br /> поддержки уровней изоляции транзакций на основе управления версиями; новой реализации уровня изоляции READ COMMITTED, который использует управление версиями строк для обеспечения совместимости считывания на уровне инструкций; нового уровня изоляции и моментального снимка для обеспечения совместимости считывания на уровне транзакций.<br /><br /> <br /><br /> Версии строк хранятся в **tempdb** хранилище версий в соответствии с требованиями транзакций, выполняющихся на уровнях изоляции на основе управления версиями.<br /><br /> Дополнительные сведения об управлении версиями строк и хранилище версий см. в разделе «Основные сведения об уровнях изоляции на основе управления версиями строк» электронной документации по [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|Кэширование метаданных временных таблиц и временных переменных|Для каждых метаданных временной таблицы и временной переменной, сохраненных в кэше средствами [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], две дополнительные страницы выделяются для **tempdb**.<br /><br /> Если хранимая процедура или триггер создает временную таблицу или временную переменную, то временный объект не удаляется, когда процедура или триггер завершает свое выполнение. Вместо этого временный объект усекается до одной страницы и используется заново в следующий раз, когда выполняется процедура или триггер.|  
|Индексы секционированных таблиц|Когда [!INCLUDE[ssDE](../../includes/ssde-md.md)] выполняет сортировку для построения секционированных индексов, достаточно места для хранения требуется запуски промежуточной сортировки каждой секции в **tempdb** Если присутствует параметр индекса SORT_IN_TEMPDB.|  
|[!INCLUDE[ssSB](../../includes/sssb-md.md)]|[!INCLUDE[ssSB](../../includes/sssb-md.md)] явным образом использует **tempdb** при сохранении существующего контекста диалогов, который не может находиться в памяти (примерно 1 КБ на диалог).<br /><br /> [!INCLUDE[ssSB](../../includes/sssb-md.md)] неявно использует **tempdb** , кэшируя объекты в контексте выполнения запроса. Например, рабочие таблицы используются для событий таймера и доставляемых в фоне диалогов.<br /><br /> Компонент DBMail, уведомления о событиях и уведомления о запросах неявно используют компонент [!INCLUDE[ssSB](../../includes/sssb-md.md)].|  
|Тип данных больших объектов (LOB)<br /><br /> Параметры и переменные больших объектов|Типы данных `varchar(max)`, `nvarchar(max)`, **varbinary (max) текст**, `ntext`, `image,` и `xml` являются типами больших объектов.<br /><br /> Когда в базе данных включен уровень изоляции транзакций на основе управления версиями строк и изменений больших объектов, измененный фрагмент типа LOB копируется в блок хранения версий **tempdb**.<br /><br /> Параметры, определяемые как типы данных больших объектов, сохраняются в **tempdb**.|  
|Обобщенные табличные выражения|Создаются временные рабочие таблицы для операций с буфером в **tempdb** при выполнении обобщенных табличных выражений.|  
  
## <a name="corrective-action"></a>Действие по исправлению  
 Чтобы назначить файлу данных или журнала автоувеличение, измените следующие инструкции, указывающие файлы данных и журнала для базы данных. Следует настроить увеличение параметра FILEGROWTH до значения, соответствующего среде.  
  
```  
ALTER DATABASE tempdb  
MODIFY FILE  
    (NAME = tempdev,  
    FILEGROWTH = 20MB);  
GO  
ALTER DATABASE tempdb  
MODIFY FILE  
    (NAME = templog,  
    FILEGROWTH = 10MB);  
```  
  
 Шаг роста по умолчанию для файлов данных равен 1 МБ. Значение по умолчанию для файла журнала равно 10 %. При настройке шага роста параметра FILEGROWTH пользуйтесь следующими общими рекомендациями.  
  
|Размер файла|Шаг роста FILEGROWTH|  
|---------------|--------------------------|  
|0–50 МБ|10 МБ|  
|100–200 МБ|20 МБ|  
|500 МБ и больше|10%|  
  
## <a name="see-also"></a>См. также  
 [Проблемы обновления компонента Database Engine](../../../2014/sql-server/install/database-engine-upgrade-issues.md)   
 [Помощник по обновлению SQL Server 2014 &#91;new&#93;](sql-server-2014-upgrade-advisor.md)  
  
  
