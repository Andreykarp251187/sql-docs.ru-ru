---
title: Шаг 3. Добавление перенаправления потока ошибок | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
ms.assetid: 5683a45d-9e73-4cd5-83ca-fae8b26b488c
author: janinezhang
ms.author: janinez
manager: craigg
ms.openlocfilehash: 3dd2fd95b1ad2d239d055b2b49b991860a58d338
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "62891406"
---
# <a name="step-3-adding-error-flow-redirection"></a>Шаг 3. Перенаправление потока ошибок
  Как было рассмотрено в предыдущей задаче, преобразование «Поиск ключа валюты» при попытке обработать поврежденный образец неструктурированного файла не может сформировать соответствие. Вместо этого формируется ошибка. Поскольку преобразование использует установки по умолчанию для вывода ошибки, любая возникшая ошибка приводит к неудачному завершению преобразования. При неудачном завершении преобразования выполнение пакета также завершается с ошибкой.  
  
 Чтобы предотвратить завершение преобразования с ошибкой, можно настроить вывод ошибок в этом компоненте таким образом, чтобы строка с ошибкой перенаправлялась на другой путь обработки. Использование отдельного пути обработки ошибок позволяет решить сразу несколько проблем. Например, можно попытаться очистить данные, а затем заново обработать строку с ошибкой. Можно также сохранить строку с ошибкой вместе с дополнительными сведениями об ошибке для последующей проверки и повторной обработки.  
  
 В этой задаче будет настроено преобразование «Поиск ключа валюты» так, чтобы все строки с ошибками перенаправлялись на вывод ошибок. Согласно ветке ошибок потока данных, эти строки будут записаны в файл.  
  
 По умолчанию два дополнительных столбца в выводе ошибок служб [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] , **ErrorCode** и **ErrorColumn**, содержат только числовые коды, представляющие номер ошибки и идентификатор столбца, в котором произошла ошибка. Эти числовые значения могут быть малополезны без соответствующего описания ошибки.  
  
 Чтобы повысить информативность вывода ошибок, перед тем как пакет запишет строки с ошибками в файл, следует с помощью компонента скрипта получить доступ к API-интерфейсу служб [!INCLUDE[ssISnoversion](../includes/ssisnoversion-md.md)] и извлечь описание ошибки.  
  
### <a name="to-configure-an-error-output"></a>Настройка выхода ошибок  
  
1.  В окне **Область элементов SSIS**разверните узел **Общие**и перетащите элемент **Компонент скрипта** в область конструктора на вкладке **Поток данных** . Поместите **Скрипт** справа от преобразования **Поиск ключа валюты** .  
  
2.  В диалоговом окне **Выбор типа компонента скрипта** выберите **Преобразование**и нажмите кнопку **ОК**.  
  
3.  Щелкните преобразование **Поиск ключа валюты** и перетащите красную стрелку на вновь созданное преобразование **Скрипт** , соединив эти два компонента.  
  
     Красная стрелка отображает вывод ошибок преобразования **Поиск ключа валюты** . Используя красную стрелку для подключения преобразования к компоненту скрипта, можно перенаправить любые ошибки обработки компоненту скрипта, который обрабатывает их и отправляет по назначению.  
  
4.  В диалоговом окне **Настройка вывода ошибок** в столбце **Ошибка** выберите **Перенаправить строку**и нажмите кнопку **ОК**.  
  
5.  В области конструктора **Поток данных** щелкните элемент **Компонент скрипта** в только что добавленном преобразовании **ScriptComponent**и измените имя на **Получение описания ошибки**.  
  
6.  Дважды щелкните преобразование **Получение описания ошибки** .  
  
7.  В диалоговом окне **Редактор преобразования «Скрипт»** на странице **Входные столбцы** выберите столбец **ErrorCode** .  
  
8.  На странице **Входы и выходы** раскройте **Выход 0**, выберите **Выходные столбцы**и нажмите кнопку **Добавить столбец**.  
  
9. В `Name` введите **ErrorDescription** и задайте `DataType` свойства **строка в Юникоде [DT_WSTR]**.  
  
10. На **сценарий** странице, убедитесь, что `LocaleID` свойству **английский (Соединенные Штаты Америки.**  
  
11. Нажмите кнопку **Изменить скрипт** , чтобы открыть среду [!INCLUDE[msCoName](../includes/msconame-md.md)] [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] Tools for Applications (VSTA). В методе `Input0_ProcessInputRow` введите или вставьте следующий код:  
  
     [Visual Basic]  
  
    ```  
    Row.ErrorDescription =   
      Me.ComponentMetaData.GetErrorDescription(Row.ErrorCode)  
    ```  
  
     [Visual C#]  
  
    ```  
    Row.ErrorDescription = this.ComponentMetaData.GetErrorDescription(Row.ErrorCode);  
    ```  
  
     Готовая подпрограмма должна выглядеть так:  
  
     [Visual Basic]  
  
    ```  
    Public Overrides Sub Input0_ProcessInputRow(ByVal Row As Input0Buffer)  
  
      Row.ErrorDescription =   
        Me.ComponentMetaData.GetErrorDescription(Row.ErrorCode)  
  
    End Sub  
    ```  
  
     [Visual C#]  
  
    ```  
    public override void Input0_ProcessInputRow(Input0Buffer Row)  
        {  
  
            Row.ErrorDescription = this.ComponentMetaData.GetErrorDescription(Row.ErrorCode);  
  
        }  
    ```  
  
12. В меню **Построение** выберите команду **Построить решение** , чтобы создать скрипт и сохранить изменения, а затем закройте средства VSTA.  
  
13. Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно **Редактор преобразования «Скрипт»** .  
  
## <a name="next-steps"></a>Следующие шаги  
 [Шаг 4: Добавление назначения неструктурированных файлов] (lesson-4-4-adding-a-flat-file-destination.md  
  
  
