---
title: Определение степени гранулярности измерения в группе мер | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology:
- analysis-services
ms.topic: conceptual
ms.assetid: 4f079485-9eb4-405c-9a20-81258298b810
author: minewiskan
ms.author: owend
manager: craigg
ms.openlocfilehash: e1d7b619cb711938f07ae7902dc1b9544adc5890
ms.sourcegitcommit: f7fced330b64d6616aeb8766747295807c92dd41
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62728875"
---
# <a name="defining-dimension-granularity-within-a-measure-group"></a>Определение степени гранулярности измерения в группе мер
  Для разных целей пользователям может понадобиться измерять данные фактов с разной степенью гранулярности или точности. Например, сведения о продажах через посредников или о продажах через Интернет могут записываться каждый день, в то время как данные о квотах продаж могут существовать только для уровня месяца или квартала. В таких случаях пользователям требуется, чтобы измерение времени обладало разной степенью гранулярности для каждой из этих разных таблиц фактов. Определить новое измерение базы данных как измерение времени с другой степенью гранулярности проще всего с помощью служб [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)].  
  
 По умолчанию, если измерение используется в группе мер, службы [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)]выполняют грануляцию данных в этом измерении на основе ключевого атрибута измерения. Например, если измерение времени включено в группу мер и применяемая по умолчанию степень гранулярности измерения времени составляет один день, то применяемая по умолчанию степень детализации этого измерения в группе мер также равна одному дню. Это применимо во многих случаях, например для групп мер **Internet Sales** и **Товарооборот посредников** в этом учебнике. Но когда такое измерение включается в иные типы групп мер, такие как квоты продаж или группа бюджетных показателей, более подходящей степенью гранулярности будет месяц или квартал.  
  
 Чтобы указать степень гранулярности измерения куба, которая отличается от используемой по умолчанию, следует изменить атрибут гранулярности данного измерения куба как применяемого в конкретной группе мер на вкладке **Использование измерений** в конструкторе кубов. При изменении степени детализации измерения в конкретной группе мер на атрибут, отличный от ключевого атрибута данного измерения, необходимо обеспечить прямую или косвенную связь всех остальных атрибутов в этой группе мер с новым атрибутом гранулярности. Для этого следует указать связи атрибутов между другими атрибутами и атрибутом, заданным как атрибут гранулярности для этой группы мер. В этом случае следует указать дополнительные связи атрибутов, не удаляя существующие связи между атрибутами. Атрибут, указанный как атрибут гранулярности, становится ключевым атрибутом в группе мер для оставшихся атрибутов измерения. Если требуемые связи атрибутов не указаны, в службах [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] статистические вычисления будут вестись неверно, что демонстрируют задачи данного занятия.  
  
 Дополнительные сведения см. в разделе [Связи измерений](multidimensional-models-olap-logical-cube-objects/dimension-relationships.md), [Определение обычной связи и ее свойств](multidimensional-models/define-a-regular-relationship-and-regular-relationship-properties.md).  
  
 В задачах данного раздела требуется добавить группу мер Sales Quotas и определить помесячную степень гранулярности измерения даты в этой группе мер. Затем предстоит определить связи атрибутов месяца с другими атрибутами измерения, чтобы обеспечить правильность статистических вычислений в службах [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] .  
  
## <a name="adding-tables-and-defining-the-sales-quotas-measure-group"></a>Добавление таблиц и определение группы мер Sales Quotas  
  
1.  Перейдите в представление источника данных **Adventure Works DW 2012** .  
  
2.  Щелкните правой кнопкой мыши **Организатор** панели щелкните **новую схему**и назовите схему `Sales Quotas`.  
  
3.  Перетащите **сотрудника**, **Территория продаж**, и `Date` таблицы из **таблиц** панели **схема** области.  
  
4.  Добавьте таблицу **FactSalesQuota** на панель **Диаграмма** , щелкнув правой кнопкой мыши на панели **Диаграмма** и выбрав команду **Добавить или удалить таблицы**.  
  
     Обратите внимание, что таблица **SalesTerritory** связана с таблицей **FactSalesQuota** через таблицу **Сотрудник** .  
  
5.  Просмотрите столбцы таблицы **FactSalesQuota** и исследуйте данные в этой таблице.  
  
     Обратите внимание, что внутри этой таблицы гранулярность данных равна календарному кварталу, что является наиболее подробным уровнем детализации в таблице FactSalesQuota.  
  
6.  В конструкторе представлений источников данных, измените **FriendlyName** свойство **FactSalesQuota** таблицу `SalesQuotas`.  
  
7.  Переключитесь на куб [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial и откройте вкладку **Структура куба** .  
  
8.  Щелкните правой кнопкой мыши **меры** панели щелкните **группы мер**, нажмите кнопку `SalesQuotas` в **группы мер** диалоговое окно, а затем щелкните **ОК**.  
  
     `Sales Quotas` Отображается группа мер **меры** области. В **измерения** области, обратите внимание, что новый `Date` измерение куба также определяется, на основе `Date` измерения базы данных. Определение нового измерения куба по времени объясняется неопределенностью в вопросе, какое из существующих связанных со временем измерений куба должно быть связано в службах [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] со столбцом **DateKey** таблицы фактов **FactSalesQuota** , которая лежит в основе группы мер "Квоты продаж". Это будет исправлено позже, в другой задаче текущего раздела.  
  
9. Разверните `Sales Quotas` группы мер.  
  
10. В панели **Меры** выберите элемент **Sales Amount Quota**и в окне свойств задайте для свойства **FormatString** значение **Валюта** .  
  
11. Выберите **Sales Quotas Count** измерения, а затем введите `#,#` как значение для **FormatString** свойства в окне «Свойства».  
  
12. Удалить **Календарный квартал** меру `Sales Quotas` группы мер.  
  
     [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] будет определено, что лежащий в основе показателя Calendar Quarter столбец содержит меры. Однако данный столбец и столбец CalendarYear содержат значения, которые будут использованы позднее в этом разделе для связывания группы мер Sales Quotas с измерением даты.  
  
13. В **меры** панели, щелкните правой кнопкой мыши `Sales Quotas` группу мер, а затем нажмите кнопку **новую меру**.  
  
     Будет открыто диалоговое окно **Создать меру** , содержащее доступные исходные столбцы для меры с типом использования **Sum**.  
  
14. В **новую меру** выберите **числа различных объектов** в **использования** списке, убедитесь, что `SalesQuotas` выбран в **исходной таблицы** выберите **EmployeeKey** в **исходный столбец** , а затем нажмите **ОК**.  
  
     Обратите внимание, что это измерение создается в новой группе мер с именем **Sales Quotas 1**. Меры числа различных объектов в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] создаются в их собственных группах мер, чтобы повысить скорость обработки.  
  
15. Измените значение **имя** свойство для **Employee Key Distinct Count** меру `Sales Person Count`, а затем введите `#,#` как значение для **FormatString** свойство.  
  
## <a name="browsing-the-measures-in-the-sales-quota-measure-group-by-date"></a>Просмотр мер в группе Sales Quota по датам  
  
1.  В меню **Сборка** выберите команду **Развернуть Analysis Services Tutorial**.  
  
2.  После успешного завершения развертывания в конструкторе кубов, где открыт куб **Tutorial, перейдите на вкладку** Браузер [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] и нажмите кнопку **Повторное соединение** .  
  
3.  Щелкните ярлык Excel, а затем выберите **Включить**.  
  
4.  В списке полей сводной таблицы разверните узел `Sales Quotas` группу мер, а затем перетащите **Sales Amount Quota** меру в область значений.  
  
5.  Разверните измерение **Территория продаж** и перетащите определенную пользователем иерархию **Территории продаж** в область меток строк.  
  
     Обратите внимание, что измерение куба Sales Territory ни прямо, ни косвенно не связано с таблицей фактов квот продаж, как показано на следующем рисунке.  
  
     ![Измерение куба Sales Territory](../../2014/tutorials/media/l5-granularity-2.gif "измерение куба Sales Territory")  
  
     На следующих этапах этого раздела будет определена ссылочная связь измерений между данным измерением и данной таблицей фактов.  
  
6.  Переместите определенную пользователем иерархию **Sales Territories** из области «Метки строк» в область «Метки столбцов».  
  
7.  В списке полей сводной таблицы выберите определенную пользователем иерархию **Территории продаж** и щелкните стрелку вниз справа.  
  
     ![Иерархия Sales Territories в списке полей](../../2014/tutorials/media/l5-granularity-1a.png "иерархия Sales Territories в списке полей")  
  
8.  В фильтре установите флажок «Выбрать все», чтобы сбросить все выбранные элементы, а затем выберите только **North America**.  
  
     ![Область фильтра для выбора North America](../../2014/tutorials/media/l5-granularity-1b.png "область фильтра для выбора North America")  
  
9. В списке полей сводной таблицы разверните узел `Date`.  
  
10. Перетащите определенную пользователем иерархию **Date.Fiscal Дата** в область «Метки строк».  
  
11. Внутри сводной таблицы щелкните стрелку вниз рядом с названием «Метки строк». Снимите флажки для всех годов, кроме **FY 2008**.  
  
     Обратите внимание на то, что только **июля 2007** членом **месяц** уровень появлении вместо **июля 2007 г.**, **августа 2007 г.** и **Сентября 2007 г.** членами **месяц** уровень и что только **1 июля 2007 года** членом `Date` отображается уровень, вместо всех 31 день. Это происходит, поскольку степень детализации данных в таблице фактов находится на уровне квартала, а степень детализации `Date` измерения установлена на уровне дня. Это будет изменено позже, в следующей задаче данного раздела.  
  
     Кроме того, обратите внимание, что значение **Sales Amount Quota** на уровнях месяца и дня равно соответствующему значению на уровне квартала и составляет 13 733 000,00 доллара США. Это связано с тем, что самый подробный уровень данных для группы мер «Квоты продаж» соответствует кварталу. Это поведение будет изменено на занятии 6.  
  
     На следующем рисунке показаны значения элемента **Sales Amount Quota**.  
  
     ![Значения Sales Amount квоты](../../2014/tutorials/media/l5-granularity-3.png "значения Sales Amount квоты")  
  
## <a name="defining-dimension-usage-properties-for-the-sales-quotas-measure-group"></a>Определение свойств использования измерений для группы мер Sales Quotas  
  
1.  Откройте в конструкторе измерений измерение **Сотрудник** , щелкните правой кнопкой мыши столбец **SalesTerritoryKey** на панели **Представление источника данных** и выберите команду **Создать атрибут из столбца**.  
  
2.  В панели **Атрибуты** выберите атрибут **SalesTerritoryKey**и в окне свойств задайте для свойства **AttributeHierarchyVisible** значение **False** , затем для свойства **AttributeHierarchyOptimizedState** задайте значение **NotOptimized**, а для свойства **AttributeHierarchyOrdered** — значение **False**.  
  
     Этот атрибут необходим для связи **Территория продаж** измерения `Sales Quotas` и **квоты продаж 1** групп мер в качестве ссылочного измерения.  
  
3.  В конструкторе кубов для [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] куба учебника по службам, нажмите кнопку **Использование измерений** вкладке, а затем просмотрите использование измерений в `Sales Quotas` и **квоты продаж 1** группы мер.  
  
     Обратите внимание, что **сотрудника** и `Date` связанные измерения куба **квоты продаж квоты продаж 1** группами мер через обычные связи. Кроме того, обратите внимание, что измерение куба **Территория продаж** не связано ни с одной из этих групп мер.  
  
4.  Щелкните ячейку на пересечении **Территория продаж** измерения и `Sales Quotas` группу мер, а затем нажмите кнопку обзора (**...** ). Будет открыто диалоговое окно **Задание связи** .  
  
5.  В списке **Выберите тип связи** выберите значение **Ссылочная**.  
  
6.  В списке **Промежуточное измерение** выберите значение **Employee**.  
  
7.  В списке **Атрибут ссылочного измерения** выберите значение **Sales Territory Region**.  
  
8.  В списке **Атрибут промежуточного измерения** выберите значение **Sales Territory Key**. (Ключевым столбцом атрибута «Регион территории продаж» является столбец SalesTerritoryKey.)  
  
9. Убедитесь, что установлен флажок **Материализовать** .  
  
10. Нажмите кнопку **ОК**.  
  
11. Щелкните ячейку на пересечении **Территория продаж** измерения и **квоты продаж 1** группу мер, а затем нажмите кнопку обзора (**...** ). Будет открыто диалоговое окно **Задание связи** .  
  
12. В списке **Выберите тип связи** выберите значение **Ссылочная**.  
  
13. В списке **Промежуточное измерение** выберите значение **Employee**.  
  
14. В списке **Атрибут ссылочного измерения** выберите значение **Sales Territory Region**.  
  
15. В списке **Атрибут промежуточного измерения** выберите значение **Sales Territory Key**. (Ключевым столбцом атрибута «Регион территории продаж» является столбец SalesTerritoryKey.)  
  
16. Убедитесь, что установлен флажок **Материализовать** .  
  
17. Нажмите кнопку **ОК**.  
  
18. Удалить `Date` измерения куба.  
  
     Вместо четырех измерений куба по времени, вы воспользуетесь **Дата заказа** измерение куба в `Sales Quotas` даты, относительно которой будут распределяться квоты продаж для группы мер. Это измерение куба также будет использоваться как первичное измерение даты в кубе.  
  
19. В **измерения** списка, переименовать **Дата заказа** измерения куба на `Date`.  
  
     Переименование **Дата заказа** измерения куба на `Date` упрощает его восприятие как первичного измерения даты в этом кубе.  
  
20. Нажмите кнопку обзора (**...** ) в ячейке на пересечении `Sales Quotas` группы мер и `Date` измерения.  
  
21. В диалоговом окне **Определение связи** в списке **Выберите тип связи** выберите значение **Обычная** .  
  
22. В списке **Атрибут гранулярности** выберите значение **Calendar Quarter**.  
  
     Будет выведено предупреждение, что в качестве атрибута гранулярности выбран неключевой атрибут и необходимо убедиться, что все остальные атрибуты прямо или косвенно связаны с этим атрибутом гранулярности, указав их в качестве свойств элементов.  
  
23. В области **Связи** диалогового окна **Задание связи** соедините столбцы измерений **CalendarYear** и **CalendarQuarter** из таблицы, лежащей в основе измерения Date куба, со столбцами **CalendarYear** и **CalendarQuarter** из таблицы, лежащей в основе группы мер Sales Quota, а затем нажмите кнопку **ОК**.  
  
    > [!NOTE]  
    >  Атрибут Calendar Quarter определен как атрибут гранулярности для измерения Date куба в группе мер Sales Quotas, однако атрибут Date продолжает оставаться атрибутом гранулярности для групп мер Internet Sales и Reseller Sales.  
  
24. Повторите предыдущие четыре шага для группы мер **Sales Quotas 1** .  
  
## <a name="defining-attribute-relationships-between-the-calendar-quarter-attribute-and-the-other-dimension-attributes-in-the-date-dimension"></a>Определение связей атрибутов между атрибутом Calendar Quarter и другими атрибутами измерения даты  
  
1.  Переключиться в режим **конструктор измерений** для `Date` измерения, а затем нажмите кнопку **связи атрибутов** вкладки.  
  
     Обратите внимание, что, несмотря на то что **календарный год** связана с **Календарный квартал** через **Календарное полугодие** атрибутов, атрибуты связаны только один финансовый календарь другой; они не соединены с **Календарный квартал** атрибут и таким образом будет не вычисляется в правильно `Sales Quotas` группы мер.  
  
2.  На диаграмме щелкните правой кнопкой мыши атрибут **Календарный квартал** , а затем выберите команду **Создать связь атрибутов**.  
  
3.  В диалоговом окне **Создание связи атрибутов** поле **Исходный атрибут** имеет значение **Calendar Quarter**. Установите поле **Связанный атрибут** в значение **Fiscal Quarter**.  
  
4.  Нажмите кнопку **ОК**.  
  
     Обратите внимание, что появится предупреждающее сообщение о том, что `Date` измерения содержит один или несколько избыточных связей атрибутов, которые могут помешать статистической обработке когда как атрибут гранулярности используется неключевой атрибут данных.  
  
5.  Удалите связь атрибута **Финансовый квартал** с атрибутом **Название месяца** .  
  
6.  В меню **Файл** выберите команду **Сохранить все**.  
  
## <a name="browsing-the-measures-in-the-sales-quota-measure-group-by-date"></a>Просмотр мер в группе Sales Quota по датам  
  
1.  В меню **Сборка** выберите команду **Развернуть Analysis Services Tutorial**.  
  
2.  После успешного завершения развертывания перейдите на вкладку **Браузер** конструктора кубов для куба [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial и нажмите кнопку **Повторное соединение**.  
  
3.  Щелкните ярлык Excel, а затем выберите **Включить**.  
  
4.  Перетащите меру **Sales Amount Quota** в область значений.  
  
5.  Перетащите определенную пользователем иерархию **Sales Territories** в область «Метки столбцов», а затем примените фильтр по значению **North America**.  
  
6.  Перетащите пользовательскую иерархию **Date.FiscalDate** в область «Метки строк», а затем щелкните стрелку вниз рядом с названием **Метки столбцов** в сводной таблице и снимите все флажки, кроме **FY 2008**, чтобы отобразить данные только для финансового года 2008.  
  
7.  Нажмите кнопку «ОК».  
  
8.  Последовательно разверните элементы **FY 2008**, **H1 FY 2008**и **Q1 FY 2008**.  
  
     На следующем рисунке показана сводная таблица для куба [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial, при этом группа мер Sales Quota правильно распределена по измерениям.  
  
     Обратите внимание, что все элементы уровня финансового квартала имеют значение, соответствующее уровню квартала. Возьмем для примера **Q1 FY 2008** . Квота $ 9 180 000,00 для **Q1 FY 2008** также является значением каждого элемента этого квартала. Это обусловлено тем, что для данной таблицы фактов степень гранулярности установлена на уровне квартала, а степень гранулярности для измерения Date также установлена на уровне квартала. На занятии 6 рассматривается, как распределять квартальную сумму пропорционально по месяцам.  
  
     ![Группе Sales Quota правильно распределена элементам](../../2014/tutorials/media/l5-granularity-7.gif "группа мер Sales quota правильно распределена по измерениям")  
  
## <a name="next-lesson"></a>Следующее занятие  
 [Занятие 6. Определение вычислений](lesson-6-defining-calculations.md)  
  
## <a name="see-also"></a>См. также  
 [Связи измерений](multidimensional-models-olap-logical-cube-objects/dimension-relationships.md)   
 [Определение обычной связи и ее свойств](multidimensional-models/define-a-regular-relationship-and-regular-relationship-properties.md)   
 [Работа с диаграммами в конструкторе представлений источника данных (службы Analysis Services)](multidimensional-models/work-with-diagrams-in-data-source-view-designer-analysis-services.md)  
  
  
