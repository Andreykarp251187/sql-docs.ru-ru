---
title: Проектирование агрегатов (XMLA) | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: reference
helpviewer_keywords:
- statistical information [XML for Analysis]
- batches [XML for Analysis]
- aggregations [Analysis Services], XML for Analysis
- XMLA, aggregations
- queries [XMLA]
- XML for Analysis, aggregations
- iterative aggregation process [XMLA]
ms.assetid: 4dd27afa-10c7-408d-bc24-ca74217ddbcb
author: minewiskan
ms.author: owend
manager: craigg
ms.openlocfilehash: 81450789395dfef84f81896990fa251514d3489e
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "62702121"
---
# <a name="designing-aggregations-xmla"></a>Создание агрегатов (XMLA)
  Статические схемы связываются с секциями определенных групп мер, чтобы эти секции при хранении агрегатов использовали одинаковую структуру. Используя ту же структуру хранилища для секций позволяет легко определить секции, которые могут быть объединены с помощью [MergePartitions](https://docs.microsoft.com/bi-reference/xmla/xml-elements-commands/mergepartitions-element-xmla) команды. Дополнительные сведения о статистических схем см. в разделе [агрегаты и статистические схемы](../multidimensional-models-olap-logical-cube-objects/aggregations-and-aggregation-designs.md).  
  
 Чтобы определить агрегаты для статистической схемы, можно использовать [DesignAggregations](https://docs.microsoft.com/bi-reference/xmla/xml-elements-commands/designaggregations-element-xmla) в XML для аналитики (XMLA) команду. Команда `DesignAggregations` имеет свойства, которые указывают, какая статическая схема должна использоваться в качестве ссылки и каким образом производится управление процессом проектирования по этой ссылке. Команда `DesignAggregations` и ее свойства позволяют спроектировать агрегаты последовательно или в пакете, а затем просмотреть итоговую статистику создания для оценки процесса проектирования.  
  
## <a name="specifying-an-aggregation-design"></a>Задание статистической схемы  
 [Объект](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/object-element-xmla) свойство `DesignAggregations` команды должен содержать ссылку на объект для существующей статистической схемой. Ссылка содержит идентификаторы базы данных, куба, группы мер и статистической схемы. Если этой статистической схемы еще не существует, то возникнет ошибка.  
  
## <a name="controlling-the-design-process"></a>Управление процессом проектирования  
 Управление алгоритмом, используемым для определения агрегатов для статистической схемы, производится при помощи следующих свойств команды `DesignAggregations`.  
  
-   [Действия](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/steps-element-xmla) свойство определяет, сколько итераций `DesignAggregations` должна выполнить команда, перед возвратом управления клиентскому приложению.  
  
-   [Время](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/time-element-xmla) свойство определяет, сколько миллисекунд `DesignAggregations` должна выполнить команда, перед возвратом управления клиентскому приложению.  
  
-   [Оптимизации](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/optimization-element-xmla) свойство определяет процент улучшения производительности `DesignAggregations` команду следует попытаться достигнуть. При итеративном проектировании агрегатов это свойство необходимо передавать только в первой команде.  
  
-   [Хранения](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/storage-element-xmla) свойство определяет предполагаемый объем дискового пространства, в байтах, используемой `DesignAggregations` команды. При итеративном проектировании агрегатов это свойство необходимо передавать только в первой команде.  
  
-   [Материализовать](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/materialize-element-xmla) свойство определяет, является ли `DesignAggregations` команда должна создавать агрегаты, определенные во время проектирования. При последовательном проектировании агрегатов на время, пока они ни будут готовы к сохранению, этому свойству следует присвоить значение FALSE. При присваивании этому свойству значения TRUE текущий процесс проектирования завершается, а определенные агрегаты добавляются в указанную статистическую схему.  
  
## <a name="specifying-queries"></a>Задание запросов  
 DesignAggregations поддержка оптимизации с учетом использования команды, добавив один или несколько `Query` элементов в [запросы](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/queries-element-xmla) свойство. `Queries` Свойство может содержать один или несколько [запроса](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/query-element-xmla) элементов. Если свойство `Queries` не содержит ни одного элемента `Query`, то в указанной в элементе `Object` статистической схеме будет использоваться структура по умолчанию, которая содержит общий набор агрегатов. Этот набор разработан с учетом критериев, указанных в свойствах `Optimization` `Storage` команды `DesignAggregations`.  
  
 Каждый элемент `Query` представляет собой целевой запрос, с помощью которого при проектировании можно определить агрегаты, охватывающие наиболее часто используемые запросы. Можно определить целевые запросы самостоятельно, либо при помощи данных, сохраненных экземпляром служб [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] в журнале запросов, получить сведения о наиболее часто используемых запросах. При отправке команды `DesignAggregations` мастер оптимизации с учетом использования извлекает целевые запросы с помощью журнала запросов, основываясь на времени, использовании или указанном пользователе. Дополнительные сведения см. в разделе [основано на использовании Справка F1 мастера оптимизации](../usage-based-optimization-wizard-f1-help.md).  
  
 При многократном проектировании агрегатов поисковые запросы необходимо передать только в первой команде `DesignAggregations`, поскольку экземпляр служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] сохраняет целевые запросы и использует их при выполнении последующих команд `DesignAggregations`. После передачи целевых запросов в первой команде `DesignAggregations` многократной обработки, любые последующие команды `DesignAggregations`, в свойстве `Queries` которых содержатся поисковые запросы, приведут к формированию ошибки.  
  
 Элемент `Query` содержит значение с разделителями-запятыми, включающее следующие аргументы.  
  
 *Frequency*,*Dataset*[,*Dataset*...]  
  
 *Частота*  
 Весовой коэффициент, соответствующий количеству предыдущих выполнений данного запроса. Если `Query` элемент представляет новый запрос, *частота* значение представляет весовой коэффициент, использованный во время проектирования, чтобы выполнить запрос. По мере увеличения частоты, увеличивается и вес, присвоенный запросу во время проектирования.  
  
 *Набор данных*  
 Числовая строка, определяющая атрибуты измерения, включаемые в запрос. Количество символов в данной строке должно совпадать с количеством атрибутов в измерении. Ноль (0) обозначает, что атрибут, находящийся на указанной порядковой позиции, в запрос для указанного измерения не включается, тогда как единица (1) обозначает включение атрибута, находящегося на указанной порядковой позиции, в запрос для указанного измерения.  
  
 Так, например, строка «011» относится к запросу, в котором задействовано измерение с тремя атрибутами, причем в запрос включены только второй и третий атрибут.  
  
> [!NOTE]  
>  Некоторые атрибуты не рассматриваются в наборе данных. Дополнительные сведения об исключенных атрибутах см. в разделе [элемент запроса &#40;XMLA&#41;](https://docs.microsoft.com/bi-reference/xmla/xml-elements-properties/query-element-xmla).  
  
 Каждое измерение в группе мер, включающее статистическую представленного *набора данных* значение в `Query` элемент. Порядок значений *Dataset* должен соответствовать порядку измерений, включенных в группу мер.  
  
## <a name="designing-aggregations-using-iterative-or-batch-processes"></a>Проектирование агрегатов при помощи последовательного или пакетного процесса  
 В зависимости того, какие интерактивные возможности необходимы процессу проектирования, команду `DesignAggregations` можно использовать в составе итеративного или пакетного процесса.  
  
### <a name="designing-aggregations-using-an-iterative-process"></a>Проектирование агрегатов при помощи последовательного процесса  
 Чтобы проектировать агрегаты последовательно, отправляют несколько команд `DesignAggregations` для обеспечения точности управления процессом проектирования. Мастер статистических схем использует этот же подход для точного управления процессом проектирования. Дополнительные сведения см. в разделе [статистической обработки Справка F1 мастера](../aggregation-design-wizard-f1-help.md).  
  
> [!NOTE]  
>  Для последовательного проектирования агрегатов требуется явный сеанс. Дополнительные сведения о явных сеансах см. в разделе [Управление соединениями и сеансами &#40;XMLA&#41;](managing-connections-and-sessions-xmla.md).  
  
 Чтобы начать последовательный процесс, сначала отправляется команда `DesignAggregations`, которая содержит следующие данные.  
  
-   Значения свойств `Storage` и `Optimization`, которые являются целевыми для всего процесса проектирования.  
  
-   Значения свойств `Steps` и `Time`, которыми ограничен первый шаг процесса проектирования.  
  
-   Если необходима оптимизация на основе использования, свойство `Queries` должно содержать запросы, которые являются целью всего процесса проектирования.  
  
-   Свойству `Materialize` присваивается значение FALSE. Присваивание этому свойству значения FALSE показывает, что по завершении этой команды процесс проектирования не будет сохранять определенные агрегаты в статистической схеме.  
  
 Первая команда `DesignAggregations` после завершения возвращает набор строк, содержащий статистику проектирования. Оценка этих данных позволит определить, следует ли продолжать процесс проектирования или же его необходимо завершить. Если процесс стоит продолжить, то отправляется еще одна команда `DesignAggregations`, содержащая значения `Steps` и `Time`, которыми будет ограничен данный шаг процесса проектирования. После этого производится оценка итоговой статистики и определяется, следует ли продолжать процесс проектирования. Такой последовательный процесс отправки команд `DesignAggregations` и оценки результатов продолжается до тех пор, пока не будут достигнуты поставленные цели и создан соответствующий набор определенных агрегатов.  
  
 После получения требуемого набора агрегатов отправляется одна завершающая команда `DesignAggregations`. Свойству `DesignAggregations` этой конечной команды `Steps` следует присвоить значение 1, а его свойству `Materialize` — значение TRUE. Завершающая команда `DesignAggregations` с такими параметрами заканчивает процесс проектирования и сохраняет определенный агрегат в статистической схеме.  
  
### <a name="designing-aggregations-using-a-batch-process"></a>Проектирование агрегатов при помощи пакетного процесса  
 Проектирование агрегатов также может производиться в рамках пакетного процесса путем отправки одной команды `DesignAggregations`, содержащей значения свойств `Steps`, `Time`, `Storage` и `Optimization`, которые являются целевыми и ограничивающими для всего процесса проектирования. Если необходима оптимизация на основе использования, то в свойство `Queries` следует также включить запросы, которые являются целью процесса проектирования. Проверьте также, что свойство `Materialize` имеет значение TRUE, чтобы после завершения команды процесс проектирования сохранил определенные агрегаты в статистической схеме.  
  
 Пакетный процесс позволяет проектировать агрегаты как в рамках явного, так и неявного сеанса. Дополнительные сведения о явных и неявных сеансах см. в разделе [Управление соединениями и сеансами &#40;XMLA&#41;](managing-connections-and-sessions-xmla.md).  
  
## <a name="returning-design-statistics"></a>Возврат статистики проектирования  
 При передаче управления клиентскому приложению команда `DesignAggregations` возвращает набор строк, состоящий из одной строки, в которой представлена статистика проектирования для этой команды. Набор строк содержит столбцы, перечисленные в следующей таблице.  
  
|Столбец|Data type|Описание|  
|------------|---------------|-----------------|  
|Шаги|Целочисленный|Число шагов, выполняемых командой перед возвратом управления клиентскому приложению.|  
|Time|Long integer|Время (в миллисекундах), прошедшее до того момента, когда команда вернула управление клиентскому приложению.|  
|Optimization|Double|Примерный процент прироста производительности, достигнутый командой перед возвратом управления клиентскому приложению.|  
|Память|Long integer|Примерный объем в байтах, занятый командой перед возвратом управления клиентскому приложению.|  
|Aggregations|Long integer|Число статических схем, определенных командой перед возвратом управления клиентскому приложению.|  
|LastStep|Логическое значение|Указывает, представляют ли данные в наборе строк последний шаг в процессе проектирования. Если свойству `Materialize` команды было присвоено значение TRUE, то этот столбец установлен в значение TRUE.|  
  
 Статистика проектирования, которая содержится в наборе строк, возвращаемом после выполнения каждой команды `DesignAggregations`, может быть использована как при последовательном, так и при пакетном проектировании. При последовательном проектировании она может использоваться для определения и отображения хода выполнения. При проектировании агрегатов в пакетном режиме эту статистику можно использовать для определения количества агрегатов, созданных командой.  
  
## <a name="see-also"></a>См. также  
 [Разработка с использованием XMLA в службах Analysis Services](developing-with-xmla-in-analysis-services.md)  
  
  
