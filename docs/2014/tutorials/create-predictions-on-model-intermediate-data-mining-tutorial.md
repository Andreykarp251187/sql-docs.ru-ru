---
title: Создание прогнозов для модели (учебник по интеллектуальному анализу интеллектуальному анализу данных) кластеризации последовательностей | Документация Майкрософт
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 94a8d4f9-a76a-49c5-9785-917010359511
author: minewiskan
ms.author: owend
manager: kfilee
ms.openlocfilehash: 893067e234d868ae6dde2f93d93bfd50458bfeb2
ms.sourcegitcommit: f7fced330b64d6616aeb8766747295807c92dd41
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63217744"
---
# <a name="creating-predictions-on-a-sequence-clustering-model-intermediate-data-mining-tutorial"></a>Создание прогнозов для модели кластеризации последовательностей (учебник по интеллектуальному анализу данных — средний уровень)
  После изучения модели кластеризации последовательностей лучше с ее просмотра в средстве просмотра, можно создать прогнозирующие запросы с помощью построителя прогнозирующих запросов на **модель интеллектуального анализа данных** вкладку в конструкторе интеллектуального анализа данных. Чтобы создать прогноз, сначала необходимо выбрать модель кластеризации последовательностей, а затем входные данные. Входные данные можно выбрать из внешнего источника данных или можно создать одноэлементный запрос и предоставить значения в диалоговом окне.  
  
 В этом занятии предполагается, что вы уже знакомы с работой построителя прогнозирующих запросов и хотите научиться создавать запросы, относящиеся к модели кластеризации последовательностей. Общие сведения об использовании построителя прогнозирующих запросов см. в разделе [интерфейсы запросов данных для интеллектуального анализа данных](../../2014/analysis-services/data-mining/data-mining-query-tools.md) или в разделе учебника интеллектуального анализа данных, [создание прогнозов &#40;Basic Data Mining Tutorial&#41;](../../2014/tutorials/creating-predictions-basic-data-mining-tutorial.md).  
  
## <a name="creating-predictions-on-the-regional-model"></a>Создание прогнозов для региональной модели  
 В этом сценарии сначала будет создано несколько одноэлементных прогнозирующих запросов, чтобы получить представление о том, насколько прогнозы могут отличаться друг от друга в зависимости от региона.  
  
#### <a name="to-create-a-singleton-query-on-a-sequence-clustering-model"></a>Создание одноэлементного запроса к модели кластеризации последовательностей  
  
1.  Нажмите кнопку **модель интеллектуального анализа данных** конструкторе интеллектуального анализа данных.  
  
2.  В **модель интеллектуального анализа данных** столбца последовательно выберите пункты **одноэлементный запрос**.  
  
     **Модель интеллектуального анализа данных** области и **одноэлементного запроса** отображаются панели.  
  
3.  В **модель интеллектуального анализа данных** панели щелкните **Выбор модели**. (Если модель кластеризации последовательностей уже выбрана, этот шаг можно пропустить.)  
  
     **Выберите модель интеллектуального анализа данных** откроется диалоговое окно.  
  
4.  Разверните узел, представляющий структуру интеллектуального анализа данных **Кластеризация последовательностей по регионам**и выберите модель **Кластеризация последовательностей по регионам**. Нажмите кнопку **ОК**. На данном этапе входная панель не учитывается. Входные данные нужно будет указать после настройки прогнозирующих функций.  
  
5.  В сетке щелкните пустую ячейку под **источника** и выберите **Прогнозирующая функция.** В ячейке под **поле**выберите **PredictSequence**.  
  
    > [!NOTE]  
    >  Можно также использовать **Predict** функции. Если вы обязательно выберите версию **Predict** функцию, которая принимает в качестве аргумента столбец таблицы...  
  
6.  В **модель интеллектуального анализа данных** области, выберите вложенную таблицу `v Assoc Seq Line Items`и перетащите его в сетке до **критерий или аргумент** поле для **PredictSequence** функции.  
  
     Путем перетаскивания имен таблиц и столбцов можно создавать сложные инструкции без синтаксических ошибок. Тем не менее, он заменяет текущее содержимое ячейки, которая включает другие необязательные аргументы для **PredictSequence** функции. Чтобы просмотреть другие аргументы, можно на время добавить в сетку второй экземпляр функции и использовать его для справки.  
  
7.  Нажмите кнопку **результат** кнопку в верхнем углу построителя прогнозирующих запросов.  
  
 Ожидаемые результаты содержат один столбец с заголовком **выражение**. **Выражение** столбец содержит вложенную таблицу с тремя столбцами, следующим образом:  
  
|$SEQUENCE|Line Number|Модель|  
|---------------|-----------------|-----------|  
|1||Велосипед Mountain-200|  
  
 Что означают эти результаты? Помните, что входные данные не были указаны. Следовательно, прогноз создается для всей совокупности вариантов, а службы Analysis Services возвращают наиболее вероятный общий прогноз.  
  
### <a name="adding-inputs-to-a-singleton-prediction-query"></a>Добавление входных данных к одноэлементному прогнозирующему запросу  
 До настоящего момента никакие входные данные не были указаны. В следующей задаче будет использоваться **одноэлементного запроса** панели, чтобы указать входные данные в запрос. Во-первых, необходимо использовать столбец [Region] в качестве входных данных для региональной модели кластеризации последовательностей, чтобы определить, одинаковы ли спрогнозированные последовательности для всех регионов. Затем будет рассмотрено, как изменить запрос, чтобы добавить вероятность для каждого прогноза, а также как преобразовать результаты в плоский формат для более удобного просмотра.  
  
##### <a name="to-generate-predictions-for-a-specific-customer-group"></a>Создание прогнозов для определенной группы клиентов  
  
1.  Нажмите кнопку **разработки** кнопку в верхнем левом углу построителя прогнозирующих запросов, чтобы вернуться в сетку построения запросов.  
  
2.  В **одноэлементного запроса** диалоговом окне щелкните **значение** поле для `Region`и выберите **Европа**.  
  
3.  Нажмите кнопку **результат** кнопку, чтобы просмотреть прогнозы для клиентов в Европе.  
  
4.  Нажмите кнопку **разработки** кнопку в верхнем левом углу построителя прогнозирующих запросов, чтобы вернуться в сетку построения запросов.  
  
5.  В **одноэлементного запроса** диалоговом окне щелкните **значение** поле для `Region`и выберите **North America**.  
  
6.  Нажмите кнопку **результат** кнопку, чтобы просмотреть прогнозы для клиентов в Северной Америке.  
  
### <a name="adding-probabilities-by-using-a-custom-expression"></a>Добавление вероятностей с помощью пользовательского выражения  
 Немного сложнее получить степень вероятности для каждого прогноза, поскольку вероятность является атрибутом прогноза и выводится в виде вложенной таблицы. Владея языком расширений интеллектуального анализа данных (DMX), запрос можно легко изменить, добавив в него инструкцию подзапроса выборки для вложенной таблицы. При этом инструкцию подзапроса выборки также можно создать и в построителе прогнозирующих запросов путем добавления пользовательского выражения.  
  
##### <a name="to-output-probabilities-for-a-predicted-sequence-by-using-a-custom-expression"></a>Вывод вероятностей для прогнозируемой последовательности с помощью пользовательского выражения  
  
1.  Нажмите кнопку **разработки** кнопку в верхнем левом углу построителя прогнозирующих запросов, чтобы вернуться в сетку построения запросов.  
  
2.  В сетке в разделе **источника**, щелкните новую строку и выберите **пользовательское выражение**.  
  
3.  Оставьте поле в разделе **поле** пустым.  
  
4.  Для **псевдоним**, тип `t`.  
  
5.  В **критерий или аргумент** введите полную инструкцию подзапроса выборки, как показано в следующем образце кода. Не забудьте включить открывающую и закрывающую круглые скобки.  
  
    ```  
    (SELECT PredictProbability([Model]) FROM PredictSequence([Sequence Clustering with Region].[v Assoc Seq Line Items]))  
    ```  
  
6.  Нажмите кнопку **результат** кнопку, чтобы просмотреть прогнозы для клиентов в Европе.  
  
 Теперь результаты содержат две вложенные таблицы, в первой из которых указан прогноз, а во второй — степень вероятности этого прогноза. Если запрос не работает, можно переключиться в режим проектирования запросов и проверить полную инструкцию запроса, которая должна иметь следующий вид:  
  
```  
SELECT  
  PredictSequence([Sequence Clustering with Region].[v Assoc Seq Line Items]),  
  ( (SELECT PredictProbability([Model]) FROM PredictSequence([Sequence Clustering with Region].[v Assoc Seq Line Items]))) as [t]  
FROM  
  [Sequence Clustering with Region]  
NATURAL PREDICTION JOIN  
(SELECT 'Europe' AS [Region]) AS t  
```  
  
### <a name="working-with-results"></a>Работа с результатами  
 Если результаты содержат много вложенных таблиц, такие результаты можно преобразовать в плоский формат для более удобного просмотра. С этой целью можно вручную изменить запрос и добавить ключевое слово `FLATTENED`.  
  
##### <a name="to-flatten-nested-rowsets-in-a-prediction-query"></a>Преобразование вложенных наборов строк в плоский формат в прогнозирующем запросе  
  
1.  Нажмите кнопку **запроса** кнопку в углу построителя прогнозирующих запросов.  
  
     Сетка будет преобразована в открытую панель, в которой можно просмотреть и изменить инструкцию DMX, созданную построителем прогнозирующих запросов.  
  
2.  После ключевого слова `SELECT` введите `FLATTENED`.  
  
     Полный текст запроса должен быть аналогичен следующему:  
  
    ```  
    SELECT FLATTENED  
      PredictSequence([Sequence Clustering with Region].[v Assoc Seq Line Items]),  
      ( (SELECT PredictProbability([Model]) FROM PredictSequence([Sequence Clustering with Region].[v Assoc Seq Line Items]))) as [t]  
    FROM  
      [Sequence Clustering with Region]  
    NATURAL PREDICTION JOIN  
    (SELECT 'Europe' AS [Region]) AS t  
    ```  
  
3.  Нажмите кнопку **результаты** кнопку в верхнем углу построителя прогнозирующих запросов.  
  
 После редактирования запроса вручную нельзя вернуться в конструктор, не потеряв изменения. Тем не менее созданную вручную инструкцию DMX можно сохранить в текстовый файл, а затем снова вернуться в конструктор. При этом в окне конструктора будет восстанавливаться последняя версия запроса, имевшаяся до выхода из него.  
  
## <a name="creating-predictions-on-the-related-model"></a>Создание прогнозов для связанной модели  
 В предыдущих примерах в качестве входных данных для одноэлементного прогнозирующего запроса использовался столбец Region в таблице вариантов, так как вам было интересно узнать, нашла ли модель какие-либо различия между регионами. Однако после изучения модели стало понятно, что эти различия недостаточно существенны для составления рекомендаций по товарам на основании региона. Что вас действительно интересует в прогнозировании — это элементы, выбираемые клиентами. Поэтому в последующих запросах будет использована модель кластеризации последовательностей, не содержащая столбец Region, в целях создания рекомендаций для всех клиентов.  
  
### <a name="using-nested-table-columns-as-input"></a>Использование столбцов вложенной таблицы в качестве входных данных  
 Прежде всего необходимо создать одноэлементный прогнозирующий запрос, который в качестве входных данных использует один элемент и возвращает следующий наиболее вероятный элемент. Чтобы получить прогноз такого типа, нужно в качестве входного значения использовать столбец вложенной таблицы. Это требование вызвано тем, что прогнозируемый атрибут Model является частью вложенной таблицы. Службы Analysis Services предоставляют **Вход вложенной таблицы** диалоговое окно, чтобы помочь вам легко создавать прогнозирующие запросы к атрибутам вложенной таблицы, с помощью построителя прогнозирующих запросов.  
  
##### <a name="to-use-a-nested-table-as-input-to-a-prediction"></a>Использование вложенной таблицы в качестве входных данных для прогноза  
  
1.  Нажмите кнопку **разработки** кнопку в верхнем левом углу построителя прогнозирующих запросов, чтобы вернуться в сетку построения запросов.  
  
2.  В **одноэлементного запроса** диалоговом окне щелкните **значение** поле для `Region`и выберите пустую строку, чтобы очистить входные данные для этого поля.  
  
3.  В **одноэлементного запроса** диалоговом окне щелкните **значение** поле для `vAssocSeqLineItems`, а затем нажмите кнопку (...).  
  
4.  В **Вход вложенной таблицы** диалоговом окне щелкните **добавить**.  
  
5.  В новой строке щелкните поле в столбце `Model`и выберите из списка для туристического велосипеда. Нажмите кнопку **ОК**.  
  
6.  Нажмите кнопку **результат** кнопку, чтобы просмотреть прогнозы.  
  
 Модель рекомендует следующие элементы, перечисленные ниже, для всех клиентов, выбравших в качестве первого элемента шину для велосипеда (Touring Tire). В результате изучения модели уже становится известно, что товары Touring Tire и Touring Tire Tube часто приобретаются клиентами вместе. Следовательно, эти рекомендации вполне обоснованы.  
  
|$SEQUENCE|Line Number|Модель|  
|---------------|-----------------|-----------|  
|1||Камера для покрышки туристического велосипеда|  
|2||Sport-100|  
|3||Кофта с длинными рукавами и эмблемой|  
  
### <a name="creating-a-bulk-prediction-query-using-nested-table-inputs"></a>Создание массового прогнозирующего запроса, используя входные данные вложенной таблицы  
 Теперь, когда модель создает прогнозы, которые можно использовать для предоставления рекомендаций, нужно создать прогнозирующий запрос, который сопоставляется с внешним источником данных. Из источника данных будут взяты значения, представляющие текущие продукты. Поскольку необходимо создать прогнозирующий запрос, предоставляющий идентификатор клиента и список продуктов в качестве входных данных, потребуется добавить таблицу клиентов в качестве таблицы вариантов и таблицу покупок в качестве вложенной таблицы. Затем нужно добавить прогнозирующие функции для создания рекомендаций, как это делалось ранее.  
  
 Данная процедура аналогична процедуре создания прогнозов в сценарии потребительской корзины, описанном в занятии 3. Однако в модели кластеризации последовательностей для прогнозов также нужно указать заказ в качестве входных данных.  
  
##### <a name="to-create-a-prediction-query-using-nested-table-inputs"></a>Создание прогнозирующего запроса с использованием входных данных вложенной таблицы  
  
1.  В **модель интеллектуального анализа данных** панели, выберите модель кластеризации последовательностей, если он еще не установлен.  
  
2.  В **Выбор входных таблиц** диалоговом окне щелкните **выбрать таблицу вариантов**.  
  
3.  В **Выбор таблицы** диалоговом окне для источника данных выберите Orders. В **имя таблицы или представления** выберите vAssocSeqOrders, а затем нажмите кнопку **ОК**.  
  
4.  В **Выбор входных таблиц** диалоговом окне щелкните **выбрать вложенную таблицу**.  
  
5.  В **Выбор таблицы** диалоговом окне для **источника данных**, выберите Orders. В **имя таблицы или представления** выберите vAssocSeqLineItems, а затем нажмите кнопку **ОК**.  
  
     Службы Analysis Services выполнят попытку выявить связи и создать их автоматически, если типы данных и имена столбцов совпадают. Если связи, которые он создает неправильные, можно правой кнопкой мыши соединительную линию и выберите **изменить соединения** для редактирования столбца сопоставление, или можно правой кнопкой мыши соединительную линию и выберите **удалить** для полностью удалите связь. В таком случае эти связи автоматически добавляются на панели конструирования, поскольку таблицы уже были соединены в представлении источника данных.  
  
6.  Добавьте в сетку новую строку. Для **источника**, выберите таблицу vAssocSeqOrders, а также для **поле**, выберите CustomerKey.  
  
7.  Добавьте в сетку новую строку. Для **источника**выберите **Прогнозирующая функция**и для **поле**выберите **PredictSequence**.  
  
8.  Перетащите vAssocSeqLineItems в **критерий или аргумент** поле. Щелкните в конце **критерий или аргумент** поле, а затем введите следующие аргументы: `2`.  
  
     Полный текст **критерий или аргумент** поле должно быть: `[Sequence Clustering].[v Assoc Seq Line Items],2`  
  
9. Нажмите кнопку **результат** кнопку, чтобы просмотреть прогнозы для каждого клиента.  
  
 Учебник по моделям кластеризации последовательностей завершен.  
  
## <a name="next-steps"></a>Следующие шаги  
 После завершения всех разделов в [данных учебник по интеллектуальному анализу &#40;службы Analysis Services — Интеллектуальный анализ данных&#41;](../../2014/tutorials/intermediate-data-mining-tutorial-analysis-services-data-mining.md), скорее всего, чтобы узнать, как с помощью инструкций расширений интеллектуального анализа данных (DMX) для построения моделей и Создание прогнозов. Дополнительные сведения см. в разделе [Создание и запрос данных модели интеллектуального анализа данных с помощью расширений интеллектуального анализа данных: Учебники по &#40;службы Analysis Services — Интеллектуальный анализ данных&#41;](../../2014/tutorials/create-query-data-mining-models-dmx-tutorials.md).  
  
 Пользователи, которым знакомы основные понятия программирования, также могут использовать объекты AMO для работы с объектами интеллектуального анализа данных программным путем. Дополнительные сведения см. в разделе [Классы интеллектуального анализа данных объектов AMO](https://docs.microsoft.com/bi-reference/amo/amo-data-mining-classes).  
  
## <a name="see-also"></a>См. также  
 [Примеры запросов к модели кластеризации последовательностей](../../2014/analysis-services/data-mining/sequence-clustering-model-query-examples.md)   
 [Содержимое моделей интеллектуального анализа данных для моделей кластеризации последовательностей (службы Analysis Services — интеллектуальный анализ данных)](../../2014/analysis-services/data-mining/mining-model-content-for-sequence-clustering-models.md)  
  
  
