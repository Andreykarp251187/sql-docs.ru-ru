---
title: Режим блокировки
description: Узнайте, как Параллельное хранилище данных использует блокировку для обеспечения целостности транзакций и поддержания согласованности баз данных, когда несколько пользователей обращаются к данным одновременно.
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 04/17/2018
ms.author: murshedz
ms.reviewer: martinle
ms.custom: seo-dt-2019
ms.openlocfilehash: f3ecf5cf783b707b75c90dfa70d502e3c81d28c3
ms.sourcegitcommit: e042272a38fb646df05152c676e5cbeae3f9cd13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2020
ms.locfileid: "74400999"
---
# <a name="locking-behavior-in-parallel-data-warehouse"></a>Поведение блокировки в параллельном хранилище данных
Узнайте, как Параллельное хранилище данных использует блокировку для обеспечения целостности транзакций и поддержания согласованности баз данных, когда несколько пользователей обращаются к данным одновременно.  
  
## <a name="locking-basics"></a><a name="Basics"></a>Основы блокировки  
**Режимы**  
  
SQL Server PDW поддерживает четыре режима блокировки:  
  
Монопольная блокировка  
Монопольная блокировка запрещает запись или чтение из заблокированного объекта до тех пор, пока не завершится транзакция, которая удерживает монопольную блокировку. Никакие другие блокировки режима не разрешены, пока действует монопольная блокировка. Например, инструкция DROP TABLE и CREATE DATABASE используют монопольную блокировку.  
  
Shared  
Общая блокировка запрещает инициацию монопольной блокировки затрагиваемого объекта, но позволяет использовать все остальные режимы блокировки. Например, инструкция SELECT инициирует общую блокировку и, таким образом, позволяет нескольким запросам одновременно обращаться к выбранным данным, но предотвращает обновление считываемых записей до тех пор, пока инструкция SELECT не завершится.  
  
ексклусивеупдате  
Блокировка Ексклусивеупдате запрещает запись в заблокированный объект, но делает возможным чтение с помощью общей блокировки. Никакие другие блокировки не разрешены, пока действует блокировка Ексклусивеупдате. Например, РЕЗЕРВная копия базы данных и инструкция RESTORE DATABASE используют монопольную блокировку обновлений.  
  
шаредупдате  
Блокировка Шаредупдате запрещает монопольный и Ексклусивеупдате режим блокировки и позволяет использовать в объекте режимы блокировки Shared и Шаредупдате. Шаредупдате изменяет объект, но не ограничивает доступ для чтения к нему во время изменения. Например, INSERT и UPDATE используют Шаредупдате блокировку.  
  
**Классы ресурсов**  
  
Блокировки удерживаются в следующих классах объектов: база данных, схема, объект (таблица, представление или процедура), приложение (используется внутренне), ЕКСТЕРНАЛДАТАСАУРЦЕ, ЕКСТЕРНАЛФИЛЕФОРМАТ и SCHEMARESOLUTION (блокировка уровня базы данных, созданная при создании, изменении или удалении объектов схемы или пользователей базы данных). Эти классы объектов могут присутствовать в столбце object_type [sys. dm_pdw_waits](../relational-databases/system-dynamic-management-views/sys-dm-pdw-waits-transact-sql.md).  
  
## <a name="general-remarks"></a><a name="Remarks"></a>Общие замечания  
Блокировки можно применять к базам данных, таблицам или представлениям.  
  
SQL Server PDW не реализует никаких настраиваемых уровней изоляции. Он поддерживает уровень изоляции READ_UNCOMMITTED, как определено стандартом ANSI. Однако, так как операции чтения выполняются в READ_UNCOMMITTED, на самом деле происходит очень мало операций блокировки или возникает состязание за конкуренцию в системе.  
  
SQL Server PDW полагается на базовый механизм SQL Server для реализации управления блокировками и параллелизмом. Если операции ведут к базовой SQL Server взаимоблокировке в пределах одного узла, SQL Server PDW использует функцию обнаружения взаимоблокировки SQL Server и завершает одну из блокирующих операторов.  
  
> [!NOTE]  
> SQL Server не допускают, что инструкции, ожидающие блокировки, блокируются более новыми запросами на блокировку. SQL Server PDW не полностью реализовал этот процесс. В SQL Server PDW непрерывные запросы на новые совмещаемые блокировки иногда могут блокировать предыдущий (но ожидающий) запрос на монопольную блокировку. Например, инструкция **Update** (требующая монопольную блокировку) может быть заблокирована общими блокировками, предоставленными для ряда инструкций **SELECT** . Чтобы разрешить заблокированный процесс (идентифицированный путем просмотра [sys. dm_pdw_waits](../relational-databases/system-dynamic-management-views/sys-dm-pdw-waits-transact-sql.md) DVM), завершите отправку новых запросов, пока не будет удовлетворена монопольная блокировка.  
  
## <a name="lock-definition-table"></a>Таблица определений блокировки  
SQL Server поддерживает следующие типы блокировок. Не все типы блокировки доступны в узле управления, но могут произойти на этих узлах.  
  
-   SCH-S (стабильность схемы). Заверяет, что элемент схемы, такой как таблица или индекс, не будет удален до тех пор, пока сеанс связи удерживает блокировку стабильности схемы на данный элемент схемы.  
  
-   SCH-M (изменение схемы). Должен поддерживаться любым сеансом связи, во время которого предполагается изменить схему данного ресурса. Заверяет, что другие сеансы не имеют ссылок на обозначенный объект.  
  
-   S (общий). Удерживающему сеансу предоставлен коллективный доступ к ресурсу.  
  
-   U (обновление). Указывает блокировку обновления, полученную на ресурсы, которые со временем могут быть обновлены. Используется для предотвращения распространенной формы взаимоблокировки, которая происходит, если несколько сеансов блокируют ресурсы для возможного обновления в будущем.  
  
-   X (эксклюзивная). Удерживающему сеансу предоставлен исключительный доступ к ресурсу.  
  
-   ИМЕЕТ (намеренный общий доступ). Указывает намерение поместить блокировки типа S на некоторые подчиненные ресурсы в иерархии блокировок.  
  
-   IU (намеренное обновление). Указывает намерение поместить блокировки типа U на некоторые подчиненные ресурсы в иерархии блокировок.  
  
-   IX (с намерением монопольного доступа). Указывает намерение поместить блокировки типа X на некоторые подчиненные ресурсы в иерархии блокировок.  
  
-   SIU (коллективная блокировка с намерением обновления). Указывает коллективный доступ к ресурсу с намерением получения блокировок обновления на подчиненные ресурсы в иерархии блокировок.  
  
-   ШЕСТЬ (коллективная блокировка с намерением монопольного доступа). Указывает коллективный доступ к ресурсу с намерением получения монопольных блокировок на подчиненные ресурсы в иерархии блокировок.  
  
-   UIX (монопольная блокировка обновления). Указывает блокировку обновления ресурса с намерением получения монопольных блокировок на подчиненные ресурсы в иерархии блокировок.  
  
-   BU. Используется для массовых операций.  
  
-   RangeS_S (общий диапазон ключей и блокировка общего ресурса). Указывает на последовательный просмотр диапазона.  
  
-   RangeS_U (общий диапазон ключей и блокировка ресурса обновления). Указывает на последовательное сканирование обновления.  
  
-   RangeI_N (вставка диапазона ключей и блокировка ресурса NULL). Используется для проверки диапазонов, перед тем как вставить новый ключ в индекс.  
  
-   RangeI_S. Блокировка преобразования ключевого диапазона, созданная перекрытием блокировок RangeI_N и S.  
  
-   RangeI_U. Блокировка преобразования ключевого диапазона, созданная перекрытием блокировок RangeI_N и U.  
  
-   RangeI_X. Блокировка преобразования ключевого диапазона, созданная перекрытием блокировок RangeI_N и X.  
  
-   RangeX_S. Блокировка преобразования ключевого диапазона, созданная перекрытием блокировок RangeI_N и RangeS_S.  
  
-   RangeX_U. Блокировка преобразования ключевого диапазона, созданная перекрытием блокировок RangeI_N и RangeS_U.  
  
-   RangeX_X (монопольная блокировка диапазона ключей и монопольной блокировки ресурса). Блокировка диалога, используемая во время обновления ключа в диапазоне.  
  
## <a name="see-also"></a>См. также:  
<!-- MISSING LINKS 
[Common Metadata Query Examples &#40;SQL Server PDW&#41;](../sqlpdw/common-metadata-query-examples-sql-server-pdw.md)  
-->
[sys.dm_pdw_waits](../relational-databases/system-dynamic-management-views/sys-dm-pdw-waits-transact-sql.md)  
  
