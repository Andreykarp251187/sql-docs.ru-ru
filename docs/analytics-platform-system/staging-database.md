---
title: Использование промежуточной базы данных
description: SQL Server Parallel Data Warehouse (PDW) использует промежуточную базу данных для временного хранения данных в процессе загрузки.
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 04/17/2018
ms.author: murshedz
ms.reviewer: martinle
ms.custom: seo-dt-2019
ms.openlocfilehash: dcd7f95833695cc5f9f791d83a6221c35e88f58e
ms.sourcegitcommit: d587a141351e59782c31229bccaa0bff2e869580
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/22/2019
ms.locfileid: "74400280"
---
# <a name="using-a-staging-database-in-parallel-data-warehouse-pdw"></a>Использование промежуточной базы данных в параллельном хранилище данных (PDW)
SQL Server Parallel Data Warehouse (PDW) использует промежуточную базу данных для временного хранения данных в процессе загрузки. По умолчанию SQL Server PDW использует целевую базу данных в качестве промежуточной базы данных, что может привести к фрагментации таблиц. Чтобы уменьшить фрагментацию таблицы, можно создать пользовательскую промежуточную базу данных. Или, если откат из-за сбоя загрузки не является проблемой, можно использовать режим загрузки FastAppend для повышения производительности, пропуская временную таблицу и загружая ее непосредственно в целевую таблицу.  
  
## <a name="StagingDatabase"></a>Основы промежуточной базы данных  
*Промежуточная база данных* — это созданная пользователем база данных PDW, которая временно хранит данные, когда она загружается в устройство. При указании промежуточной базы данных для загрузки устройство сначала копирует данные в промежуточную базу данных, а затем копирует данные из временных таблиц в промежуточной базе данных в постоянные таблицы в целевой базе данных.  
  
Если промежуточная база данных не указана для загрузки, SQL Серверпдв создает временные таблицы в целевой базе данных и использует их для хранения загруженных данных перед вставкой загруженных данных в постоянные целевые таблицы.  
  
Когда нагрузка использует *режим FastAppend*, SQL серверпдв полностью пропускает использование временных таблиц и добавляет данные непосредственно в целевую таблицу. Режим FastAppend повышает производительность загрузки для сценариев ELT, когда данные загружаются в таблицу, которая является временной таблицей с точки зрения приложения. Например, процесс ELT может загружать данные во временную таблицу, обрабатывать их путем очистки и отмены дупинг, а затем вставлять данные в целевую таблицу фактов. В этом случае PDW не требуется сначала выполнить загрузку данных во внутреннюю временную таблицу, прежде чем вставлять данные во временную таблицу приложения. Режим FastAppend позволяет избежать дополнительного шага загрузки, что значительно повышает производительность нагрузки. Чтобы использовать режим FastAppend, необходимо использовать режим с несколькими транзакциями. Это означает, что восстановление после сбоя или аварийной нагрузки должно обрабатываться собственным процессом загрузки.  
  
**Преимущества промежуточной базы данных**  
  
Основное преимущество промежуточной базы данных заключается в сокращении фрагментации таблиц. Если промежуточная база данных не используется, данные загружаются во временные таблицы в целевой базе данных. При создании и удалении временных таблиц в целевой базе данных страницы для временных таблиц и постоянных таблиц становятся чередованием. Со временем фрагментация таблицы происходит и снижает производительность. В отличие от этого, промежуточная база данных гарантирует, что временные таблицы создаются и удаляются в отдельном пространстве файлов, чем в постоянных таблицах.  
  
**Структуры таблиц промежуточной базы данных**  
  
Структура хранилища для каждой таблицы базы данных зависит от целевой таблицы.  
  
-   Для загрузки в кучу или кластеризованный индекс columnstore промежуточная таблица является кучей.  
  
-   Для загрузки в кластеризованный индекс rowstore промежуточная таблица является кластеризованным индексом rowstore.  
  
## <a name="Permissions"></a>Чтение  
Требуется разрешение CREATE (для создания временной таблицы) в промежуточной базе данных. 

<!-- MISSING LINKS

For more information, see [Grant Permissions to load data](grant-permissions-to-load-data.md).  

-->
  
## <a name="CreatingStagingDatabase"></a>Рекомендации по созданию промежуточной базы данных  
  
1.  На каждое устройство должно быть только одна промежуточная база данных. Промежуточная база данных может совместно использоваться всеми заданиями загрузки для всех целевых баз данных.  
  
2.  Размер промежуточной базы данных зависит от конкретного клиента. Изначально при первом заполнении устройства промежуточная база данных должна быть достаточно большой, чтобы соответствовать начальным заданиям загрузки. Эти задания загрузки, как правило, имеют большой размер, так как несколько нагрузок могут выполняться одновременно. После завершения заданий начальной загрузки и работы системы в рабочей среде размер каждого задания загрузки, скорее всего, будет меньше. Если загрузка невелика, можно уменьшить размер промежуточной базы данных в соответствии с меньшими размерами нагрузки. Чтобы уменьшить размер, можно удалить промежуточную базу данных и создать ее повторно с выделением меньшего размера или использовать инструкцию [ALTER DATABASE](../t-sql/statements/alter-database-transact-sql.md?tabs=sqlpdw) .  
  
    При создании промежуточной базы данных используйте следующие рекомендации.  
  
    -   Размер реплицированной таблицы должен быть предполагаемым размером на каждый вычисляемый узел всех реплицируемых таблиц, которые будут загружаться одновременно. Размер обычно составляет 25-30 ГБ.  
  
    -   Размер распределенной таблицы должен быть предполагаемым размером на устройство для всех распределенных таблиц, которые будут загружаться параллельно.  
  
    -   Размер журнала обычно аналогичен размеру реплицированной таблицы.  
  
## <a name="Examples"></a>Примеров  
  
### <a name="a-create-a-staging-database"></a>а. Создание промежуточной базы данных 
В следующем примере создается промежуточная база данных Стажедб для использования со всеми нагрузками на устройстве. Предположим, вы оцениваете, что пять реплицируемых таблиц размером 5 ГБ будут загружаться одновременно. Эта параллельная обработка приводит к выделению не менее 25 ГБ для реплицируемого размера. Предположим, вы оцениваете, что шесть распределенных таблиц размеров 100, 200, 400, 500, 500 и 550 ГБ будут загружаться одновременно. Эта параллельная обработка приводит к выделению не менее 2250 ГБ памяти для размера распределенной таблицы.  
  
```sql  
CREATE DATABASE Stagedb  
WITH (  
  
    AUTOGROW = ON,  
  
    REPLICATED_SIZE = 25 GB,  
  
    DISTRIBUTED_SIZE = 2250 GB,  
  
    LOG_SIZE = 25 GB  
  
);  
```  

<!-- MISSING LINKS
 
## See Also  
[Common metadata query examples](metadata-query-examples.md)  

-->
  
