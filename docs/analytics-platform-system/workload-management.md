---
title: Управление рабочей нагрузкой
description: Управление рабочей нагрузкой в системе платформы аналитики.
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 04/17/2018
ms.author: murshedz
ms.reviewer: martinle
ms.custom: seo-dt-2019
ms.openlocfilehash: d14714cb23a9f6b0d6cc63ddca5049cb6741017c
ms.sourcegitcommit: 33e774fbf48a432485c601541840905c21f613a0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "74399443"
---
# <a name="workload-management-in-analytics-platform-system"></a>Управление рабочей нагрузкой в системе платформы аналитики

Возможности управления рабочей нагрузкой SQL Server PDW позволяют пользователям и администраторам назначать запросы к предварительно заданным конфигурациям памяти и параллелизму. Используйте управление рабочей нагрузкой, чтобы повысить производительность рабочей нагрузки (как единообразное, так и смешанное), разрешая запросам иметь соответствующие ресурсы, не беспокоясь о бесконечности запросов.  
  
Например, с помощью методов управления рабочей нагрузкой в SQL Server PDW можно:  
  
-   Выделение большого количества ресурсов для задания загрузки.  
  
-   Укажите дополнительные ресурсы для создания индекса columnstore.  
  
-   Устраняйте неполадки, связанные с медленным выполнением хэш-соединений, чтобы узнать, требует ли он больше памяти, а затем предоставьте ему больше памяти.  
  
## <a name="workload-management-basics"></a><a name="Basics"></a>Основы управления рабочей нагрузкой  
  
### <a name="key-terms"></a>Основные понятия  
Управление рабочей нагрузкой  
*Управление рабочей нагрузкой* — это возможность понимать и настраивать использование системных ресурсов, чтобы обеспечить максимальную производительность параллельных запросов.  
  
Класс ресурсов  
В SQL Server PDW *класс ресурсов* — это встроенная роль сервера с предварительно присвоенными ограничениями для памяти и параллелизма. SQL Server PDW выделяет ресурсы для запросов в соответствии с членством в роли сервера класса ресурсов для имени входа, которое отправляет запросы.  
  
На COMPUTE Nodes реализация классов ресурсов использует функцию Resource Governor в SQL Server. Дополнительные сведения о Resource Governor см. в разделе [Resource Governor](../relational-databases/resource-governor/resource-governor.md) на сайте MSDN.  
  
### <a name="understand-current-resource-utilization"></a>Сведения о текущем использовании ресурсов  
Чтобы понять использование системных ресурсов для выполняющихся запросов, используйте динамические административные представления SQL Server PDW. Например, вы можете использовать динамические административные представления, чтобы понять, может ли медленный хэш-соединение работать с большим объемом памяти.  
  
<!-- MISSING LINKS
For examples, see [Common Metadata Query Examples &#40;SQL Server PDW&#41;](../sqlpdw/common-metadata-query-examples-sql-server-pdw.md).  
-->
  
### <a name="adjust-resource-allocations"></a>Настройка выделения ресурсов  
Чтобы настроить использование ресурсов, измените членство в классе ресурсов для имени входа, отправляющего запрос. Роли сервера класса ресурсов называются **mediumrc**, **largerc**и **xlargerc**. Они представляют собой средние, крупные и дополнительные ресурсы, выделенные для больших ресурсов соответственно.  
  
Например, чтобы выделить в запрос большой объем системных ресурсов, добавьте имя входа, отправляющее запрос в роль сервера **largerc** . Следующая инструкция ALTER SERVER ROLE добавляет имя входа Анна к роли сервера largerc.  
  
```sql  
ALTER SERVER ROLE largerc ADD MEMBER Anna;  
```  
  
## <a name="resource-class-descriptions"></a><a name="RC"></a>Описания классов ресурсов  
В следующей таблице описаны классы ресурсов и их распределение системных ресурсов.  
  
|Класс ресурсов|Важность запроса|Максимальное использование памяти *|Слоты выдачи (максимум = 32)|Описание|  
|------------------|----------------------|--------------------------|---------------------------------------|---------------|  
|default|Средний|400 МБ|1|По умолчанию для каждого имени входа разрешен небольшой объем памяти и ресурсы параллелизма для запросов.<br /><br />При добавлении имени входа в класс ресурсов новый класс имеет приоритет. При удалении имени входа из всех классов ресурсов имя входа возвращается к выделению ресурсов по умолчанию.|  
|MediumRC|Средний|1200 МБ|3|Примеры запросов, которым может потребоваться класс ресурсов Medium:<br /><br />Операции CTAS с большими хэш-подключениями.<br /><br />Выберите операции, для которых требуется больше памяти, чтобы избежать кэширования на диск.<br /><br />Загрузка данных в кластеризованные индексы columnstore.<br /><br />Сборка, перестроение и реорганизация кластеризованных индексов columnstore для небольших таблиц, имеющих 10-15 столбцов.|  
|Largerc|Высокий|2,8 ГБ|7|Примеры запросов, которым может потребоваться класс ресурсов большого размера:<br /><br />Очень крупные операции CTAS с огромными хэш-соединениеми или содержат большие агрегаты, такие как предложения с большим ПОРЯДКом или ГРУППИРОВАНие по.<br /><br />Выберите операции, требующие очень большого объема памяти для таких операций, как хэш-соединение, или агрегаты, такие как предложения ORDER BY или GROUP BY.<br /><br />Загрузка данных в кластеризованные индексы columnstore.<br /><br />Сборка, перестроение и реорганизация кластеризованных индексов columnstore для небольших таблиц, имеющих 10-15 столбцов.|  
|xlargerc|Высокий|8,4 ГБ|22|Дополнительный класс ресурсов большого размера предназначен для запросов, которые могут потребовать дополнительного потребления ресурсов большого размера во время выполнения.|  
  
<sup>*</sup>Максимальное использование памяти является приближением.  
  
### <a name="request-importance"></a>Важность запроса  
Важность запроса сопоставляется с количеством времени ЦП, которое SQL Server, выполняемых на вычислительных узлах, будет предоставлять запросы.  Запросы с более высоким приоритетом получают больше времени ЦП.  
  
### <a name="maximum-memory-usage"></a>Максимальное использование памяти  
Максимальное использование памяти — это максимальный объем доступной памяти, который может быть использован запросом в пределах каждого пространства обработки. Например, запрос mediumrc может использовать до 1200 МБ для обработки в каждом распределении. По-прежнему важно гарантировать, что данные не будут наклонены во избежание наличия нескольких дистрибутивов, выполняющих большую часть работы.  
  
### <a name="concurrency-slots"></a>Слоты выдачи  
Цель распределения 1, 3, 7 и 22 слотов выдачи заключается в том, чтобы разрешить одновременное выполнение больших и мелких процессов, не блокируя небольшой процесс при выполнении большого процесса.  Например, SQL Server PDW может выделять максимум 32 слотов выдачи для выполнения одного дополнительного большого запроса (22 слота), 1 большого запроса (7 слотов) и 1 средний запрос (3 слота) одновременно.  
  
Примеры выделения до 32 слотов выдачи для параллельных запросов:  
  
-   28 слотов = 4 крупные  
  
-   30 слотов = 10 Средний  
  
-   32 слоты = 32 по умолчанию  
  
-   32 слотов = 1 очень крупный + 1 большой + 1 средний  
  
-   32 разъемов = 2 крупных + 4 среднего + 6 по умолчанию  
  
Допустим, 6 больших запросов отправляются в SQL Server PDW, а затем отправляется 10 запросов по умолчанию. SQL Server PDW обработает запросы в порядке приоритета следующим образом:  
  
-   Выделите 28 слотов выдачи, чтобы начать обработку 4 больших запросов, когда память станет доступной, и сохраним 2 больших запроса в очереди.  
  
-   Выделите 4 слота выдачи, чтобы начать обработку 4 запросов по умолчанию и удержать 6 запросов по умолчанию в очереди ожидания.  
  
По мере того как запросы будут завершены и слоты выдачи станут доступны, SQL Server PDW выделит оставшиеся запросы в соответствии с доступными ресурсами и приоритетом. Например, если открыто 7 слотов выдачи, ожидающие большие запросы будут иметь более высокий приоритет для 7 слотов, чем ожидание средних запросов.  Если открыто 6 слотов, SQL Server PDW выделит 6 дополнительных запросов, имеющих размер по умолчанию. Однако слоты памяти и выдачи должны быть доступны до тех пор, пока SQL Server PDW разрешают выполнение запроса.  
  
В каждом классе ресурсов запросы выполняются в порядке поступления (FIFO).  
  
## <a name="general-remarks"></a><a name="GeneralRemarks"></a>Общие замечания  
Если имя входа является членом более чем одного класса ресурсов, приоритет имеет класс с наибольшим количеством ресурсов.  
  
При добавлении или удалении имени входа из класса ресурса изменение вступает в силу немедленно для всех будущих запросов; текущие выполняющиеся или ожидающие запросы не затрагиваются. Для этого имени входа не нужно отключаться и повторно подключаться, чтобы изменения не происходили.  
  
Для каждого имени входа параметры класса ресурсов применяются к отдельным инструкциям и операциям, а не к сеансу.  
  
Прежде чем SQL Server PDW выполнит инструкцию, она попытается получить слоты выдачи, необходимые для запроса. Если не удается получить достаточное число слотов выдачи, SQL Server PDW перемещает запрос в состояние ожидания выполнения. Все ресурсы системы, которые уже были выделены для запроса, возвращаются в систему.  
  
Большинству инструкций SQL всегда требуется выделение ресурсов по умолчанию и, следовательно, они не контролируются классами ресурсов. Например, для создания имени входа требуется только небольшой объем ресурсов и выделяется ресурсы по умолчанию, даже если имя входа, вызывающее создание имени входа, является членом класса ресурсов.  Например, если Анна является членом класса ресурсов largerc и отправляет инструкцию CREATE LOGIN, то инструкция CREATE LOGIN будет выполняться с числом ресурсов по умолчанию.  
  
Инструкции и операции SQL, управляемые классами ресурсов:  
  
-   ALTER INDEX REBUILD  
  
-   ALTER INDEX REORGANIZE  
  
-   ALTER TABLE REBUILD  
  
-   СОЗДАНИЕ КЛАСТЕРИЗОВАННОГО ИНДЕКСА  
  
-   СОЗДАНИЕ КЛАСТЕРИЗОВАННОГО ИНДЕКСА COLUMNSTORE  
  
-   CREATE TABLE AS SELECT  
  
-   СОЗДАТЬ УДАЛЕННУЮ ТАБЛИЦУ КАК SELECT  
  
-   Загрузка данных с помощью **dwloader**.  
  
-   INSERT SELECT  
  
-   UPDATE  
  
-   DELETE  
  
-   Восстановление базы данных при восстановлении в устройство с большим количеством вычислений.  
  
-   SELECT, исключая запросы только динамического административного представления  
  
## <a name="limitations-and-restrictions"></a><a name="Limits"></a>Ограничения  
Классы ресурсов управляют выделением памяти и параллелизмом.  Они не управляют операциями ввода-вывода.  
  
## <a name="metadata"></a><a name="Metadata"></a>Метаданные  
Динамические административные представления, содержащие сведения о классах ресурсов и членах классов ресурсов.  
  
-   [sys.server_role_members](../relational-databases/system-catalog-views/sys-server-role-members-transact-sql.md)  
  
-   [sys.server_principals](../relational-databases/system-catalog-views/sys-server-principals-transact-sql.md)  
  
Динамические административные представления, содержащие сведения о состоянии запросов и требуемых им ресурсах:  
  
-   [sys.dm_pdw_lock_waits](../relational-databases/system-dynamic-management-views/sys-dm-pdw-lock-waits-transact-sql.md)  
  
-   [sys.dm_pdw_resource_waits](../relational-databases/system-dynamic-management-views/sys-dm-pdw-resource-waits-transact-sql.md)  
  
Связанные системные представления, предоставляемые из SQL Server DMV на вычисленных узлах. Ссылки на эти [динамические административные представления](../relational-databases/system-dynamic-management-views/system-dynamic-management-views.md) см. в статье SQL Server.  
  
-   sys.dm_pdw_nodes_resource_governor_resource_pools  
  
-   sys.dm_pdw_nodes_resource_governor_workload_groups  
  
-   sys.dm_pdw_nodes_resource_governor_resource_pools  
  
-   sys. dm_pdw_nodws_resource_governor_workload_groups  
  
-   sys.dm_pdw_nodes_exec_sessions  
  
-   sys.dm_pdw_nodes_exec_requests  
  
-   sys.dm_pdw_nodes_exec_query_memory_grants  
  
-   sys.dm_pdw_nodes_exec_query_resource_semaphores  
  
-   sys.dm_pdw_nodes_os_memory_brokers  
  
-   sys.dm_pdw_nodes_os_memory_cache_entries  
  
-   sys.dm_pdw_nodes_exec_cached_plans  
  
## <a name="related-tasks"></a><a name="RelatedTasks"></a>Связанные задачи  
[Задачи управления рабочей нагрузкой](workload-management-tasks.md)  
  
<!-- MISSING LINKS
See the Workload Management section of [Common Metadata Query Examples &#40;SQL Server PDW&#41;](../sqlpdw/common-metadata-query-examples-sql-server-pdw.md) for the following tasks:  
  
1.  Find the number of active requests for each resource group.  
  
2.  Determine if my requests need more memory  
  
3.  Determine if there are a high number of query optimizations or suboptimal plan generations.  
  
4.  Determine Average CPU time per request in each resource pool to date  
  
## See Also  
[Common Metadata Query Examples &#40;SQL Server PDW&#41;](../sqlpdw/common-metadata-query-examples-sql-server-pdw.md)  
-->
  
