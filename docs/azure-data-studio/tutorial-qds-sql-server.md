---
title: Руководство. Включение примера мини-приложения "Пять самых медленных запросов"
titleSuffix: Azure Data Studio
description: В этом руководстве показано, как включить пример мини-приложения "Пять самых медленных запросов" на панели мониторинга базы данных.
ms.prod: sql
ms.technology: azure-data-studio
ms.topic: tutorial
author: markingmyname
ms.author: maghan
ms.reviewer: alayu; sstein
ms.custom: seodec18
ms.date: 09/24/2018
ms.openlocfilehash: 5c94d2cf8b80ad7724cc1f710dc67d3f4a13c59e
ms.sourcegitcommit: db9bed6214f9dca82dccb4ccd4a2417c62e4f1bd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/25/2019
ms.locfileid: "67959069"
---
# <a name="tutorial-add-the-five-slowest-queries-sample-widget-to-the-database-dashboard"></a>Руководство. Добавление примера мини-приложения *Пять самых медленных запросов* на панель мониторинга базы данных

В этом руководстве показано, как добавить один из встроенных в [!INCLUDE[name-sos](../includes/name-sos-short.md)] примеров мини-приложений на *панель мониторинга базы данных* для быстрого просмотра пяти самых медленных запросов к базе данных. Вы также узнаете, как просмотреть подробные сведения о медленных запросах и планах запросов с помощью функций [!INCLUDE[name-sos](../includes/name-sos-short.md)]. В этом руководстве вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * включение хранилища запросов в базе данных;
> * добавление готового аналитического мини-приложения на панель мониторинга базы данных;
> * просмотр подробных сведений о самых медленных запросах к базе данных;
> * просмотр планов выполнения запросов для медленных запросов.

В [!INCLUDE[name-sos](../includes/name-sos-short.md)] есть несколько готовых аналитических мини-приложений. В этом руководстве демонстрируется добавление мини-приложения *query-data-store-db-insight*, однако инструкции в основном одинаковы для любого мини-приложения.

## <a name="prerequisites"></a>предварительные требования

Для работы с этим руководством требуется SQL Server или база данных SQL Azure *TutorialDB*. Чтобы создать базу данных *TutorialDB*, выполните инструкции, приведенные в одном из следующих кратких руководств:

- [Подключение и отправка запроса к SQL Server с помощью [!INCLUDE[name-sos-short](../includes/name-sos-short.md)]](quickstart-sql-server.md)
- [Подключение и отправка запроса к базе данных SQL Azure с помощью[!INCLUDE[name-sos-short](../includes/name-sos-short.md)]](quickstart-sql-database.md)



## <a name="turn-on-query-store-for-your-database"></a>Включение хранилища запросов для базы данных

Для мини-приложения в этом примере необходимо включить *хранилище запросов*.

1. Щелкните правой кнопкой мыши базу данных **TutorialDB** (на боковой панели **Серверы**) и выберите команду **Создать запрос**.
2. Вставьте в редакторе запросов следующую инструкцию Transact-SQL и нажмите кнопку **Выполнить**:

   ```sql
    ALTER DATABASE TutorialDB SET QUERY_STORE = ON
   ```

## <a name="add-the-slow-queries-widget-to-your-database-dashboard"></a>Добавление мини-приложения медленных запросов на панель мониторинга базы данных

Чтобы добавить *мини-приложение медленных запросов* на панель мониторинга, измените параметр *dashboard.database.widgets* в файле *параметров пользователя*.

1. Откройте *параметры пользователя* — нажмите сочетание клавиш **CTRL+SHIFT+P**, после чего появится *палитра команд*.
2. Введите *settings* (параметры) в поле поиска и затем выберите вариант **Настройки: открыть пользовательские параметры**.

   ![Команда "Открыть пользовательские параметры"](./media/tutorial-qds-sql-server/open-user-settings.png)

2. Введите *dashboard* (панель мониторинга) в поле поиска параметров и найдите **dashboard.database.widgets**.

   ![Поиск параметров](./media/tutorial-qds-sql-server/search-settings.png)

3. Чтобы настроить параметры **dashboard.database.widgets**, необходимо изменить запись **dashboard.database.widgets** в разделе **Параметры пользователя** (столбец в правой части). Если запись **dashboard.database.widgets** отсутствует в разделе **Параметры пользователя**, наведите указатель мыши на текст **dashboard.database.widgets** в столбце "Параметры по умолчанию", щелкните значок карандаша, расположенный слева от текста, и выберите **Копировать в параметры**. Если во всплывающем окне отображается команда **Заменить в параметрах**, не выбирайте ее. В столбце **Параметры пользователя** в правой части найдите раздел **dashboard.database.widgets**, а затем перейдите к следующему шагу.

4. В разделе **dashboard.database.widgets** добавьте следующее:

   ```json
        {
            "name": "slow queries widget",
            "gridItemConfig": {
                "sizex": 2,
                "sizey": 1
            },
            "widget": {
                "query-data-store-db-insight": null
            }
        },
    ```

1. Если вы впервые добавляете новое мини-приложение, раздел **dashboard.database.widgets** должен выглядеть следующим образом:

   ```json
   "dashboard.database.widgets": [
       {
           "name": "slow queries widget",
           "gridItemConfig": {
               "sizex": 2,
               "sizey": 1
           },
           "widget": {
               "query-data-store-db-insight": null
           }
       },
       {
           "name": "Tasks",
           "gridItemConfig": {
               "sizex": 1,
               "sizey": 1
           },
           "widget": {
               "tasks-widget": {}
           }
       },
       {
           "gridItemConfig": {
               "sizex": 1,
               "sizey": 2
           },
           "widget": {
               "explorer-widget": {}
           }
       }
   ]
   ```

1. Нажмите клавиши **CTRL+S**, чтобы сохранить измененные **параметры пользователя**.

6. Откройте *панель мониторинга базы данных*. Для этого перейдите к базе данных **TutorialDB** на боковой панели **Серверы**, щелкните ее правой кнопкой мыши и выберите пункт **Управление**.

   ![Открытие панели мониторинга](./media/tutorial-qds-sql-server/insight-open-dashboard.png)

7. Аналитическое мини-приложение появится на панели мониторинга: 

   ![Мини-приложение QDS](./media/tutorial-qds-sql-server/insight-qds-result.png)


## <a name="view-insight-details-for-more-information"></a>Просмотр подробных аналитических сведений

1. Чтобы просмотреть дополнительные сведения в аналитическом мини-приложении, щелкните многоточие ( **...** ) в правом верхнем углу и выберите пункт **Показать подробности**.
2. Чтобы отобразить дополнительные сведения для элемента, выберите его в списке **Данные диаграммы**.

   ![Диалоговое окно с подробными аналитическими сведениями](./media/tutorial-qds-sql-server/insight-details-dialog.png)

3. Щелкните правой кнопкой мыши ячейку справа от **query_sql_txt** в области **Сведения элемента** и выберите пункт **Копировать ячейку**.

4. Закройте область **Аналитика**.

## <a name="view-the-query-plan"></a>Просмотр плана запроса 

1. Откройте новое окно редактора запросов, нажав клавиши **CTRL+N**.

2. Вставьте в редактор текст запроса из предыдущих шагов.

3. Щелкните **Объяснение**.

   ![Объяснение в мини-приложении QDS](./media/tutorial-qds-sql-server/insight-qds-explain.png)

4. Просмотрите план выполнения запроса:

   ![showplan](./media/tutorial-qds-sql-server/showplan.png)

## <a name="save-and-open-a-query-plan"></a>Сохранение и открытие плана запроса 

1. Откройте диалоговое окно с подробными аналитическими сведениями.
2. Выберите один из элементов запроса.
2. Щелкните правой кнопкой мыши значение **query_plan** и выберите команду **Копировать ячейку**.

   ![План в мини-приложении QDS](./media/tutorial-qds-sql-server/insight-qds-plan.png)

3. Нажмите клавиши **CTRL+N**, чтобы открыть новое окно редактора.

4. Вставьте в редактор скопированный план.

5. Нажмите клавиши **CTRL+S**, чтобы сохранить файл, и измените расширение имени файла на *.sqlplan*. Расширение *.sqlplan* отсутствует в раскрывающемся списке расширений, поэтому его нужно ввести. Для этого руководства назовите файл *slowquery.sqlplan*.

6. План запроса откроется в средстве просмотра планов запросов [!INCLUDE[name-sos](../includes/name-sos-short.md)]:

   ![План в мини-приложении QDS](./media/tutorial-qds-sql-server/sqlplan.png)


## <a name="next-steps"></a>Следующие шаги
В этом руководстве вы узнали, как выполнять следующие задачи:
> [!div class="checklist"]
> * включение хранилища запросов в базе данных;
> * добавление аналитического мини-приложения на панель мониторинга базы данных;
> * просмотр подробных сведений о самых медленных запросах к базе данных;
> * просмотр планов выполнения запросов для медленных запросов.


Чтобы узнать, как включить пример аналитического мини-приложения для **отслеживания использования табличного пространства**, выполните следующее руководство:

> [!div class="nextstepaction"]
> [Запуск примера аналитического мини-приложения для отслеживания использования табличного пространства](tutorial-table-space-sql-server.md)
