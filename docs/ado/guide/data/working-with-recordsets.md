---
title: Работа с наборами записей | Документация Майкрософт
ms.prod: sql
ms.prod_service: connectivity
ms.technology: connectivity
ms.custom: ''
ms.date: 01/19/2017
ms.reviewer: ''
ms.topic: conceptual
helpviewer_keywords:
- Recordset object [ADO]
ms.assetid: bdf9a56a-de4a-44de-9111-2f11ab7b16ea
author: MightyPen
ms.author: genemi
ms.openlocfilehash: a3025140929d7a7cf281f72c035bf79e0a5883b3
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "67923418"
---
# <a name="working-with-recordsets"></a>Работа с наборами записей
**Записей** объект имеет встроенные функции, позволяющие изменить порядок данных в результирующем наборе, для поиска определенной записи на основе критериев, которые вы указали и даже оптимизировать эти операции поиска, с помощью индексов. Эти функции доступны для использования зависит от поставщика и в некоторых случаях — например, [индекс](../../../ado/reference/ado-api/index-property.md) свойство — Структура самого источника данных.  
  
## <a name="arranging-data"></a>Объединение данных  
 Часто наиболее эффективный способ для упорядочивания данных в вашей **записей** , указав предложение ORDER BY в SQL-команда, используемая для возврата результатов к нему. Тем не менее, может потребоваться изменить порядок данных в **записей** который уже был создан. Можно использовать **сортировки** свойство, чтобы задать порядок, в какие строки **записей** проверено. Кроме того **фильтра** свойство определяет, какие строки являются возможен при обходе строк.  
  
 **Сортировки** Возвращает или задает свойство **строка** значение, указывающее поле имена в **записей** по которому производится сортировка. Каждое имя отделяется запятой и при необходимости следует пробел и ключевое слово **ASC** (сортирует поля в порядке возрастания) или **DESC** (сортирует поля в порядке убывания). По умолчанию если ключевое слово не указан, поле сортируется в порядке возрастания.  
  
 Операция сортировки эффективен, поскольку данные не одностраничный физически, но осуществляется в порядке, указанном с помощью индекса.  
  
 **Сортировки** свойства требуется [CursorLocation](../../../ado/reference/ado-api/cursorlocation-property-ado.md) свойству будет присвоено **adUseClient**. Временный индекс создается для каждого поля, указанного в **сортировки** свойства, если индекс еще не существует.  
  
 Установка **сортировки** присваивается пустая строка будет восстановить исходный порядок строк и удалить временные индексы. Существующие индексы, не удаляются.  
  
 Предположим, что **записей** содержит три поля с именем *firstName*, *middleInitial*, и *lastName*. Задать **сортировки** строку "`lastName DESC, firstName ASC`«, будет порядок **записей** по фамилии в порядке убывания, а затем по фамилиям в возрастающем порядке. Отчество учитывается.  
  
 Нет ссылка на поле, в строке критерии сортировки можно присвоить имя, либо «ASC» или «DESC» так как эти имена конфликтовать с ключевыми словами **ASC** и **DESC**. Присвойте поле с конфликтующим именем псевдоним с помощью **AS** ключевое слово в запросе, который возвращает **записей**.  
  
 Дополнительные сведения о **записей** фильтрации, см. в разделе «Фильтрация результатов» далее в этом разделе.  
  
## <a name="finding-a-specific-record"></a>Поиск определенной записи  
 ADO предоставляет [найти](../../../ado/reference/ado-api/find-method-ado.md) и [Seek](../../../ado/reference/ado-api/seek-method.md) методы для поиска определенной записи в **записей**. **Найти** метод поддерживается с помощью разнообразных поставщиков, но они ограничены одной поиска. **Seek** метод поддерживает поиск по нескольким критериям, но не поддерживается множеством поставщиков.  
  
 Индексы в поля можно повысить производительность **найти** метод и **сортировки** и **фильтра** свойства **записей** объект. Можно создать внутренний индекс для **поле** объекта, задав его динамической [оптимизировать](../../../ado/reference/ado-api/optimize-property-dynamic-ado.md) свойство. Это динамическое свойство добавляется к **свойства** коллекцию **поле** объекта при установке [CursorLocation](../../../ado/reference/ado-api/cursorlocation-property-ado.md) свойства **adUseClient**. Помните, что этот индекс является внутренним для ADO — не удается получить доступ к нему или использовать его для других целей. Кроме того, этот индекс отличается от [индекс](../../../ado/reference/ado-api/index-property.md) свойство **записей** объекта.  
  
 **Найти** метод быстро находит значение в столбце (поле) элемента **записей**. Часто можно улучшить скорость **найти** метод для столбца с помощью **оптимизировать** свойства для создания индекса в ней.  
  
 **Найти** метод ограничивает поиска для одного поля. **Seek** методу требуется иметь индекс и есть и другие ограничения также. Если необходимо выполнить поиск по нескольким полям, которые не являются основой для индекса, или если поставщик не поддерживает индексы, можно ограничить результаты с помощью **фильтра** свойство **записей** объекта.  
  
### <a name="find"></a>Найти  
 **Найти** поиска методов **записей** для строки, которая удовлетворяет указанного критерия. При необходимости можно указать направление поиска, начальную строку и смещение от начала строки. Если условие удовлетворено, текущая позиция строки имеет значение на найдено записи; в противном случае позиция имеет значение (начала или конца) из **записей**, в зависимости от направление поиска.  
  
 Можно указать только имя одного столбца для критерия. Другими словами этот метод не поддерживает поиск по нескольким столбцам.  
  
 Оператор сравнения для критерия может быть" **>** "(больше)," **\<** "(меньше), «=» (равно), «> =» (больше или равно), «< =» (меньше или равно)," <>» (не равно), или «Такие как» (сопоставление шаблонов).  
  
 Значение критерия может быть строка, число с плавающей запятой или даты. Строковых значений с разделителями с одинарные кавычки, или «#» (знак) метки (например, «состояние = «WA»» или «состояние = WA #»). Значения дат разделяются с отметками «#» (знак) (например, «start_date > #7/22/97 #»).  
  
 Если оператор сравнения «как», строковое значение может содержать символ звездочки (*) для поиска одного или нескольких вхождений любого символа или подстроки. Например «состояние, подобно состоянию меня\*"» соответствует Майн и штат Массачусетс. Начальные и конечные звездочки также можно найти подстроку, содержащийся в значения. Например «состояния, такие как "\*как\*"» соответствует Аляска и Арканзас, штат Массачусетс.  
  
 Звездочка используется только в конце строки критериев или друг с другом в начале и конце строки критериев, как показано выше. Нельзя использовать в качестве начальных подстановочный знак звездочку ("* str') или внедренные подстановочные ('s\*r"). Это приведет к ошибке.  
  
### <a name="seek-and-index"></a>Поиск и индекса  
 Используйте **Seek** метод вместе с **индекс** свойства, если базовый поставщик поддерживает индексы на **записей** объекта. Используйте [поддерживает](../../../ado/reference/ado-api/supports-method.md) **(adSeek)** метод, чтобы определить, поддерживает ли базовый поставщик **Seek**и **Supports(adIndex)** метод, чтобы определить, поддерживает ли поставщик индексов. (Например, [поставщик OLE DB для Jet (Майкрософт)](../../../ado/guide/appendixes/microsoft-ole-db-provider-for-microsoft-jet.md) поддерживает **Seek** и **индекс**.)  
  
 Если **Seek** может не найти нужную строку, ошибка не происходит, а эта строка находится в конце **записей**. Задайте **индекс** свойства для заданного индекса до выполнения этого метода.  
  
 Этот метод поддерживается только с курсорами на стороне сервера. Поиск не поддерживается, если [CursorLocation](../../../ado/reference/ado-api/cursorlocation-property-ado.md) значение свойства **записей** объект **adUseClient**.  
  
 Этот метод можно использовать только тогда, когда **записей** объект был открыт с [CommandTypeEnum](../../../ado/reference/ado-api/commandtypeenum.md) значение **adCmdTableDirect**.  
  
## <a name="filtering-the-results"></a>Фильтрация результатов  
 **Найти** метод ограничивает поиска для одного поля. **Seek** методу требуется иметь индекс и есть и другие ограничения также. Если необходимо выполнить поиск по нескольким полям, которые не являются основой для индекса или если поставщик не поддерживает индексы, можно ограничить результаты с помощью **фильтра** свойство **записей** объекта.  
  
 Используйте **фильтра** свойство, чтобы выборочно отсеять записей в **записей** объекта. Обработанные фильтром **записей** становится текущий курсор, который означает, что записи, которые не удовлетворяют **фильтра** критерии не доступны в **набор записей** до **Фильтра** удаляется. Затрагиваются другие свойства, которые возвращают значения, основанные на текущий курсор, такие как **примеры AbsolutePosition**, **примеры AbsolutePage**, **RecordCount**, и  **PageCount**. Это обусловлено параметр **фильтра** свойство конкретное значение перейдет к первой записи, которая удовлетворяет новое значение текущей записи.  
  
 **Фильтра** свойство принимает аргумент типа variant. Это значение представляет собой одну из трех методов использования **фильтра** свойство: строка условия, **FilterGroupEnum** константой или массив закладки. Дополнительные сведения см. в разделе фильтрация со строкой критерии фильтрации с константой и фильтрация с помощью закладок далее в этом разделе.  
  
> [!NOTE]
>  Когда вы знаете, вы хотите выбрать данные, это обычно более эффективно, чтобы открыть **записей** с помощью инструкции SQL, который фактически фильтрует результирующий набор, а не полагаться на **фильтра** свойство.  
  
 Чтобы удалить фильтр из **записей**, использовать **adFilterNone** константы. Установка **фильтра** строку нулевой длины ("») имеет тот же эффект, как с помощью **adFilterNone** константы.  
  
### <a name="filtering-with-a-criteria-string"></a>Фильтрация с использованием строки критериев  
 Критерии строка состоит из предложений в форме *значение оператора FieldName* (например, `"LastName = 'Smith'"`). Составные предложения можно создать путем объединения отдельных предложений с **AND** (например, `"LastName = 'Smith' AND FirstName = 'John'"`) и **или** (например, `"LastName = 'Smith' OR LastName = 'Jones'"`). Следуйте приведенным ниже рекомендациям для строк критериям:  
  
-   *FieldName* должно быть именем допустимого поля из **записей**. Если имя содержит пробелы, необходимо заключить имя в квадратные скобки.  
  
-   *Оператор* должно быть одно из следующих: **\<** , **>** , **\< =** , **>=** , **<>** , **=** , или **как**.  
  
-   *Значение* является значением, с которым требуется выполнить сравнение значения полей (например, `'Smith'`, `#8/24/95#`, `12.345`, или `$50.00`). Использовать одинарные кавычки (') со строками и символов (`#`) с датами. Можно использовать для чисел, десятичных запятых, знак доллара и экспоненциальное представление чисел. Если *оператор* — **как**, *значение* можно использовать подстановочные знаки. Только символ звездочки (\*) и знак процента (%) поддерживаются подстановочные знаки, и они должны быть последним символом в строке. *Значение* не может иметь значение null.  
  
    > [!NOTE]
    >  Чтобы включить одинарные кавычки (') в фильтре *значение*, используйте две одинарные кавычки для представления одного. Например, для фильтрации по *O'Malley*, эта строка критерии должны быть `"col1 = 'O''Malley'"`. Чтобы включить одинарные кавычки в начале и конце значения фильтра, необходимо заключить строку в знаки фунта (#). Например, для фильтрации по *"1"* , эта строка критерии должны быть `"col1 = #'1'#"`.  
  
 Имеется не приоритет между **AND** и **или**. Предложения можно группировать в скобки. Тем не менее, вы можете Группировать предложения, объединить с **или** и затем присоединиться к группе на другое предложение с предложением AND следующим образом.  
  
```  
(LastName = 'Smith' OR LastName = 'Jones') AND FirstName = 'John'  
```  
  
 Вместо этого можно следующим образом построить этот фильтр.  
  
```  
(LastName = 'Smith' AND FirstName = 'John') OR (LastName = 'Jones' AND FirstName = 'John')  
```  
  
 В **как** предложение, можно использовать подстановочный знак в начале и в конце шаблона (например, `LastName Like '*mit*'`) или только в конце шаблона (например, `LastName Like 'Smit*'`).  
  
### <a name="filtering-with-a-constant"></a>Фильтрация с константой  
 Для фильтрации доступны следующие константы **наборы записей**.  
  
|Константа|Описание|  
|--------------|-----------------|  
|**adFilterAffectedRecords**|Фильтры для просмотра только записей, затронутых последней **удалить**, **Resync**, **UpdateBatch**, или **CancelBatch** вызова.|  
|**adFilterConflictingRecords**|Фильтры для просмотра записей, которые не удалось последнего пакета обновления.|  
|**adFilterFetchedRecords**|Фильтры для просмотра записей в текущем кэше — то есть результаты последнего вызова метода для извлечения записей из базы данных.|  
|**adFilterNone**|Удаляет текущий фильтр и восстанавливает все записи для просмотра.|  
|**adFilterPendingRecords**|Фильтры для просмотра только записей, были изменены, но еще не были отправлены на сервер. Применимо только для пакетный режим обновления.|  
  
 Константы фильтра облегчают устранения отдельных записей конфликтов при пакетный режим обновления, позволяя просмотреть, к примеру, только те записи, были затронуты во время последней **UpdateBatch** вызова метода, как показано на Ниже приведен пример.  
  
 `Attribute VB_Name = "modExaminingData"`  
  
### <a name="filtering-with-bookmarks"></a>Фильтрация с помощью закладок  
 Наконец, можно передать массив вариантов закладок **фильтра** свойство. Этот результирующий курсор будет содержать только те записи, в которых закладки был передан в свойство. В следующем примере кода создает массив закладок из записей в **записей** имеющих «B» *ProductName* поля. Затем он передает массив, в который **фильтра** свойства и отображает сведения об полученный в результате отфильтрованных **записей**.  
  
```  
'BeginFilterBkmk  
Dim vBkmkArray() As Variant  
Dim i As Integer  
  
'Recordset created using "SELECT * FROM Products" as command.  
'So, we will check to see if ProductName has a capital B, and  
'if so, add to the array.  
i = 0  
Do While Not objRs.EOF  
    If InStr(1, objRs("ProductName"), "B") Then  
        ReDim Preserve vBkmkArray(i)  
        vBkmkArray(i) = objRs.Bookmark  
        i = i + 1  
        Debug.Print objRs("ProductName")  
    End If  
    objRs.MoveNext  
Loop  
  
'Filter using the array of bookmarks.  
objRs.Filter = vBkmkArray  
  
objRs.MoveFirst  
Do While Not objRs.EOF  
    Debug.Print objRs("ProductName")  
    objRs.MoveNext  
Loop  
'EndFilterBkmk  
```  
  
## <a name="creating-a-clone-of-a-recordset"></a>Создание точной копии набора записей  
 Используйте **клона** повторяющийся метод для создания нескольких **записей** объектов, особенно в том случае, если вы хотите поддерживать более чем одна текущая запись в заданном наборе записей. С помощью **клона** метод является более эффективным, чем создание и открытие нового **записей** объект с тем же определением, что и исходный.  
  
 Текущую запись в только что созданный клона изначально имеет значение первой записи. Указатель текущей записи в клонированный **записей** не синхронизирован с исходным или наоборот. Вы можете перейти независимо друг от друга, в каждом **записей**.  
  
 Изменения, вносимые на один **записей** объект видны во всех его клонов, вне зависимости от типа курсора. Однако после выполнения [Requery](../../../ado/reference/ado-api/requery-method.md) на исходном **записей**, клонов больше не будут синхронизированы с исходным.  
  
 Закрытие исходного **записей** не закрывает его копии, а также закрытие копию Закройте исходный или любого из этих копий.  
  
 Вы можете клонировать **записей** объекта, если он поддерживает закладки. Закладка значения являются взаимозаменяемыми; то есть ссылку закладку из одного **записей** объект ссылается на одной и той же записи в любой из его клонов.
