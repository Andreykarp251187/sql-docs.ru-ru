---
title: Приступая к работе с Database Experimentation Assistant для SQL Server обновлений
description: Начало работы с Database Experimentation Assistant
ms.custom: ''
ms.date: 10/22/2018
ms.prod: sql
ms.prod_service: dea
ms.suite: sql
ms.technology: dea
ms.tgt_pltfrm: ''
ms.topic: conceptual
author: HJToland3
ms.author: ajaykar
ms.reviewer: mathoma
ms.openlocfilehash: 9fe162b2a9bc0db4a2a49648eecb76c5802f57c0
ms.sourcegitcommit: 4c75b49599018124f05f91c1df3271d473827e4d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2019
ms.locfileid: "72381772"
---
# <a name="get-started-with-database-experimentation-assistant"></a>Начало работы с Database Experimentation Assistant

Database Experimentation Assistant (ДЕА) — это решение для тестирования A/B для изменений в средах SQL Server, таких как обновления или новые индексы. ДЕА помогает оценить, как Рабочая нагрузка на исходном сервере (в текущей среде) будет выполняться в новой среде. ДЕА поможет выполнить тестирование A/B, выполнив три шага: 

- Сбор
- Воспроизведения
- Анализ

Эта статья посвящена этим действиям.

## <a name="capture"></a>Сбор

Первый этап SQL Server A/B-тестирования — запись трассировки на исходном сервере. Исходным сервером обычно является рабочий сервер. Файлы трассировки записывают всю рабочую нагрузку запроса на этом сервере, включая метки времени. Позже эта трассировка воспроизводится на целевых серверах для анализа. Аналитический отчет предоставляет аналитические сведения о разнице в производительности рабочей нагрузки между двумя целевыми серверами.

Рекомендации

- Прежде чем начать запись трассировки, убедитесь, что выполняется резервное копирование баз данных, из которых выполняется запись трассировки.
- Пользователь ДЕА должен быть настроен для подключения к базе данных с использованием проверки подлинности Windows.
- Учетной записи службы SQL Server требуется доступ к исходному пути файла трассировки.
- Чтобы ДЕА определить, улучшился ли производительность запроса, этот запрос должен выполняться не менее 15 раз в течение периода записи.  

Чтобы записать трассировку на исходном сервере, выполните следующие действия.

1. В ДЕА перейдите к разделу **все записи** , щелкнув значок камеры в меню слева.

   ![Меню навигации слева](./media/database-experimentation-assistant-get-started/dea-get-started-leftnav.png)

1. Введите или выберите следующие сведения:

   - **Имя трассировки**: имя создаваемого файла трассировки. Не используйте имя трассировки, использующее соглашение об именовании файла продолжения, например Каптуренаме @ no__t-0NNN.
   - **Длительность**: длительность записи.
   - **SQL Server имя экземпляра**: экземпляр SQL Server, из которого необходимо записать трассировку.
   - **Имя базы данных**: имя базы данных на компьютере, на котором выполняется SQL Server, для которой необходимо записать трассировку. Если оставить поле пустым, трассировка будет захвачена из всех баз данных на сервере.
   - **Путь к файлу трассировки источника данных на SQL Server компьютере**: путь к папке, в которую нужно сохранить файл трассировки.

1. Убедитесь, что создана резервная копия целевой базы данных. Затем установите флажок База данных.
1. Нажмите кнопку **запустить** , чтобы начать запись.

Вы можете просмотреть ход выполнения записи, включая время начала, длительность и оставшееся время. Вы также можете начать новую запись, пока вы дождитесь завершения этой записи. После завершения записи используйте выходной файл трассировки для запуска второго этапа: воспроизводите файл трассировки на целевых серверах.

Часто задаваемые вопросы о захвате трассировки см. в разделе [часто задаваемых](database-experimentation-assistant-capture-trace.md#frequently-asked-questions-about-trace-capture)вопросов.

## <a name="replay"></a>Воспроизведения

Вторым этапом SQL Server A/B является воспроизведение файла трассировки, который был захвачен на целевых серверах. Затем собирайте обширные трассировки от воспроизведения для анализа. 

Вы воспроизводите файл трассировки на двух целевых серверах: один имитирует исходный сервер (цель 1) и один, который имитирует предлагаемое изменение (цель 2). Конфигурации оборудования целевого объекта 1 и целевого сервера должны быть как можно более похожими, чтобы SQL Server можно было точно проанализировать воздействие предложенных изменений на производительность.

Рекомендации

- Чтобы запустить воспроизведение, на компьютерах должны быть настроены для запуска трассировки распределенное воспроизведение (DReplay). Дополнительные сведения см. в статье [Установка контроллера и клиента распределенное воспроизведение](https://blogs.msdn.microsoft.com/datamigration/distributed-replay-controller-and-client-setup/).
- Убедитесь, что базы данных на целевых серверах восстанавливаются с помощью резервной копии с исходного сервера.
- Кэширование запросов в SQL Server может повлиять на результаты оценки. Рекомендуется перезапустить службу SQL Server (MSSQLSERVER) в приложении "службы", чтобы повысить согласованность результатов оценки.

Чтобы воспроизвести файл трассировки, выполните следующие действия.

1. В ДЕА выберите значок воспроизведения в меню слева, чтобы просмотреть **все воспроизведения**. Список прошедших повторов, которые выполняются во время сеанса (при его наличии). Чтобы начать новое воспроизведение, выберите **новое воспроизведение**.

1. Введите или выберите следующие сведения:

   - **Имя воспроизведения**: имя файла для трассировки воспроизведения.
   - **Имя компьютера контроллера**: имя компьютера контроллера распределенное воспроизведение.
   - **Путь к исходному файлу трассировки на контроллере**: путь к файлу трассировки источника из [записи](#capture).
   - **SQL Server имя экземпляра**: имя экземпляра SQL Server, для которого воспроизводится трассировка источника.
   - **Путь к целевому файлу трассировки для хранения на SQL Server компьютере**: путь к папке для результирующего файла трассировки воспроизведения.

1. Установите флажок, чтобы восстановить резервную копию с первого шага.

1. Нажмите кнопку **Пуск** , чтобы начать воспроизведение. 

Вы можете просмотреть состояние воспроизведения. После воспроизведения исходной трассировки на обоих целевых серверах можно создать аналитический отчет.

Распространенные вопросы о воспроизведении см. в разделе [часто ЗАдаваемые вопросы о воспроизведении](database-experimentation-assistant-replay-trace.md#frequently-asked-questions-about-trace-replay).

## <a name="analysis"></a>Анализ

Последним шагом является создание аналитического отчета с помощью трассировок воспроизведения. Аналитический отчет может помочь получить представление о влиянии на производительность предлагаемого изменения.

Рекомендации

- Если один или несколько компонентов отсутствуют, при попытке создать отчет об анализе (требуется подключение к Интернету) отображается страница предварительные требования со ссылками для загрузки.
- Для просмотра отчета, созданного в более ранней версии средства, необходимо сначала обновить схему.

Создание отчета об анализе:

1. В меню слева выберите пункт **аналитические отчеты**. Подключитесь к компьютеру, на котором выполняется SQL Server, где хранятся базы данных отчетов. Появится список всех отчетов на сервере. Чтобы создать новый отчет, выберите **Новый отчет**.

1. Введите или выберите сведения, необходимые для создания отчета:

   - **Имя отчета**: имя создаваемого отчета анализа.
   - **Трассировка для целевого объекта 1 SQL Server**: путь к файлу трассировки для воспроизведения на целевом объекте 1.
   - **Трассировка для целевого объекта 2 SQL Server**: путь к файлу трассировки, который воспроизводится на целевом компьютере 2.

1. Нажмите кнопку **запустить** , чтобы создать отчет. Новый отчет появится в верхней части списка. Значок рядом с отчетом станет зеленым флажком при создании отчета.

Теперь просмотрите отчет об анализе, чтобы получить ценные сведения, предоставленные в тесте A/B.

Часто задаваемые вопросы об аналитических отчетах см. в статье [вопросы и ответы по анализу](database-experimentation-assistant-create-report.md#frequently-asked-questions-about-analysis-reports).

### <a name="analysis-report"></a>Аналитический отчет

На первой странице отчета отображается версия и сведения о сборке для целевых серверов, на которых был выполнен эксперимент. Можно использовать пороговое значение для настройки чувствительности или допустимости анализа теста A/B. По умолчанию пороговое значение устанавливается равным 5%. Любое повышение производительности, которое больше или равно 5%, относится к категории **Улучшено**. Выберите параметры в раскрывающемся меню, чтобы оценить отчет с использованием различных порогов производительности.

![Порог](https://msdnshared.blob.core.windows.net/media/2017/03/threshold.jpg)

Две круговые диаграммы демонстрируют влияние различий между двумя целевыми серверами для рабочей нагрузки. Левая диаграмма основана на количестве выполнений. Правильная диаграмма основана на отдельных запросах. Существует пять возможных категорий.

- **Улучшено**. статистический запрос был запущен лучше на целевом объекте 2, чем на целевом объекте 1.
- **Снижение работоспособности**. Статистическая работа запроса выполнялась хуже, чем на целевом уровне 1.
- **То же**: нет статистической разницы между целевым объектом 1 и целевым объектом 2.
- **Невозможно вычислить**: размер выборки для запроса слишком мал для статистического анализа. Для анализа тестирования A/B ДЕА требует, чтобы те же запросы имели по крайней мере 30 выполнений для каждого целевого объекта.
- **Ошибка**: запрос был по крайней мере один раз в одной из целевых объектов.

![Круговая диаграмма](./media/database-experimentation-assistant-get-started/dea-get-started-piechart.png)

Выберите срез для детализации определенной категории и получения метрик производительности, включая **невозможность оценки** среза круговой диаграммы.

На странице детализации для категории изменение производительности отображается список запросов в этой категории. Страница **ошибки** содержит три вкладки:

- **Новые ошибки**: ошибки, возникшие в целевом объекте 2, но не на целевом объекте 1.
- **Существующие ошибки**: ошибки, возникшие как на целевом объекте 1, так и на целевом компьютере 2.
- **Разрешенные ошибки**: ошибки, возникшие на целевом объекте 1, но не на целевом компьютере 2.

   ![Страница ошибки](./media/database-experimentation-assistant-get-started/dea-get-started-errorpage.png)

Выберите запрос для перехода на страницу **сводки сравнения** для этого запроса.

На странице **сводки сравнения** отображается сводная статистика для этого запроса. Сводка включает число выполнений, среднюю длительность, среднее значение ЦП, среднее число операций чтения/записи и количество ошибок.

![Сводная статистика](./media/database-experimentation-assistant-get-started/dea-get-started-summarystats.png)

Если запрос является ошибкой, на вкладке **сведения об ошибке** отображаются дополнительные сведения об ошибке. На вкладке **сведения о плане запроса** отображаются сведения о планах запросов, которые используются для запроса к целевому объекту 1 и целевому объекту 2.

![План запроса](./media/database-experimentation-assistant-get-started/dea-get-started-queryplan.png)

На любой странице отчета об анализе нажмите кнопку **Печать** в правом верхнем углу, чтобы напечатать все видимое.

## <a name="next-steps"></a>Следующие шаги

- Сведения о создании файла трассировки с журналом событий, происходящих на сервере, см. в разделе [захват трассировки](database-experimentation-assistant-capture-trace.md).

- Чтобы получить 19-минутное введение в ДЕА и демонстрацию, просмотрите следующее видео:

  > [!VIDEO https://channel9.msdn.com/Shows/Data-Exposed/Introducing-the-Database-Experimentation-Assistant/player]
