---
title: Запись трассировки в Database Experimentation Assistant для SQL Server обновлений
description: Запись трассировки в Database Experimentation Assistant
ms.custom: ''
ms.date: 10/22/2018
ms.prod: sql
ms.prod_service: dea
ms.suite: sql
ms.technology: dea
ms.tgt_pltfrm: ''
ms.topic: conceptual
author: HJToland3
ms.author: ajaykar
ms.reviewer: mathoma
ms.openlocfilehash: 3887daff7807d57244449d4f35d220bb47b8f10d
ms.sourcegitcommit: 5e838bdf705136f34d4d8b622740b0e643cb8d96
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2019
ms.locfileid: "69653817"
---
# <a name="capture-a-trace-in-database-experimentation-assistant"></a>Запись трассировки в Database Experimentation Assistant

Можно использовать захват трассировки в Database Experimentation Assistant (ДЕА), чтобы создать файл трассировки с журналом событий сервера. Перехваченное событие сервера — это событие, возникающее на определенном сервере за определенный период времени. Запись трассировки должна выполняться один раз для каждого сервера.

Прежде чем начать запись трассировки, убедитесь, что резервное копирование всех целевых баз данных выполнено.

Кэширование запросов в SQL Server может повлиять на результаты оценки. Рекомендуется перезапустить службу SQL Server (MSSQLSERVER) в приложении "службы", чтобы повысить согласованность результатов оценки.

## <a name="create-a-trace-capture"></a>Создание записи трассировки

1. В ДЕА выберите значок меню в меню слева. В развернутом меню выберите **захват трассировок** рядом со значком камеры.

    ![Выбор захвата трассировок в меню](./media/database-experimentation-assistant-capture-trace/dea-capture-trace-capture.png)

1. В разделе **Новая запись**введите или выберите следующие сведения.

    - **Имя экземпляра SQL Server**: Введите имя компьютера, на котором выполняется SQL Server, для которого требуется записать трассировку сервера.
    - **Имя базы данных**: Введите имя базы данных, в которой должна начаться трассировка базы данных. Если не указать базу данных, трассировка будет захвачена во всех базах данных на сервере.
    - **Имя файла трассировки**: Введите имя файла трассировки для записи.
    - **Максимальный размер файла (МБ)** : Выберите размер переключения для файлов. При необходимости в выбранном размере файла создается новый файл. Рекомендуемый размер переключения — 200 МБ.
    - **Длительность (в мин.)** : Выберите период времени (в минутах), в течение которого должна выполняться запись трассировки.
    - **Путь к выходному файлу трассировки**: Выберите целевой путь для файла трассировки. 

    > [!NOTE]
    > Путь к файлу трассировки должен находиться на компьютере, на котором работает SQL Server. Если служба SQL Server не задана для конкретной учетной записи, для записи файла трассировки службе могут потребоваться разрешения на запись в указанную папку.
    >
    >

    ![Страница «Создание записи»](./media/database-experimentation-assistant-capture-trace/dea-capture-trace-inputs.png)

## <a name="start-the-trace-capture"></a>Начать запись трассировки

После ввода или выбора требуемой информации нажмите кнопку **начать** , чтобы начать сбор трассировок. Если введенная информация действительна, начнется процесс отслеживания трассировки. В противном случае текстовые поля с недопустимыми записями будут выделены красным цветом. 

Убедитесь, что выбранные или введенные значения верны, а затем нажмите кнопку **запустить**.

Когда запись трассировки будет завершена, выберите новый файл трассировки в расположении файла, указанном в поле **путь к выходному файлу трассировки**. Щелкните значок колокольчика в нижней части меню слева, чтобы отслеживать ход выполнения записи.

![Ход отслеживания трассировки](./media/database-experimentation-assistant-capture-trace/dea-capture-trace-progress.png)

### <a name="trace-file"></a>Файл трассировки

Запись трассировки записывает TRC-файл в указанное расположение. Файл трассировки содержит результаты трассировки действия SQL Server базы данных. Файлы TRC предназначены для предоставления дополнительных сведений об ошибках, обнаруженных и сообщаемых SQL Server.

## <a name="frequently-asked-questions-about-trace-capture"></a>Часто задаваемые вопросы о захвате трассировки

Ниже приведены некоторые часто задаваемые вопросы о захвате трассировки в ДЕА.

### <a name="what-events-are-captured-when-i-run-a-trace-capture-on-a-production-database"></a>Какие события фиксируются при выполнении записи трассировки в рабочей базе данных?

В следующей таблице приведен список событий и соответствующих данных столбцов, собранных для трассировок.
  
|Имя события|Текстовые данные (1)|Двоичные данные (2)|Идентификатор базы данных (3)|Имя узла (8)|Имя приложения (10)|Имя для входа (11)|SPID (12)|Время начала (14)|Время окончания (15)|Имя базы данных (35)|Последовательность событий (51)|Система (60)|  
|---|---|---|---|---|---|---|---|---|---|---|---|---|  
|**RPC: завершено (10)**||*|*|*|*|*|*|*|*|*|*|*|  
|**RPC: запуск (11)**||*|*|*|*|*|*|*||*|*|*|  
|**Выходной параметр RPC (100)**|*||*|*|*|*|*|*||*|*|*|  
|**SQL: BatchCompleted (12)**|*||*|*|*|*|*|*|*|*|*|*|  
|**SQL: BatchStarting (13)**|*||*|*|*|*|*|*||*|*|*|  
|**Имя входа аудита (14)**|*|*|*|*|*|*|*|*||*|*|*|  
|**Аудит выхода (15)**|*||*|*|*|*|*|*|*|*|*|*|  
|**ExistingConnection (17)**|*|*|*|*|*|*|*|*||*|*|*|  
|**CursorOpen (53)**|*||*|*|*|*|*|*||*|*|*|  
|**CursorPrepare (70)**|*||*|*|*|*|*|*||*|*|*|  
|**Подготовка SQL (71)**|||*|*|*|*|*|*||*|*|*|  
|**Exec Prepared SQL (72)**|||*|*|*|*|*|*||*|*|*|  
|**CursorExecute (74)**|*||*|*|*|*|*|*||*|*|*|  
|**CursorUnprepare (77)**|*||*|*|*|*|*|*||*|*|*|  
|**CursorClose (78)**|*||*|*|*|*|*|*||*|*|*|  

### <a name="is-there-a-performance-effect-on-my-production-server-when-trace-capture-is-running"></a>Влияет ли производительность на рабочем сервере при выполнении отслеживания трассировки?
    
Да, во время сбора трассировки имеется минимальный результат производительности. В наших тестах мы обнаружили нехватку памяти в 3%.
    
### <a name="what-kind-of-permissions-are-required-for-capturing-traces-on-a-production-workload"></a>Какие разрешения требуются для отслеживания трассировок в рабочей нагрузке?
    
- Пользователь Windows, выполняющий операцию трассировки в приложении Деа, должен иметь права системного администратора на компьютере, на котором выполняется SQL Server.
- Учетная запись службы, используемая на компьютере, на котором работает SQL Server, должна иметь доступ на запись к указанному пути файла трассировки.

### <a name="can-i-capture-traces-for-the-entire-server-or-only-on-a-single-database"></a>Можно ли записывать трассировки для всего сервера или только для одной базы данных?
    
ДЕА можно использовать для захвата трассировок для всех баз данных на сервере или для отдельной базы данных.
    
### <a name="i-have-a-linked-server-configured-in-my-production-environment-do-those-queries-show-up-in-the-traces"></a>У меня есть связанный сервер, настроенный в рабочей среде. Отображаются ли эти запросы в трассировках?
    
Если вы запускаете трассировку трассировки для всего сервера, Трассировка захватывает все запросы, включая запросы связанных серверов. Чтобы запустить запись трассировки для всего сервера, оставьте поле **имя базы данных** в разделе **Новая запись** пустой.
    
### <a name="whats-the-minimum-recommended-time-for-production-workload-traces"></a>Каково минимальное рекомендуемое время для трассировок рабочей нагрузки в рабочей нагрузке?
    
Рекомендуется выбрать время, которое лучше всего соответствует всей рабочей нагрузке. Таким образом, анализ выполняется для всех запросов в рабочей нагрузке.
    
### <a name="how-important-is-to-take-a-database-backup-right-before-i-start-a-trace-capture"></a>Насколько важно сделать резервную копию базы данных непосредственно перед началом записи трассировки?
    
Прежде чем начать запись трассировки, убедитесь, что вы создаете резервные копии всех целевых баз данных. Захваченная трассировка в целевом объекте 1 и целевом объекте 2 воспроизводится. Если состояние базы данных не совпадает, результаты эксперимента будут отклонены.

### <a name="can-i-collect-xevents-instead-of-traces-and-can-i-replay-xevents"></a>Могу ли я получить XEvents вместо трассировок и можно ли воспроизвести XEvents?
    
Да. ДЕА поддерживает XEvents. Скачайте последнюю версию ДЕА и придайте ей попытку.

## <a name="troubleshoot-trace-captures"></a>Устранение неполадок при захватах трассировки

Если при выполнении записи трассировки отображается сообщение об ошибке, ознакомьтесь со следующими предварительными требованиями.

- Убедитесь, что имя компьютера, на котором работает SQL Server, является допустимым. Для подтверждения попробуйте подключиться к компьютеру, на котором работает SQL Server, с помощью SQL Server Management Studio (SSMS).
- Убедитесь, что конфигурация брандмауэра не блокирует подключения к компьютеру, на котором работает SQL Server.
- Убедитесь, что у пользователя есть разрешения, перечисленные в [разделе часто задаваемые вопросы](https://blogs.msdn.microsoft.com/datamigration/2017/03/24/dea-2-0-replay-faq/)о воспроизведении публикации в блоге.
- Убедитесь, что имя трассировки не соответствует стандартному соглашению о смене ключей (захват\_1). Вместо этого попробуйте использовать такие имена трассировок\_, как Capture 1A или Capture1.

Ниже приведены некоторые возможные ошибки, которые могут возникнуть, и способы их устранения.

|Возможные ошибки|Решение|  
|---|---|  
|Не удалось запустить трассировку на целевом SQL Server, проверьте наличие необходимых разрешений и убедитесь, что учетная запись SQL Server имеет доступ на запись к указанному пути файла трассировки код ошибки SQL (53)|Пользователь, запускающий средство Деа, должен иметь доступ к компьютеру, на котором работает SQL Server. Пользователю должна быть назначена роль sysadmin.|  
|Не удалось запустить трассировку на целевом SQL Server, проверьте наличие необходимых разрешений и убедитесь, что учетная запись SQL Server имеет доступ на запись к указанному пути файла трассировки код ошибки SQL (19062)|Указанный путь трассировки может не существовать, или папка не имеет разрешений на запись для учетной записи, от имени которой работают службы SQL Server (например, СЕТЕВая служба). Путь должен существовать и должен иметь необходимые разрешения для запуска трассировки.|  
|Сейчас на целевом сервере выполняется трассировка ДЕА.|Активная трассировка уже запущена на целевом сервере. Вы не можете начать новую трассировку, если уже выполняется трассировка на уровне сервера.|  
|Не удается открыть запрошенную базу данных для записи трассировки. Эта ошибка может быть вызвана неверным именем базы данных.|Указанная база данных не существует или недоступна текущему пользователю. Используйте правильное имя базы данных.|  

Если вы видите другие ошибки с меткой " *код ошибки SQL*", см. раздел [ядро СУБД Errors](https://docs.microsoft.com/sql/relational-databases/errors-events/database-engine-events-and-errors) For detailed descriptions.

## <a name="next-steps"></a>Следующие шаги

- Чтобы узнать, как настроить средства распределенное воспроизведение в SQL Server перед воспроизведением захваченной трассировки, см. раздел [Настройка воспроизведения](database-experimentation-assistant-configure-replay.md).

- Чтобы получить 19-минутное введение в ДЕА и демонстрацию, просмотрите следующее видео:

  > [!VIDEO https://channel9.msdn.com/Shows/Data-Exposed/Introducing-the-Database-Experimentation-Assistant/player]
