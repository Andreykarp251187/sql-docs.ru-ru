---
title: Запишите трассировку в помощнике по базе данных службы "Экспериментирование" для обновления до SQL Server
description: Запишите трассировку в помощнике по базе данных службы "Экспериментирование"
ms.custom: ''
ms.date: 10/22/2018
ms.prod: sql
ms.prod_service: dea
ms.suite: sql
ms.technology: dea
ms.tgt_pltfrm: ''
ms.topic: conceptual
author: HJToland3
ms.author: ajaykar
ms.reviewer: mathoma
manager: jroth
ms.openlocfilehash: dc53a9e1d151e07ce7e2eebf1444fd0d0065f8be
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2019
ms.locfileid: "66794503"
---
# <a name="capture-a-trace-in-database-experimentation-assistant"></a>Запишите трассировку в помощнике по базе данных службы "Экспериментирование"

В базе данных службы "Экспериментирование" Assistant (веб) записи трассировки можно использовать для создания файла трассировки, который имеет журнал зарегистрированных серверных событиях. Событие записанного сервера является событие, происходящее на конкретном сервере во время определенного периода времени. Записи трассировки необходимо запустить один раз на каждом сервере.

Перед началом записи трассировки, убедитесь, что резервное копирование всех баз данных в целевой.

Кэширование запросов в SQL Server может повлиять на результаты оценки. Мы рекомендуется перезапустить службу SQL Server (MSSQLSERVER) в приложения службы, чтобы улучшить согласованность результатов оценки.

## <a name="create-a-trace-capture"></a>Создание записи трассировки

1. В Инициатив выберите значок "меню" в меню слева. В развернутом меню, выберите **захвата трассировки** рядом со значком камеры.

    ![Выберите в меню записи трассировок](./media/database-experimentation-assistant-capture-trace/dea-capture-trace-capture.png)

1. В разделе **новые записи**введите или выберите следующие сведения:

    - **Имя экземпляра SQL Server**: Введите имя компьютера, на котором вы хотите записать трассировку сервера SQL Server.
    - **Имя базы данных**: Введите имя для базы данных, на котором для запуска трассировки базы данных. Если не указать базу данных, трассировки записывается во всех базах данных на сервере.
    - **Имя файла трассировки**: Введите имя для файла трассировки для записи.
    - **Максимальный размер файла (МБ)** : Выберите размер смены для файлов. При необходимости в выбранный вами размер файла, создается новый файл. Рекомендуемые смены размер составляет 200 МБ.
    - **Длительность (мин)** : Выберите продолжительность времени (в минутах), необходимо до запуска записи трассировки.
    - **Путь для сохранения выходной файл трассировки**: Выберите конечный путь для файла трассировки. 

    > [!NOTE]
    > На компьютере, на котором выполняется SQL Server должен быть путь к файлу в файл трассировки. Если служба SQL Server не настроен для определенной учетной записи, служба может требуются разрешения на запись в указанную папку для файла трассировки для записи.
    >
    >

    ![Новая страница записи](./media/database-experimentation-assistant-capture-trace/dea-capture-trace-inputs.png)

## <a name="start-the-trace-capture"></a>Начать запись трассировки

Введите или выберите необходимые сведения, выберите **запустить** начать сбор трассировок. Если введенные сведения является допустимым, начинает процесс отслеживания трассировки. В противном случае текстовые поля, которые были введены недопустимые записи, выделяются красным цветом. 

Убедитесь, что выбран или введен значения верны, а затем выберите **запустить**.

После завершения сбора данных трассировки под управлением, найдите новый файл трассировки в папке, указанной в **путь для сохранения выходной файл трассировки**. Выберите значок колокольчика в нижней части меню слева, чтобы отслеживать ход выполнения записи.

![Записи о ходе выполнения трассировки](./media/database-experimentation-assistant-capture-trace/dea-capture-trace-progress.png)

### <a name="trace-file"></a>Файл трассировки

Запись данных трассировки записывает TRC-файл в указанном расположении. Файл трассировки содержит результаты трассировки действия базы данных SQL Server. TRC-файлы предназначены для предоставления дополнительных сведений об ошибках, которые обнаруживаются и предоставляемых сервером SQL Server.

## <a name="frequently-asked-questions-about-trace-capture"></a>Часто задаваемые вопросы о записи трассировки

Ниже некоторые часто задаваемые вопросы о записи трассировки в веб.

### <a name="what-events-are-captured-when-i-run-a-trace-capture-on-a-production-database"></a>Какие события регистрируются при запуске захвата трассировки на производственной базы данных?

Следующая таблица предоставляет список событий и соответствующие данные столбцов, которые мы собираем для трассировки:
  
|Имя события|Текстовые данные (1)|Двоичные данные (2)|Идентификатор базы данных (3)|Имя узла (8)|Имя приложения (10)|Имя для входа (11)|SPID (12)|Время начала (14)|Время окончания (15)|Имя базы данных (35)|Последовательность событий (51)|IsSystem (60)|  
|---|---|---|---|---|---|---|---|---|---|---|---|---|  
|**RPC: завершена (10)**||*|*|*|*|*|*|*|*|*|*|*|  
|**RPC: запуск (11)**||*|*|*|*|*|*|*||*|*|*|  
|**RPC Output Parameter (100)**|*||*|*|*|*|*|*||*|*|*|  
|**SQL: BatchCompleted (12)**|*||*|*|*|*|*|*|*|*|*|*|  
|**SQL: BatchStarting (13)**|*||*|*|*|*|*|*||*|*|*|  
|**Audit Login (14)**|*|*|*|*|*|*|*|*||*|*|*|  
|**Audit Logout (15)**|*||*|*|*|*|*|*|*|*|*|*|  
|**ExistingConnection (17)**|*|*|*|*|*|*|*|*||*|*|*|  
|**CursorOpen (53)**|*||*|*|*|*|*|*||*|*|*|  
|**CursorPrepare (70)**|*||*|*|*|*|*|*||*|*|*|  
|**Prepare SQL (71)**|||*|*|*|*|*|*||*|*|*|  
|**Exec Prepared SQL (72)**|||*|*|*|*|*|*||*|*|*|  
|**CursorExecute (74)**|*||*|*|*|*|*|*||*|*|*|  
|**CursorUnprepare (77)**|*||*|*|*|*|*|*||*|*|*|  
|**CursorClose (78)**|*||*|*|*|*|*|*||*|*|*|  

### <a name="is-there-a-performance-effect-on-my-production-server-when-trace-capture-is-running"></a>Есть ли влияние на производительность на моем рабочем сервере при запуске захвата трассировки?
    
Да, есть эффект минимальной производительности во время сбора трассировки. Согласно проведенным тестам мы обнаружили о нехватке памяти 3%.
    
### <a name="what-kind-of-permissions-are-required-for-capturing-traces-on-a-production-workload"></a>Какие разрешения требуются для захвата трассировок на рабочей нагрузки?
    
- Windows пользователь, выполняющий операции трассировки в веб-приложения должна иметь права sysadmin на компьютере, на котором выполняется SQL Server.
- Учетная запись службы, используется на компьютере под управлением SQL Server должна иметь доступ на запись к указанной трассировке путь к файлу.

### <a name="can-i-capture-traces-for-the-entire-server-or-only-on-a-single-database"></a>Можно записать трассировки для всего сервера или только на одну базу данных?
    
Инициатив можно использовать для трассировки для всех баз данных на сервере или для отдельной базы данных.
    
### <a name="i-have-a-linked-server-configured-in-my-production-environment-do-those-queries-show-up-in-the-traces"></a>У меня есть на связанный сервер, настроенный в своей рабочей среды. Эти запросы, отображаются в трассировках?
    
Если вы используете запись трассировки для всего сервера, трассировки записываются все запросы, включая запросами связанного сервера. Чтобы запустить записи трассировки для всего сервера, оставьте **имя базы данных** поле в разделе **новые записи** пустой.
    
### <a name="whats-the-minimum-recommended-time-for-production-workload-traces"></a>Что такое минимальное время рекомендуется для производства трассировки рабочей нагрузки?
    
Мы рекомендуем выбрать время, которое наилучшим образом представляющий полностью рабочей нагрузки. Таким образом, чтобы начать анализ для всех запросов в рабочей нагрузке.
    
### <a name="how-important-is-to-take-a-database-backup-right-before-i-start-a-trace-capture"></a>Насколько важна резервное копирование базы данных, правой, прежде чем приступать к записи трассировки?
    
Перед началом записи трассировки, убедитесь, что резервную копию всех целевых баз данных. Собранные данные трассировки в цель 1 и 2 целевой воспроизводится. Если состояние базы данных не совпадают, результаты выполнения службы "Экспериментирование" несогласованны.

### <a name="can-i-collect-xevents-instead-of-traces-and-can-i-replay-xevents"></a>Можно ли собирать XEvents вместо трассировки и я воспроизведения XEvents?
    
Да. Инициатив поддерживает XEvents. Загрузите последнюю версию веб и Испытайте их.

## <a name="troubleshoot-trace-captures"></a>Устранение неполадок захват трассировки

Если появится сообщение об ошибке при выполнении записи трассировки, ознакомьтесь со следующими требованиями:

- Убедитесь, что имя компьютера под управлением SQL Server является допустимым. Чтобы проверить, попробуйте подключиться к компьютеру под управлением SQL Server с помощью SQL Server Management Studio (SSMS).
- Убедитесь, что конфигурация брандмауэра не блокируют подключения к компьютерам под управлением SQL Server.
- Убедитесь, что у пользователя есть разрешения, которые перечислены в блоге [воспроизведения часто задаваемые вопросы о](https://blogs.msdn.microsoft.com/datamigration/2017/03/24/dea-2-0-replay-faq/).
- Убедитесь, что имя трассировки не подчиняются правилам стандартный продолжения (записать\_1). Вместо этого попробуйте имена трассировки, как захват\_1A или Capture1.

Ниже приведены некоторые возможные ошибки, которые можно увидеть и решения по их устранению.

|Возможные ошибки|Решение|  
|---|---|  
|Не удалось запустить трассировку на целевом сервере SQL, проверить ли, что у вас есть необходимые разрешения и учетная запись SQL Server имеет доступ на запись указанной трассировки пути к файлу, код ошибки Sql (53)|Пользователь, запустив средство Инициатив, должен иметь доступ к компьютеру под управлением SQL Server. Пользователю необходимо назначить роли sysadmin.|  
|Не удалось запустить трассировку на целевом сервере SQL, проверить ли, что у вас есть необходимые разрешения и учетная запись SQL Server имеет доступ на запись указанной трассировки пути к файлу, код ошибки Sql (19062)|Указанный путь трассировки может отсутствовать или папка не имеет разрешения на запись для учетной записи, под SQL Server, которые они работают (например, NETWORK SERVICE). Путь должен существовать, и он должен иметь необходимые разрешения для запуска трассировки.|  
|В настоящее время Инициатив трассировки запущена на целевом сервере.|Текущая трассировка уже запущена на целевом сервере. Невозможно запустить новую трассировку, если трассировка уровня сервера уже выполняется.|  
|Не удается открыть запрошенную базу данных для записи трассировки. Эта ошибка может быть вызвана неправильной базы данных имя.|Указанная база данных не существует, или он недоступен для текущего пользователя. Используйте правильное имя базы данных.|  

При обнаружении ошибок, с меткой *код ошибки Sql*, см. в разделе [системных сообщений об ошибках](https://docs.microsoft.com/previous-versions/sql/sql-server-2008-r2/cc645603(v=sql.105)) подробное описание и способы их устранения.
    
## <a name="next-steps"></a>Следующие шаги

- Чтобы узнать, как настроить средства распределенного воспроизведения в SQL Server, прежде чем воспроизведения записанной трассировки, см. в разделе [Настройка воспроизведения](database-experimentation-assistant-configure-replay.md).

- 19-минутный введение Инициатив и демонстрации в следующем видео:

  > [!VIDEO https://channel9.msdn.com/Shows/Data-Exposed/Introducing-the-Database-Experimentation-Assistant/player]
