---
title: Воспроизведение трассировки с помощью базы данных службы "Экспериментирование" Assistant для обновления до SQL Server
description: Воспроизведение трассировки с помощью помощника по базе данных службы "Экспериментирование"
ms.custom: ''
ms.date: 10/22/2018
ms.prod: sql
ms.prod_service: dea
ms.suite: sql
ms.technology: dea
ms.tgt_pltfrm: ''
ms.topic: conceptual
author: HJToland3
ms.author: ajaykar
ms.reviewer: douglasl
manager: craigg
ms.openlocfilehash: 09c3ffe6897107d2b3db0f53b0fdc895ee437efd
ms.sourcegitcommit: f7fced330b64d6616aeb8766747295807c92dd41
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63273993"
---
# <a name="replay-a-trace-in-database-experimentation-assistant"></a>Воспроизведение трассировки в помощнике по базе данных службы "Экспериментирование"

В базе данных службы "Экспериментирование" Assistant (веб), можно воспроизводить файл записанной трассировки в обновленной тестовой среде. Например рассмотрим рабочую нагрузку, которая работает на SQL Server 2008 R2. Файл трассировки для рабочей нагрузки должны воспроизводиться дважды: один раз в среде с той же версии SQL Server, который работает в рабочей среде и еще раз в среде, имеющей обновления целевой версии SQL Server, таких как SQL Server 2016.

> [!NOTE]
> Чтобы выполнить это действие, необходимо вручную настроить виртуальных машин или физических компьютеров для выполнения распределенного воспроизведения трассировок. Дополнительные сведения см. в разделе [установки контроллера и клиенты распределенного воспроизведения](https://blogs.msdn.microsoft.com/datamigration/distributed-replay-controller-and-client-setup/).
>
>

## <a name="create-a-trace-replay"></a>Создание воспроизведение трассировки

В Инициатив выберите значок "меню". В развернутом меню, выберите **воспроизведение трассировок** рядом со значком воспроизведения.

![Выберите в меню воспроизведение трассировок](./media/database-experimentation-assistant-replay-trace/dea-replay-trace-open.png)

> [!NOTE]
> На компьютере контроллера распределенного воспроизведения требуются разрешения для учетной записи пользователя, который можно использовать для удаленного.
>

### <a name="grant-access-to-the-distributed-replay-controller"></a>Доступ к данным для контроллера распределенного воспроизведения

1. В командной строке введите **dcomcnfg** открыть **службы компонентов** интерфейс.
1. Разверните **службы компонентов** > **компьютеров** > **компьютер** > **DCOM Config**  >  **DReplayController**.
1. Щелкните правой кнопкой мыши **DReplayController**, а затем выберите **свойства**.
1. На **безопасности** выберите **изменить** для добавления учетной записи пользователя.
1. Нажмите кнопку **ОК**.

### <a name="verify-setup"></a>Проверка установки

1.  **Путь установки SQL Server**: Введите путь к папке установки SQL Server. Например, C:\\Program Files (x86)\\Microsoft SQL Server\\120.
1.  **Имя компьютера контроллера**: Введите имя компьютера, на котором настроена роль контроллера. Эта машина со службой Windows с именем контроллера распределенного воспроизведения SQL Server. Контроллер распределенного воспроизведения управляет согласованными действиями клиентов распределенного воспроизведения. В каждой среде распределенного воспроизведения можно установить только один экземпляр контроллера.
1.  **Имена компьютеров клиента**: Введите имя для каждого клиентского компьютера, разделенных запятыми. Пример: client1 client2. Может иметь до пяти контроллеры клиента. Клиенты находятся в одной или нескольких машин, физическим или виртуальным, где выполняется служба Windows, с именем клиента распределенного воспроизведения SQL Server. Клиенты распределенного воспроизведения работают совместно для имитации рабочей нагрузки на экземпляре SQL Server. В каждой среде распределенного воспроизведения можно установить один или несколько клиентов.
1.  Выберите **Далее**.

### <a name="select-a-trace"></a>Выберите трассировку

1.  **Путь к файлу трассировки**: Введите путь к файлу входных данных трассировки (TRC в качестве).
1.  **Путь для сохранения воспроизведения предварительная обработка выходных данных**:  
    \- Если у вас еще нет файла IRF, введите путь к папке, где вы хотите сохранить файл IRF и выводит других предварительной обработки.  
    \- Если у вас уже есть IRF файл, введите путь к файлам IRF.
1. Выберите **Далее**.

### <a name="replay-a-trace"></a>Воспроизведение трассировки

1.  **Имя файла трассировки**: Введите имя файла трассировки.
1.  **Максимальный размер файла (МБ)**: Введите значение размера файл продолжения трассировки. Значение по умолчанию — 200 МБ. Можно ввести пользовательское значение.
1.  **Путь для сохранения выходных данных трассировки для воспроизведения**: Введите путь, .trc выходного файла.
1.  **Имя экземпляра SQL Server**:  Введите имя экземпляра SQL Server, на котором для воспроизведения трассировки.
1.  Выберите **запустить**.

Если введенные сведения является допустимым, запускает процесс распределенного воспроизведения. В противном случае boses текста, которые имеют неверные сведения будут выделены красным цветом. Убедитесь, что вы ввели значения верны, а затем выберите **запустить**.

Дождитесь завершения воспроизведения выполнение до см. в разделе указанное расположение. Выберите значок колокольчика в нижней части меню слева, чтобы отслеживать ход выполнения воспроизведения.

![Ход воспроизведения трассировок](./media/database-experimentation-assistant-replay-trace/dea-replay-trace-progress.png)

## <a name="frequently-asked-questions-about-trace-replay"></a>Часто задаваемые вопросы о воспроизведение трассировки

### <a name="what-security-permissions-do-i-need-to-start-a-replay-capture-on-my-target-server"></a>Какие разрешения безопасности необходимо начать захват воспроизведения на целевом сервере?

- Пользователь Windows, на котором выполняется операция трассировки в веб-приложения должна иметь права sysadmin на целевом компьютере под управлением SQL Server. Эти права необходимы для запуска трассировки.
- Учетная запись службы, под которой выполняется компьютер под управлением SQL Server должен иметь доступ на запись к указанной трассировке путь к файлу.
- Учетная запись службы, под которой запущены службы клиента распределенного воспроизведения необходимо иметь права пользователя для подключения к целевому компьютеру под управлением SQL Server и для выполнения запросов.

### <a name="can-i-start-more-than-one-replay-in-the-same-session"></a>Можно запустить несколько воспроизведения в одном сеансе?

Да, можно запустить несколько воспроизведения и отслеживать их выполнения в одном сеансе.

### <a name="can-i-start-more-than-one-replay-in-parallel"></a>Можно запустить несколько воспроизведения в параллельном режиме?

Да, но не с тем же количестве компьютеров, выбранных в **контроллера, а также клиенты**. Контроллер и клиентов будет занят. Настроить отдельный набор тестируемых компьютеров **контроллера, а также клиент** запустить параллельных воспроизведение.

### <a name="how-long-does-a-replay-typically-take-to-finish"></a>Сколько воспроизведение обычно времени занимает до конца?

Воспроизведение обычно занимает столько времени, что источник трассировки, а также время, необходимое для предварительной обработки источника трассировки. Тем не менее если клиентские компьютеры, зарегистрированные в контроллере не могут справиться с нагрузкой, созданного из воспроизведения, воспроизведение может занять больше времени. До 16 клиентских компьютеров можно зарегистрировать с контроллером.

### <a name="how-large-do-target-trace-files-get"></a>Размер получу целевые файлы трассировки?

Целевой объект трассировки, файлы могут быть в диапазоне от 5 до 15 раза больше объема источника трассировки. Размер файла зависит от количества запросов выполняются. К примеру большие двоичные объекты план запроса может быть большим. Если изменить часто статистику для этих запросов, регистрируются дополнительные события.

### <a name="why-do-i-need-to-restore-databases"></a>Зачем нужно восстановить базы данных?

SQL Server — это система управления с отслеживанием состояния реляционной базы данных. Для правильной работы A / B-тестирования, состояние базы данных должны храниться все время. В противном случае возможны ошибки в запросах во время воспроизведения, который не будет отображаться в рабочей среде. Чтобы избежать этих ошибок, рекомендуется выполнить сразу перед сбор данных по исходной резервной копии. Аналогичным образом при восстановлении резервной копии на конечном компьютере под управлением SQL Server является обязательным для предотвращения ошибок во время воспроизведения.

### <a name="what-does-pass--on-the-replay-page-mean"></a>Что «pass %» на странице воспроизведения среднее?

**Передайте %** означает, что передается только процент запросов. Произвести диагностику ли ожидается, что количество ошибок. Ошибки можно ожидать, или могут возникать ошибки, так как базы данных потеряло их целостность. Если значение для **pass %** разработчику требуется, можно остановить трассировку и просмотрите файл трассировки в SQL Profiler, чтобы увидеть, какие запросы не удалось выполнить.

### <a name="how-can-i-look-at-the-trace-events-that-were-collected-during-replay"></a>Как можно просматривать события трассировки, собранные во время воспроизведения?

Открыть файл трассировки целевой объект и просмотреть ее в SQL Profiler. Или, если вы хотите внести изменения в записи преобразования, все скрипты SQL Server доступны в папку C:\\Program Files (x86)\\Корпорация Майкрософт\\базы данных службы "Экспериментирование" Assistant\\сценариев\\ StartReplayCapture.sql.

### <a name="what-trace-events-does-dea-collect-during-replay"></a>Во время воспроизведения события трассировки собирает Инициатив?

Инициатив захватывает события трассировки, содержащие сведения, связанные с производительностью. Конфигурация системы отслеживания является StartReplayCaptureTrace.sql сценария. Это типичный события трассировки SQL Server, которые перечислены в [sp_trace_setevent (Transact-SQL) справочную документацию](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-trace-setevent-transact-sql).

## <a name="troubleshoot-trace-replay"></a>Устранение неполадок воспроизведение трассировки

### <a name="i-cant-connect-to-the-computer-thats-running-sql-server"></a>Не удается подключиться к компьютеру, на котором выполняется SQL Server

- Убедитесь, что имя компьютера под управлением SQL Server является допустимым. Чтобы проверить, попробуйте подключиться к серверу с помощью SQL Server Management Studio (SSMS).
- Убедитесь, что конфигурация брандмауэра не блокируют подключения к компьютерам под управлением SQL Server.
- Убедитесь, что у пользователя есть необходимые права.
- Убедитесь, что учетная запись службы клиента распределенного воспроизведения имеет доступ к компьютеру под управлением SQL Server.

Дополнительные сведения можно получить в журналах в папке % temp %\\Инициатив. Если проблема сохранится, обратитесь к команде разработчиков.

### <a name="i-cant-connect-to-the-distributed-replay-controller"></a>Не удается подключиться к контроллеру распределенного воспроизведения

- Запустите службу контроллера распределенного воспроизведения на компьютере контроллера. Чтобы проверить, используйте средства управления распределенного воспроизведения (выполните команду `dreplay.exe status -f 1`).
- Если воспроизведение запускается удаленно:
  - Убедитесь, что компьютер под управлением Инициатив удается успешно проверить связь контроллера. Убедитесь, что параметры брандмауэра разрешают подключения, следуя инструкциям на **Настройка среде воспроизведения** страницы. Дополнительные сведения см. в статье [распределенного воспроизведения SQL Server](https://docs.microsoft.com/sql/tools/distributed-replay/sql-server-distributed-replay?view=sql-server-2017).
  - Убедитесь, что удаленный запуск DCOM и удаленная активация разрешены для пользователя контроллера распределенного воспроизведения.
  - Убедитесь, что права удаленного доступа DCOM разрешены для пользователя контроллера распределенного воспроизведения.

### <a name="the-trace-file-path-exists-on-my-machine-why-cant-distributed-replay-controller-find-it"></a>На моем компьютере существует путь к файлу трассировки. Почему я не контроллера распределенного воспроизведения найти ее?

Распределенное воспроизведение можно получить доступ к только локальный диск ресурсов. Перед началом воспроизведения необходимо скопировать исходные файлы трассировки на компьютере контроллера распределенного воспроизведения. Кроме того, необходимо указать путь на Инициатив **новый воспроизведения** страницы. 

UNC-пути не совместимы с распределенного воспроизведения. Распределенного воспроизведения пути должны быть локальными, абсолютные пути к первого файла трассировки источника, включая расширение.

### <a name="why-cant-i-browse-for-files-on-the-new-replay-page"></a>Почему не удается просмотреть для файлов на странице воспроизведения новый?

Так как мы не удается просмотреть папки на удаленном компьютере, выполнив поиск по файлам бесполезно. Копирование и вставка абсолютные пути является более эффективным.

### <a name="i-started-replay-with-a-trace-but-distributed-replay-didnt-replay-any-events"></a>Я начал воспроизведения с трассировкой, но распределенного воспроизведения не позволяет воспроизвести все события

Эта проблема может возникать, так как файл трассировки или не имеет воспроизводимых событий; он не содержит сведения о том, как воспроизвести события. Проверьте, является ли предоставленный путь к файлу трассировки файла трассировки источника. Исходный файл трассировки создается с помощью конфигурации, указанное в скрипте StartCaptureTrace.sql.

### <a name="i-see-unexpected-error-occurred-when-i-try-to-preprocess-my-trace-files-by-using-the-sql-server-2017-distributed-replay-controller"></a>Я см. в разделе «произошла непредвиденная ошибка!» При попытке предварительной обработки файлов трассировки, используя контроллер распределенного воспроизведения SQL Server 2017

Данная проблема возникает в RTM-версии SQL Server 2017. Дополнительные сведения см. в разделе [произошла непредвиденная ошибка при использовании компонента DReplay для воспроизведения записанной трассировки в SQL Server 2017](https://support.microsoft.com/help/4045678/fix-unexpected-error-when-you-use-the-dreplay-feature-to-replay-a).  
  
Проблема была устранена в последний накопительный пакет обновления 1 для SQL Server 2017. Скачайте последнюю версию [накопительный пакет обновления 1 для SQL Server 2017](https://support.microsoft.com/help/4038634/cumulative-update-1-for-sql-server-2017).

## <a name="next-steps"></a>Следующие шаги

- Создание отчета об анализе, который помогает получить сведения о предлагаемых изменений, см. в разделе [Создание отчеты](database-experimentation-assistant-create-report.md).

- 19-минутный введение Инициатив и демонстрации в следующем видео:

  > [!VIDEO https://channel9.msdn.com/Shows/Data-Exposed/Introducing-the-Database-Experimentation-Assistant/player]
