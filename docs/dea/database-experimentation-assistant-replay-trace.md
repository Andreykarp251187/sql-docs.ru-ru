---
title: Воспроизведение трассировки для SQL Server обновлений
description: Воспроизведение трассировки с Database Experimentation Assistant для SQL Server обновлений
ms.custom: seo-lt-2019
ms.date: 10/22/2018
ms.prod: sql
ms.prod_service: dea
ms.suite: sql
ms.technology: dea
ms.tgt_pltfrm: ''
ms.topic: conceptual
author: HJToland3
ms.author: ajaykar
ms.reviewer: mathoma
ms.openlocfilehash: b1607aefdc8495f374b2586b0b896f20e87f62d1
ms.sourcegitcommit: d00ba0b4696ef7dee31cd0b293a3f54a1beaf458
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2019
ms.locfileid: "74056697"
---
# <a name="replay-a-trace-in-database-experimentation-assistant"></a>Воспроизведение трассировки в Database Experimentation Assistant

В Database Experimentation Assistant (ДЕА) можно воспроизвести захваченный файл трассировки в обновленной тестовой среде. Например, рассмотрим рабочую нагрузку, которая работает на SQL Server 2008 R2. Файл трассировки для рабочей нагрузки необходимо воспроизводить дважды: один раз в среде с той же версией SQL Server, которая работает в рабочей среде, и снова в окружении, где используется версия SQL Server, например SQL Server 2016.

> [!NOTE]
> Чтобы выполнить это действие, необходимо вручную настроить виртуальные машины или физические компьютеры для запуска трассировок распределенное воспроизведение. Дополнительные сведения см. в статье [Установка контроллера и клиентов распределенное воспроизведение](https://blogs.msdn.microsoft.com/datamigration/distributed-replay-controller-and-client-setup/).
>
>

## <a name="create-a-trace-replay"></a>Создание воспроизведения трассировки

В ДЕА выберите значок меню. В развернутом меню выберите **воспроизвести трассировки** рядом со значком воспроизведения.

![Выбор воспроизведения трассировок в меню](./media/database-experimentation-assistant-replay-trace/dea-replay-trace-open.png)

> [!NOTE]
> Компьютеру контроллера распределенное воспроизведение требуются разрешения для учетной записи пользователя, используемой для удаленного доступа.
>

### <a name="grant-access-to-the-distributed-replay-controller"></a>Предоставление доступа к контроллеру распределенное воспроизведение

1. В командной строке введите **DCOMCNFG** , чтобы открыть интерфейс **служб компонентов** .
1. Разверните узел **службы компонентов** > **компьютеры** > **Мой компьютер** > Настройка **DCOM** > **DReplayController**.
1. Щелкните правой кнопкой мыши **DReplayController**и выберите пункт **свойства**.
1. На вкладке **Безопасность** выберите **изменить** , чтобы добавить учетную запись пользователя.
1. Нажмите кнопку **ОК**.

### <a name="verify-setup"></a>Проверка установки

1.  **Путь установки SQL Server**: введите путь к месту установки SQL Server. Например, C:\\Program Files (x86)\\Microsoft SQL Server\\120.
1.  **Имя компьютера контроллера**: введите имя компьютера, который был настроен в качестве контроллера. На этом компьютере запущена служба Windows с именем SQL Server распределенное воспроизведение контроллер. Контроллер распределенное воспроизведение управляет действиями клиентов распределенное воспроизведение. В каждой среде распределенного воспроизведения можно установить только один экземпляр контроллера.
1.  **Имена клиентских компьютеров**: введите имя для каждой клиентской машины, разделяя их запятыми. Пример: КЛИЕНТ1, КЛИЕНТ2. Можно использовать до пяти контроллеров клиента. Клиенты — это один или несколько машин (физических или виртуальных), которые запускают службу Windows с именем SQL Server распределенное воспроизведение Client. Клиенты распределенного воспроизведения работают совместно для имитации рабочей нагрузки на экземпляре SQL Server. В каждой среде распределенного воспроизведения можно установить один или несколько клиентов.
1.  Выберите **Далее**.

### <a name="select-a-trace"></a>Выбор трассировки

1.  **Путь к файлу трассировки**: введите путь к входному файлу трассировки (TRC).
1.  **Путь к выходным данным предварительной обработки для воспроизведения**:  
    \- если у вас еще нет файла ИРФ, введите путь к расположению, где будет храниться файл ИРФ и другие предварительные выходные данные.  
    \- если у вас уже есть файл ИРФ, введите путь к файлам ИРФ.
1. Выберите **Далее**.

### <a name="replay-a-trace"></a>Воспроизвести трассировку

1.  **Имя файла трассировки**: введите имя файла трассировки.
1.  **Максимальный размер файла (МБ)** : введите значение размера ролловера файла трассировки. Значение по умолчанию — 200 МБ. Можно ввести пользовательское значение.
1.  **Путь к выходным данным трассировки воспроизведения**: введите путь к выходному файлу. trc.
1.  **SQL Server имя экземпляра**: введите имя экземпляра SQL Server, для которого необходимо воспроизвести трассировки.
1.  Нажмите кнопку **Пуск**.

Если введенные сведения являются допустимыми, запускается процесс распределенное воспроизведение. В противном случае текст босес с неправильными сведениями выделяется красным цветом. Убедитесь, что введены правильные значения, а затем нажмите кнопку **запустить**.

Дождитесь завершения воспроизведения, чтобы увидеть указанное расположение. Щелкните значок колокольчика в нижней части меню слева, чтобы отслеживать ход воспроизведения.

![Воспроизвести ход трассировки](./media/database-experimentation-assistant-replay-trace/dea-replay-trace-progress.png)

## <a name="frequently-asked-questions-about-trace-replay"></a>Часто задаваемые вопросы о воспроизведении трассировки

### <a name="what-security-permissions-do-i-need-to-start-a-replay-capture-on-my-target-server"></a>Какие разрешения безопасности требуются для запуска записи воспроизведения на целевом сервере?

- Пользователь Windows, выполняющий операцию трассировки в приложении Деа, должен иметь права системного администратора на целевом компьютере, на котором выполняется SQL Server. Эти права пользователя необходимы для запуска трассировки.
- Учетная запись службы, под которой выполняется SQL Server, должна иметь доступ на запись к указанному пути файла трассировки.
- Учетная запись службы, под которой выполняются клиентские службы распределенное воспроизведение, должна иметь права пользователя для подключения к целевому компьютеру, на котором выполняется SQL Server, и для выполнения запросов.

### <a name="can-i-start-more-than-one-replay-in-the-same-session"></a>Можно ли запустить более одного воспроизведения в одном сеансе?

Да, можно запустить несколько повторов и отследить их до завершения в одном сеансе.

### <a name="can-i-start-more-than-one-replay-in-parallel"></a>Можно ли запускать более одного воспроизведения параллельно?

Да, но не с тем же набором компьютеров, выбранным в поле **Клиенты контроллера Plus**. Контроллер и клиенты будут заняты. Настройте отдельный набор компьютеров в разделе **контроллер и клиент** , чтобы начать параллельное воспроизведение.

### <a name="how-long-does-a-replay-typically-take-to-finish"></a>Сколько времени воспроизведение обычно занимает это время?

Воспроизведение обычно занимает то же время, что и исходная трассировка, а также время, необходимое для предварительной обработки трассировки источника. Однако если клиентские компьютеры, зарегистрированные в контроллере, недостаточно для управления нагрузкой, созданной на основе воспроизведения, воспроизведение может занять больше времени. С контроллером можно зарегистрировать до 16 клиентских компьютеров.

### <a name="how-large-do-target-trace-files-get"></a>Как крупные целевые файлы трассировки получают?

Целевые файлы трассировки могут находиться в диапазоне от 5 до 15 раз в длину трассировки источника. Размер файла зависит от количества выполняемых запросов. Например, большие двоичные объекты плана запроса могут быть большими. Если статистика для этих запросов изменяется часто, записываются дополнительные события.

### <a name="why-do-i-need-to-restore-databases"></a>Зачем нужно восстанавливать базы данных?

SQL Server — это система управления реляционными базами данных с отслеживанием состояния. Для правильного выполнения теста A/B состояние базы данных должно храниться в любое время. В противном случае в запросах во время воспроизведения могут отображаться ошибки, которые не отображаются в рабочей среде. Чтобы избежать этих ошибок, рекомендуется сделать резервную копию прямо перед записью источника. Аналогичным образом, чтобы предотвратить возникновение ошибок во время воспроизведения, необходимо восстановить резервную копию на целевом компьютере, на котором выполняется SQL Server.

### <a name="what-does-pass--on-the-replay-page-mean"></a>Что означает "передать%" на странице воспроизведения?

**Pass%** означает, что передается только процент запросов. Можно определить, ожидается ли количество ошибок. Ошибки могут быть ожидаемыми, или ошибки могут возникать из-за потери целостности базы данных. Если значение для параметра **Pass%** не соответствует ожиданиям, можно отключить трассировку и просмотреть файл трассировки в SQL Profiler, чтобы узнать, какие запросы не были выполнены успешно.

### <a name="how-can-i-look-at-the-trace-events-that-were-collected-during-replay"></a>Как просмотреть события трассировки, собранные во время воспроизведения?

Откройте целевой файл трассировки и просмотрите его в SQL Profiler. Или, если вы хотите внести изменения в запись воспроизведения, все сценарии SQL Server доступны на языке C:\\Program Files (x86)\\Microsoft Corporation\\Database Experimentation Assistant\\Scripts\\Стартреплайкаптуре. SQL.

### <a name="what-trace-events-does-dea-collect-during-replay"></a>Какие события трассировки ДЕА собираются во время воспроизведения?

ДЕА фиксирует события трассировки, содержащие сведения о производительности. Конфигурация отслеживания находится в скрипте Стартреплайкаптуретраце. SQL. Эти события являются типичными SQL Server событий трассировки, которые перечислены в [справочной документации по sp_trace_setevent (Transact-SQL)](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-trace-setevent-transact-sql).

## <a name="troubleshoot-trace-replay"></a>Устранение неполадок при воспроизведении трассировки

### <a name="i-cant-connect-to-the-computer-thats-running-sql-server"></a>Не удается подключиться к компьютеру, на котором работает SQL Server

- Убедитесь, что имя компьютера, на котором работает SQL Server, является допустимым. Для подтверждения попробуйте подключиться к серверу с помощью SQL Server Management Studio (SSMS).
- Убедитесь, что конфигурация брандмауэра не блокирует подключения к компьютеру, на котором работает SQL Server.
- Убедитесь, что у пользователя есть необходимые права пользователя.
- Убедитесь, что учетная запись службы клиента распределенное воспроизведение имеет доступ к компьютеру, на котором работает SQL Server.

Дополнительные сведения можно получить в журналах в каталоге% Temp%\\ДЕА. Если проблема не исчезнет, обратитесь к группе разработчиков продукта.

### <a name="i-cant-connect-to-the-distributed-replay-controller"></a>Не удается подключиться к контроллеру распределенное воспроизведение

- Убедитесь, что служба контроллера распределенное воспроизведение запущена на компьютере контроллера. Для проверки используйте средства управления распределенное воспроизведение (выполните команду `dreplay.exe status -f 1`).
- Если воспроизведение запускается удаленно:
  - Убедитесь, что компьютер, на котором работает Деа, может успешно проверить связь с контроллером. Убедитесь, что параметры брандмауэра разрешают подключения в соответствии с инструкциями на странице **Настройка среды воспроизведения** . Дополнительные сведения см. в статье [SQL Server распределенное воспроизведение](https://docs.microsoft.com/sql/tools/distributed-replay/sql-server-distributed-replay?view=sql-server-2017).
  - Убедитесь, что удаленный запуск и удаленная активация DCOM разрешены для пользователя контроллера распределенное воспроизведение.
  - Убедитесь, что для пользователя контроллера распределенное воспроизведение разрешены права удаленного доступа DCOM.

### <a name="the-trace-file-path-exists-on-my-machine-why-cant-distributed-replay-controller-find-it"></a>Путь к файлу трассировки существует на компьютере. Почему распределенное воспроизведение контроллер не может найти его?

Распределенное воспроизведение может получать доступ только к локальным дискам. Перед началом воспроизведения необходимо скопировать исходные файлы трассировки на компьютер контроллера распределенное воспроизведение. Кроме того, необходимо указать путь на ДЕА новой странице **воспроизведения** . 

Пути UNC несовместимы с распределенное воспроизведение. Пути распределенное воспроизведение должны быть локальными, абсолютными путями к первому исходному файлу трассировки, включая расширение.

### <a name="why-cant-i-browse-for-files-on-the-new-replay-page"></a>Почему не удается найти файлы на новой странице воспроизведения?

Поскольку не удается просмотреть папки удаленного компьютера, просмотр файлов не полезен. Копировать и вставлять абсолютные пути более эффективно.

### <a name="i-started-replay-with-a-trace-but-distributed-replay-didnt-replay-any-events"></a>Я начал воспроизведение с трассировкой, но распределенное воспроизведение не воспроизводил какие-либо события

Эта проблема может возникать из-за того, что файл трассировки либо не имеет воспроизводимых событий, либо не содержит сведений о том, как воспроизвести события. Убедитесь, что указанный путь к файлу трассировки является исходным файлом трассировки. Исходный файл трассировки создается с помощью конфигурации, представленной в скрипте Старткаптуретраце. SQL.

### <a name="i-see-unexpected-error-occurred-when-i-try-to-preprocess-my-trace-files-by-using-the-sql-server-2017-distributed-replay-controller"></a>Я вижу "непредвиденная ошибка". При попытке предварительной обработки файлов трассировки с помощью контроллера распределенное воспроизведение SQL Server 2017

Эта проблема известна в RTM-версии SQL Server 2017. Дополнительные сведения см. в статье [непредвиденная ошибка при использовании функции DReplay для воспроизведения захваченной трассировки в SQL Server 2017](https://support.microsoft.com/help/4045678/fix-unexpected-error-when-you-use-the-dreplay-feature-to-replay-a).  
  
Эта ошибка устранена в последнем накопительном пакете обновления 1 для SQL Server 2017. Скачайте последнюю версию [накопительного пакета обновления 1 для SQL Server 2017](https://support.microsoft.com/help/4038634/cumulative-update-1-for-sql-server-2017).

## <a name="next-steps"></a>Следующие шаги

- Чтобы создать аналитический отчет, который поможет получить представление о предлагаемых изменениях, см. раздел [Создание отчетов](database-experimentation-assistant-create-report.md).

- Чтобы получить 19-минутное введение в ДЕА и демонстрацию, просмотрите следующее видео:

  > [!VIDEO https://channel9.msdn.com/Shows/Data-Exposed/Introducing-the-Database-Experimentation-Assistant/player]
