---
title: Настройка распределенного воспроизведения | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: sql-tools
ms.reviewer: ''
ms.technology: tools-other
ms.topic: conceptual
ms.assetid: aee11dde-daad-439b-b594-9f4aeac94335
author: markingmyname
ms.author: maghan
manager: craigg
ms.openlocfilehash: 4255b78991e557ab36d7d0f97ab9be0fed5194a3
ms.sourcegitcommit: e0c55d919ff9cec233a7a14e72ba16799f4505b2
ms.translationtype: MTE75
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2019
ms.locfileid: "67732102"
---
# <a name="configure-distributed-replay"></a>Настройка распределенного воспроизведения
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  Сведения о конфигурации распределенного воспроизведения [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] задаются в XML-файлах на контроллере распределенного воспроизведения, на клиентах, а также в месте установки средства администрирования. Эти файлы включают в себя:  
  
-   [Файл конфигурации контроллера](#DReplayController)  
  
-   [Файл конфигурации клиента](#DReplayClient)  
  
-   [Файл конфигурации предварительной обработки](#PreprocessConfig)  
  
-   [Файла конфигурации воспроизведения](#ReplayConfig)  
  
##  <a name="DReplayController"></a> Файл конфигурации контроллера: DReplayController.config  
 При запуске службы контроллера распределенного воспроизведения [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] загружаются данные об уровне ведения журнала из файла конфигурации контроллера `DReplayController.config`. Этот файл находится в папке, в которую установлена служба контроллера распределенного воспроизведения:  
  
 **\<путь установки контроллера>\DReplayController.config**  
  
 Уровень ведения журнала, заданный в файле конфигурации контроллера, включает следующие параметры.  
  
|Настройка|XML-элемент|Описание|Допустимые значения|Обязательно|  
|-------------|-----------------|-----------------|--------------------|--------------|  
|Уровень ведения журнала|`<LoggingLevel>`|Задает уровень ведения журнала для службы контроллера.|`INFORMATION` &#124; `WARNING` &#124; `CRITICAL`|Нет. Значением по умолчанию является `CRITICAL`.|  
  
### <a name="example"></a>Пример  
 В этом примере показан файл конфигурации контроллера, в котором подавляются записи журнала `INFORMATION` и `WARNING` .  
  
```  
<?xml version='1.0'?>  
<Options>  
<LoggingLevel>CRITICAL</LoggingLevel>  
</Options>  
```  
  
##  <a name="DReplayClient"></a> Файл конфигурации клиента: DReplayClient.config  
 При запуске служба клиента распределенного воспроизведения [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] загружает параметры конфигурации из файла конфигурации клиента `DReplayClient.config`. Этот файл находится на каждом клиентском компьютере в папке, где установлена служба клиента распределенного воспроизведения:  
  
 **\<путь установки клиента>\DReplayClient.config**  
  
 В файле конфигурации клиента указываются следующие параметры:  
  
|Настройка|XML-элемент|Описание|Допустимые значения|Обязательно|  
|-------------|-----------------|-----------------|--------------------|--------------|  
|Контроллер|`<Controller>`|Задает имя компьютера для контроллера. Клиент предпринимает попытку зарегистрироваться в среде распределенного воспроизведения, обращаясь к контроллеру.|Локальный компьютер можно указать как «`localhost`» или «`.`».|Нет. По умолчанию клиент пытается зарегистрироваться на экземпляре контроллера, работающего локально («`.`»), если таковой существует.|  
|Рабочий каталог клиента|`<WorkingDirectory>`|Локальный путь на клиенте, где сохраняются переданные файлы.<br /><br /> Файлы в этом каталоге при следующем воспроизведении перезаписываются.|Полное имя каталога, начиная с буквы диска.|Нет. Если значение не задано, то переданные файлы сохраняются в той же папке, где находится файл конфигурации клиента по умолчанию. Если значение указано, но папка не существует на клиенте, то служба клиента не будет запущена.|  
|Результирующий каталог клиента|`<ResultDirectory>`|Локальный путь на клиенте, где сохраняется файл результатов трассировки после воспроизведения (для клиента).<br /><br /> Файлы в этом каталоге при следующем воспроизведении перезаписываются.|Полное имя каталога, начиная с буквы диска.|Нет. Если значение не задано, то файл трассировки результатов сохраняется в той же папке, где находится файл конфигурации клиента по умолчанию. Если значение указано, но папка не существует на клиенте, то служба клиента не будет запущена.|  
|Уровень ведения журнала|`<LoggingLevel>`|Задает уровень ведения журнала для службы клиента.|`INFORMATION` &#124; `WARNING` &#124; `CRITICAL`|Нет. Значением по умолчанию является `CRITICAL`.|  
  
### <a name="example"></a>Пример  
 В этом примере показан измененный файл конфигурации клиента, в котором указано, что служба контроллера выполняется на другом компьютере с именем `Controller1`. Элементы `WorkingDirectory` и `ResultDirectory` настроены на использование папок `c:\ClientWorkingDir` и `c:\ResultTraceDir`соответственно. Уровень ведения журнала по умолчанию изменен, в нем подавлены записи журнала `INFORMATION` и `WARNING` .  
  
```  
<?xml version='1.0'?>  
<Options>  
    <Controller>Controller1</Controller>  
    <WorkingDirectory>c:\ClientWorkingDir</WorkingDirectory>  
    <ResultDirectory>c:\ResultTraceDir</ResultDirectory>  
    <LoggingLevel>CRITICAL</LoggingLevel>  
</Options>  
```  
  
##  <a name="PreprocessConfig"></a> Файл конфигурации предварительной обработки: DReplay.exe.preprocess.config  
 При использовании средства администрирования для запуска предварительной обработки оно загружает параметры из файла конфигурации предварительной обработки `DReplay.exe.preprocess.config`.  
  
 Расположение измененного файла конфигурации предварительной обработки можно указать в файле конфигурации по умолчанию или в параметре средства администрирования **-c**. Дополнительные сведения об использовании параметра предварительной обработки средства администрирования см. в разделе [Параметр предварительной обработки (средство администрирования распределенного воспроизведения)](../../tools/distributed-replay/preprocess-option-distributed-replay-administration-tool.md).  
  
 Файл конфигурации предварительной обработки по умолчанию расположен в папке установки средства администрирования.  
  
 **\<путь установки средства администрирования>\DReplayAdmin\DReplay.exe.preprocess.config**  
  
 Параметры конфигурации предварительной обработки указываются в дочерних XML-элементах элемента `<PreprocessModifiers>` в файле конфигурации предварительной обработки. В их число входят следующие параметры.  
  
|Настройка|XML-элемент|Описание|Допустимые значения|Обязательно|  
|-------------|-----------------|-----------------|--------------------|--------------|  
|Включить действия системного сеанса|`<IncSystemSession>`|Указывает, будут ли включены записанные действия системного сеанса при воспроизведении.|`Yes` &#124; `No`|Нет. Значением по умолчанию является `No`.|  
|Максимальное время простоя|`<MaxIdleTime>`|Время простоя в секундах.|Целое число больше >= -1.<br /><br /> `-1` указывает, что значение в исходном файле трассировки не менялось.<br /><br /> `0` указывает наличие некоторой активности, которая происходит в любой момент времени.|Нет. Значением по умолчанию является `-1`.|  
  
### <a name="example"></a>Пример  
 Файл конфигурации предварительной обработки по умолчанию.  
  
```  
<?xml version='1.0'?>  
<Options>  
    <PreprocessModifiers>  
        <IncSystemSession>No</IncSystemSession>  
        <MaxIdleTime>-1</MaxIdleTime>  
    </PreprocessModifiers>  
</Options>  
```  
  
##  <a name="ReplayConfig"></a> Файла конфигурации воспроизведения: DReplay.exe.replay.config  
 При использовании средства администрирования для запуска воспроизведения событий оно загружает параметры воспроизведения из файла конфигурации воспроизведения `DReplay.exe.replay.config`.  
  
 Расположение измененного файла конфигурации воспроизведения можно указать в файле конфигурации по умолчанию или в параметре средства администрирования **-c**. Дополнительные сведения об использовании параметра воспроизведения средства администрирования см. в разделе [Параметр воспроизведения (средство администрирования распределенного воспроизведения)](../../tools/distributed-replay/replay-option-distributed-replay-administration-tool.md).  
  
 Файл конфигурации воспроизведения по умолчанию расположен в папке установки средства администрирования.  
  
 **\<путь установки средства администрирования>\DReplayAdmin\DReplay.exe.replay.config**  
  
 Параметры конфигурации воспроизведения указываются в дочерних XML-элементах элементов `<ReplayOptions>` и `<OutputOptions>` в файле конфигурации воспроизведения.  
  
### <a name="replayoptions-element"></a>\<ReplayOptions > элемент  
 В файле конфигурации воспроизведения в элементе `<ReplayOptions>` указываются следующие параметры.  
  
|Настройка|XML-элемент|Описание|Допустимые значения|Обязательно|  
|-------------|-----------------|-----------------|--------------------|--------------|  
|Целевой экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (тестовый сервер)|`<Server>`|Задает имя сервера и экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для подключения.|*имя_сервера*[\\*имя_экземпляра*]<br /><br /> Указывать «`localhost`» или «`.`» в качестве псевдонима локального узла нельзя.|Нет, если имя сервера уже указано в параметре **-s**_целевой сервер_ со значением **replay** средства администрирования.|  
|Режим последовательного выполнения|`<SequencingMode>`|Задает режим планирования событий.|`synchronization` &#124; `stress`|Нет. Значением по умолчанию является `stress`.|  
|Гранулярность масштабирования нагрузки|`<StressScaleGranularity>`|Указывает, должны ли все соединения с идентификатором SPID масштабироваться в режиме нагрузки совместно (SPID) или независимо (Connection).|SPID &#124; Connection|Да. Значением по умолчанию является `SPID`.|  
|Масштаб времени подключения|`<ConnectTimeScale>`|Используется для масштабирования времени подключения в режиме нагрузки.|Целое число от `1` до `100`.|Нет. Значением по умолчанию является `100`.|  
|Масштаб времени обработки|`<ThinkTimeScale>`|Используется для масштабирования времени обработки в режиме нагрузки.|Целое число от `0` до `100`.|Нет. Значением по умолчанию является `100`.|  
|Использование пула соединений|`<UseConnectionPooling>`|Указывает, будет ли использоваться пул соединений на каждом клиенте распределенного воспроизведения.|Да &#124; Нет|Да. Значением по умолчанию является `Yes`.|  
|Интервал опроса монитора исправности|`<HealthmonInterval>`|Указывает частоту запуска монитора исправности (в секундах).<br /><br /> Это значение используется только в режиме синхронизации.|Целое число >= 1<br /><br /> (`-1` для отключения)|Нет. Значением по умолчанию является `60`.|  
|Время ожидания запроса|`<QueryTimeout>`|Задает время ожидания запроса в секундах. Это значение действует только до возврата первой строки.|Целое число >= 1<br /><br /> (`-1` для отключения)|Нет. Значением по умолчанию является `3600`.|  
|Потоков на клиент|`<ThreadsPerClient>`|Задает число потоков воспроизведения для использования на каждом клиенте воспроизведения.|Целое число от `1` до `512`.|Нет. Если значение не указано, то для распределенного воспроизведения будет использоваться значение `255`.|  
  
### <a name="outputoptions-element"></a>\<OutputOptions > элемент  
 В файле конфигурации воспроизведения в элементе `<OutputOptions>` указываются следующие параметры.  
  
|Настройка|XML-элемент|Описание|Допустимые значения|Обязательно|  
|-------------|-----------------|-----------------|--------------------|--------------|  
|Запись числа строк|`<RecordRowCount>`|Указывает, следует ли записывать число строк для каждого результирующего набора.|`Yes` &#124; `No`|Нет. Значением по умолчанию является `Yes`.|  
|Запись результирующих наборов|`<RecordResultSet>`|Указывает, следует ли записывать содержимое всех результирующих наборов.|`Yes` &#124; `No`|Нет. Значением по умолчанию является `No`.|  
  
### <a name="example"></a>Пример  
 Файл конфигурации воспроизведения по умолчанию:  
  
```  
<?xml version='1.0'?>  
<Options>  
    <ReplayOptions>  
        <Server></Server>  
        <SequencingMode>stress</SequencingMode>  
        <ConnectTimeScale></ConnectTimeScale>  
        <ThinkTimeScale></ThinkTimeScale>  
        <HealthmonInterval>60</HealthmonInterval>  
        <QueryTimeout>3600</QueryTimeout>  
        <ThreadsPerClient></ThreadsPerClient>  
    </ReplayOptions>  
    <OutputOptions>  
        <ResultTrace>  
            <RecordRowCount>Yes</RecordRowCount>  
            <RecordResultSet>No</RecordResultSet>  
        </ResultTrace>  
    </OutputOptions>  
</Options>  
```  

### <a name="possible-issue-when-running-with-synchronization-sequencing-mode"></a>Возможные проблемы при работе с синхронизацией, в режиме виртуализации
 Могут возникнуть проблемы, в котором функциональные возможности воспроизведения отображается «зависания» или воспроизведения событий очень медленно. Это явление может произойти, если в воспроизводимой трассировке зависит от того, данные и/или событий, которые не существуют в целевой восстановленной базе данных. 
 
 Например, отслеживаемых рабочей нагрузки, использующая WAITFOR, такие как в, как инструкция WAITFOR RECEIVE компонента Service Broker. При использовании режим последовательного выполнения синхронизации, пакеты будут воспроизведены последовательно. Если происходит вставка в исходной базе данных после резервного копирования базы данных, но перед воспроизведение записи начала трассировки, ПОЛУЧАТЬ WAITFOR, выданных во время воспроизведения придется ждать за весь период WAITFOR. События, задайте для воспроизведения после получения WAITFOR будет задержка. Это может привести к счетчика монитора производительности Batch Requests/sec для удаления целевой базы данных воспроизведения до нуля, пока не завершится WAITFOR. 
 
 Если необходимо использовать режим синхронизации и требуется, чтобы избежать этого, выполните следующие действия.
 
1.  Замораживание баз данных, которые вы будете использовать как целевые объекты воспроизведения.

2.  Разрешите все ожидающие действия для завершения.

3.  Резервное копирование баз данных и разрешить выполнятся.

4.  Начать запись трассировки распределенного воспроизведения и возобновления нормальной рабочей нагрузкой. 
 
 
## <a name="see-also"></a>См. также:  
 [Параметры командной строки средства администрирования (программа распределенного воспроизведения)](../../tools/distributed-replay/administration-tool-command-line-options-distributed-replay-utility.md)   
 [Распределенное воспроизведение SQL Server](../../tools/distributed-replay/sql-server-distributed-replay.md)   
 [Форум о распределенном воспроизведении SQL Server](https://social.technet.microsoft.com/Forums/sl/sqldru/)   
 [Использование распределенного воспроизведения для нагрузочного теста SQL Server. Часть 2](https://blogs.msdn.com/b/mspfe/archive/2012/11/14/using-distributed-replay-to-load-test-your-sql-server-part-2.aspx)   
 [Использование распределенного воспроизведения для нагрузочного теста SQL Server. Часть 1](https://blogs.msdn.com/b/mspfe/archive/2012/11/08/using-distributed-replay-to-load-test-your-sql-server-part-1.aspx)  
  
  
