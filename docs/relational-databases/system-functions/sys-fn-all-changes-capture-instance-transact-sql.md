---
title: sys. fn_all_changes_ @ no__t-0capture_instance @ no__t-1 (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 06/02/2016
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- fn_all_changes
- sys.fn_all_changes
- fn_all_changes_TSQL
- sys.fn_all_changes_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- fn_all_changes_<capture_instance>
- sys.fn_all_changes_<capture_instance>
ms.assetid: 564fae96-b88c-4f22-9338-26ec168ba6f5
author: rothja
ms.author: jroth
ms.openlocfilehash: 0c8dce82cd331e1cf35464fe7122521fcd3285fa
ms.sourcegitcommit: c426c7ef99ffaa9e91a93ef653cd6bf3bfd42132
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/10/2019
ms.locfileid: "72251254"
---
# <a name="sysfn_all_changes_ltcapture_instancegt-transact-sql"></a>sys. fn_all_changes_ @ no__t-0capture_instance @ no__t-1 (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-xxxx-xxxx-xxx-md.md)]

  Оболочки для всех функций запроса **изменений** . Скрипты, необходимые для создания этих функций, создаются хранимой процедурой sys.sp_cdc_generate_wrapper_function.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
fn_all_changes_<capture_instance> ('start_time' ,'end_time', '<row_filter_option>' )  
  
<capture_instance> ::= The name of the capture instance.  
<row_filter_option> ::=  
{ all  
  | all update old  
}  
```  
  
## <a name="arguments"></a>Аргументы  
 *start_time*  
 Значение **DateTime** , представляющее низкую конечную точку диапазона записей таблицы изменений, включаемых в результирующий набор.  
  
 В результирующий набор включаются только строки из таблицы изменений CDC. < capture_instance > _CT, которые имеют связанное время фиксации больше *start_time* .  
  
 Если для этого аргумента задано значение NULL, нижняя конечная точка диапазона запроса будет соответствовать нижней конечной точке допустимого диапазона для экземпляра системы отслеживания.  
  
 *end_time*  
 Значение **DateTime** , представляющее верхнюю конечную точку диапазона записей таблицы изменений, включаемых в результирующий набор.  
  
 Этот параметр может принимать одно из двух возможных значений в зависимости от значения, выбранного для @closed_high_end_point при вызове sys. sp_cdc_generate_wrapper_function для создания скрипта создания для функции-оболочки:  
  
-   @closed_high_end_point = 1  
  
     В результирующий набор включаются только строки из таблицы изменений CDC. < capture_instance > _CT, которые имеют связанное время фиксации, меньшее или равное end_time.  
  
-   @closed_high_end_point = 0  
  
     В результирующий набор включаются только строки в таблице изменений CDC. capture_instance_CT, которые имеют связанное время фиксации строго меньше end_time.  
  
 Если для этого аргумента задано значение NULL, верхняя конечная точка диапазона запроса будет соответствовать верхней конечной точке допустимого диапазона для экземпляра системы отслеживания.  
  
 <row_filter_option> ::= { all | all update old }  
 Параметр, управляющий содержимым столбцов метаданных, а также строк, возвращаемых в результирующем наборе.  
  
 Может быть одним из следующих:  
  
 all  
 Возвращает все изменения в пределах указанного диапазона номеров LSN. При использовании этого параметра для изменений, произошедших в результате операции обновления, возвращаются только строки, содержащие новые значения, записанные после обновления.  
  
 all update old  
 Возвращает все изменения в пределах указанного диапазона номеров LSN. ‏При использовании этого параметра для изменений, произошедших в результате операции обновления, возвращаются две строки, содержащие значения до и после обновления.  
  
## <a name="table-returned"></a>Возвращаемая таблица  
  
|Имя столбца|Тип столбца|Описание|  
|-----------------|-----------------|-----------------|  
|__CDC_STARTLSN|**binary(10)**|Номер LSN-фиксации транзакции, связанный с этим изменением. Все изменения, зафиксированные в одной транзакции, имеют общий номер LSN-фиксации.|  
|__CDC_SEQVAL|**binary(10)**|Значение последовательности, используемое для упорядочивания изменений строк в пределах транзакции.|  
|@no__t 0columns из @column_list >|**различать**|Столбцы, указанные в аргументе *column_list* , sp_cdc_generate_wrapper_function при вызове для создания скрипта, создающего функцию-оболочку.|  
|__CDC_OPERATION|**nvarchar (2)**|Код операции, указывающий операцию, необходимую для применения строки к целевой среде. Он будет изменяться в зависимости от значения аргумента *row_filter_option* , переданного в вызове:<br /><br /> *row_filter_option* = "все"<br /><br /> «D» — операция удаления<br /><br /> «I» — операция вставки<br /><br /> «UN» — новые значения операции обновления<br /><br /> *row_filter_option* = "все обновление Old"<br /><br /> «D» — операция удаления<br /><br /> «I» — операция вставки<br /><br /> «UN» — новые значения операции обновления<br /><br /> «UO» — старые значения операции обновления|  
|@no__t 0columns из @update_flag_list >|**bit**|Битовый флаг, имя которого образуется добавлением «_uflag» к имени столбца. Флаг всегда имеет значение NULL, если @no__t -0 _CDC_OPERATION равно "," I "," «UO» ". Если @no__t -0 _CDC_OPERATION имеет значение "UN", оно устанавливается равным 1, если обновление вызвало изменение в соответствующем столбце. В противном случае флагу присваивается значение 0.|  
  
## <a name="remarks"></a>Примечания  
 Функция fn_all_changes_ < capture_instance > выступает в качестве оболочки для функции запроса CDC. fn_cdc_get_all_changes_ < capture_instance >. Хранимая процедура sys.sp_cdc_generate_wrapper формирует скрипт для создания оболочки.  
  
 Функции-оболочки не создаются автоматически. Чтобы создать функции-оболочки, нужно выполнить две операции:  
  
1.  запустить хранимую процедуру, чтобы сформировать создающий оболочку скрипт;  
  
2.  выполнить скрипт, чтобы создать функцию-оболочку.  

[!INCLUDE[freshInclude](../../includes/paragraph-content/fresh-note-steps-feedback.md)]

 Функции-оболочки позволяют пользователям систематически запрашивать изменения, произошедшие в интервале, ограниченном значениями **DateTime** , а не значениями LSN. Функции-оболочки выполняют все необходимые преобразования между предоставленными значениями **DateTime** и значениями LSN, которые необходимы внутренне как аргументы для функций запроса. Если функции-оболочки используются последовательно для обработки потока информации об изменениях, данные не потеряются и не будут повторяться, если выполняется следующее условие: значение @end_time интервала, соответствующего одному вызову, передается как значение @start_time для последующего вызова.  
  
 Используя параметр @closed_high_end_point при создании скрипта, можно формировать оболочки для поддержки закрытой или открытой верхней границы в заданном окне запроса. Таким образом, можно решить, включаются ли в интервал записи, для которых время фиксации совпадает с верхней границей интервала извлекаемых данных. По умолчанию верхняя граница включается в интервал.  
  
 Результирующий набор, возвращаемый функцией-оболочкой **All Changes** , возвращает столбцы __ $ start_lsn и \_ @ no__t-2 $ seqval таблицы изменений в виде столбцов @no__t -3 _cdc_startlsn и @no__t по 4 _cdc_seqval соответственно. В нем следуют только те столбцы, которые были записаны в параметре *\@column_list* при создании оболочки. Если *\@column_list* имеет значение null, возвращаются все отслеживания исходных столбцов. За исходными столбцами следует столбец операции, @no__t -0 _CDC_OPERATION, который является столбцом из одного или двух символов, определяющим операцию.  
  
 Затем к результирующему набору добавляются битовые флаги для каждого столбца, указанного параметром @update_flag_list. Для оболочки **All Changes** битовые флаги всегда будут иметь значение null, если __CDC_OPERATION равно "," I "или" «UO» ". Если @no__t -0 _CDC_OPERATION имеет значение "UN", флаг будет установлен равным 1 или 0 в зависимости от того, привело ли операция обновления к изменению столбца.  
  
 Шаблон конфигурации системы отслеживания измененных данных "Создание экземпляра оболочки CDC возвращающие табличное для схемы" показывает, как использовать хранимую процедуру sp_cdc_generate_wrapper_function для получения скриптов создания для всех функций-оболочек для функций запросов, определенных схемой. Затем шаблон создает эти скрипты. Дополнительные сведения о шаблонах см. в разделе [Обозреватель шаблонов](../../ssms/template/template-explorer.md).  
  
## <a name="see-also"></a>См. также  
 [sys. sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql.md)   
 [CDC. fn_cdc_get_all_changes_&#60;capture_instance&#62;  &#40;Transact-SQL&#41;](../../relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql.md)  
  
  
