---
title: Настройка топологии (одноранговая репликация) | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
f1_keywords:
- sql13.rep.p2pwizard.peers.f1
ms.assetid: 5377c59f-2e25-4852-a306-c87ae3dca9fd
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 1fcb84fe69c617cacc183910e3446400a172ea6d
ms.sourcegitcommit: b2e81cb349eecacee91cd3766410ffb3677ad7e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "67903116"
---
# <a name="configure-topology-peer-to-peer-replication"></a>Настройка топологии (одноранговая репликация)
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  Для выполнения таких наиболее типичных задач конфигурации, как добавление и удаление узлов, а также добавления новых соединений между существующими узлами, служит страница **Настройка топологии** . Узел, выбранный на странице **Публикация** этого мастера, отображается в области конструктора. Чтобы задать параметры конфигурации, щелкните правой кнопкой мыши узел, соединение или область конструктора.  
  
> [!NOTE]  
>  Мастер настройки одноранговой топологии запрашивает сведения о топологии при закрытии этого мастера. Если этот мастер был закрыт и вновь открыт до того, как все узлы ответили на запрос на информацию, мастер, возможно, отобразит лишь часть сети.  
  
## <a name="options"></a>Параметры  
 Страница **Настройка топологии** содержит элементы интерфейса и параметры, доступные при щелчке правой кнопкой мыши. В следующей таблице содержатся описания всех элементов интерфейса.  
  
|Элемент интерфейса|Описание|  
|-----------------------|-----------------|  
|Область конструктора|Отображает другие элементы интерфейса. Для добавления элементов щелкните правой кнопкой область конструктора.|  
|![Первый узел в топологии](../../relational-databases/replication/media/p2pwizard-firstnode.gif "Первый узел в топологии")|Исходный узел в топологии. Новые узлы инициализируются с помощью копии базы данных публикации исходного узла.|  
|![Узел, для которого доступны полные сведения](../../relational-databases/replication/media/p2pwizard-complete.gif "Узел, для которого доступны полные сведения")|Узел, на котором выполняется экземпляр [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] или более поздней версии и для которого в репликации имеются полные сведения. Чтобы указать параметры конфигурации, щелкните узел правой кнопкой мыши.|  
|![Узел, для которого доступны неполные сведения](../../relational-databases/replication/media/p2pwizard-incomplete.gif "Узел, для которого доступны неполные сведения")|Узел, для которого в репликации имеются неполные сведения. Чтобы указать параметры конфигурации, щелкните узел правой кнопкой мыши.<br /><br /> В репликации содержатся неполные сведения по одной из следующих причин.<br /><br /> — На узле выполняется экземпляр [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], не хранящий все метаданные, которые требуются мастеру.<br /><br /> — На узле выполняется экземпляр более поздней версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], но репликации не удается получить с узла сведения о подписке. Чтобы устранить эту неполадку, выполните следующее.<br /><br /> Убедитесь, что база данных на узле находится в режиме «в сети», а подключение можно выполнить с учетными данными агента распространителя, который соединяется с этим узлом.<br /><br /> Убедитесь, что выполняются агент чтения журнала и агент распространителя, которые соединяются с этим узлом.<br /><br /> Убедитесь, что время ожидания обновления достаточно долгое, чтобы собрать все сведения о топологии. Чтобы задать время ожидания обновления, щелкните правой кнопкой мыши область конструктора и выберите **Задать время ожидания обновления**.|  
|Серая линия со стрелками|Соединение между двумя узлами. Чтобы добавить соединение, щелкните правой кнопкой мыши нужный узел. Чтобы удалить соединение, щелкните его правой кнопкой мыши.<br /><br /> Если у линии одна стрелка, в репликации имеются неполные сведения об одном из узлов.|  
  
### <a name="options-for-the-design-surface"></a>Параметры для области конструктора  
 **Отрисовать граф заново**  
 Отрисовывает объекты в области конструктора, не обновляя топологию. Отрисовка может помочь лучше представить топологию.  
  
 **Обновить топологию**  
 Опрашивает каждый узел в топологии и отображает его обновленные сведения. Если в топологии много узлов, этот процесс может занять несколько минут.  
  
 Если закрыть и вновь открыть мастер в то время, как он запрашивает сведения о топологии, причем не все узлы ответили на запрос, эта страница может отобразить не все узлы в топологии.  
  
 **Добавить новый одноранговый узел**  
 Добавляет экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] к одноранговой топологии. При добавлении экземпляра к узлу на этом экземпляре после завершения мастера создается публикация. После добавления узла щелкните его правой кнопкой мыши, чтобы добавить соединение между новым и существующим узлом.  
  
 Для участия в одноранговой топологии экземпляр должен удовлетворять следующим требованиям.  
  
-   Должен быть сконфигурирован как распространитель или быть связан с удаленным распространителем.  
  
-   Должен содержать копию базы данных, участвующей в репликации. Она обычно является восстановленной резервной копией исходной базы данных публикации.  
  
 **Выбрать узлы для просмотра**  
 Выберите узлы для просмотра в области конструктора. Этот параметр полезен, если в топологии большое количество узлов. Необходимо помнить, что соединения можно добавить только между узлами, видимыми в области конструктора.  
  
 **Задать время ожидания обновления**  
 Укажите, как долго может продолжаться процесс обновления, прежде чем истечет время ожидания.  
  
### <a name="options-for-each-node"></a>Параметры для каждого узла  
 **Добавить новое одноранговое соединение**  
 Добавляет соединение между двумя узлами. Например, при добавлении соединения между узлами A и B репликация добавляет две подписки. Первая позволяет узлу A получать изменения от публикации в узле B, а вторая — узлу B получать изменения от публикации в узле A.  
  
 **Удалить одноранговый узел**  
 Удаляет узел из топологии. Например, при удалении узла C удаляется и публикация на этом узле. Также удаляются подписки между узлом A и узлом C, а также между узлом B и узлом C. База данных на узле C не удаляется, а публикация и распространение не отключаются.  
  
> [!NOTE]  
>  Настраивая одноранговую репликацию, укажите идентификатор для каждого узла. Этот идентификатор должен быть уникальным на всех узлах в топологии. Он хранится в столбце originator_id системной таблицы [MSpeer_originatorid_history](../../relational-databases/system-tables/mspeer-originatorid-history-transact-sql.md). Если узел удаляется из топологии, идентификатор сохраняется в таблице журнала. Идентификатор сохраняется, чтобы предотвратить ложные конфликты, если в топологии продолжается репликация изменений, сделанных в удаленном узле. Если нужно повторно использовать идентификатор для нового узла, сначала необходимо вручную удалить идентификатор из таблицы MSpeer_originatorid_history на всех узлах. Прежде чем удалить идентификатор для узла, выполните процедуру [sp_requestpeerresponse](../../relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql.md) , чтобы убедиться, что все изменения, исходящие с этого узла, были реплицированы.  
  
 **Подключиться ко всем отображенным узлам**  
 Добавляет соединение между выбранным узлом и всеми остальными узлами. Например, если в трехузловой топологии выбрать этот параметр для узла C, репликация добавляет четыре подписки: две используют узел A и узел B для получения изменений от публикации на узле C, а две используют узел C для получения изменений от публикаций на узле A и узле B.  
  
 **Выбрать узлы для просмотра**  
 Выберите узлы для просмотра в области конструктора. Этот параметр полезен, если в топологии большое количество узлов. Необходимо помнить, что соединения можно добавить только между узлами, видимыми в области конструктора.  
  
### <a name="options-for-the-connection-arrows"></a>Параметры для стрелок соединений  
 **Удалить одноранговое соединение**  
 Удаляет соединение между двумя узлами. Например, при удалении соединения между узлом A и узлом B репликация удаляет две подписки: одна использовала узел A для получения изменений от публикации на узле B, вторая — узел B для получения изменений от публикации на узле A.  
  
## <a name="see-also"></a>См. также:  
 [Настройка публикации и распространения](../../relational-databases/replication/configure-publishing-and-distribution.md)   
 [Администрирование одноранговой топологии (программирование репликации на языке Transact-SQL)](../../relational-databases/replication/administration/administer-a-peer-to-peer-topology-replication-transact-sql-programming.md)   
 [Peer-to-Peer Transactional Replication](../../relational-databases/replication/transactional/peer-to-peer-transactional-replication.md)  
  
  
