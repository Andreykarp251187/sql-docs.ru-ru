---
title: Создание набора строк возвращающего табличное значение параметра | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters, rowset creation
ms.assetid: ffe213ca-cc0e-465e-b31c-a8272324c4fe
author: markingmyname
ms.author: maghan
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: ab3541f354af26f32f4071c2a6d09648cd53af6d
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81283206"
---
# <a name="table-valued-parameter-rowset-creation"></a>Создание набора строк возвращающего табличное значение параметра
[!INCLUDE[appliesto-ss-asdb-asdw-pdw-md](../../includes/appliesto-ss-asdb-asdw-pdw-md.md)]

  Несмотря на то, что потребители могут предоставить для возвращающих табличные значения параметров любой объект набора строк, типичные объекты наборов строк реализуются для конечных хранилищ данных и таким образом предоставляют ограниченную производительность. По этой причине поставщик OLE DB собственного клиента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] разрешает пользователям создавать специализированный объект набора строк на основе данных в памяти. Этот специальный объект рядового набора памяти является новым объектом COM, называемым набором параметров, оцениваемым таблицей. Он предлагает функциональные возможности, аналогичные набору параметров.  
  
 Объекты набора строк возвращающего табличное значение параметра создаются явным образом поставщиком для входных параметров через несколько интерфейсов уровня сеанса. Для одного возвращающего значение параметра существует один объект набора строк. Потребитель может создавать объекты набора строк возвращающего табличное значение параметра либо путем предоставления уже известных метаданных (статический сценарий), либо путем его обнаружения через интерфейсы поставщика (динамический сценарий). Эти два сценария описаны в следующих разделах.  
  
## <a name="static-scenario"></a>Статический сценарий  
 Когда сведения о типе известны, потребитель использует метод ITableDefinitionWithConstraints::CreateTableWithConstraints для создания экземпляра объекта набора строк, соответствующего возвращающему табличное значение параметру.  
  
 Поле *guid* (параметр *pTableID*) содержит специальный идентификатор GUID (CLSID_ROWSET_TVP). Элемент *pwszName* содержит имя типа возвращающего табличное значение параметра, который потребитель хочет создать. Поле *eKind* будет установлено в значение DBKIND_GUID_NAME. Данное имя требуется при использовании нерегламентированной инструкции SQL. При вызове процедуры имя является необязательным.  
  
 Для статистической обработки потребитель передает параметр *pUnkOuter* и управляющий интерфейс IUnknown.  
  
 Свойства объекта параметров, оцениваемые таблицей, считываются только, поэтому от потребителя не ожидается, что он будет устанавливать какие-либо свойства в *rgPropertySets.*  
  
 Для элемента *rgPropertySets* каждой структуры DBCOLUMNDESC потребитель может указать дополнительные свойства для каждого столбца. Эти свойства принадлежат набору свойств DBPROPSET_SQLSERVERCOLUMN. Они позволяют указать для каждого столбца вычисляемые настройки и настройки по умолчанию. Также они поддерживают существующие свойства столбца, например допустимость значений NULL и идентификатор.  
  
 Для получения соответствующих сведений от объекта набора строк возвращающего табличные значения параметра потребитель использует метод IRowsetInfo::GetProperties.  
  
 Для получения информации о нулевом, уникальном, вычисленных и обновленных состояниях каждого столбца потребитель использует IColumnsRowset::GetColumnsRowset или IColumnsInfo::GetColumnInfo. Эти методы предоставляют подробные сведения о каждом столбце набора строк возвращающего табличные значения параметра.  
  
 Потребитель указывает тип каждого столбца возвращающего табличные значения параметра. Это действие аналогично тому, как указываются столбцы при создании таблицы в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Потребитель получает объект параметра, оцениваемый в таблице, от поставщика [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB через параметр вывода *ppRowset.*  
  
## <a name="dynamic-scenario"></a>Динамический сценарий  
 Если у потребителя нет информации о типе, он должен использовать IOpenRowset::OpenRowset для мгновенного набора параметров, оцениваемых таблицей. Потребитель должен предоставить поставщику имя типа.  
  
 В этом сценарии поставщик получает сведения о типе объекта набора строк возвращающего табличные значения параметра из сервера от лица потребителя.  
  
 Параметры *pTableID* и *pUnkOuter* устанавливаются так же, как и в статическом сценарии. Затем [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поставщик NATIVE Client OLE DB получает информацию о типе (информацию о столбцах и ограничениях) с сервера и возвращает объект параметра, оцениваемый таблицей, через параметр *ppRowset.* Данная операция требует связи с сервером, поэтому выполняется не так быстро, как статический сценарий. Динамический сценарий работает только с параметризованными вызовами процедур.  
  
## <a name="see-also"></a>См. также:  
 [Параметры, оцененные &#40;OLE DB&#41;](../../relational-databases/native-client-ole-db-table-valued-parameters/table-valued-parameters-ole-db.md)   
 [Использование возвращающих табличные значения параметров &#40;OLE DB&#41;](../../relational-databases/native-client-ole-db-how-to/use-table-valued-parameters-ole-db.md)  
  
  
