---
title: Создание плана обслуживания (область конструктора планов обслуживания) | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- Maintenance Plan Design Surface
ms.assetid: 2ef803ee-a9f8-454a-ad63-fedcbe6838d1
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 7b39b4391780a8133dae199e39638a6db77d73aa
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68083901"
---
# <a name="create-a-maintenance-plan-maintenance-plan-design-surface"></a>Создание планов обслуживания (область конструктора планов обслуживания)
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  В этом разделе описывается создание плана обслуживания одного или нескольких серверов с помощью области конструктора для плана обслуживания в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. **Мастер планов обслуживания** лучше подходит для создания простых планов обслуживания, а область конструктора позволяет использовать расширенные рабочие процессы.  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [безопасность](#Security)  
  
-   [Создание плана обслуживания с помощью области конструктора планов обслуживания](#SSMSProcedure)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="Restrictions"></a> Ограничения  
  
-   Для создания многосерверного плана обслуживания необходимо настроить многосерверную среду, содержащую один главный сервер и один или несколько целевых серверов. План многосерверного обслуживания необходимо создать и хранить на главном сервере. На целевых серверах эти планы можно просматривать, но нельзя хранить.  
  
-   Члены ролей **db_ssisadmin** и **dc_admin** могут повышать свои права доступа до **sysadmin**. Такое повышение прав доступа может происходить, поскольку эти роли могут изменять пакеты служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , а эти пакеты могут выполняться [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] при помощи контекста безопасности **sysadmin** агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Чтобы предотвратить такое повышение прав доступа при выполнении планов обслуживания, наборов элементов сбора данных и других пакетов служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , настройте задания агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , запускающие пакеты, на использование учетной записи-посредника с ограниченными правами доступа или добавьте в роли **db_ssisadmin** и **dc_admin** только членов роли **sysadmin** .  
  
###  <a name="Security"></a> безопасность  
  
####  <a name="Permissions"></a> Permissions  
 Для создания планов обслуживания и работы с ними пользователь должен быть членом предопределенной роли сервера **sysadmin** . В обозревателе объектов узел **Планы обслуживания** отображается только для пользователей, являющихся членами предопределенной роли сервера **sysadmin** .  
  
##  <a name="SSMSProcedure"></a> Использование области конструктора планов обслуживания  
  
#### <a name="to-create-a-maintenance-plan"></a>Создание плана обслуживания  
  
1.  В обозревателе объектов щелкните знак «плюс», чтобы развернуть сервер, где нужно создать план обслуживания.  
  
2.  Щелкните знак «плюс», чтобы развернуть папку **Управление** .  
  
3.  Щелкните правой кнопкой мыши папку **Планы обслуживания** и выберите команду **Создать план обслуживания**.  
  
4.  В диалоговом окне **Создание плана обслуживания** в поле **Имя** введите имя плана и нажмите кнопку **ОК**. Откроется панель элементов и область *maintenance_plan_name* **[Конструктор]** с вложенным планом **Subplan_1** в основной сетке.  
  
     В заголовке области конструктора доступны следующие команды.  
  
     **Добавление вложенного плана**  
     Добавляет настраиваемый вложенный план.  
  
     **Свойства вложенного плана**  
     Открывает диалоговое окно **Свойства вложенного плана** для выбранного вложенного плана в основной сетке. Чтобы открыть диалоговое окно **Свойства вложенного плана** , также можно дважды щелкнуть вложенный план в сетке. Дополнительные сведения об этом диалоговом окне см. ниже.  
  
     **Удаление выбранного вложенного плана**  
     Удаляет выбранный вложенный план.  
  
     **Расписание вложенного плана**  
     Открывает диалоговое окно **Создание расписания задания** для выбранного вложенного плана.  
  
     **Удаление расписания**  
     Удаляет расписание из выбранного вложенного плана.  
  
     **Управление соединениями**  
     Открывает диалоговое окно **Управление соединениями** . Используется для добавления дополнительных соединений экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] к плану обслуживания. Дополнительные сведения об этом диалоговом окне см. ниже.  
  
     **Отчеты и ведение журнала**  
     Открывает диалоговое окно **Отчеты и ведение журнала** . Дополнительные сведения об этом диалоговом окне см. ниже.  
  
     **Серверы**  
     Отображает диалоговое окно **Серверы** , которое используется для выбора серверов, на которых будут выполняться задачи вложенного плана. Этот параметр доступен только на главных серверах в многосерверном окружении. Дополнительные сведения см. в статье [Создание многосерверной среды](../../ssms/agent/create-a-multiserver-environment.md) и [План обслуживания (серверы)](../../relational-databases/maintenance-plans/maintenance-plan-servers.md).  
  
     **Название**  
     Отображает имя плана обслуживания. Имя нового плана обслуживания необходимо указать в диалоговом окне до открытия конструктора планов обслуживания. Чтобы переименовать план обслуживания, щелкните правой кнопкой мыши план в обозревателе объектов и выберите **Переименовать**.  
  
     **Описание**  
     Просмотрите или укажите описание для плана обслуживания. Максимальная длина описания составляет 512 знаков.  
  
     **Область конструктора**  
     Создание и обслуживание планов обслуживания. Используйте область конструктора, чтобы добавлять задачи обслуживания к плану, удалять задачи из плана, указывать ссылки очередности между задачами, а также для указания ветвления задач и параллелизма.  
  
     Ссылка очередности между двумя задачами устанавливает связь между ними. Вторая задача ( *зависимая*) выполняется только в том случае, если результат выполнения первой задачи ( *приоритетной*) удовлетворяет указанным критериям. Обычно оценка результата выполнения задается как **Успешно**, **Ошибка**или **Завершение**. Дополнительные сведения см. в шаге **8** ниже.  
  
5.  В заголовке области конструктора дважды щелкните **Subplan_1** и введите имя и описание для вложенного плана в диалоговом окне **Свойства вложенного плана** .  
  
     В диалоговом окне **Свойства вложенного плана** доступны следующие параметры.  
  
     **Название**  
     Имя вложенного плана.  
  
     **Описание**  
     Краткое описание вложенного плана.  
  
     **Расписание**  
     Расписание, по которому будет выполняться вложенный план. Щелкните значок **Расписание вложенного плана** , чтобы открыть диалоговое окно **Создание расписания заданий** . Нажмите кнопку **Удалить расписание** , чтобы удалить расписание из вложенного плана.  
  
     Список**Запуск от имени**  
     Выберите учетную запись, используемую для запуска этой вложенной задачи.  
  
6.  Нажмите кнопку **Расписание вложенного плана** , чтобы ввести данные расписания в диалоговом окне **Создание расписания заданий** .  
  
7.  Для создания вложенного плана перетащите элементы потока задач с **панели элементов** в область конструктора планов. Двойной щелчок задачи открывает диалоговое окно, где можно настроить параметры задачи.  
  
     На **панели элементов**доступны следующие задачи плана обслуживания:  
  
    -   **Задача «Создание резервной копии базы данных»**  
  
    -   **Задача «Проверка целостности базы данных»**  
  
    -   **Задача «Выполнение задания агента SQL Server»**  
  
    -   **Задача «Выполнение инструкции T-SQL»**  
  
    -   **Задача «Очистка журнала»**  
  
    -   **Задача «Очистка после обслуживания»**  
  
    -   **Задача «Уведомление оператора»**  
  
    -   **Задача «Перестроение индекса»**  
  
    -   **Задача «Реорганизация индекса»**  
  
    -   **Задача «Сжатие базы данных»**  
  
    -   **Задача «Обновление статистики»**  
  
     Добавление задач на **панель элементов**  
  
    1.  В меню **Сервис** выберите пункт **Выбрать элементы панели элементов**.  
  
    2.  Выберите инструменты, которые должны появиться на **панели элементов**, и нажмите кнопку **ОК**.  
  
     При добавлении задач плана обслуживания на **панель элементов** они становятся доступными в **мастере планов обслуживания**. Дополнительные сведения по отдельным задачам, перечисленным выше, см. в разделе [Использование мастера планов обслуживания](../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md#SSMSProcedure) статьи **Запуск мастера планов обслуживания**.  
  
8.  Определение рабочего процесса между задачами  
  
    1.  Щелкните правой кнопкой мыши приоритетную задачу и выберите команду **Добавить элементы управления очередностью**.  
  
    2.  В диалоговом окне **Поток управления** в списке **Для** выберите зависимую задачу и нажмите кнопку **ОК**.  
  
    3.  Дважды щелкните соединитель между двумя задачами, чтобы открыть диалоговое окно **Редактор элементов управления очередностью** .  
  
         В диалоговом окне **Редактор элементов управления очередностью** доступны следующие параметры.  
  
         **Ограничение**  
         Определяет механизм работы ограничения между двумя задачами.  
  
         Список**Вычислительная операция**  
         Определяет вычислительную операцию, которую использует ограничение очередностью. Операциями могут быть: **Ограничение**, **Выражение**, **Выражение и ограничение** и **Выражение или ограничение**.  
  
         Список**Значение**  
         Укажите ограничение по значению: **Успешно**, **Сбой** или **Завершение**. **Успех** является значением по умолчанию.  
  
        > [!NOTE]  
        >  Строка элементов управления очередностью имеет зеленый цвет для значения **Успех**, красный для значения **Неудача**и синий для значения **Завершение**.  
  
         **Выражение**  
         При использовании операций **Выражение**, **Выражение и ограничение**или **Выражение или ограничение**введите выражение. Выражение должно иметь логическое значение.  
  
         **Тест**  
         Проверка выражения.  
  
         **Несколько ограничений**  
         Определяет механизм взаимодействия нескольких ограничений друг с другом при управлении выполнением задачи с ограничением.  
  
         **Логическое И**  
         Выберите, чтобы указать, что несколько ограничений очередности в одном исполняемом объекте должны учитываться вместе. Все ограничения должны иметь значение True. Этот параметр выбирается по умолчанию.  
  
        > [!NOTE]  
        >  Этот тип ограничения очередностью имеет вид сплошной зеленой, красной или синей линии.  
  
         **Логическое ИЛИ**  
         Выберите, чтобы указать, что несколько ограничений очередности в одном исполняемом объекте должны учитываться вместе. По крайней мере одно ограничение должно иметь значение True.  
  
        > [!NOTE]  
        >  Этот тип ограничения очередностью имеет вид пунктирной зеленой, красной или синей линии.  
  
9. Чтобы добавить другой вложенный план, содержащий задачи, выполняемые по другому расписанию, на панели инструментов нажмите кнопку **Добавить вложенный план** , чтобы открыть диалоговое окно **Свойства вложенного плана** .  
  
10. Добавление соединений с разными серверами  
  
    1.  На панели инструментов области конструктора нажмите кнопку **Управление соединениями**.  
  
    2.  В диалоговом окне **Управление соединениями** нажмите кнопку **Добавить**.  
  
    3.  В диалоговом окне **Свойства соединениями** в поле **Имя соединения** введите имя создаваемого подключения.  
  
    4.  В области **Укажите следующие параметры для подключения к данным SQL Server** в поле **Выберите или введите имя сервера** введите имя сервера SQL Server, который нужно использовать, или нажмите кнопку с многоточием **(…)** и выберите сервер в диалоговом окне **SQL Server**. После выбора сервера в диалоговом окне **SQL Server** нажмите кнопку **ОК**.  
  
    5.  В области **Введите данные для входа на сервер**выберите **Использовать встроенную систему безопасности Windows NT** или **Использовать указанные имя пользователя и пароль**. Если выбрано использование указанных имени пользователя и пароля, введите данные в полях **Имя пользователя** и **Пароль** соответственно.  
  
    6.  В диалоговом окне **Свойства соединения** нажмите кнопку **ОК**.  
  
    7.  В диалоговом окне **Управление соединениями** нажмите кнопку **Закрыть**.  
  
11. Задание параметров отчета  
  
    1.  На панели инструментов области конструктора щелкните значок **Отчеты и ведение журнала**.  
  
    2.  В диалоговом окне **Отчеты и ведение журнала** в области **Отчеты**выберите **Сформировать текстовый файл отчета** , **Отправить отчет адресату по электронной почте** или оба варианта.  
  
        1.  Если выбран параметр **Сформировать текстовый файл отчета**, выберите **Создать новый файл** или **Добавить в файл**.  
  
        2.  В зависимости от выбора выше введите имя и полный путь к новому файлу или файлу, который будет дополняться, указав данные в полях **Папка** или **Имя файла** . Либо нажмите кнопку с многоточием **(…)** и выберите путь к папке или имя файла в диалоговом окне **Поиск папки —** _имя\_сервера_ или **Поиск файлов базы данных —** _имя\_сервера_.  
  
        3.  Если выбран параметр **Отправить отчет адресату по электронной почте**, то в списке **Оператор агента** нужно выбрать получателя отчета.  
  
            > [!NOTE]  
            >  В агенте SQL Server должно быть настроено использование компонента Database Mail для отправки почты. Дополнительные сведения см. в разделе [Configure SQL Server Agent Mail to Use Database Mail](../../relational-databases/database-mail/configure-sql-server-agent-mail-to-use-database-mail.md).  
  
    3.  Чтобы сохранить более подробные сведения, в области **Ведение журнала**выберите **Записывать подробные данные в журнал**.  
  
    4.  Чтобы записать результаты выполнения плана обслуживания на другой сервер, выберите **Войти на удаленный сервер** и выберите соединение с сервером в списке **Соединение** или нажмите кнопку **Создать** и введите данные соединения в диалоговом окне **Свойства подключения** .  
  
    5.  В диалоговом окне **Отчеты и ведение журнала** нажмите кнопку **ОК**.  
  
12. Для просмотра результатов в средстве просмотра журнала в **Обозревателе объектов**щелкните правой кнопкой мыши папку **Планы обслуживания** или конкретный план обслуживания и выберите команду **Просмотр журнала**.  

[!INCLUDE[freshInclude](../../includes/paragraph-content/fresh-note-steps-feedback.md)]

     The following options are available on the **Log File Viewer -**_server\_name_ dialog box.  
  
     **Load Log**  
     Open a dialog box where you can specify a log file to load.  
  
     **Export**  
     Open a dialog box that lets you export the information that is shown in the **Log file summary** grid to a text file.  
  
     **Refresh**  
     Refresh the view of the selected logs. The **Refresh** button rereads the selected logs from the target server while applying any filter settings.  
  
     **Filter**  
     Open a dialog box that lets you specify settings that are used to filter the log file, such as **Connection**, **Date**, or other **General** filter criteria.  
  
     **Search**  
     Search the log file for specific text. Searching with wildcard characters is not supported.  
  
     **Stop**  
     Stops loading the log file entries. For example, you can use this option if a remote or offline log file takes a long time to load, and you only want to view the most recent entries.  
  
     **Log file summary**  
     This information panel displays a summary of the log file filtering. If the file is not filtered, you will see the following text, **No filter applied**. If a filter is applied to the log, you will see the following text, **Filter log entries where:** \<filter criteria>.  
  
     **Date**  
     Displays the date of the event.  
  
     **Source**  
     Displays the source feature from which the event is created, such as the name of the service (MSSQLSERVER, for example). This does not appear for all log types.  
  
     **Message**  
     Displays any messages associated with the event.  
  
     **Log Type**  
     Displays the type of log to which the event belongs. All selected logs appear in the log file summary window.  
  
     **Log Source**  
     Displays a description of the source log in which the event is captured.  
  
     **Selected row details**  
     Select a row to display additional details about the selected event row at the bottom of the page. The columns can be reordered by dragging them to new locations in the grid. The columns can be resized by dragging the column separator bars in the grid header to the left or right. Double-click the column separator bars in the grid header to automatically size the column to the content width.  
  
     **Instance**  
     The name of the instance on which the event occurred. This is displayed as *computer name*\\*instance name*.  
  
  
