---
title: sp_changepublication (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 08/29/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: replication
ms.topic: language-reference
f1_keywords:
- sp_changepublication
- sp_changepublication_TSQL
helpviewer_keywords:
- sp_changepublication
ms.assetid: c36e5865-25d5-42b7-b045-dc5036225081
author: stevestein
ms.author: sstein
ms.openlocfilehash: f963aa920a1e783cfec5b467d1c57fdb2e805893
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68124861"
---
# <a name="spchangepublication-transact-sql"></a>sp_changepublication (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-xxxx-xxxx-xxx-md.md)]

  Изменяет свойства публикации. Эта хранимая процедура выполняется на издателе в базе данных публикации.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
sp_changepublication [ [ @publication = ] 'publication' ]  
    [ , [ @property = ] 'property' ]  
    [ , [ @value = ] 'value' ]  
    [ , [ @force_invalidate_snapshot = ] force_invalidate_snapshot ]  
    [ , [ @force_reinit_subscription = ] force_reinit_subscription ]  
    [ , [ @publisher = ] 'publisher' ]  
```  
  
## <a name="arguments"></a>Аргументы  
`[ @publication = ] 'publication'` — Имя публикации. *Публикация* — **sysname**, значение по умолчанию NULL.  
  
`[ @property = ] 'property'` Представляет изменяемое свойство публикации. *Свойство* — **nvarchar(255)** .  
  
`[ @value = ] 'value'` — Это новое значение свойства. *значение* — **nvarchar(255)** , значение по умолчанию NULL.  
  
 В данной таблице описаны свойства публикации, доступные для изменения, а также ограничения на значения этих свойств.  
  
|Свойство|Значение|Описание|  
|--------------|-----------|-----------------|  
|**allow_anonymous**|**true**|На данную публикацию могут создаваться анонимные подписки и *immediate_sync* также должны быть **true**. Невозможно изменить для одноранговых публикаций.|  
||**false**|На данную публикацию нельзя создавать анонимные подписки. Невозможно изменить для одноранговых публикаций.|  
|**allow_initialize_from_backup**|**true**|Подписчики могут инициализировать подписку на эту публикацию из резервной копии, а не из исходного моментального снимка. Это свойство не может быть изменено для отличных[!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] публикаций.|  
||**false**|Подписчики должны использовать исходный моментальный снимок. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**allow_partition_switch**|**true**|ИНСТРУКЦИЯ ALTER TABLE … Операторы SWITCH могут выполняться в опубликованной базе данных. Дополнительные сведения см. в статье [Replicate Partitioned Tables and Indexes](../../relational-databases/replication/publish/replicate-partitioned-tables-and-indexes.md) (Репликация секционированных таблиц и индексов).|  
||**false**|ИНСТРУКЦИЯ ALTER TABLE … Операторы SWITCH не может выполняться в опубликованной базе данных.|  
|**allow_pull**|**true**|Подписки по запросу на данную публикацию разрешены. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Подписки по запросу на данную публикацию не разрешены. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**allow_push**|**true**|Принудительные подписки на данную публикацию разрешены.|  
||**false**|Принудительные подписки на данную публикацию не разрешены.|  
|**allow_subscription_copy**|**true**|Включает возможность копирования баз данных, подписанных на эту публикацию. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Отключает возможность копирования баз данных, подписанных на эту публикацию. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**alt_snapshot_folder**||Расположение альтернативной папки для моментального снимка.|  
|**centralized_conflicts**|**true**|Конфликтующие записи хранятся на издателе. Можно изменить только в том случае, если нет активных подписок. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Конфликтные записи хранятся как на издателе, так и на подписчике, вызвавшем конфликт. Можно изменить только в том случае, если нет активных подписок. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**compress_snapshot**|**true**|Моментальный снимок в альтернативной папке моментальных снимков сжимается в формате CAB. Сжатие моментального снимка в папке моментальных снимков по умолчанию невозможно.|  
||**false**|Моментальный снимок не сжат, это режим по умолчанию для репликации.|  
|**conflict_policy**|**pub wins**|Политика устранения конфликтов, возникающих при обновлении подписчиков, когда преимущество имеет издатель. Это свойство можно изменить только при отсутствии активных подписок. Не поддерживается для издателей Oracle.|  
||**Sub reinit**|Для обновления подписчиков. Если происходит конфликт, подписку необходимо инициализировать повторно. Это свойство можно изменить только при отсутствии активных подписок. Не поддерживается для издателей Oracle.|  
||**Sub wins**|Политика устранения конфликтов, возникающих при обновлении подписчиков, при которой преимущество имеет подписчик. Это свойство можно изменить только при отсутствии активных подписок. Не поддерживается для издателей Oracle.|  
|**conflict_retention**||**int** , указывающий срок хранения конфликтов, в днях. Значение по умолчанию — 14 суток. **0** означает, что очистка конфликтов не требуется. Не поддерживается для издателей Oracle.|  
|**description**||Необязательная запись описания публикации.|  
|**enabled_for_het_sub**|**true**|Позволяет публикации поддерживать подписчиков, не являющихся подписчиками [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. **enabled_for_het_sub** нельзя изменить, если существуют подписки на публикацию. Может потребоваться выполнить [хранимые процедуры репликации (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-changepublication-transact-sql.md) соблюдать следующие требования перед установкой **enabled_for_het_sub** значение true:<br /> - **allow_queued_tran** должно быть **false**.<br /> - **allow_sync_tran** должно быть **false**.<br /> Изменение **enabled_for_het_sub** для **true** может изменить существующие параметры публикации. Дополнительные сведения см. в статье [Non-SQL Server Subscribers](../../relational-databases/replication/non-sql/non-sql-server-subscribers.md). Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Публикация не поддерживает подписчиков, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**enabled_for_internet**|**true**|Публикация через Интернет разрешена, поэтому для передачи файлов моментальных снимков подписчику может быть использован протокол FTP. Файлы синхронизации для публикации помещаются в следующий каталог: C:\Program Files\Microsoft SQL Server\MSSQL\Repldata\ftp. *ftp_address* не может иметь значение NULL. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**false**|Публикация через Интернет не разрешена. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**enabled_for_p2p**|**true**|Публикация поддерживает одноранговую репликацию. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].<br /> Чтобы задать **enabled_for_p2p** для **true**, применяются следующие ограничения:<br /> - **allow_anonymous** должно быть **false**<br /> - **allow_dts** должно быть **false**.<br /> - **allow_initialize_from_backup** должно быть **true**<br /> - **allow_queued_tran** должно быть **false**.<br /> - **allow_sync_tran** должно быть **false**.<br /> - **enabled_for_het_sub** должно быть **false**.<br /> - **independent_agent** должно быть **true**.<br /> - **repl_freq** должно быть **непрерывной**.<br /> - **replicate_ddl** должно быть **1**.|  
||**false**|Публикация не поддерживает одноранговую репликацию. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_address**||Доступное по протоколу FTP расположение файлов моментальных снимков публикации. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_login**||Имя пользователя, используемое для подключения к службе FTP, и значение ANONYMOUS, если оно разрешено. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_password**||Пароль для имени пользователя при подключении к службе FTP. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_port**||Номер порта службы FTP для распространителя. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**ftp_subdirectory**||Указывает, где создаются файлы моментальных снимков, если публикация поддерживает распространение моментальных снимков по протоколу FTP. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|**immediate_sync**|**true**|Файлы синхронизации для публикации создаются или повторно создаются при каждом выполнении агента моментальных снимков. Подписчики могут получать файлы синхронизации сразу после подписки, если агент моментальных снимков завершил работу перед подпиской. Новые подписки получают самые свежие файлы синхронизации, сформированные при последнем выполнении агента моментальных снимков. *independent_agent* также должны быть **true**. См. в разделе "Примечания" ниже, чтобы узнать больше **immediate_sync**.|  
||**false**|Файлы синхронизации создаются только для новых подписок. Подписчики могут получать файлы синхронизации после подписки при условии, что агент моментальных снимков был запущен и завершил работу.|  
|**independent_agent**|**true**|Публикация имеет собственный выделенный агент распространителя.|  
||**false**|Публикация использует общий агент распространителя, а каждая пара баз данных публикации и подписки имеет общий агент.|  
|**p2p_continue_onconflict**|**true**|Агент распространителя продолжает обрабатывать изменения при обнаружении конфликта.<br /> **Предупреждение:** Мы рекомендуем использовать значение по умолчанию `FALSE`. Если этот параметр установлен `TRUE`, агент распространителя будет пытаться обеспечить конвергентность данных в топологии, применяя конфликтующую строку из узла с наибольшим значением идентификатора инициатора. Этот метод не гарантирует конвергенции. После обнаружения конфликта следует убедиться, что топология остается согласованной. Дополнительные сведения см. в подразделе «Обработка конфликтов» раздела [Conflict Detection in Peer-to-Peer Replication](../../relational-databases/replication/transactional/peer-to-peer-conflict-detection-in-peer-to-peer-replication.md).|  
||**false**|Агент распространителя прекращает обрабатывать изменения при обнаружении конфликта.|  
|**post_snapshot_script**||Указывает расположение файла скрипта на языке [!INCLUDE[tsql](../../includes/tsql-md.md)], который агент распространителя запускает после применения всех остальных скриптов и данных объектов репликации во время исходной синхронизации.|  
|**pre_snapshot_script**||Указывает расположение файла скрипта на языке [!INCLUDE[tsql](../../includes/tsql-md.md)], который агент распространителя запускает перед применением всех остальных скриптов и данных объектов репликации во время исходной синхронизации.|  
|**publish_to_ActiveDirectory**|**true**|Этот аргумент устарел и поддерживается только для обратной совместимости скриптов. Больше нельзя добавлять данные публикации в службу [!INCLUDE[msCoName](../../includes/msconame-md.md)] Active Directory.|  
||**false**|Удаляет сведения о публикации из службы Active Directory.|  
|**queue_type**|**sql**|Для хранения транзакций используется [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Это свойство можно изменить только при отсутствии активных подписок.<br /><br /> Примечание. Поддержка использования [!INCLUDE[msCoName](../../includes/msconame-md.md)] очереди сообщений прекратила работу. Указав значение **msmq** для *значение* приводит к ошибке.|  
|**repl_freq**|**Непрерывная**|Публикует выход всех транзакций, основанных на журнале.|  
||**Моментальный снимок**|Публикует только запланированные события синхронизации.|  
|**replicate_ddl**|**1**|Реплицируются инструкции языка определения данных (DDL), которые выполняются на издателе. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
||**0**|Репликация инструкций DDL не производится. Это свойство невозможно изменить для публикаций, не являющихся [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Невозможно отключить репликацию изменений схемы при использовании одноранговой репликации.|  
|**replicate_partition_switch**|**true**|ИНСТРУКЦИЯ ALTER TABLE … Инструкции SWITCH, которые выполняются для опубликованной базы данных должны реплицироваться на подписчики. Этот параметр действителен, только если *allow_partition_switch* имеет значение TRUE. Дополнительные сведения см. в статье [Replicate Partitioned Tables and Indexes](../../relational-databases/replication/publish/replicate-partitioned-tables-and-indexes.md) (Репликация секционированных таблиц и индексов).|  
||**false**|ИНСТРУКЦИЯ ALTER TABLE … Операторы SWITCH не должны реплицироваться на подписчики.|  
|**хранение**||**int** представляющее срок хранения в часах, действия подписки. Если подписка не активна в течение указанного срока хранения, она удаляется.|  
|**snapshot_in_defaultfolder**|**true**|Файлы моментального снимка сохранены в папке для моментальных снимков по умолчанию. Если *alt_snapshot_folder*также указано, файлы моментальных снимков хранятся в модели по умолчанию и альтернативные расположения.|  
||**false**|Файлы моментальных снимков хранятся в другом расположении, заданном по *alt_snapshot_folder*.|  
|**status**|**Active**|Данные публикации становятся доступными подписчику сразу после создания публикации. Не поддерживается для издателей Oracle.|  
||**Неактивные**|Данные публикации недоступны подписчику сразу после создания публикации. Не поддерживается для издателей Oracle.|  
|**sync_method**|**native**|При синхронизации подписок выполняется массовое копирование таблиц в собственном режиме.|  
||**character**|При синхронизации подписок выполняется массовое копирование таблиц в символьном режиме.|  
||**Параллельные**|Используется собственный программный вывод для массового копирования всех таблиц, не блокирующий таблицы во время формирования моментальных снимков. Недопустимо для репликации моментальных снимков.|  
||**Concurrent_c**|Используется символьный программный вывод для массового копирования всех таблиц, не блокирующий таблицы во время формирования моментальных снимков. Недопустимо для репликации моментальных снимков.|  
|**Идентификатор задачи**||Это свойство устарело и больше не поддерживается.|  
|**allow_drop**|**true**|Позволяет `DROP TABLE` DLL поддержки для статей, которые являются частью репликации транзакций. Минимальная поддерживаемая версия: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] Пакет обновления 2 или более поздней версии и [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] пакет обновления 1 или более поздней версии. Дополнительные справочные материалы. [Статья базы знаний 3170123](https://support.microsoft.com/help/3170123/supports-drop-table-ddl-for-articles-that-are-included-in-transactional-replication-in-sql-server-2014-or-in-sql-server-2016-sp1)|
||**false**|Отключает `DROP TABLE` DLL поддержки для статей, которые являются частью репликации транзакций. Это **по умолчанию** значение этого свойства.|
|**NULL** (по умолчанию)||Возвращает список поддерживаемых значений для *свойство*.|  
  
`[ @force_invalidate_snapshot = ] force_invalidate_snapshot` Подтверждает, что действие, выполняемое данной хранимой процедурой, может сделать недействительным существующий моментальный снимок. *подписки потребуют* — **бит**, значение по умолчанию **0**.  
  - **0** означает, что изменения статьи не приводят к недействительности моментального снимка. Если хранимая процедура определяет, что изменение требует создания нового моментального снимка, возникает ошибка и изменения не выполняются.  
  - **1** изменения в статье могут привести к недействительности моментального снимка. Если имеются подписки, требующие нового моментального снимка, это значение дает разрешение пометить существующий моментальный снимок как устаревший и сформировать новый моментальный снимок.   
Сведения о свойствах, при изменении которых требуется формирование нового моментального снимка, см. в разделе «Примечания».  
  
[ **@force_reinit_subscription =** ] *этот*  
 Подтверждает, что действие, выполняемое данной хранимой процедурой, может сделать необходимой повторную инициализацию текущих подписок. *Этот* — **бит** значение по умолчанию **0**.  
  - **0** указывает, что изменения статьи не вызывают повторной инициализации подписки. Если хранимая процедура определяет, что изменения потребуют повторной инициализации подписок, возникает ошибка, и изменения не выполняются.  
  - **1** указывает, что изменения в статье приводят существующую подписку для повторной инициализации и дает разрешение произвести повторную инициализацию подписки.  
  
`[ @publisher = ] 'publisher'` Указывает, отличный от [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] издателя. *издатель* — **sysname**, значение по умолчанию NULL.  
  
  > [!NOTE]  
  >  *издатель* не следует использовать при изменении свойств статьи на [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] издателя.  
  
## <a name="return-code-values"></a>Значения кода возврата  
 **0** (успешное завершение) или **1** (неуспешное завершение)  
  
## <a name="remarks"></a>Примечания  
 **sp_changepublication** используется в репликации моментальных снимков и репликации транзакций.  
  
 После изменения любого из следующих свойств, необходимо создать новый моментальный снимок, и необходимо указать значение **1** для *подписки потребуют* параметра.  
-   **alt_snapshot_folder**  
-   **compress_snapshot**  
-   **enabled_for_het_sub**  
-   **ftp_address**  
-   **ftp_login**  
-   **ftp_password**  
-   **ftp_port**  
-   **ftp_subdirectory**  
-   **post_snapshot_script**  
-   **pre_snapshot_script**  
-   **snapshot_in_defaultfolder**  
-   **sync_mode**  
  
Для получения списка объектов публикации в Active Directory с помощью **publish_to_active_directory** параметра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] объект уже должен быть создан в Active Directory.  
  
## <a name="impact-of-immediate-sync"></a>Влияние свойства «immediate sync»  
 При интерпретации синхронизации все изменения в журнале отслеживаются сразу после того, как исходный моментальный снимок сформирован, даже если нет подписок. Зарегистрированных изменений используются в том случае, когда клиент использует резервное копирование для добавить новый одноранговый узел. После восстановления резервной копии одноранговый узел является синхронизированы с любые другие изменения, происходящие после создания резервной копии. Поскольку команды отслеживаются в базе данных распространителя, логику синхронизации можно просмотрите последнего архивированного номера LSN и использовать ее в качестве отправной точки, зная, что команда доступна, если была создана резервная копия в течение максимального срока хранения. (Значение по умолчанию для минимального срока хранения составляет 0 часов, а также максимальный срок хранения — 24 ч.)  
  
 При интерпретации синхронизации имеет значение off, изменения сохраняются по меньшей мере на минимальный срок хранения и удаляются сразу же для всех реплицированных транзакций. Если свойство «immediate sync» отключено и настроено на срок хранения по умолчанию, скорее всего, необходимые изменения после создания резервной копии были очищены, а новый одноранговый узел не был инициализирован надлежащим образом. Остался единственный параметр — замораживание топологии. Установка свойства «immediate sync» в положение «включено» предоставляет большую гибкость и рекомендуется для репликации P2P.  
  
## <a name="example"></a>Пример  
 [!code-sql[HowTo#sp_changepublication](../../relational-databases/replication/codesnippet/tsql/sp-changepublication-tra_1.sql)]  
  
## <a name="permissions"></a>Разрешения  
 Только члены **sysadmin** предопределенной роли сервера или **db_owner** предопределенной роли базы данных могут выполнять процедуру **sp_changepublication**.  
  
## <a name="see-also"></a>См. также  
 [Просмотр и изменение свойств публикации](../../relational-databases/replication/publish/view-and-modify-publication-properties.md)   
 [Изменение свойств публикации и статьи](../../relational-databases/replication/publish/change-publication-and-article-properties.md)   
 [sp_addpublication &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-addpublication-transact-sql.md)   
 [sp_droppublication &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-droppublication-transact-sql.md)   
 [sp_helppublication (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-helppublication-transact-sql.md)   
 [Хранимые процедуры репликации (Transact-SQL)](../../relational-databases/system-stored-procedures/replication-stored-procedures-transact-sql.md)  
  
  
