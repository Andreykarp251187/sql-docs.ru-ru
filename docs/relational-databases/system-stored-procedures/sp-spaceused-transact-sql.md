---
title: sp_spaceused (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 08/14/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- sp_spaceused_TSQL
- sp_spaceused
dev_langs:
- TSQL
helpviewer_keywords:
- sp_spaceused
ms.assetid: c6253b48-29f5-4371-bfcd-3ef404060621
author: stevestein
ms.author: sstein
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: 1dc80f17fc88fa665b41a130bb69ebe0d4f1f26c
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68032876"
---
# <a name="spspaceused-transact-sql"></a>sp_spaceused (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2012-all-md](../../includes/tsql-appliesto-ss2012-all-md.md)]

  Выводит количество строк, зарезервированное место на диске и место на диске, которое используется таблицей, индексированным представлением или очередью компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)] в текущей базе данных, либо выводит место на диске, зарезервированное и используемое всей базой данных.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
sp_spaceused [[ @objname = ] 'objname' ]   
[, [ @updateusage = ] 'updateusage' ]  
[, [ @mode = ] 'mode' ]  
[, [ @oneresultset = ] oneresultset ]  
[, [ @include_total_xtp_storage = ] include_total_xtp_storage ]
```  
  
## <a name="arguments"></a>Аргументы  

Для [!INCLUDE[sssdw-md](../../includes/sssdw-md.md)] и [!INCLUDE[sspdw-md](../../includes/sspdw-md.md)], `sp_spaceused` необходимо указать именованные параметры (например `sp_spaceused (@objname= N'Table1');` вместо того чтобы полагаться на порядковый номер параметра. 

`[ @objname = ] 'objname'`
   
 Полное или неполное имя таблицы, индексированного представления или очереди, для которых были запрошены сведения по использованию места на диске. Кавычки необходимы только в том случае, если указано уточненное имя объекта. Если указано полностью уточненное имя, включающее имя базы данных, именем базы данных должно быть имя текущей базы данных.  
Если *objname* не указан, результаты возвращаются для всей базы данных.  
*ObjName* — **nvarchar(776)** , значение по умолчанию NULL.  
> [!NOTE]  
> [!INCLUDE[sssdw-md](../../includes/sssdw-md.md)] и [!INCLUDE[sspdw-md](../../includes/sspdw-md.md)] поддерживают только объекты базы данных и таблицы.
  
`[ @updateusage = ] 'updateusage'` Указывает, что следует запускать DBCC UPDATEUSAGE для обновления сведений об использовании пространства. Когда *objname* — не указано, инструкция выполняется на всю базу данных; в противном случае инструкция выполняется *objname*. Значения могут быть **true** или **false**. *UPDATEUSAGE* — **varchar(5)** , значение по умолчанию **false**.  
  
`[ @mode = ] 'mode'` Указывает область результатов. Для перенесенной таблицы или базы данных *режим* позволяет включить или исключить удаленного часть объекта. Дополнительные сведения см. в разделе [Stretch Database](../../sql-server/stretch-database/stretch-database.md).  
  
 *Режим* аргумент может иметь следующие значения:  
  
|Значение|Описание|  
|-----------|-----------------|  
|ALL|Возвращает статистику хранения объекта или базы данных, включая части локального и удаленного часть.|  
|LOCAL_ONLY|Возвращает статистику только локальную часть объектов или база данных хранилища. Если объект или база данных не совместимых со Stretch, возвращает та же статистика, как и при @mode = ALL.|  
|REMOTE_ONLY|Возвращает статистику только удаленной части объекта или базы данных хранилища. Этот параметр выдает ошибку, если выполняется одно из следующих условий:<br /><br /> В таблице не включена для Stretch.<br /><br /> Таблица включена для Stretch, но никогда не включалась переноса данных. В этом случае удаленная таблица еще не содержит схему.<br /><br /> Пользователь удален вручную удаленной таблицы.<br /><br /> При подготовке remote data archive вернул состояние успешно, но на самом деле не удалось.|  
  
 *режим* — **varchar(11)** , значение по умолчанию **N'ALL'** .  
  
`[ @oneresultset = ] oneresultset` Указывает, следует ли возвращать один результирующий набор. *Oneresultset* аргумент может иметь следующие значения:  
  
|Значение|Описание|  
|-----------|-----------------|  
|0|Когда *@objname* равно null или не указан, возвращаются два результирующих набора. Два результирующих набора является поведением по умолчанию.|  
|1|Когда *@objname* = null или является не указан, возвращается один результирующий набор.|  
  
 *oneresultset* — **бит**, значение по умолчанию **0**.  

`[ @include_total_xtp_storage] 'include_total_xtp_storage'`
**Применяется к:** [!INCLUDE[sssql17-md](../../includes/sssql17-md.md)], [!INCLUDE[sssds-md](../../includes/sssds-md.md)].  
  
 Когда @oneresultset= 1, параметр @include_total_xtp_storage определяет, включает ли одного результирующего набора столбцов для хранилища MEMORY_OPTIMIZED_DATA. Значение по умолчанию — 0, то есть, по умолчанию, (Если этот параметр опущен) XTP столбцы не включаются в результирующий набор.  

## <a name="return-code-values"></a>Значения кода возврата  
 0 (успешное завершение) или 1 (неуспешное завершение)  
  
## <a name="result-sets"></a>Результирующие наборы  
 Если *objname* опущен и значение *oneresultset* равно 0, возвращаются следующие результирующие наборы, для предоставления сведений размер текущей базы данных.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar(18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов.|  
|**нераспределенное место**|**varchar(18)**|Место в базе данных, не зарезервированное для объектов базы данных.|  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**Зарезервировано**|**varchar(18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами.|  
|**неиспользуемые**|**varchar(18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|  
  
 Если *objname* опущен и значение *oneresultset* -1, следующие один результирующий набор возвращается для предоставления сведений размер текущей базы данных.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar(18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов.|  
|**нераспределенное место**|**varchar(18)**|Место в базе данных, не зарезервированное для объектов базы данных.|  
|**Зарезервировано**|**varchar(18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами.|  
|**неиспользуемые**|**varchar(18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|  
  
 Если *objname* указан, для указанного объекта возвращается следующий результирующий набор.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**name**|**nvarchar(128)**|Имя объекта, для которого были запрошены сведения об используемом пространстве.<br /><br /> Имя схемы объекта не возвращается. Если требуется указать имя схемы, используйте [sys.dm_db_partition_stats](../../relational-databases/system-dynamic-management-views/sys-dm-db-partition-stats-transact-sql.md) или [sys.dm_db_index_physical_stats](../../relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql.md) динамические административные представления для получения эквивалентных сведений о размере.|  
|**rows**|**char(20)**|Количество существующих строк в таблице. Если объект указан как очередь компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)], этот столбец указывает число сообщений в очереди.|  
|**Зарезервировано**|**varchar(18)**|Общий объем пространства, зарезервированный для *objname*.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными *objname*.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами *objname*.|  
|**неиспользуемые**|**varchar(18)**|Общий объем пространства, зарезервированный для *objname* , но еще не используется.|  
 
Это режим по умолчанию, если параметры не указаны. Следующие результирующие наборы возвращаются описанием сведений о размере базы данных на диске. 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar(18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов. Если база данных имеет файловую группу MEMORY_OPTIMIZED_DATA, это включает общий размер на диске все файлы контрольных точек в файловой группе.|  
|**нераспределенное место**|**varchar(18)**|Место в базе данных, не зарезервированное для объектов базы данных. Если база данных имеет файловую группу MEMORY_OPTIMIZED_DATA, это включает общий размер на диске файлов контрольных точек с состоянием PRECREATED в файловой группе.|  

Пространство, используемое таблицами в базе данных: (этот результирующий набор не отражает оптимизированные для памяти таблицы, как есть без учета по таблицам на диске) 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**Зарезервировано**|**varchar(18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами.|  
|**неиспользуемые**|**varchar(18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|

Следующий результирующий набор возвращается **, только если** база данных имеет файловую группу MEMORY_OPTIMIZED_DATA с по крайней мере один контейнер: 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**xtp_precreated**|**varchar(18)**|Общий размер файлов контрольных точек с состоянием PRECREATED, в КБ. Счетчики для свободного места в базе данных в целом. [Например, если имеется 600 000 КБ готовые файлы контрольных точек, этот столбец содержит 600000 "KB"]|  
|**xtp_used**|**varchar(18)**|Общий размер файлов контрольных точек с состояниями UNDER CONSTRUCTION, АКТИВНЫЕ и MERGE TARGET, в КБ. Это пространство на диске активно используется для данных в таблицах, оптимизированных для памяти.|  
|**xtp_pending_truncation**|**varchar(18)**|Общий размер файлов контрольных точек с состоянием WAITING_FOR_LOG_TRUNCATION, в КБ. Это дисковое пространство для файлов контрольных точек, которые ожидают очистки, когда происходит усечение журнала.|

Если *objname* — этот параметр опущен, oneresultset значение 1, и *include_total_xtp_storage* -1, следующие один результирующий набор возвращается для предоставления сведений размер текущей базы данных. Если `include_total_xtp_storage` равно 0 (по умолчанию), последние три столбца, пропускаются. 

|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**database_name**|**nvarchar(128)**|Имя текущей базы данных.|  
|**database_size**|**varchar(18)**|Размер текущей базы данных в мегабайтах. **database_size** включает файлы данных и журналов. Если база данных имеет файловую группу MEMORY_OPTIMIZED_DATA, это включает общий размер на диске все файлы контрольных точек в файловой группе.|
|**нераспределенное место**|**varchar(18)**|Место в базе данных, не зарезервированное для объектов базы данных. Если база данных имеет файловую группу MEMORY_OPTIMIZED_DATA, это включает общий размер на диске файлов контрольных точек с состоянием PRECREATED в файловой группе.|  
|**Зарезервировано**|**varchar(18)**|Общий объем пространства, выделенный объектам в базе данных.|  
|**data**|**varchar(18)**|Общий объем пространства, используемый данными.|  
|**index_size**|**varchar(18)**|Общий объем пространства, используемый индексами.|  
|**неиспользуемые**|**varchar(18)**|Общий объем пространства, зарезервированный для объектов в базе данных, но пока не используемый.|
|**xtp_precreated**|**varchar(18)**|Общий размер файлов контрольных точек с состоянием PRECREATED, в КБ. Это учитывается при подсчете незанятое пространство в базе данных в целом. Возвращает значение NULL, если базы данных не является файловой группой memory_optimized_data с по крайней мере один контейнер. *Этот столбец содержит только указывается, если @include_total_xtp_storage= 1*.| 
|**xtp_used**|**varchar(18)**|Общий размер файлов контрольных точек с состояниями UNDER CONSTRUCTION, АКТИВНЫЕ и MERGE TARGET, в КБ. Это пространство на диске активно используется для данных в таблицах, оптимизированных для памяти. Возвращает значение NULL, если базы данных не является файловой группой memory_optimized_data с по крайней мере один контейнер. *Этот столбец содержит только указывается, если @include_total_xtp_storage= 1*.| 
|**xtp_pending_truncation**|**varchar(18)**|Общий размер файлов контрольных точек с состоянием WAITING_FOR_LOG_TRUNCATION, в КБ. Это дисковое пространство для файлов контрольных точек, которые ожидают очистки, когда происходит усечение журнала. Возвращает значение NULL, если базы данных не является файловой группой memory_optimized_data с по крайней мере один контейнер. Этот столбец содержит только указывается, если `@include_total_xtp_storage=1`.|

## <a name="remarks"></a>Примечания  
 **database_size** превышающий сумму **зарезервированные** + **нераспределенное пространство** так, как он включает размер файлов журнала, но **зарезервировано**и **unallocated_space** учитывают только страницы данных.  
  
 Страницы, используемые XML-индексов и полнотекстовых индексов, включаются в **index_size** обоих результирующих наборах. Когда *objname* указано, страницы XML-индексов и полнотекстовых индексов для объекта также учитываются в общих **зарезервированные** и **index_size** результаты.  
  
 Если место, занятое вычисляется для базы данных или объект, имеющий пространственный индекс, а столбцы размер пространства, такие как **database_size**, **зарезервированные**, и **index_size**, включают размер пространственного индекса.  
  
 Когда *updateusage* указано, [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] просмотров страницы в базе данных, а также вносит все необходимые изменения **sys.allocation_units** и **sys.partitions** представления относительно дискового пространства, используемого всеми таблицами каталога. Иногда возникают ситуации, например после удаления индекса, когда сведения о занимаемом таблицей месте могут устареть. *UPDATEUSAGE* может занять некоторое время для запуска на больших таблиц или баз данных. Используйте *updateusage* только при подозрении возвращаются неверные значения и если процесс не будет неблагоприятно влиять на других пользователей или процессов в базе данных. При необходимости инструкцию DBCC UPDATEUSAGE можно запускать отдельно.  
  
> [!NOTE]  
>  При удалении или перестройке больших индексов либо удалении или усечении больших таблиц компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] откладывает фактическое освобождение страниц и связанных блокировок до момента фиксации транзакции. Отложенные операции удаления не освобождают выделенное место немедленно. Таким образом, значения, возвращаемые методом **sp_spaceused** сразу после удаления или усечения большого объекта может не отражать доступное пространство на диске.  
  
## <a name="permissions"></a>Разрешения  
 Разрешение на выполнение процедуры **sp_spaceused** предоставлено роли **public** . Параметр **@updateusage** могут указывать только члены предопределенной роли базы данных **@updateusage** .  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-displaying-disk-space-information-about-a-table"></a>A. Вывод сведений о занимаемом месте на диске для таблицы  
 В следующем примере предоставляются сведения о месте на диске для таблицы `Vendor` и ее индексах.  
  
```sql  
USE AdventureWorks2012;  
GO  
EXEC sp_spaceused N'Purchasing.Vendor';  
GO  
```  
  
### <a name="b-displaying-updated-space-information-about-a-database"></a>Б. Вывод обновленных сведений о занимаемом месте на диске для базы данных  
 В следующем примере приводятся итоговые сведения об использовании места на диске текущей базой данных с применением необязательного параметра `@updateusage`, чтобы получить достоверные текущие значения.  
  
```sql  
USE AdventureWorks008R2;  
GO  
EXEC sp_spaceused @updateusage = N'TRUE';  
GO  
```  
  
### <a name="c-displaying-space-usage-information-about-the-remote-table-associated-with-a-stretch-enabled-table"></a>В. Отображение информации о удаленной таблицы связанный с таблицей с включенным Stretch  
 Следующий пример приводится сводка место, занятое удаленной таблицы, связанные с таблицей с включенным Stretch, с помощью **@mode** аргумент для указания удаленного целевого объекта. Дополнительные сведения см. в разделе [Stretch Database](../../sql-server/stretch-database/stretch-database.md).  
  
```sql  
USE StretchedAdventureWorks2016  
GO  
EXEC sp_spaceused N'Purchasing.Vendor', @mode = 'REMOTE_ONLY'  
```  
  
### <a name="d-displaying-space-usage-information-for-a-database-in-a-single-result-set"></a>Г. Отображение сведения об использовании пространства для базы данных из одного результирующего набора  
 Следующий пример приводится сводка использование пространства для текущей базы данных в один результирующий набор.  
  
```sql  
USE AdventureWorks2016  
GO  
EXEC sp_spaceused @oneresultset = 1  
```  

### <a name="e-displaying-space-usage-information-for-a-database-with-at-least-one-memoryoptimized-file-group-in-a-single-result-set"></a>Д. Отображение сведения об использовании пространства для базы данных с файловой группы по крайней мере один MEMORY_OPTIMIZED в один результирующий набор 
 Следующий пример приводится сводка использование пространства для текущей базы данных с помощью по крайней мере один MEMORY_OPTIMIZED файловой группы, в единый результирующий набор.
 
```sql
USE WideWorldImporters
GO
EXEC sp_spaceused @updateusage = 'FALSE', @mode = 'ALL', @oneresultset = '1', @include_total_xtp_storage = '1';
GO
``` 

### <a name="f-displaying-space-usage-information-for-a-memoryoptimized-table-object-in-a-database"></a>Е. Вывод информации для объекта MEMORY_OPTIMIZED таблицы в базе данных.
 Следующий пример приводится сводка использование пространства для объекта MEMORY_OPTIMIZED таблицы в текущей базе данных с помощью по крайней мере одну группу файлов MEMORY_OPTIMIZED.
 
```sql
USE WideWorldImporters
GO
EXEC sp_spaceused
@objname = N'VehicleTemparatures',
@updateusage = 'FALSE',
@mode = 'ALL',
@oneresultset = '0',
@include_total_xtp_storage = '1';
GO
```  

## <a name="see-also"></a>См. также  
 [CREATE INDEX (Transact-SQL)](../../t-sql/statements/create-index-transact-sql.md)   
 [CREATE TABLE (Transact-SQL)](../../t-sql/statements/create-table-transact-sql.md)   
 [DBCC UPDATEUSAGE &#40;Transact-SQL&#41;](../../t-sql/database-console-commands/dbcc-updateusage-transact-sql.md)   
 [SQL Server Service Broker](../../database-engine/configure-windows/sql-server-service-broker.md)   
 [sys.allocation_units (Transact-SQL)](../../relational-databases/system-catalog-views/sys-allocation-units-transact-sql.md)   
 [sys.indexes (Transact-SQL)](../../relational-databases/system-catalog-views/sys-indexes-transact-sql.md)   
 [sys.index_columns (Transact-SQL)](../../relational-databases/system-catalog-views/sys-index-columns-transact-sql.md)   
 [sys.objects (Transact-SQL)](../../relational-databases/system-catalog-views/sys-objects-transact-sql.md)   
 [sys.partitions (Transact-SQL)](../../relational-databases/system-catalog-views/sys-partitions-transact-sql.md)   
 [Системные хранимые процедуры (Transact-SQL)](../../relational-databases/system-stored-procedures/system-stored-procedures-transact-sql.md)  
  
  
