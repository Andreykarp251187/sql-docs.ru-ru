---
title: sp_describe_first_result_set (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 03/17/2018
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- sp_describe_first_result_set
- sp_describe_first_result_set_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- sp_describe_first_result_set
ms.assetid: f2355a75-3a8e-43e6-96ad-4f41038f6d22
author: stevestein
ms.author: sstein
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: dc58447e9893647dfa73643f14455d715625478e
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68053048"
---
# <a name="spdescribefirstresultset-transact-sql"></a>sp_describe_first_result_set (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2012-all-md](../../includes/tsql-appliesto-ss2012-all-md.md)]

  Возвращает метаданные для первого возможного результирующего набора [!INCLUDE[tsql](../../includes/tsql-md.md)] пакетной службы. Возвращает пустой результирующий набор, если пакет не вернул результатов. Вызывает ошибку, если [!INCLUDE[ssDE](../../includes/ssde-md.md)] не удается определить метаданные для первого запроса, который будет выполнен при выполнении статического анализа. Динамическое административное представление [sys.dm_exec_describe_first_result_set &#40;Transact-SQL&#41; ](../../relational-databases/system-dynamic-management-views/sys-dm-exec-describe-first-result-set-transact-sql.md) возвращает те же данные.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
sp_describe_first_result_set [ @tsql = ] N'Transact-SQL_batch'   
    [ , [ @params = ] N'parameters' ]   
    [ , [ @browse_information_mode = ] <tinyint> ] ]  
```  
  
## <a name="arguments"></a>Аргументы  
`[ \@tsql = ] 'Transact-SQL_batch'` Один или несколько [!INCLUDE[tsql](../../includes/tsql-md.md)] инструкций. *Transact SQL_batch* может быть **nvarchar (***n***)** или **nvarchar(max)** .  
  
`[ \@params = ] N'parameters'` \@params обеспечивает строку объявления параметров для [!INCLUDE[tsql](../../includes/tsql-md.md)] пакета, который схожего с sp_executesql. Параметры могут быть **nvarchar(n)** или **nvarchar(max)** .  
  
 Строка, содержащая определения всех параметров, внедренных в [!INCLUDE[tsql](../../includes/tsql-md.md)] *_batch*. Строка должна представлять собой константу в Юникоде либо переменную в этом же формате. Определение каждого параметра состоит из имени параметра и типа данных. *n* — заполнитель, указывающий Дополнительные определения параметра. Каждый параметр, указанный в инструкции должен быть определен в \@params. Если [!INCLUDE[tsql](../../includes/tsql-md.md)] инструкция или пакет в инструкции не содержит параметров, \@params не является обязательным. Значением по умолчанию для этого аргумента является NULL.  
  
`[ \@browse_information_mode = ] tinyint` Указывает, если возвращаются дополнительные ключевые столбцы и сведения об исходной таблице. Если он имеет значение 1, то каждый запрос анализируется аналогично анализу запроса с параметром FOR BROWSE. Возвращаются дополнительные ключевые столбцы и сведения об исходной таблице.  
  
-   Если задано значение 0, то данные не возвращаются.  
  
-   Если он имеет значение 1, то каждый запрос анализируется аналогично анализу запроса с параметром FOR BROWSE. Это приводит к возврату имен базовых таблиц в качестве сведений об исходном столбце.  
  
-   Если задано значение 2, то каждый запрос анализируется так, как если бы он использовался для подготовки или выполнения курсора. Тогда в качестве сведений об исходном столбце возвращаются имена представлений.  
  
## <a name="return-code-values"></a>Значения кода возврата  
 **sp_describe_first_result_set** всегда возвращает состояние 0 в случае успешного выполнения. Если процедура вызывает ошибку и процедура вызывается через RPC, возвращаемое состояние заполняется типом ошибки, описанным в столбце error_type sys.dm_exec_describe_first_result_set. Если процедура вызывается из [!INCLUDE[tsql](../../includes/tsql-md.md)], то возвращаемое значение всегда равно нулю, даже при наличии ошибок.  
  
## <a name="result-sets"></a>Результирующие наборы  
 Эти общие метаданные возвращаются в виде результирующего набора с одной строкой для каждого столбца в результирующих метаданных. Каждая строка описывает тип и допустимость значений NULL в столбце в формате, описанном в следующем разделе. Если первая инструкция не существует для каждого пути управления, возвращается результирующий набор с нулем строк.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**is_hidden**|**бит NOT NULL**|Указывает, что столбец является дополнительным, добавленным для целей просмотра сведений, и что он фактически не отображается в результирующем наборе.|  
|**column_ordinal**|**int NOT NULL**|Содержит порядковый номер столбца в результирующем наборе. Позиция первого столбца будет указана как 1.|  
|**name**|**аргумент NULL**|Содержит имя столбца, если его можно определить. В противном случае будет содержать значение NULL.|  
|**is_nullable**|**бит NOT NULL**|Содержит значение 1, если столбец допускает значения NULL, значение 0, если столбец не допускает значения NULL, и значение 1, если не удалось определить, допускает ли столбец значения NULL.|  
|**system_type_id**|**int NOT NULL**|Содержит system_type_id для типа данных столбца, как указано в sys.types. Для типов CLR, даже если system_type_name возвращает NULL, этот столбец вернет значение 240.|  
|**system_type_name**|**nvarchar(256) NULL**|Содержит имя и аргументы (длина, точность, масштаб и т. д.), указанные для типа данных столбца. Если тип данных является пользовательским псевдонимом, то здесь указывается базовый системный тип данных. Если это определяемый пользователем тип данных CLR, то в этом столбце вернется NULL.|  
|**max_length**|**smallint NOT NULL**|Максимальная длина столбца (в байтах).<br /><br /> -1 = тип данных столбца — **varchar(max)** , **nvarchar(max)** , **varbinary(max)** , или **xml**.<br /><br /> Для **текст** столбцы, **max_length** значение будет равно 16 или значение, заданное параметром **sp_tableoption «text in row»** .|  
|**precision**|**tinyint NOT NULL**|Точность столбца, если он является числовым. В противном случае возвращается 0.|  
|**масштаб**|**tinyint NOT NULL**|Масштаб значений столбца в случае числового выражения. В противном случае возвращается 0.|  
|**collation_name**|**аргумент NULL**|Имя параметров сортировки столбца, если он символьный. В противном случае возвращается NULL.|  
|**user_type_id**|**int NULL**|Для типов CLR и псевдонимов содержит user_type_id для типа данных столбца, как указано в sys.types. В противном случае значение равно NULL.|  
|**user_type_database**|**аргумент NULL**|Для типов CLR и псевдонимов содержит имя базы данных, в которой этот тип определен. В противном случае значение равно NULL.|  
|**user_type_schema**|**аргумент NULL**|Для типов CLR и псевдонимов содержит имя схемы, в которой этот тип определен. В противном случае значение равно NULL.|  
|**user_type_name**|**аргумент NULL**|Для типов CLR и псевдонимов содержит имя типа. В противном случае значение равно NULL.|  
|**assembly_qualified_type_name**|**nvarchar(4000)**|Для типов CLR возвращает имя сборки и класса, определяющего тип. В противном случае значение равно NULL.|  
|**xml_collection_id**|**int NULL**|Содержит xml_collection_id для типа данных столбца, как указано в sys.columns. Этот столбец возвратит NULL, если возвращаемый тип не связан с коллекцией схем XML.|  
|**xml_collection_database**|**аргумент NULL**|Содержит базу данных, в которой определена коллекция схем XML, связанная с этим типом. Этот столбец возвратит NULL, если возвращаемый тип не связан с коллекцией схем XML.|  
|**xml_collection_schema**|**аргумент NULL**|Содержит схему, в которой определена коллекция схем XML, связанная с этим типом. Этот столбец возвратит NULL, если возвращаемый тип не связан с коллекцией схем XML.|  
|**xml_collection_name**|**аргумент NULL**|Содержит имя коллекции схем XML, связанной с этим типом. Этот столбец возвратит NULL, если возвращаемый тип не связан с коллекцией схем XML.|  
|**is_xml_document**|**бит NOT NULL**|Возвращает значение 1, если возвращается тип данных XML, который гарантированно будет полным XML-документом (включая корневой узел), а не фрагментом XML. В противном случае возвращается 0.|  
|**is_case_sensitive**|**бит NOT NULL**|Возвращает значение 1, если столбец относится к строковому типу с учетом регистра, либо значение 0 в противном случае.|  
|**is_fixed_length_clr_type**|**бит NOT NULL**|Возвращает значение 1, если столбец относится имеет тип CLR с фиксированной длиной, либо в противном случае значение 0.|  
|**source_server**|**sysname**|Имя исходного сервера, возвращаемое столбцом этого результата (если он исходит от удаленного сервера). Имя дается так, как оно отображается в представлении каталога sys.servers. Возвращает NULL, если столбец поступает с локального сервера или если невозможно определить, с какого сервера он поступил. Заполняется только при запросе просмотра информации.|  
|**source_database**|**sysname**|Имя исходной базы данных, возвращаемое столбцом этого результата. Возвращает NULL, если не удалось определить базу данных. Заполняется только при запросе просмотра информации.|  
|**source_schema**|**sysname**|Имя исходной схемы, возвращаемое столбцом в этом результате. Возвращает NULL, если не удалось определить схему. Заполняется только при запросе просмотра информации.|  
|**source_table**|**sysname**|Имя исходной таблицы, возвращаемое столбцом в этом результате. Возвращает NULL, если не удалось определить таблицу. Заполняется только при запросе просмотра информации.|  
|**source_column**|**sysname**|Имя исходного столбца, возвращаемое результирующим столбцом. Возвращает NULL, если не удалось определить столбец. Заполняется только при запросе просмотра информации.|  
|**is_identity_column**|**бит NULL**|Возвращает значение 1, если столбец является столбцом идентификаторов, либо значение 0 в противном случае. Возвращает NULL, если не удалось определить, является ли столбец столбцом идентификаторов.|  
|**is_part_of_unique_key**|**бит NULL**|Возвращает значение 1, если столбец является частью уникального индекса (включая ограничение уникальности и первичности), либо значение 0 в противном случае. Возвращает NULL, если не удалось определить, является ли столбец частью уникального индекса. Заполняется только при запросе просмотра информации.|  
|**is_updateable**|**бит NULL**|Возвращает значение 1, если столбец можно обновлять, либо значение 0 в противном случае. Возвращает NULL, если не удалось определить, можно ли обновлять столбец.|  
|**is_computed_column**|**бит NULL**|Возвращает значение 1, если столбец является вычисляемым столбцом, либо значение 0 в противном случае. Возвращает NULL, если не удалось определить, является ли столбец вычисляемым столбцом.|  
|**is_sparse_column_set**|**бит NULL**|Возвращает значение 1, если столбец является разреженным, и значение 0 в противном случае. Возвращает NULL, если не удалось определить, является ли столбец частью набора разреженных столбцов.|  
|**ordinal_in_order_by_list**|**smallint NULL**|Позиция этого столбца в списке ORDER BY. Возвращает NULL, если столбец не отображается в списке ORDER BY, или если список ORDER BY нельзя однозначно определить.|  
|**order_by_list_length**|**smallint NULL**|Длина списка ORDER BY. Возвращает NULL, если нет списка ORDER BY или если список ORDER BY нельзя однозначно определить. Обратите внимание, что это значение будет одинаковым для всех строк, возвращенных **sp_describe_first_result_set.**|  
|**order_by_is_descending**|**smallint NULL**|Если значение ordinal_in_order_by_list не равно NULL, **order_by_is_descending** столбец сообщает направление в предложении ORDER BY для этого столбца. В противном случае возвращается значение NULL.|  
|**tds_type_id**|**int NOT NULL**|Для внутреннего использования.|  
|**tds_length**|**int NOT NULL**|Для внутреннего использования.|  
|**tds_collation_id**|**int NULL**|Для внутреннего использования.|  
|**tds_collation_sort_id**|**tinyint NULL**|Для внутреннего использования.|  
  
## <a name="remarks"></a>Примечания  
 **sp_describe_first_result_set** гарантии, что если процедура возвращает метаданные первого результирующего набора для (гипотетического) пакета A и, если такой пакет (A) впоследствии выполнены затем пакета будет (1), возникает ошибка во время оптимизации (2) вызывает ошибку времени выполнения, (3) не возвращает никаких результатов задано или (4) возвращает первый результирующий набор с те же метаданные, описываемого **sp_describe_first_result_set**.  
  
 Имя, допустимость значений NULL и тип данных могут различаться. Если **sp_describe_first_result_set** возвращает, является пустой результирующий набор, гарантии, что выполнение пакета будет возвращать нет результирующих наборов.  
  
 Эта гарантия предполагается, что нет соответствующей схемы изменений на сервере. Не включать в себя создание временных таблиц или табличных переменных в пакете A в промежутке между изменениям соответствующих схем на сервере, **sp_describe_first_result_set** вызывается и время, когда результирующий набор возвращается во время выполнения, включая изменения схем пакетом B.  
  
 **sp_describe_first_result_set** возвращает сообщение об ошибке в любом из следующих случаев.  
  
-   Если входные данные \@tsql не является допустимым [!INCLUDE[tsql](../../includes/tsql-md.md)] пакетной службы. Допустимость определяется путем синтаксического разбора и анализа [!INCLUDE[tsql](../../includes/tsql-md.md)] пакетной службы. Все ошибки, вызванных пакетом во время оптимизации запроса или во время выполнения не учитываются при определении ли [!INCLUDE[tsql](../../includes/tsql-md.md)] допустимости пакета.  
  
-   Если \@params не равно NULL и содержит строку, которая не является синтаксически правильной строкой объявления параметров или если он содержит строку, объявляющий любого параметра более одного раза.  
  
-   Если входные данные [!INCLUDE[tsql](../../includes/tsql-md.md)] пакет объявляет локальную переменную с тем же именем, как параметр, объявленный в \@params.  
  
-   Если инструкция использует временную таблицу.  
  
-   В запрос включено создание постоянной таблицы, к которой он будет обращен.  
  
 При успешном выполнении остальных проверок учитываются все возможные пути потоков управления. Это учитывает все управление операторов потока (GOTO, IF/ELSE, WHILE, и [!INCLUDE[tsql](../../includes/tsql-md.md)] блоки TRY/CATCH) и все процедуры, динамические [!INCLUDE[tsql](../../includes/tsql-md.md)] пакетов или триггеры, вызывается из входного пакета с помощью инструкции EXEC, выполнение инструкции DDL Срабатывание триггеров DDL или DML-инструкцией, которое вызывает срабатывание триггеров на целевую таблицу или таблицы, который изменяется из-за каскадные действия на ограничение внешнего ключа. При наличии нескольких возможных путей управления на определенном этапе выполнение алгоритма прерывается.  
  
 Для всех путей потоков управления первая инструкция (если таковые имеются), возвращает результирующий набор, определяется **sp_describe_first_result_set**.  
  
 При наличии в пакете нескольких первых инструкций результаты могут различаться, т.е. могут быть получены различные количества столбцов, имена столбцов, допустимости значений NULL и типы данных. Ниже более подробно описывается обработка этих различий:  
  
-   При получении различного количества столбцов в результатах вызывается ошибка и результат не возвращается.  
  
-   Если отличаются имена столбцов, для имен возвращаемых столбцов задается значение NULL.  
  
-   Если различается допустимость значений NULL, то будет разрешено задание значений NULL.  
  
-   Если типы данных различаются, будет вызвана ошибка и не будет возвращен результат, за исключением следующих случаев:  
  
    -   **varchar(a)** для **varchar(a')** где ">.  
  
    -   **varchar(a)** для **varchar(max)**  
  
    -   **nvarchar(a)** для **nvarchar(a')** где ">.  
  
    -   **nvarchar(a)** для **nvarchar(max)**  
  
    -   **varbinary(a)** для **varbinary(a')** где ">.  
  
    -   **varbinary(a)** для **varbinary(max)**  
  
 **sp_describe_first_result_set** не поддерживает косвенную рекурсию.  
  
## <a name="permissions"></a>Разрешения  
 Требуется разрешение на выполнение \@аргумент tsql.  
  
## <a name="examples"></a>Примеры  
  
### <a name="typical-examples"></a>Наиболее распространенные примеры  
  
#### <a name="a-simple-example"></a>A. Простой пример  
 В следующем примере описывается результирующий набор, возвращаемый одним запросом.  
  
```  
sp_describe_first_result_set @tsql = N'SELECT object_id, name, type_desc FROM sys.indexes'  
```  
  
 В следующем примере описывается результирующий набор, возвращаемый одним запросом, в котором содержится параметр.  
  
```  
sp_describe_first_result_set @tsql =   
N'SELECT object_id, name, type_desc   
FROM sys.indexes   
WHERE object_id = @id1'  
, @params = N'@id1 int'  
```  
  
#### <a name="b-browse-mode-examples"></a>Б. Примеры режима просмотра  
 В следующих трех примерах показаны ключевые различия между разными режимами просмотра сведений. В результаты запроса включены только столбцы, относящиеся к теме.  
  
 В примере используется значение 0, которое указывает, что возврата сведений не происходит.  
  
```sql  
CREATE TABLE dbo.t (a int PRIMARY KEY, b1 int);  
GO  
CREATE VIEW dbo.v AS SELECT b1 AS b2 FROM dbo.t;  
GO  
EXEC sp_describe_first_result_set N'SELECT b2 AS b3 FROM dbo.v', null, 0;  
```  
  
 [!INCLUDE[ssResult](../../includes/ssresult-md.md)]  
  
|is_hidden|column_ordinal|name|source_schema|source_table|source_column|is_part_of_unique_key|  
|----------------|---------------------|----------|--------------------|-------------------|--------------------|-------------------------------|  
|0|1|b3|NULL|NULL|NULL|NULL|  
  
 В примере используется значение 1, которое указывает, что возврат сведений происходит так, как если бы в запросе был указан параметр FOR BROWSE.  
  
```sql  
EXEC sp_describe_first_result_set N'SELECT b2 AS b3 FROM v', null, 1  
  
```  
  
 [!INCLUDE[ssResult](../../includes/ssresult-md.md)]  
  
|is_hidden|column_ordinal|name|source_schema|source_table|source_column|is_part_of_unique_key|  
|----------------|---------------------|----------|--------------------|-------------------|--------------------|-------------------------------|  
|0|1|b3|dbo|t|B1|0|  
|1|2|a|dbo|t|a|1|  
  
 В примере используется значение 2, которое показывает, что анализ выполняется так же, как и при подготовке курсора.  
  
```sql  
EXEC sp_describe_first_result_set N'SELECT b2 AS b3 FROM v', null, 2  
```  
  
 [!INCLUDE[ssResult](../../includes/ssresult-md.md)]  
  
|is_hidden|column_ordinal|name|source_schema|source_table|source_column|is_part_of_unique_key|  
|----------------|---------------------|----------|--------------------|-------------------|--------------------|-------------------------------|  
|0|1|B3|dbo|v|B2|0|  
|1|2|ROWSTAT|NULL|NULL|NULL|0|  
  
### <a name="examples-of-problems"></a>Примеры проблем  
 Ниже во всех примерах используются две таблицы. Для создания примеров таблиц выполните следующие инструкции.  
  
```  
CREATE TABLE dbo.t1 (a int NULL, b varchar(10) NULL, c nvarchar(10) NULL);  
CREATE TABLE dbo.t2 (a smallint NOT NULL, d varchar(20) NOT NULL, e int NOT NULL);  
```  
  
#### <a name="error-because-the-number-of-columns-differ"></a>Ошибка, вызванная различием в количестве столбцов  
 В этом примере различается количество столбцов в возможных первых результирующих наборах.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
IF(1=1)  
    SELECT a FROM t1;  
ELSE  
    SELECT a, b FROM t1;  
SELECT * FROM t; -- Ignored, not a possible first result set.'  
  
```  
  
#### <a name="error-because-the-data-types-differ"></a>Ошибка, вызванная различием типов данных  
 Типы столбцов различаются в возможных первых результирующих наборах.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
IF(1=1)  
    SELECT a FROM t1;  
ELSE  
    SELECT a FROM t2;  
```  
  
 Результат: Ошибка, несовпадающие типы (**int** и **smallint**).  
  
#### <a name="column-name-cannot-be-determined"></a>Не удается определить имя столбца  
 У столбцов в различных первых результирующих наборах различается длина в одном типе переменной длины, допустимость значений NULL и имена столбцов:  
  
```  
sp_describe_first_result_set @tsql =   
N'  
IF(1=1)  
    SELECT b FROM t1;  
ELSE  
    SELECT d FROM t2; '  
```  
  
 Результат: \<Неизвестное имя столбца > **varchar(20) NULL**  
  
#### <a name="column-name-forced-to-be-identical-through-aliasing"></a>Для имен столбцов принудительно обеспечивается соответствие с помощью присвоения псевдонимов  
 Аналогично предыдущему, но имена столбцов идентичны благодаря присвоению псевдонимов.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
IF(1=1)  
    SELECT b FROM t1;  
ELSE  
    SELECT d AS b FROM t2;'  
```  
  
 Результат: b **varchar (20) NULL**  
  
#### <a name="error-because-column-types-cannot-be-matched"></a>Ошибка, вызванная невозможностью сопоставления типов столбцов  
 Типы столбцов различаются в возможных первых результирующих наборах.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
IF(1=1)  
    SELECT b FROM t1;  
ELSE  
    SELECT c FROM t1;'  
```  
  
 Результат: Ошибка, несовпадающие типы (**varchar(10)** и **nvarchar(10)** ).  
  
#### <a name="result-set-can-return-an-error"></a>Результирующий набор может вернуть ошибку  
 Первым результирующим набором передается либо ошибка, либо действительно результирующий набор.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
IF(1=1)  
    RAISERROR(''Some Error'', 16, 1);  
  
ELSE  
    SELECT a FROM t1;  
SELECT e FROM t2; -- Ignored, not a possible first result set.;'  
```  
  
 Результат: **intNULL**  
  
#### <a name="some-code-paths-return-no-results"></a>Некоторые кодовые пути не возвращают результаты  
 Первым результирующим набором передается либо значение NULL, либо действительно результирующий набор.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
IF(1=1)  
    RETURN;  
SELECT a FROM t1;'  
```  
  
 Результат: **intNULL**  
  
#### <a name="result-from-dynamic-sql"></a>Результат динамического SQL  
 Первый результирующий набор является динамическим SQL, который можно обнаружить, поскольку он является строковым литералом.  
  
```  
sp_describe_first_result_set @tsql =   
N'EXEC(N''SELECT a FROM t1'');'  
```  
  
 Результат: **INT NULL**  
  
#### <a name="result-failure-from-dynamic-sql"></a>Результат: ошибка динамического SQL  
 Невозможно определить первый результирующий набор из-за динамического SQL.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
DECLARE @SQL NVARCHAR(max);  
SET @SQL = N''SELECT a FROM t1 WHERE 1 = 1 '';  
IF(1=1)  
    SET @SQL += N'' AND e > 10 '';  
EXEC(@SQL); '  
```  
  
 Результат: Ошибка. Результат невозможно обнаружить из-за динамического SQL.  
  
#### <a name="result-set-specified-by-user"></a>Результирующий набор, указываемый пользователем  
 Первый результирующий набор указывается пользователем вручную.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
DECLARE @SQL NVARCHAR(max);  
SET @SQL = N''SELECT a FROM t1 WHERE 1 = 1 '';  
IF(1=1)  
    SET @SQL += N'' AND e > 10 '';  
EXEC(@SQL)  
    WITH RESULT SETS(  
        (Column1 BIGINT NOT NULL)  
    ); '  
```  
  
 Результат: Column1 **bigint NOT NULL**  
  
#### <a name="error-caused-by-a-ambiguous-result-set"></a>Ошибка вызвана неоднозначным результирующим набором  
 В этом примере предполагается, что другого пользователя с именем user1 имеется таблица с именем t1 в схеме по умолчанию s1 со столбцами ( **int NOT NULL**).  
  
```  
sp_describe_first_result_set @tsql =   
N'  
    IF(@p > 0)  
    EXECUTE AS USER = ''user1'';  
    SELECT * FROM t1;'  
, @params = N'@p int'  
```  
  
 Результат: Ошибка. T1 может быть dbo.t1 или s1.t1 с Разное количество столбцов.  
  
#### <a name="result-even-with-ambiguous-result-set"></a>Результат возвращается даже при неоднозначном результирующем наборе  
 Используйте те же предположения, что и в предыдущем примере.  
  
```  
sp_describe_first_result_set @tsql =   
N'  
    IF(@p > 0)  
    EXECUTE AS USER = ''user1'';  
    SELECT a FROM t1;'  
```  
  
 Результат: **int NULL** поскольку dbo.t1.a и s1.t1.a имеют тип **int** и различную допустимость значений NULL.  
  
## <a name="see-also"></a>См. также  
 [sp_describe_undeclared_parameters &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-describe-undeclared-parameters-transact-sql.md)   
 [sys.dm_exec_describe_first_result_set &#40;Transact-SQL&#41;](../../relational-databases/system-dynamic-management-views/sys-dm-exec-describe-first-result-set-transact-sql.md)   
 [sys.dm_exec_describe_first_result_set_for_object &#40;Transact-SQL&#41;](../../relational-databases/system-dynamic-management-views/sys-dm-exec-describe-first-result-set-for-object-transact-sql.md)  
 
