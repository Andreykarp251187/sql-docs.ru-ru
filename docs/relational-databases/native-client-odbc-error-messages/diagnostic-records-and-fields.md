---
title: Диагностические записи и поля Документы Майкрософт
ms.custom: ''
ms.date: 03/17/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- header records [ODBC]
- SQL Server Native Client ODBC driver, errors
- messages [ODBC], diagnostic records
- ODBC error handling, diagnostic records
- SQLGetDiagField function
- diagnostic records [ODBC]
- errors [ODBC], diagnostic records
- fields [ODBC]
- status information [ODBC]
author: markingmyname
ms.author: maghan
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: b9cfea2db0ad0a5eadeede6df3f76ea3979243d0
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81291858"
---
# <a name="diagnostic-records-and-fields"></a>Диагностические записи и поля
[!INCLUDE[appliesto-ss-asdb-asdw-pdw-md](../../includes/appliesto-ss-asdb-asdw-pdw-md.md)]

  Диагностические записи связаны со средой ODBC, соединением, инструкцией или указателями дескриптора. Когда любая функция ODBC возвращает код возврата, отличный от SQL_SUCCESS или SQL_INVALID_HANDLE, дескриптор, вызванный функцией, имеет связанные диагностические записи, содержащие информационные сообщения или сообщения об ошибке. Эти записи сохраняются до тех пор, пока с помощью данного дескриптора не будет вызвана другая функция, в этот момент записи отменяются. Не существует ограничения на количество диагностических записей, одновременно связанных с дескриптором.  
  
 Существует два типа диагностических записей: заголовок и состояние. Заголовочная запись имеет номер 0; если есть записи состояния, то они имеют номера от 1 и далее. Диагностические записи содержат различные поля для заголовочной записи и для записей состояния. Компоненты ODBC могут также определять свои собственные поля диагностических записей.  
  
 Поля в заголовочной записи содержат общие сведения о выполнении функции, включая код возврата, число строк, число записей состояния и тип выполняемой инструкции. Заголовочная запись создается всегда, если только функция ODBC не возвращает SQL_INVALID_HANDLE. Полный список полей в записи заголовка можно ознакомьтесь с [приведенным](../../relational-databases/native-client-odbc-api/sqlgetdiagfield.md)в заголовке полем.  
  
 Поля в записях состояния содержат сведения об конкретных ошибках и предупреждениях, возвращаемых диспетчером драйверов ODBC, драйвером или источником данных, включая значение SQLSTATE, номер собственной ошибки, диагностическое сообщение, номер столбца и номер строки. Записи состояния создаются только в том случае, если функция возвращает SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA или SQL_STILL_EXECUTING. Полный список полей в записях о состоянии можно ознакомьтесь с **s'LGetDiagField.**  
  
 **SLGetDiagRec** получает одну диагностическую запись вместе с ODBC S'LSTATE, родным номером ошибок и полями диагностических сообщений. Эта функциональность похожа на ODBC 2. _х_**функция S'LError.** Простейшая функция обработки ошибок в ODBC 3. *x* является повторное вызов **S'LGetDiagRec,** начиная с параметра *RecNumber,* установленного на 1, и приравливания *RecNumber* на 1 до тех пор, пока **S'LGetDiagRec** не вернется SQL_NO_DATA. Это эквивалентно ODBC 2. *x* приложение, вызывая **S'LError** до тех пор, пока оно не вернется SQL_NO_DATA_FOUND.  
  
 ODBC 3. *x* поддерживает гораздо больше диагностической информации, чем ODBC 2. *x*. Эта информация хранится в дополнительных полях в диагностических записях, извлеченных с помощью **S'LGetDiagField.**  
  
 Драйвер [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC имеет диагностические поля для конкретных драйверов, которые могут быть получены с **помощью S'LGetDiagField.** Метки для этих специфических для драйвера полей определяются в файле sqlncli.h. С помощью этих меток можно получить состояние [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], степень серьезности, имя сервера, имя процедуры и номер строки, связанный с каждой диагностической записью. Кроме того, sqlncli.h содержит определения кодов, которые водитель использует для идентификации заявлений Transact-S'L, если приложение вызывает **S'LGetDiagField** с *диагототионатором,* установленным для SQL_DIAG_DYNAMIC_FUNCTION_CODE.  
  
 **Менеджер** драйвера ODBC обрабатывается менеджером драйверов ODBC, используя информацию об ошибках, которую он кэширует с базового драйвера. Диспетчер драйверов ODBC не кэширует специфические для драйвера диагностические поля до того, как установлено успешное соединение. **SLGetDiagField** возвращается SQL_ERROR, если он называется, чтобы получить драйвер конкретных диагностических полей до успешного подключения была завершена. Если функция соединения ODBC возвращает SQL_SUCCESS_WITH_INFO, то специфические для драйвера диагностические поля еще не доступны для функции соединения. Вы можете начать вызов **S'LGetDiagField** для диагностических полей для конкретных драйверов только после того, как вы сделали еще один вызов функции ODBC после функции подключения.  
  
 Большинство ошибок, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] о которых сообщает водитель Native Client ODBC, могут быть эффективно диагностированы, используя только информацию, возвращенную **S'LGetDiagRec.** Однако в некоторых случаях сведения, возвращаемые в специфических для драйвера диагностических полях, важны для диагностирования ошибки. При кодировании обработка ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ODBC для приложений, использующих драйвер Native Client ODBC, рекомендуется также использовать **S'LGetDiagField** для получения по крайней мере SQL_DIAG_SS_MSGSTATE и SQL_DIAG_SS_SEVERITY полей для конкретных драйверов. Если какая-то ошибка может быть вызвана в нескольких местах кода [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], то SQL_DIAG_SS_MSGSTATE показывает сотруднику отдела службы технической поддержки корпорации Майкрософт, где именно ошибка была вызвана, и это может иногда помочь при диагностике проблемы.  
  
## <a name="see-also"></a>См. также:  
 [Обработка ошибок и сообщений](../../relational-databases/native-client-odbc-error-messages/handling-errors-and-messages.md)  
  
  
