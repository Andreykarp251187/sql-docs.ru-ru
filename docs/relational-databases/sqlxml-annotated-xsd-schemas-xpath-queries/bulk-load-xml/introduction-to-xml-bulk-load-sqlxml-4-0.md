---
title: Общие сведения о массовой загрузки XML (SQLXML 4.0) | Документация Майкрософт
ms.custom: ''
ms.date: 03/17/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: xml
ms.topic: reference
helpviewer_keywords:
- nontransacted XML Bulk Load operations
- XML Bulk Load [SQLXML], about XML Bulk Load
- bulk load [SQLXML], about bulk load
- transacted XML Bulk Load operations
- streaming XML data
ms.assetid: 38bd3cbd-65ef-4c23-9ef3-e70ecf6bb88a
author: MightyPen
ms.author: genemi
monikerRange: =azuresqldb-current||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: 4c00dc0f155ed79cddd715aad96238cfe8723a10
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68046552"
---
# <a name="introduction-to-xml-bulk-load-sqlxml-40"></a>Введение в массовую загрузку XML (SQLXML 4.0)
[!INCLUDE[appliesto-ss-asdb-xxxx-xxx-md](../../../includes/appliesto-ss-asdb-xxxx-xxx-md.md)]
  Массовая загрузка XML является изолированным объектом COM, который позволяет загрузить частично структурированные XML-данные в таблицы Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
 Можно вставить XML-данные в базу данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] при помощи инструкции INSERT и функции OPENXML, однако программа массовой загрузки обладает более высокой производительностью, если нужно вставить большие объемы XML-данных.  
  
 Метод Execute модели объектов массовой загрузки XML принимает два параметра:  
  
-   Схема XSD (XML Schema definition) с заметками или схема XDR (XML-Data Reduced) с заметками. Программа массовой загрузки XML интерпретирует эту схему сопоставления и заметки, которые указаны в схеме, при идентификации таблиц SQL Server, в которые XML-данные будут вставлены.  
  
-   XML-документ или фрагмент документа (фрагмент документа — это документ, в котором элемент верхнего уровня может быть не единственным). Может быть указано имя файла или поток, из которого массовая загрузка XML может читать.  
  
 Массовая загрузка XML интерпретирует схему сопоставления и указывает таблицу или таблицы, в которые будут вставлены XML-данные.  
  
 Предполагается, что читатель знаком со следующими функциями [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
-   Схемы XSD и XDR с заметками. Дополнительные сведения о схемах XSD с заметками см. в разделе [введение в схемы XSD с заметками &#40;SQLXML 4.0&#41;](../../../relational-databases/sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md). Сведения о схемах XDR с заметками, см. в разделе [схемы XDR с заметками &#40;в SQLXML 4.0&#41;](../../../relational-databases/sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).  
  
-   Механизмы массовой вставки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], такие как инструкция [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT и программа bcp. Дополнительные сведения см. в разделе [BULK INSERT &#40;Transact-SQL&#41; ](../../../t-sql/statements/bulk-insert-transact-sql.md) и [служебная программа bcp](../../../tools/bcp-utility.md).  
  
## <a name="streaming-of-xml-data"></a>Потоковая передача XML-данных  
 Так как исходный XML-документ может быть большого размера, для обработки массовой загрузки целый документ не читается в память. Вместо этого массовая загрузка XML интерпретирует XML-данные как поток и читает. После того как программа прочитает данные, она идентифицирует таблицу базы данных, создает соответствующую запись из источника XML-данных, а затем отправляет запись [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для вставки.  
  
 Например, следующий исходный XML-документ состоит из  **\<клиента >** элементов и  **\<порядок >** дочерние элементы:  
  
```  
<Customer ...>  
    <Order.../>  
    <Order .../>  
     ...  
</Customer>  
...  
```  
  
 Как Массовая загрузка XML считывает  **\<клиента >** элемент, она создает запись для Customertable. При чтении  **\</Customer >** закрывающего тега, Массовая загрузка XML выставляет запись в таблицу в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. В том же способом, при чтении  **\<порядок >** элемент, Массовая загрузка XML формирует запись для таблице Ordertable, а затем вставляет эту запись в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] таблицу при чтении  **\< / Order >** закрывающего тега.  
  
## <a name="transacted-and-nontransacted-xml-bulk-load-operations"></a>Транзакционные и нетранзакционные операции массовой загрузки XML  
 Массовая загрузка XML может работать в транзакционном и нетранзакционном режимах. Производительность обычно оптимальна, если вы являетесь массовую загрузку в нетранзакционном режиме: то есть свойство Transaction присвоено значение FALSE) и выполняется одно из следующих условий:  
  
-   Таблицы, в которые происходит массовая загрузка данных, пусты и не имеют индексов.  
  
-   Таблицы содержат данные и имеют уникальные индексы.  
  
 Нетранзакционный подход не гарантирует возможности отката, если в процессе массовой загрузки что-то пойдет не так (также могут случаться частичные откаты). Нетранзакционная массовая загрузка подходит, если база данных пуста. В этом случае, если что-то пошло не так, можно очистить базу данных и начать массовую загрузку XML заново.  
  
> [!NOTE]  
>  В нетранзакционном режиме массовая загрузка XML использует вложенные внутренние транзакции по умолчанию и фиксирует их. Когда свойство Transaction имеет значение TRUE, Массовая загрузка XML не вызывает фиксацию для этой транзакции.  
  
 Если свойство Transaction имеет значение TRUE, Массовая загрузка XML создает временные файлы, по одному для каждой таблицы, который определен в схеме сопоставления. Массовая загрузка XML сначала поместит записи из исходного XML-документа в эти временные файлы. Затем инструкция [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT получит эти записи из файлов и поместит их в соответствующие таблицы. Можно указать расположение этих временных файлов, используя свойство TempFilePath. Следует убедиться, что у учетной записи [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], используемой в массовой загрузке XML, есть доступ к этому пути. Если свойство TempFilePath не указано, который указан в переменной среды TEMP путь к файлу по умолчанию используется для создания временных файлов.  
  
 Если свойство транзакции является значение FALSE (по умолчанию), Массовая загрузка XML использует интерфейс OLE DB интерфейса IRowsetFastLoad для массовой загрузки данных.  
  
 Если в свойстве ConnectionString задает строку подключения, и свойство Transaction имеет значение TRUE, Массовая загрузка работает в своем собственном контексте транзакции. (Например, массовая загрузка XML начинает собственную транзакцию и фиксирует изменения или при необходимости производит откат.)  
  
 Если свойство ConnectionCommand устанавливает соединение с существующий объект соединения и свойство Transaction имеет значение TRUE, Массовая загрузка XML не выдает инструкции COMMIT или ROLLBACK в случае успеха или сбоя, соответственно. Если происходит ошибка, массовая загрузка XML возвращает соответствующее сообщение об ошибке. Решение об использовании инструкции COMMIT или ROLLBACK остается за клиентом, который инициировал массовую загрузку. Объект соединения, который используется для массовой загрузки XML должен быть типа ICommand или объектом команды ADO.  
  
 В SQLXML 4.0 ConnectionObject не может использоваться со свойством транзакции, имеющим значение FALSE. Нетранзакционный режим не поддерживается с ConnectionObject, так как невозможно открыть более чем одного интерфейса IRowsetFastLoad на переданный сеанс.  
  
  
