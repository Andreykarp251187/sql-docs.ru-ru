---
title: CLR Интеграция Код Безопасности доступа (ru) Документы Майкрософт
description: Для интеграции S'L Server CLR CLR CLR поддерживает безопасность доступа к кодам для управляемого кода, где разрешения предоставляются сборкам на основе идентирования кода.
ms.custom: ''
ms.date: 03/17/2017
ms.prod: sql
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
helpviewer_keywords:
- UNSAFE assemblies
- permissions [CLR integration]
- common language runtime [SQL Server], security
- SAFE assemblies
- code access security [CLR integration]
- EXTERNAL_ACCESS assemblies
ms.assetid: 2111cfe0-d5e0-43b1-93c3-e994ac0e9729
author: rothja
ms.author: jroth
ms.openlocfilehash: 912db3acb6f6dc21952e99da31a1484a9745ed0b
ms.sourcegitcommit: b2cc3f213042813af803ced37901c5c9d8016c24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81488328"
---
# <a name="clr-integration-code-access-security"></a>Управление доступом для кода на основе интеграции со средой CLR
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  Среда CLR поддерживает модель безопасности, называемую управлением доступом для кода. В этой модели разрешения предоставляются сборкам на основе идентификатора кода. Дополнительные сведения см. в разделе «Управление доступом для кода» справочной документации пакета средств разработки программного обеспечения .NET Framework.  
  
 Политика безопасности, которая регламентирует разрешения, предоставляемые сборкам, определяется в трех разных местах.  
  
-   Политика машины: Это политика, действия для всех управляемых [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] кода, работающих в машине, на которой установлен.  
  
-   Политика пользователя: Это политика, внедряемая для управляемого кода, размещенного в процессе. Для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] применяемая политика пользователя зависит от учетной записи Windows, от имени которой работает служба [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
-   Политика хоста: Это политика, созданная хостом CLR [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)](в данном случае), которая действует для управляемого кода, работаемого в этом узлах.  
  
 Механизм управления доступом к коду, поддерживаемый средой CLR, основан на предположении, что в среде времени выполнения может размещаться код, доверенный полностью или частично. Ресурсы, защищаемые механизмом защиты доступа к коду платформы .NET Framework, обычно окружены оболочкой API-интерфейсов управляемого кода, которые предоставляют доступ к ресурсу только после получения соответствующего разрешения. Требование разрешения удовлетворяется только в том случае, если все вызывающие элементы (на уровне сборки) в стеке вызовов обладают соответствующими ресурсными разрешениями.  
  
 Набор разрешений CAS, которые предоставляются управляемому коду при его выполнении в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], является пересечением наборов разрешений, предоставляемых на трех указанных уровнях политики. Даже если [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляет ряд разрешений сборке, загруженной в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], в конечном итоге набор разрешений, которые предоставлены пользовательскому коду, может быть подвергнут дальнейшему сокращению с учетом политик, заданных на уровне пользователя и компьютера.  
  
## <a name="sql-server-host-policy-level-permission-sets"></a>Наборы разрешений на уровне политики узла SQL Server  
 Набор разрешений CAS, который предоставляется определяемым пользователем сборкам на уровне политики узла [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], определяется набором разрешений, заданным при создании сборки. Существует три набора разрешений: **SAFE,** **EXTERNAL_ACCESS** и **UNSAFE** (указано с использованием **PERMISSION_SET** [варианта CREATE ASSEMBLY &#40;&#41;Transact-S'L). ](../../../t-sql/statements/create-assembly-transact-sql.md)  
  
 Среде CLR, размещенной в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], предоставляется уровень политики безопасности на уровне сервера; данная политика представляет собой дополнительный уровень политики, расположенный ниже двух всегда действующих уровней политики. Данная политика задается для каждого домена приложений, создаваемого службами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Эта политика не предназначена для домена приложения по умолчанию, который применяется при создании в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] экземпляра среды CLR.  
  
 Политика на уровне узла служб [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] является сочетанием фиксированной политики служб [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для системных сборок и пользовательской политики для пользовательских сборок.  
  
 Фиксированная политика для сборок CLR и системных сборок [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляет этим сборкам полное доверие.  
  
 В основе пользовательской части политики сервера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] лежит указание владельцем сборки одного из трех сегментов разрешений для каждой сборки. Дополнительные сведения о правах доступа, перечисленных ниже, см. в документации пакета SDK для платформы .NET Framework.  
  
### <a name="safe"></a>SAFE  
 Разрешаются только внутренние вычисления и локальный доступ к данным. **SAFE** является самым ограничительным набором разрешений. Код, выполняемый сборкой с разрешениями **SAFE,** не может получить доступ к внешним системным ресурсам, таким как файлы, сеть, переменные среды или реестр.  
  
 **Сборки SAFE** имеют следующие разрешения и значения:  
  
|Разрешение|Значения и описание|  
|----------------|-----------------------------|  
|**Разрешение безопасности**|**Исполнение:** Разрешение на выполнение управляемого кода.|  
|**SqlКлиентЫРазрешение**|**Контекстное соединение - истинное,** **контекстное соединение - да**: только контекст-соединение может быть использовано, и строка соединения может указывать только значение "контекстное соединение -истинное" или "контекстное соединение".<br /><br /> **AllowBlankPassword - ложно:**  Пустые пароли не допускаются.|  
  
### <a name="external_access"></a>EXTERNAL_ACCESS  
 EXTERNAL_ACCESS сборки имеют те же разрешения, что и сборки **SAFE,** с дополнительной возможностью доступа к внешним системным ресурсам, таким как файлы, сети, экологические переменные и реестр.  
  
 **EXTERNAL_ACCESS** сборки также имеют следующие разрешения и значения:  
  
|Разрешение|Значения и описание|  
|----------------|-----------------------------|  
|**Распределенноеразрешение транзакций**|**Неограниченное:** Разрешены распределенные транзакции.|  
|**DNSPermission**|**Неограниченное:** Разрешение на запрос информации от серверов доменных имен.|  
|**Окружающая средаРазрешение**|**Неограниченное:** Разрешен полный доступ к переменным системной среды и среды пользователя.|  
|**EventLogPermission**|**Администрирование:** Разрешены следующие действия: создание источника событий, чтение существующих журналов, исключение источников событий или журналов, ответы на записи, очистка журнала событий, прослушивание событий и доступ к коллекции всех журналов событий.|  
|**FileIOPermission**|**Неограниченное:** Разрешен полный доступ к файлам и папкам.|  
|**KeyContainerPermission**|**Неограниченное:** Разрешен полный доступ к ключевым контейнерам.|  
|**СетьИнформационноеразрешение**|**Доступ:** Допускается пинг.|  
|**РегистрацияРазрешение**|Позволяет читать права на **HKEY_CLASSES_ROOT,** **HKEY_LOCAL_MACHINE,** **HKEY_CURRENT_USER,** **HKEY_CURRENT_CONFIG,** и **HKEY_USERS.**|  
|**Разрешение безопасности**|**Утверждение:** Возможность утверждать, что все абоненты этого кода имеют необходимое разрешение на операцию.<br /><br /> **КонтрольДиректор:** Возможность манипулировать основным объектом.<br /><br /> **Исполнение:** Разрешение на выполнение управляемого кода.<br /><br /> **СериализацияФорстомтер:** Возможность предоставления услуг сериализации.|  
|**SmtpPermission**|**Доступ:** Разрешено исходящие соединения с портом-хозяином SMTP 25.|  
|**Разносе**|**Подключение:** Разрешены исходящие соединения (все порты, все протоколы) по транспортному адресу.|  
|**SqlКлиентЫРазрешение**|**Неограниченное:** Разрешен полный доступ к источнику данных.|  
|**ХранениеРазрешение**|**Неограниченное:** Разрешен полный доступ к сертификатам X.509.|  
|**Веб-позволение**|**Подключение:** Разрешены исходящие подключения к веб-ресурсам.|  
  
### <a name="unsafe"></a>UNSAFE  
 Набор UNSAFE предоставляет сборкам неограниченный доступ к внутренним и внешним ресурсам [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Выполнение кода из сборки **UNSAFE** также может вызывать неуправляемый код.  
  
 **Сборки UNSAFE** предоставляются **FullTrust**.  
  
> [!IMPORTANT]  
>  **SAFE** — рекомендуемая настройка разрешения для сборок, выполняющих задачи вычислений [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]и управления данными без доступа к ресурсам за пределами. **EXTERNAL_ACCESS** рекомендуется для сборок, которые [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]получают доступ к ресурсам за пределами. **EXTERNAL_ACCESS** сборки по умолчанию [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] выполняются как учетная запись службы. Возможно, **EXTERNAL_ACCESS** код явно выдает себя за контекст безопасности windows Authentication вызываемого абонента. Поскольку значение по умолчанию выполняется как учетная запись [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] службы, разрешение на выполнение **EXTERNAL_ACCESS** должно быть дано только входам, которым доверяют выполнять сяврчатую учетную запись службы. С точки зрения безопасности сборки **EXTERNAL_ACCESS** и **UNSAFE** идентичны. Однако **EXTERNAL_ACCESS** сборки обеспечивают различную надежность и надежность защиты, которые не входят в сборки **UNSAFE.** Указание **UNSAFE** позволяет коду в сборке выполнять [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] незаконные операции против пространства процесса, и, следовательно, потенциально может поставить под угрозу надежность и масштабируемость [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Для получения дополнительной информации о создании [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]сборки CLR в , см. [Managing CLR Integration Assemblies](../../../relational-databases/clr-integration/assemblies/managing-clr-integration-assemblies.md)  
  
## <a name="accessing-external-resources"></a>Доступ к внешним ресурсам  
 Если пользовательский тип (UDT), сохраненная процедура или другой тип сборки конструкции зарегистрированы с набором разрешений **SAFE,** то управляемый код, исполняющий в конструкции, не может получить доступ к внешним ресурсам. Однако, если указаны наборы разрешений **EXTERNAL_ACCESS** или **UNSAFE** и [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] управляемый код пытается получить доступ к внешним ресурсам, применяются следующие правила:  
  
|Если|То|  
|--------|----------|  
|Контекст выполнения соответствует имени входа [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].|Попытки получить доступ к внешним ресурсам отклоняются, и активизируется исключение безопасности.|  
|Контекст выполнения соответствует имени входа Windows, и контекстом выполнения является первоначальный вызывающий объект.|Доступ к внешнему ресурсу предоставляется в контексте безопасности учетной записи [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].|  
|Вызывающий объект не является первоначальным вызывающим объектом.|Доступ запрещается, и активизируется исключение безопасности.|  
|Контекст выполнения соответствует имени входа Windows, контекст выполнения является исходным вызывающим объектом, а к вызывающему объекту применяется олицетворение.|При доступе используется контекст безопасности вызывающего объекта, а не учетная запись службы.|  
  
## <a name="permission-set-summary"></a>Сводные данные о наборе разрешений  
 На следующей диаграмме кратко излагаются ограничения и разрешения, выданные **SAFE,** **EXTERNAL_ACCESS**и наборы разрешений **UNSAFE.**  
  
|||||  
|-|-|-|-|  
||**SAFE**|**EXTERNAL_ACCESS**|**Небезопасных**|  
|**Разрешения на доступ к коду**|Только выполнение|Выполнение и доступ к внешним ресурсам|Неограниченное (включая P/Invoke)|  
|**Ограничения модели программирования**|Да|Да|Без ограничений|  
|**Требование к проверяемости**|Да|Да|нет|  
|**Локальный доступ к данным**|Да|Да|Да|  
|**Возможность вызова машинного кода**|нет|нет|Да|  
  
## <a name="see-also"></a>См. также:  
 [Интеграционная безопасность CLR](../../../relational-databases/clr-integration/security/clr-integration-security.md)   
 [Атрибуты защиты хоста и программирование интеграции CLR](../../../relational-databases/clr-integration-security-host-protection-attributes/host-protection-attributes-and-clr-integration-programming.md)   
 [ClR Интеграция Программирование Модель Ограничения](../../../relational-databases/clr-integration/database-objects/clr-integration-programming-model-restrictions.md)   
 [Среда размещения CLR](../../../relational-databases/clr-integration/clr-integration-architecture-clr-hosted-environment.md)  
  
  
