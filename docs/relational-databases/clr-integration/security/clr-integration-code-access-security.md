---
title: CLR Integration Code Access Security | Документация Майкрософт
ms.custom: ''
ms.date: 03/17/2017
ms.prod: sql
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
helpviewer_keywords:
- UNSAFE assemblies
- permissions [CLR integration]
- common language runtime [SQL Server], security
- SAFE assemblies
- code access security [CLR integration]
- EXTERNAL_ACCESS assemblies
ms.assetid: 2111cfe0-d5e0-43b1-93c3-e994ac0e9729
author: rothja
ms.author: jroth
ms.openlocfilehash: f49968392dd813b48f43e5e63586fd0c6bec71d8
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68118519"
---
# <a name="clr-integration-code-access-security"></a>Управление доступом для кода на основе интеграции со средой CLR
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  Среда CLR поддерживает модель безопасности, называемую управлением доступом для кода. В этой модели разрешения предоставляются сборкам на основе идентификатора кода. Дополнительные сведения см. в разделе «Управление доступом для кода» справочной документации пакета средств разработки программного обеспечения .NET Framework.  
  
 Политика безопасности, которая регламентирует разрешения, предоставляемые сборкам, определяется в трех разных местах.  
  
-   Политики компьютера: Это политика действует для всего управляемого кода, выполняющихся на машине, на котором [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] установлен.  
  
-   Политика для пользователя: Это политика действует для управляемого кода, выполняемый в рамках процесса. Для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] применяемая политика пользователя зависит от учетной записи Windows, от имени которой работает служба [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
-   Политика для узла: Это политика, Настройка узлом среды CLR (в этом случае [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]), распространяется на управляемый код, выполняемый на узле.  
  
 Механизм управления доступом к коду, поддерживаемый средой CLR, основан на предположении, что в среде времени выполнения может размещаться код, доверенный полностью или частично. Ресурсы, которые защищены с помощью управления доступом для кода среды CLR, обычно заключаются в оболочку управляемого API-интерфейсы, которые требуют соответствующих разрешений перед предоставлением ему доступа к ресурсу. Требование разрешения удовлетворяется только в том случае, если все вызывающие элементы (на уровне сборки) в стеке вызовов обладают соответствующими ресурсными разрешениями.  
  
 Набор разрешений CAS, которые предоставляются управляемому коду при его выполнении в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], является пересечением наборов разрешений, предоставляемых на трех указанных уровнях политики. Даже если [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляет ряд разрешений сборке, загруженной в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], в конечном итоге набор разрешений, которые предоставлены пользовательскому коду, может быть подвергнут дальнейшему сокращению с учетом политик, заданных на уровне пользователя и компьютера.  
  
## <a name="sql-server-host-policy-level-permission-sets"></a>Наборы разрешений на уровне политики узла SQL Server  
 Набор разрешений CAS, который предоставляется определяемым пользователем сборкам на уровне политики узла [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], определяется набором разрешений, заданным при создании сборки. Существует три набора разрешений: **БЕЗОПАСНЫЙ**, **EXTERNAL_ACCESS** и **UNSAFE** (указанный с помощью **PERMISSION_SET** параметр [CREATE ASSEMBLY &#40; Transact-SQL&#41;](../../../t-sql/statements/create-assembly-transact-sql.md)).  
  
 Среде CLR, размещенной в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], предоставляется уровень политики безопасности на уровне сервера; данная политика представляет собой дополнительный уровень политики, расположенный ниже двух всегда действующих уровней политики. Данная политика задается для каждого домена приложений, создаваемого службами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Эта политика не предназначена для домена приложения по умолчанию, который применяется при создании в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] экземпляра среды CLR.  
  
 Политика на уровне узла служб [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] является сочетанием фиксированной политики служб [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для системных сборок и пользовательской политики для пользовательских сборок.  
  
 Фиксированная политика для сборок CLR и системных сборок [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляет этим сборкам полное доверие.  
  
 В основе пользовательской части политики сервера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] лежит указание владельцем сборки одного из трех сегментов разрешений для каждой сборки. Дополнительные сведения о правах доступа, перечисленных ниже, см. в документации пакета SDK для платформы .NET Framework.  
  
### <a name="safe"></a>SAFE  
 Разрешаются только внутренние вычисления и локальный доступ к данным. **БЕЗОПАСНЫЙ** является наиболее ограниченным набором разрешений. Код, выполняемый сборкой с **БЕЗОПАСНОМ** разрешений не может получить доступ к внешним системным ресурсам — файлам, сети, переменные среды или реестр.  
  
 **БЕЗОПАСНЫЙ** сборки имеют следующие разрешения и значения:  
  
|Разрешение|Значения и описание|  
|----------------|-----------------------------|  
|**SecurityPermission**|**Выполнение:** Разрешение на выполнение управляемого кода.|  
|**Разрешение SQL-клиента**|**Контекстное соединение = true**, **контекстное соединение = yes**: Только контекстное соединение может использоваться и строку подключения можно указать только значение «Контекстное соединение = true» или «контекстное соединение = yes».<br /><br /> **AllowBlankPassword = false:**  Пустые пароли не допускаются.|  
  
### <a name="externalaccess"></a>EXTERNAL_ACCESS  
 Сборки EXTERNAL_ACCESS имеют те же разрешения, что **БЕЗОПАСНОМ** сборки, с дополнительными возможностями для доступа к внешним системным ресурсам, например файлы, сети, переменные среды и реестр.  
  
 **EXTERNAL_ACCESS** сборки также имеют следующие разрешения и значения:  
  
|Разрешение|Значения и описание|  
|----------------|-----------------------------|  
|**DistributedTransactionPermission**|**Неограниченный доступ:** Распределенные транзакции допускаются.|  
|**DNSPermission**|**Неограниченный доступ:** Разрешение на запрос сведений с DNS-серверов.|  
|**EnvironmentPermission**|**Неограниченный доступ:** Разрешен полный доступ к системным и пользовательским переменным среды.|  
|**EventLogPermission**|**Администрирование:** Разрешаются следующие действия: Создание источника событий, чтение существующих журналов, удаление источников событий или журналов, формирование ответов на записи, очистка журнала событий, прослушивание событий и доступ к коллекции всех журналов событий.|  
|**FileIOPermission**|**Неограниченный доступ:** Разрешен полный доступ к файлам и папкам.|  
|**KeyContainerPermission**|**Неограниченный доступ:** Разрешен полный доступ к контейнерам ключей.|  
|**NetworkInformationPermission**|**Доступ:** Разрешено выполнять команду ping.|  
|**RegistryPermission**|Предоставляет право чтения разделов для **HKEY_CLASSES_ROOT**, **HKEY_LOCAL_MACHINE**, **HKEY_CURRENT_USER**, **HKEY_CURRENT_CONFIG**и  **HKEY_USERS.**|  
|**SecurityPermission**|**Проверочное утверждение:** Способность подтверждать, что все объекты, вызывающие этого кода имеют необходимое разрешение для операции.<br /><br /> **ControlPrincipal:** Возможность управлять объектом участника.<br /><br /> **Выполнение:** Разрешение на выполнение управляемого кода.<br /><br /> **SerializationFormatter:** Возможность предоставления служб сериализации.|  
|**SmtpPermission**|**Доступ:** Разрешены исходящие соединения с портом сервера SMTP 25.|  
|**SocketPermission**|**Подключение:** Разрешены исходящие соединения (все порты, все протоколы) для адреса транспорта.|  
|**Разрешение SQL-клиента**|**Неограниченный доступ:** Разрешен полный доступ к источнику данных.|  
|**StorePermission**|**Неограниченный доступ:** Разрешен полный доступ к хранилищу сертификатов X.509.|  
|**WebPermission**|**Подключение:** Разрешены исходящие соединения для веб-ресурсов.|  
  
### <a name="unsafe"></a>UNSAFE  
 Набор UNSAFE предоставляет сборкам неограниченный доступ к внутренним и внешним ресурсам [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Код, исполняемый внутри **UNSAFE** сборки также может вызывать неуправляемый код.  
  
 **НЕБЕЗОПАСНЫЙ** сборки, получающие **FullTrust**.  
  
> [!IMPORTANT]  
>  **БЕЗОПАСНЫЙ** является рекомендованной установкой разрешений для сборок, которые выполняют задачи вычисления и данных управления без доступа к ресурсам за пределами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. **EXTERNAL_ACCESS** рекомендуется для сборок, которые обращаются к ресурсам за пределами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. **EXTERNAL_ACCESS** сборки по умолчанию, выполняются как [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] учетной записи службы. Существует возможность **EXTERNAL_ACCESS** кода можно явно применять олицетворение контекста безопасности вызывающего объекта проверки подлинности Windows. Поскольку по умолчанию для выполнения в качестве [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] учетная запись службы, разрешение на выполнение **EXTERNAL_ACCESS** должно предоставляться только именам входа, которым доверено выполнение в качестве учетной записи службы. С точки зрения безопасности **EXTERNAL_ACCESS** и **UNSAFE** сборки идентичны. Тем не менее **EXTERNAL_ACCESS** сборки обеспечивают различные надежные и устойчивые средства защиты, не входящие в **UNSAFE** сборок. Указание **UNSAFE** позволяет коду в сборке выполнять запрещенные операции [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] пространстве процесса и таким образом можно нарушать устойчивость и масштабируемость [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Дополнительные сведения о создании сборок CLR в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], см. в разделе [Управление сборками интеграции со средой CLR](../../../relational-databases/clr-integration/assemblies/managing-clr-integration-assemblies.md).  
  
## <a name="accessing-external-resources"></a>Доступ к внешним ресурсам  
 Если зарегистрирован определяемого пользователем типа (UDT), хранимой процедуры или другой тип сборки конструкция **БЕЗОПАСНОМ** набор разрешений, то управляемый код выполняется в конструкции не способен получить доступ к внешним ресурсам. Тем не менее если параметр **EXTERNAL_ACCESS** или **UNSAFE** указываются наборы разрешений и управляемом коде предпринимается попытка доступа к внешним ресурсам [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] применяются следующие правила:  
  
|Если оператор|То|  
|--------|----------|  
|Контекст выполнения соответствует имени входа [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].|Попытки получить доступ к внешним ресурсам отклоняются, и активизируется исключение безопасности.|  
|Контекст выполнения соответствует имени входа Windows, и контекстом выполнения является первоначальный вызывающий объект.|Доступ к внешнему ресурсу предоставляется в контексте безопасности учетной записи [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].|  
|Вызывающий объект не является первоначальным вызывающим объектом.|Доступ запрещается, и активизируется исключение безопасности.|  
|Контекст выполнения соответствует имени входа Windows, контекст выполнения является исходным вызывающим объектом, а к вызывающему объекту применяется олицетворение.|При доступе используется контекст безопасности вызывающего объекта, а не учетная запись службы.|  
  
## <a name="permission-set-summary"></a>Сводные данные о наборе разрешений  
 На следующей диаграмме показаны ограничения и разрешения, предоставленные **БЕЗОПАСНОМ**, **EXTERNAL_ACCESS**, и **UNSAFE** наборы разрешений.  
  
|||||  
|-|-|-|-|  
||**SAFE**|**EXTERNAL_ACCESS**|**UNSAFE**|  
|**Разрешения управления доступом для кода**|Только выполнение|Выполнение и доступ к внешним ресурсам|Неограниченное (включая P/Invoke)|  
|**Ограничения модели программирования**|Да|Да|Без ограничений|  
|**Требование к проверяемости**|Да|Да|Нет|  
|**Доступ к локальным данным**|Да|Да|Да|  
|**Возможность вызова машинного кода**|Нет|Нет|Да|  
  
## <a name="see-also"></a>См. также  
 [Безопасность интеграции со средой CLR](../../../relational-databases/clr-integration/security/clr-integration-security.md)   
 [Атрибуты защиты узла и программирование интеграции со средой CLR](../../../relational-databases/clr-integration-security-host-protection-attributes/host-protection-attributes-and-clr-integration-programming.md)   
 [Ограничения модели программирования интеграции со средой CLR](../../../relational-databases/clr-integration/database-objects/clr-integration-programming-model-restrictions.md)   
 [Среда размещения CLR](../../../relational-databases/clr-integration/clr-integration-architecture-clr-hosted-environment.md)  
  
  
