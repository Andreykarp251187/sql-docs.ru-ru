---
title: Обработка множественных шагов задания | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: sql-tools
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- job steps [SQL Server Agent]
- ordering job steps [SQL Server]
- multiple job steps
- SQL Server Agent jobs, job steps
- control of flow for jobs [SQL Server]
ms.assetid: 7aba19ff-72b3-45f6-8e54-23f4988d63a8
author: markingmyname
ms.author: maghan
monikerRange: = azuresqldb-mi-current || >= sql-server-2016 || = sqlallproducts-allversions
ms.openlocfilehash: 800318df9945b674f3e0777f6c53b67b71ba61a9
ms.sourcegitcommit: e7d921828e9eeac78e7ab96eb90996990c2405e9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/16/2019
ms.locfileid: "68262397"
---
# <a name="handle-multiple-job-steps"></a>Обработка множественных шагов задания
[!INCLUDE[appliesto-ss-asdbmi-xxxx-xxx-md](../../includes/appliesto-ss-asdbmi-xxxx-xxx-md.md)]

> [!IMPORTANT]  
> Сейчас в [управляемом экземпляре базы данных SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance) поддерживается большинство функций агента SQL Server (но не все). Подробные сведения см. в статье [Различия T-SQL между управляемым экземпляром базы данных SQL Azure и SQL Server](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance-transact-sql-information#sql-server-agent).

Если в задании содержится более одного шага, необходимо указать порядок выполнения шагов задания. Это называется *управлением потоком*. Добавить новые шаги задания и реорганизовать поток шагов задания можно в любое время; изменения вступают в силу при следующем выполнении задания. На этой иллюстрации показано управление потоком для задания резервного копирования базы данных.  
  
![Управление потоком шагов заданий агента SQL Server](../../ssms/agent/media/dbflow01.gif "Управление потоком шагов заданий агента SQL Server")  
  
Первый шаг — это создание резервной копии базы данных. Если этот шаг завершается ошибкой, агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] сообщает о сбое оператору, назначенному для получения уведомления. Если шаг создания резервной копии базы данных завершается успешно, выполнение задания переходит к следующему шагу — «очистке» данных заказчика. Если этот шаг завершается ошибкой, агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] пропускает его и переходит сразу к шагу восстановления базы данных. Если «очистка» данных заказчика завершается успешно, выполнение задания переходит к следующему шагу — обновлению статистики, и так далее, до тех пор, пока в результате выполнения последнего шага не будет выдан отчет об успешном или неудачном завершении.  
  
Пользователь определяет действие управления потоком на случай успешного или неудачного завершения каждого из шагов задания. Необходимо указать действие, которое предпринимается, когда шаг задания завершается успешно, и действие, предпринимаемое в случае неудачного завершения шага. Можно также задать число повторных попыток для неудачно завершенных шагов задания и интервал между повторными попытками.  
  
> [!NOTE]  
> Если в графическом пользовательском интерфейсе (GUI) агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] удалить один или нескольких шагов из многошагового задания, то GUI удаляет все шаги задания, а затем вновь добавляет остающиеся шаги с исправленными ссылками для успешного и ошибочного завершения. Предположим, что имеется задание из пяти шагов, и первый шаг сконфигурирован так, что в случае его успешного завершения задание переходит на шаг 4. Если удалить шаг 3, GUI удаляет все остальные шаги этого задания и добавляет остающиеся четыре шага (1, 2, 4 и 5) с исправленными ссылками. В этом случае ссылка на шаге 1 будет перенастроена для перехода на шаг 3, если шаг 1 завершается успешно.  
  
Шаги задания должны быть автономными. Это значит, что задание не может передавать логические значения, данные или числовые значения между шагами задания. Однако можно передавать значения из одного шага задания [!INCLUDE[tsql](../../includes/tsql-md.md)] в другой с помощью постоянных таблиц или глобальных временных таблиц. Можно передавать значения между шагами задания, в которых запускаются исполняемые программы, с помощью файлов. Например, исполняемая программа, выполняемая на одном шаге задания, записывает файл, а программа, выполняемая на последующем шаге, считывает файл.  
  
> [!NOTE]  
> Если создаются задания с циклическими шагами (за шагом 1 следует шаг 2, затем шаг 2 возвращается к шагу 1), то при создании задания с использованием среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]выдается предупреждающее сообщение.  
  
[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Агент записывает сведения о задании и шагах задания в журнал заданий.  
  
## <a name="see-also"></a>См. также:  
[sp_add_job](../../relational-databases/system-stored-procedures/sp-add-job-transact-sql.md)  
[sysjobhistory](../../relational-databases/system-tables/dbo-sysjobhistory-transact-sql.md)  
[sysjobs (Transact-SQL)](https://msdn.microsoft.com/e244a6a5-54c2-47a6-8039-dd1852b0ae59)  
[sysjobsteps](../../relational-databases/system-tables/dbo-sysjobsteps-transact-sql.md)  
[Реализация заданий](../../ssms/agent/implement-jobs.md)  
[Управление шагами задания](../../ssms/agent/manage-job-steps.md)  
  
