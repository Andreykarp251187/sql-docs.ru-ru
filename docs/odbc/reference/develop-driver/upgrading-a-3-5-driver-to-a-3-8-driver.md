---
title: Обновление драйвера 3,5 до драйвера 3,8 | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
ms.assetid: ffba36ac-d22e-40b9-911a-973fa9e10bd3
author: MightyPen
ms.author: genemi
ms.openlocfilehash: 97b100b1ade97e1e88cf1421f09a7723412c8b76
ms.sourcegitcommit: 4baa8d3c13dd290068885aea914845ede58aa840
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79289802"
---
# <a name="upgrading-a-35-driver-to-a-38-driver"></a>Обновление драйвера с версии 3.5 до 3.8
В этом разделе приводятся рекомендации и рекомендации по обновлению драйвера ODBC 3,5 до драйвера ODBC 3,8.  
  
##### <a name="version-numbers"></a>Номера версий  
 Следующие рекомендации относятся к номерам версий.  
  
-   Драйвер должен поддерживать SQL_OV_ODBC3_80 для SQL_ATTR_ODBC_VERSION, возвращая SQL_ERROR для значений, отличных от SQL_OV_ODBC2, SQL_OV_ODBC3 и SQL_OV_ODBC3_80. В будущих версиях диспетчера драйверов предполагается, что драйвер поддерживает уровень совместимости ODBC, если драйвер возвращает SQL_SUCCESS из [функции SQLSetEnvAttr](../../../odbc/reference/syntax/sqlsetenvattr-function.md).  
  
-   Драйвер версии 3,8 должен возвращать 03,80 из **SQLGetInfo** при передаче SQL_DRIVER_ODBC_VER в *инфотипе*. Однако старые диспетчеры драйверов, включенные в более старые версии Microsoft Windows, будут рассматривать драйвер как драйвер версии 3,5 и выдавать предупреждение.  
  
     В Windows 7 версия диспетчера драйверов — 03,80. В Windows 8 версия диспетчера драйверов 03,81 через SQL_DM_VER SQLGetInfo (параметр*инфотипе* ). SQL_ODBC_VER выводит версию 03,80 в Windows 7 и Windows 8.  
  
##### <a name="driver-specific-c-data-types"></a>Специфические для драйвера типы данных C  
 Драйвер может иметь настраиваемые типы данных C, если он работает с приложением ODBC версии 3,8. (Дополнительные сведения см. [в разделе Типы данных C в ODBC](../../../odbc/reference/develop-app/c-data-types-in-odbc.md).) Однако драйвер 3,8 не требует реализации каких-либо типов C, относящихся к драйверу. Но драйвер по-прежнему должен выполнять проверку диапазона типов C. Диспетчер драйверов не сделает это для драйверов 3,8. Для упрощения разработки драйверов значение типа данных C, характерное для драйвера, может быть определено в следующем формате:  
  
```  
SQL_DRIVER_C_TYPE_BASE+0, SQL_DRIVER_C_TYPE_BASE+1  
```  
  
##### <a name="driver-specific-data-types-descriptor-types-information-types-diagnostic-types-and-attributes"></a>Специфические для драйвера типы данных, Типы дескрипторов, типы сведений, типы диагностики и атрибуты  
 При разработке нового драйвера следует использовать диапазон, зависящий от драйвера, для типов данных, типов дескрипторов, типов сведений, типов диагностики и атрибутов. Диапазоны, зависящие от драйвера, и их значения базового типа обсуждаются в [типах данных, типов дескрипторов, типах сведений, типах диагностики и атрибутах, связанных с драйверами](../../../odbc/reference/develop-app/driver-specific-data-types-descriptor-information-diagnostic.md).  
  
##### <a name="connection-pooling"></a>Организация пулов соединений  
 Для лучшего управления пулами подключений в ODBC 3,8 появился атрибут подключения SQL_ATTR_RESET_CONNECTION **SQLSetConnectAttr**. SQL_RESET_CONNECTION_YES является единственным допустимым значением для этого атрибута. SQL_ATTR_RESET_CONNECTION задаются непосредственно перед тем, как диспетчер драйверов помещает подключение в пул соединений, позволяя драйверу сбрасывать другие атрибуты подключения к значениям по умолчанию.  
  
 Чтобы избежать ненужного взаимодействия с сервером, драйвер может отложить сброс атрибута подключения до следующего соединения с удаленным сервером после повторного использования подключения из пула.  
  
 Обратите внимание, что SQL_ATTR_RESET_CONNECTION используется только при обмене данными между диспетчером драйверов и драйвером. Приложение не может задать этот атрибут напрямую. Все драйверы версии 3,8 должны реализовывать этот атрибут соединения.  
  
##### <a name="streamed-output-parameters"></a>Потоковые выходные параметры  
 В ODBC версии 3,8 представлены потоковые выходные параметры, более масштабируемый способ получения выходных параметров. (Дополнительные сведения см. в разделе [получение выходных параметров с помощью SQLGetData](../../../odbc/reference/develop-app/retrieving-output-parameters-using-sqlgetdata.md).) Для поддержки этой функции драйвер должен задать SQL_GD_OUTPUT_PARAMS в возвращаемом значении, когда SQL_GETDATA_EXTENSIONS является *инфотипе* в вызове **SQLGetInfo** . Поддержка типа SQL с потоковыми выходными параметрами должна быть реализована в драйвере. Диспетчер драйверов не выдаст ошибку для недопустимого типа SQL. Типы SQL, поддерживающие потоковые выходные параметры, определены в драйвере.  
  
 Драйвер должен возвращать SQL_ERROR, если приложение использовало **SQLGetData** для получения параметра, который не совпадает с параметром, возвращаемым **метод SQLParamData**.  
  
##### <a name="asynchronous-execution-for-connection-operations-polling-method"></a>Асинхронное выполнение операций соединения (метод опроса)  
 Драйвер может включить асинхронную поддержку для различных операций подключения.  
  
 Начиная с Windows 7, ODBC поддерживает метод опроса (Дополнительные сведения см. в разделе [асинхронное выполнение (метод опроса)](../../../odbc/reference/develop-app/asynchronous-execution-polling-method.md). Драйверу ODBC версии 3,8 не обязательно реализовывать асинхронные операции с дескрипторами соединений. Даже если драйвер не реализует асинхронные операции с дескрипторами соединения, драйвер по-прежнему должен реализовывать SQL_ASYNC_DBC_FUNCTIONS *инфотипе* и возвращать **SQL_ASYNC_DBC_NOT_CAPABLE**.  
  
 При включении асинхронных операций соединения время выполнения операции подключения представляет собой общее время всех повторных вызовов. Если последний повторный вызов происходит после того, как общее время превышает значение, заданное атрибутом подключения SQL_ATTR_CONNECTION_TIMEOUT, а операция не завершена, драйвер возвращает SQL_ERROR и записывает в журнал диагностическую запись с HYT01 SQLState и сообщение "время ожидания подключения истекло". Если операция завершилась, время ожидания не истечет.  
  
##### <a name="sqlcancelhandle-function"></a>Функция SQLCancelHandle  
 ODBC 3,8 поддерживает [функцию склканцелхандле](../../../odbc/reference/syntax/sqlcancelhandle-function.md), которая используется для отмены соединений и операций с инструкциями. Драйвер, поддерживающий **склканцелхандле** , должен экспортировать функцию. Драйвер не должен отменять синхронную или асинхронную функцию подключения, которая выполняется, если приложение вызывает **SQLCancel** или **склканцелхандле** в обработчике инструкций. Аналогичным образом драйвер не должен отменять синхронную или асинхронную функцию инструкции, которая выполняется, если приложение вызывает **склканцелхандле** в обработчике соединения. Кроме того, драйвер не должен отменять операцию обзора (**SQLBrowseConnect** возвращает SQL_NEED_DATA), если приложение вызывает **склканцелхандле** в обработчике соединения. В этих случаях драйвер должен возвращать HY010, «ошибка последовательности функций».  
  
 Не требуется одновременно поддерживать операции **склканцелхандле** и асинхронного подключения. Драйвер может поддерживать асинхронные операции подключения, но не **склканцелхандле**, и наоборот.  
  
##### <a name="suspended-connections"></a>Приостановленные подключения  
 Диспетчер драйверов ODBC 3,8 может перевести подключение в состояние SUSPENDED. Приложение будет вызывать **SQLDisconnect** для освобождения ресурсов, связанных с подключением. В этом случае драйвер должен попытаться освободить как можно больше ресурсов без проверки состояния соединения. Дополнительные сведения о состоянии SUSPENDED см. в разделе [функция SQLEndTran](../../../odbc/reference/syntax/sqlendtran-function.md).  
  
##### <a name="driver-aware-connection-pooling"></a>Организация пулов соединений с учетом драйвера  
 ODBC в Windows 8 позволяет драйверам настраивать поведение пула подключений. Дополнительные сведения см. в статье [Организация пулов соединений с учетом драйверов](../../../odbc/reference/develop-app/driver-aware-connection-pooling.md).  
  
##### <a name="asynchronous-execution-notification-method"></a>Асинхронное выполнение (метод уведомления)  
 ODBC 3,8 поддерживает метод уведомления для асинхронных операций, доступный начиная с Windows 8. Дополнительные сведения см. в разделе [асинхронное выполнение (метод уведомления)](../../../odbc/reference/develop-app/asynchronous-execution-notification-method.md).  
  
## <a name="see-also"></a>См. также:  
 [Разработка драйвера ODBC](../../../odbc/reference/develop-driver/developing-an-odbc-driver.md)   
 [Драйверы ODBC, предоставляемые корпорацией Майкрософт](../../../odbc/microsoft/microsoft-supplied-odbc-drivers.md)   
 [Новые возможности ODBC 3.8](../../../odbc/reference/what-s-new-in-odbc-3-8.md)
