---
title: Подсчет использования | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- usage counts [ODBC]
- file usage counts [ODBC]
- installing ODBC components [ODBC], usage counts
- subkeys [ODBC], usage counts
ms.assetid: 0678aee9-8256-463c-89dd-77b1a0dfdd60
author: MightyPen
ms.author: genemi
ms.openlocfilehash: edf9976dd3e5d890b46919808e896a8e81a0cd93
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "68093793"
---
# <a name="usage-counting"></a>Подсчет использования
> [!NOTE]  
>  Начиная с Windows XP и Windows Server 2003, ODBC входит в операционную систему Windows. Следует явно устанавливать ODBC только в более ранних версиях Windows.  
  
 В реестре для каждого компонента хранятся два типа счетчиков использования: количество используемых компонентов и один или несколько необязательных счетчиков использования файлов. Счетчик использования компонентов помогает библиотеке DLL установщика поддерживать записи реестра. Он хранится в значении Усажекаунт в подразделах ODBC Core, Driver и Translator. Формат значения Усажекаунт и дополнительные сведения об этих подразделах см. в разделе [записи реестра для компонентов ODBC](../../../odbc/reference/install/registry-entries-for-odbc-components.md).  
  
 При первой установке компонента библиотека DLL установщика создает подраздел для него и задает для данных значения Усажекаунт в этом подразделе значение 1. При повторном установке компонента библиотека DLL установщика увеличивает счетчик использования. При удалении компонента библиотека DLL установщика уменьшает счетчик использования. Если счетчик использования попадает в значение 0, то библиотека DLL установщика удаляет подраздел для компонента.  
  
> [!CAUTION]  
>  Приложение не должно физически удалять файлы диспетчера драйверов, если счетчик использования компонента и число использований файлов достигли нуля.  
  
 Счетчики использования файлов помогают определить, когда файл должен быть фактически скопирован или удален, в отличие от увеличения или уменьшения счетчика использования. Это важно, поскольку компоненты ODBC, а значит, файлы в компонентах ODBC являются общими и могут быть установлены или удалены различными приложениями. Приложение может удалять файлы драйверов и переводчиков, если количество используемых компонентов и количество использованных файлов достигли нуля. Однако файлы диспетчера драйверов не должны удаляться, если счетчик использования компонентов и счетчик использования файлов достигли нуля, так как эти файлы могут использоваться другими приложениями, которые не увеличивают счетчик использования файлов.  
  
> [!NOTE]  
>  Счетчики использования файлов являются необязательными в Microsoft® другая®/Windows2000.  
  
 Счетчики использования файлов сохраняются программой установки после вызова **склинсталлдриверманажер**, **склинсталлдриверекс**, **склинсталлтранслаторекс**, **склремоведриверманажер**, **SQLRemoveDriver**или **SQLRemoveTranslator**.  
  
 При первой установке компонента программа установки или библиотека DLL установщика создают значение в следующем разделе для каждого файла в этом компоненте, который еще не находится в системе.  
  
> [!NOTE]  
>  HKEY_LOCAL_MACHINE  
>   
>  SOFTWARE  
>   
>  Microsoft  
>   
>  Windows  
>   
>  CurrentVersion  
>   
>  SharedDlls  
  
 Он устанавливает для данных этих значений значение 1 и копирует файл в систему. При повторном установке компонента программа установки или DLL-библиотека установщика увеличивают счетчики использования. При удалении компонента программа установки или DLL-библиотека установщика уменьшают счетчики использования. Если счетчик использования оказывается равным 0, программа установки или библиотека DLL установщика удаляют значение для файла и, если компонент является драйвером или транслятором, удаляет файл. Не следует удалять файлы диспетчера драйверов.  
  
 В следующей таблице показан формат значения счетчика использования файлов.  
  
|Имя|Тип данных|Данные|  
|----------|---------------|----------|  
|*полный путь*|REG_DWORD|*count*|  
  
 Например, предположим, что драйвер для Informix использует файлы Infrmx32. dll и Infrmx32. hlp, и предположим, что этот драйвер установлен дважды. Значения в подразделе SharedDlls для драйвера Informix будут выглядеть следующим образом:  
  
```  
C:\WINDOWS\SYSTEM32\INFRMX32.DLL : REG_DWORD : 0x2  
C:\WINDOWS\SYSTEM32\INFRMX32.HLP : REG_DWORD : 0x2  
```
