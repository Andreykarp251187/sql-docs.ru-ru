---
title: Функция S'LBrowseConnect (англ.) Документы Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLBrowseConnect
apilocation:
- sqlsrv32.dll
- odbc32.dll
apitype: dllExport
f1_keywords:
- SQLBrowseConnect
helpviewer_keywords:
- SQLBrowseConnect function [ODBC]
ms.assetid: b7f1be66-e6c7-4790-88ec-62b7662103c0
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 607b0d764a694098a23111e9d7f4ce9755ea982d
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81301344"
---
# <a name="sqlbrowseconnect-function"></a>Функция SQLBrowseConnect
**Соответствия**  
 Версия Введена: Соответствие стандартам ODBC 1.0: ODBC  
  
 **Сводка**  
 **Компания «СЗЛBrowseConnect»** поддерживает итеративный метод обнаружения и перечисления значений атрибутов и атрибутов, необходимых для подключения к источнику данных. Каждый вызов в **S'LBrowseConnect** возвращает последовательные уровни атрибутов и значений атрибутов. При перечислении всех уровней подключение к источнику данных завершается, а полная строка соединения возвращается **s'LBrowseConnect.** Обратный код SQL_SUCCESS или SQL_SUCCESS_WITH_INFO указывает на то, что вся информация о подключении была указана и приложение теперь подключено к источнику данных.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLBrowseConnect(  
     SQLHDBC         ConnectionHandle,  
     SQLCHAR *       InConnectionString,  
     SQLSMALLINT     StringLength1,  
     SQLCHAR *       OutConnectionString,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   StringLength2Ptr);  
```  
  
## <a name="arguments"></a>Аргументы  
 *ПодключениеРучка*  
 [Input] Дескриптор подключения  
  
 *InConnectionString*  
 (Вход) Просмотреть строку подключения запроса (см.*"Аргумент InConnectionString"* в "Комментарии").  
  
 *Струннаядлина1*  
 (Вход) Длина*InConnectionString* в символах.  
  
 *OutConnectionString*  
 (Выход) Указатель на буфер символов, в котором можно вернуть строку подключения к результатам просмотра (см.*«Аргумент OutConnectionString»* в «Комментарии»).  
  
 Если *OutConnectionString* является NULL, *StringLength2Ptr* по-прежнему возвращает общее количество символов (за исключением символа с нулевым прекращением для данных символов), доступных для возврата в буфере, на который указывает *OutConnectionString.*  
  
 *BufferLength*  
 (Вход) Длина, в символах, буфера*OutConnectionString.*  
  
 *СтрунныйДлин2Птр*  
 (Выход) Общее количество символов (за исключением нулевого \*прекращения) доступно для возврата в *OutConnectionString*. Если количество символов, доступных для возврата, больше или равно \* *BufferLength,* строка соединения в *OutConnectionString* усечена до *BufferLength* минус длина персонажа с нулевым прекращением.  
  
## <a name="returns"></a>Результаты  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_NEED_DATA, SQL_ERROR, SQL_INVALID_HANDLE или SQL_STILL_EXECUTING.  
  
## <a name="diagnostics"></a>Диагностика  
 При **SQLBrowseConnect** возврате SQL_ERROR, SQL_SUCCESS_WITH_INFO или SQL_NEED_DATA, связанные с этим значения S'LSTATE могут быть получены, позвонив по **телефону S'LGetDiagRec** с *помощью handleType* SQL_HANDLE_STMT и *ручки ConnectionHandle.* В следующей таблице перечислены значения S'LSTATE, обычно возвращаемые **S'LBrowseConnect,** и разъясняются каждое из них в контексте этой функции; нотация "(DM)" предшествует описаниям S'LSTATEs, возвращенным менеджером драйвера. Код возврата, связанный с каждым значением S'LSTATE, является SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Error|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение, конкретное для водителя. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01004|Строковые данные, правые усеченные|Буфер \* *OutConnectionString* не был достаточно большим, чтобы вернуть всю строку соединения результатов просмотра, поэтому строка была усечена. Буфер -*StringLength2Ptr* содержит длину непрогнатой строки подключения к результатам просмотра. (Функция возвращает SQL_NEED_DATA.)|  
|01S00|Недействительный атрибут строки соединения|Недействительный ключевое слово атрибута было указано в строке подключения к запросу просмотра *(InConnectionString).* (Функция возвращает SQL_NEED_DATA.)<br /><br /> Ключевое слово атрибута было указано в строке подключения к запросу просмотра *(InConnectionString*), которая не применяется к текущему уровню соединения. (Функция возвращает SQL_NEED_DATA.)|  
|01S02|Значение изменено|Драйвер не поддержал указанное значение аргумента *ValuePtr* в **S'LSetConnectAttr** и заменил аналогичное значение. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|08001|Клиент не может установить соединение|Водитель не смог установить связь с источником данных.|  
|08002|Имя соединения в использовании|(DM) Указанное соединение уже использовалось для установления соединения с источником данных, и соединение было открыто.|  
|08004|Сервер отклонил соединение|Источник данных отклонил установление соединения по причинам, определенным для реализации.|  
|08S01|Сбой связи|Связь между драйвером и источником данных, к которому пытался подключиться, не сработала до завершения обработки функции.|  
|28000|Недействительная спецификация авторизации|Либо идентификатор пользователя или строка авторизации, либо и то, и другое, как указано в строке подключения к запросу просмотра *(InConnectionString),* нарушили ограничения, определенные источником данных.|  
|HY000|Общая ошибка|Произошла ошибка, в соответствии с которой не было конкретного S'LSTATE и для которой не было определено конкретное осуществление СЗЛСТАТ. Сообщение об ошибке, возвращенное **S'LGetDiagRec** в * \*буфере MessageText,* описывает ошибку и ее причину.|  
|HY001|Ошибка распределения памяти|(DM) Менеджер драйвера не смог выделить память, необходимую для поддержки выполнения или завершения функции.<br /><br /> Водитель не смог выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Operation canceled|Асинхронная операция была отменена, позвонив в [функцию S'LCancelHandle.](../../../odbc/reference/syntax/sqlcancelhandle-function.md) Затем исходная функция была снова вызвана на *ConnectionHandle.*<br /><br /> Операция была отменена, позвонив по **S'LCancelHandle** на *ConnectionHandle* из другого потока в многопоточном приложении.|  
|HY010|Ошибка последовательности функций|(DM) Асинхронно выполнение функции (не этот) был вызван для *ConnectionHandle* и по-прежнему выполнения, когда эта функция была вызвана.|  
|HY013|Ошибка управления памятью|Вызов функции не может быть обработан, поскольку основные объекты памяти не могут быть доступны, возможно, из-за низких условий памяти.|  
|HY090|Недействительная длина строки или буфера|(DM) Значение, указанное для аргумента *StringLength1,* было меньше 0 и не было равно SQL_NTS.<br /><br /> (DM) Значение, указанное для *аргумента BufferLength* было меньше, чем 0.|  
|HY114|Драйвер не поддерживает выполнение асинхронной функции уровня соединения|(DM) Приложение включило асинхронную операцию на ручке соединения перед подключением. Однако водитель не поддерживает асинхронную работу на ручке соединения.|  
|HYT00|Время ожидания истекло|Период тайм-аута входа истек до завершения подключения к источнику данных. Период тайм-аута устанавливается с **помощью s'LSetConnectAttr,** SQL_ATTR_LOGIN_TIMEOUT.|  
|HYT01|Срок истечения времени подключения|Период тайм-аута соединения истек до того, как источник данных ответил на запрос. Период тайм-аута соединения устанавливается через **S'LSetConnectAttr,** SQL_ATTR_CONNECTION_TIMEOUT.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) Драйвер, соответствующий указанному названию источника данных, не поддерживает функцию.|  
|IM002|Источник данных не найден и не указан драйвер по умолчанию|(DM) Имя источника данных, указанное в строке подключения к запросу просмотра *(InConnectionString*), не было найдено в информации системы, и не было спецификации драйвера по умолчанию.<br /><br /> (DM) источник данных ODBC и информация о драйвере по умолчанию не были найдены в информации системы.|  
|IM003|Указанный драйвер не может быть загружен|(DM) Драйвер, указанный в спецификации источника данных в системной информации или указанный ключевым словом **DRIVER,** не найден или не может быть загружен по какой-либо другой причине.|  
|IM004|Водитель **S'LAllocHandle** на SQL_HANDLE _ENV не удалось|(DM) Во время **S'LBrowseConnect**, менеджер драйвера назвал функцию **драйвера S'LAllocHandle** с *HandleType* SQL_HANDLE_ENV и водитель вернул сярприг.|  
|IM005|Водитель **S'LAllocHandle** на SQL_HANDLE_DBC не удалось|(DM) Во время **S'LBrowseConnect**, менеджер драйвера назвал функцию **драйвера S'LAllocHandle** с *HandleType* SQL_HANDLE_DBC и водитель вернул сярприг.|  
|IM006|Сбой **драйвера s'LSetConnectAttr**|(DM) Во время **S'LBrowseConnect**, менеджер драйвера назвал функцию **драйвера S'LSetConnectAttr** и драйвер вернулся ошибка.|  
|IM009|Невозможно загрузить перевод DLL|Водитель не смог загрузить перевод DLL, указанный для источника данных или для соединения.|  
|IM010|Имя источника данных слишком длинное|(DM) Значение атрибута для ключевого слова DSN было длиннее, чем SQL_MAX_DSN_LENGTH символов.|  
|IM011|Имя водителя слишком длинное|(DM) Значение атрибута для ключевого слова DRIVER было длиннее 255 символов.|  
|IM012|Driver ошибка синтаксиса ключевых слов|(DM) Пара значения ключевых слов для ключевого слова DRIVER содержала ошибку синтаксиса.|  
|IM014|Указанный DSN содержит несоответствие архитектуры между драйвером и приложением|(DM) 32-разрядное приложение использует DSN, соединяющийся с 64-разрядным драйвером; или наоборот.|  
|IM017|Опрос отключен в асинхронном режиме уведомления|Всякий раз, когда используется модель уведомления, опрос отключается.|  
|IM018|Для завершения предыдущей асинхронной операции на этой ручке не был вызван **S'LCompleteAsync.**|Если предыдущий вызов функции на ручке возвращается SQL_STILL_EXECUTING и если режим уведомления включен, **s'LCompleteAsync** должен быть вызван на ручку, чтобы сделать пост-обработку и завершить операцию.|  
|S1118|Водитель не поддерживает асинхронное уведомление|Если водитель не поддерживает асинхронное уведомление, вы не можете установить SQL_ATTR_ASYNC_DBC_EVENT или SQL_ATTR_ASYNC_DBC_RETCODE_PTR.|  
  
## <a name="inconnectionstring-argument"></a>InConnectionString Аргумент  
 Строка подключения к запросу просмотра имеет следующий синтаксис:  
  
 *соединение-строка* ::"`;` *атрибут*, &#124; *атрибут* `;` *соединения строки*;<br>
 *атрибут* ::: *атрибут-ключевое значение*`=``{`*атрибута-значения* `}`&#124;*attribute-value* `DRIVER=`<br>
 *атрибут-ключевое слово* `DSN` ::" &#124; `UID` &#124; &#124; `PWD` *драйвер-определенный-атрибут-ключевое слово*<br>
 *атрибут-значение* ::: *строка персонажа*<br>
 *драйвер-определенный атрибут-ключевое слово* :: *идентификатор*<br>
  
 где *строка символов* имеет ноль или больше символов; *идентификатор* имеет один или несколько символов; *атрибут-ключевое слово* не является чувствительным к случаям; *атрибут-значение* может быть чувствительным к случаям; и значение ключевого слова **DSN** не состоит исключительно из пробелов. Из-за строки соединения и инициализации грамматики файла, ключевые слова и значения атрибутов, которые содержат символы **{}();;? Следует \*избегать!** Из-за грамматики в системе информации, ключевые слова\\и имена источников данных не могут содержать backslash ( ) характер. Для ODBC 2. *x* драйвер, скобки необходимы вокруг значения атрибута для ключевого слова DRIVER.  
  
 Если какие-либо ключевые слова повторяются в строке подключения к запросу просмотра, драйвер использует значение, связанное с первым появлением ключевого слова. Если ключевые слова **DSN** и **DRIVER** включены в одну и ту же строку подключения к запросу просмотра, менеджер драйвера и драйвер используют какое ключевое слово появляется первым.  
  
 Для получения информации о том, как приложение выбирает источник данных или драйвер, [см.](../../../odbc/reference/develop-app/choosing-a-data-source-or-driver.md)  
  
## <a name="outconnectionstring-argument"></a>Аргумент OutConnectionString  
 Строка подключения результатов просмотра — это список атрибутов соединения. Атрибут соединения состоит из ключевого слова атрибута и соответствующего значения атрибута. Строка подключения к результатам просмотра имеет следующий синтаксис:  
  
 *соединение-строка* ::"`;` *атрибут*- &#124; *атрибут* `;` *соединения строки*<br>
 *атрибут* :::`*`*attribute-keyword*`=`*attribute-value*<br>
 *атрибут-ключевое слово* ::: *ODBC-атрибут-ключевое слово* &#124; *драйвер-определенный-атрибут-ключевое слово*<br>
 *ODBC-атрибут-ключевое* слово`UID` `PWD`-`:`&#124;*локально-идентификатор*- *водитель-определенный-атрибут-ключевое слово* :: *идентификатор*`:`-*локализованный-идентификатор*- *атрибут-значение:::* `{` *атрибут-значение-список* `}` &#124; `?` (скобки буквально; они возвращены водителем.)<br>
 *атрибут-значение-список* ::: *строка символа-строка* `:`-*ложа локализованного символа*- &#124; *строка характера* -`:`*логосво-символ строка*- `,` *атрибут-значение-список*<br>
  
 где *строка символа* и *логово-символ астну* имеют ноль или больше символов; *идентификатор* и *локализованный идентификатор* имеют один или несколько символов; *атрибут-ключевое слово* не является чувствительным к случаям; и *атрибут-значение* может быть чувствительным к случаям. Из-за строки соединения и инициализации грамматики файла, ключевых слов, локализованных идентификаторов и значений атрибутов, содержащих символы **{}();?? Следует \*избегать!** Из-за грамматики в системе информации, ключевые слова\\и имена источников данных не могут содержать backslash ( ) характер.  
  
 Синтаксис строки соединения результатов просмотра используется в соответствии со следующими семантическими правилами:  
  
-   Если\*звездочка () предшествует *атрибуту,атрибут*неявляется и может быть опущен а затем в следующем вызове на *attribute* **s'LBrowseConnect.**  
  
-   Ключевые слова атрибута **UID** и **PWD** имеют то же значение, что и в **S'LDriverConnect.**  
  
-   *Драйвер-определяемый атрибут-ключевое слово* называет вид атрибута, для которого может быть поставлено значение атрибута. Например, это могут быть **SERVER,** **DATABASE,** **HOST**или **DBMS.**  
  
-   *Слова ODBC-attribute-key и* *драйвер-определенные ключевые слова* включают локализованную или удобную версию ключевого слова. Это может быть использовано приложениями в качестве метки в диалоговом поле. Тем не менее, **UID,** **PWD**, или *идентификатор* только должны быть использованы при прохождении строки запроса просмотра к водителю.  
  
-   Список*атрибутов-значение*— это перечисление фактических значений, действительных для соответствующего *ключевого слова атрибута.* Обратите внимание, что{}скобки () не указывают список вариантов; они возвращаются водителем. Например, это может быть список имен серверов или список имен баз данных.  
  
-   Если *значение атрибута* является одним вопросительным знаком (?), одно значение соответствует *ключевому слову атрибута.* Например, УИДЗ-Джонс; PWD-Сезам.  
  
-   Каждый звонок в **S'LBrowseConnect** возвращает только информацию, необходимую для удовлетворения следующего уровня процесса подключения. Водитель связывает информацию о состоянии с ручкой соединения, так что контекст всегда может быть определен на каждом вызове.  
  
## <a name="using-sqlbrowseconnect"></a>С помощью S'LBrowseConnect  
 Для подключения к веб-уйму требуется **выделенное** соединение. Менеджер драйвера загружает драйвер, указанный в указанном или соответствующий названию источника данных, указанному в начальной строке подключения запроса просмотра; для получения информации о том, когда [SQLConnect Function](../../../odbc/reference/syntax/sqlconnect-function.md)это происходит, см. Водитель может установить связь с источником данных во время просмотра. Если **s'LBrowseConnect** возвращается SQL_ERROR, невыполненные соединения прекращаются и соединение возвращается в неподключенное состояние.  
  
> [!NOTE]  
>  **S'LBrowseConnect** не поддерживает объединение соединений. Если **s'LBrowseConnect** вызывается во время объединения соединения, s'LSTATESTATE HY000 (общая ошибка) будет возвращена.  
  
 При первом вызове **s'LBrowseConnect** на подключение строка подключения к запросу просмотра должна содержать ключевое слово **DSN** или ключевое слово **DRIVER.** Если строка подключения к запросу просмотра содержит ключевое слово **DSN,** менеджер драйвера находит соответствующую спецификацию источника данных в системной информации:  
  
-   Если менеджер драйвера находит соответствующую спецификацию источника данных, он загружает связанный драйвер DLL; водитель может получить информацию об источнике данных из системной информации.  
  
-   Если менеджер драйвера не может найти соответствующую спецификацию источника данных, он находит спецификацию источника данных по умолчанию и загружает связанный драйвер DLL; водитель может получить информацию об источнике данных по умолчанию из системной информации. "DEFAULT" передается водителю для DSN.  
  
-   Если менеджер драйвера не может найти соответствующую спецификацию источника данных и нет спецификации источника данных по умолчанию, он возвращает SQL_ERROR с S'LSTATE IM002 (источник данных не найден и не указан драйвер по умолчанию).  
  
 Если строка подключения к запросу просмотра содержит ключевое слово **DRIVER,** менеджер драйвера загружает указанный драйвер; он не пытается найти источник данных в системной информации. Поскольку ключевое слово **DRIVER** не использует информацию из системной информации, водитель должен определить достаточное количество ключевых слов, чтобы водитель мог подключиться к источнику данных, используя только информацию в строках подключения к запросу просмотра.  
  
 При каждом вызове в **S'LBrowseConnect**приложение определяет значения атрибутов соединения в строке подключения запроса. Драйвер возвращает последовательные уровни значений атрибутов и атрибутов в строке соединения результатов просмотра; он возвращается SQL_NEED_DATA, пока есть атрибуты соединения, которые еще не перечислены в строке подключения к запросу просмотра. Приложение использует содержимое строки подключения к результатам просмотра для создания строки подключения к запросу просмотра для следующего вызова на **S'LBrowseConnect.** Все обязательные атрибуты (которые не предшествуют звездочка в аргументе *OutConnectionString)* должны быть включены в следующий вызов на **S'LBrowseConnect.** Обратите внимание, что приложение не может использовать содержимое строк соединения результатов предыдущего просмотра при построении текущей строки подключения к запросу просмотра; то есть он не может указать различные значения для атрибутов, установленных в предыдущих уровнях.  
  
 Когда перечислены все уровни соединения и связанные с ними атрибуты, драйвер возвращается SQL_SUCCESS, подключение к источнику данных завершено, и в приложение возвращается полная строка соединения. Строка соединения подходит для использования, в сочетании с **S'LDriverConnect**, с SQL_DRIVER_NOPROMPT вариант омулятом для установления другого соединения. Строка полного соединения не может быть использована в другом вызове на **S'LBrowseConnect**, однако; если **s'LBrowseConnect** были вызваны снова, вся последовательность вызовов должна быть повторена.  
  
 **Кроме того, в** процессе просмотра SQL_NEED_DATA, если есть восстановимые несмертельные ошибки; например, недействительный пароль или ключевое слово атрибута, поставляемое приложением. Когда SQL_NEED_DATA возвращается, а строка подключения к результатам просмотра остается неизменной, произошла ошибка, и приложение может вызвать **S'LGetDiagRec,** чтобы вернуть S'LSTATE для ошибок времени просмотра. Это позволяет приложению исправить атрибут и продолжить просмотр.  
  
 Приложение может завершить процесс просмотра в любое время, позвонив по **s'LDisconnect.** Водитель прекратит все невыполненные соединения и вернет соединение в неподключенное состояние.  
  
 Если асинхронные операции включены на ручке соединения, **S'LBrowseConnect** также может вернуться SQL_STILL_EXECUTING. При возврате SQL_NEED_DATA приложение должно использовать **S'LDisconnect** для отмены процесса просмотра. Если **s'LBrowseConnect** возвращает SQL_STILL_EXECUTING, приложение должно использовать **S'LCancelHandle** для отмены незавершенной операции. Вызов **S'LКансканхликпослем** после возврата функции SQL_NEED_DATA не имеет эффекта.  
  
 Для получения более подробной [информации см.](../../../odbc/reference/develop-app/connecting-with-sqlbrowseconnect.md)  
  
 Если драйвер поддерживает **s'LBrowseConnect,** раздел ключевого слова драйвера в системе информации для драйвера должен содержать ключевое слово **ConnectFunctions** с третьим символом, установленным на "Y".  
  
## <a name="code-example"></a>Пример кода  
  
> [!NOTE]  
>  Если вы подключаетесь к поставщику источников данных, который поддерживает аутентификацию Windows, следует указать `Trusted_Connection=yes` вместо идентификатора пользователя и информацию о паролях в строке соединения.  
  
 В следующем примере приложение неоднократно вызывает **S'LBrowseConnect.** Каждый раз, когда **s'LBrowseConnect** возвращается SQL_NEED_DATA, \*он передает обратно информацию о данных, которые ему нужны в *OutConnectionString*. Приложение передает *OutConnectionString* в свой обычный **GetUserInput** (не отображается). **GetUserInput** разбирает информацию, создает и отображает диалоговый ящик и возвращает информацию, введенную пользователем в \* *InConnectionString.* Приложение передает информацию пользователя водителю при следующем звонке в **S'LBrowseConnect.** После того, как приложение предоставило всю необходимую информацию для подключения водителя к источнику данных, **S'LBrowseConnect** возвращает SQL_SUCCESS и приложение продолжается.  
  
 Более подробный пример подключения к драйверу сервера S'L, позвонив по **s'LBrowseConnect,** [см.](../../../odbc/reference/develop-app/sql-server-browsing-example.md)  
  
 Например, для подключения к источнику данных Продаж могут возникнуть следующие действия. Во-первых, приложение передает следующую строку в **S'LBrowseConnect:**  
  
```  
"DSN=Sales"  
```  
  
 Менеджер драйвера загружает драйвер, связанный с источником продаж данных. Затем он вызывает функцию **драйвера S'LBrowseConnect** с теми же аргументами, которые он получил от приложения. Водитель возвращает следующую строку в*OutConnectionString*:  
  
```  
"HOST:Server={red,blue,green};UID:ID=?;PWD:Password=?"  
```  
  
 Приложение передает эту строку в режим **GetUserInput,** который создает диалоговое окно, которое просит пользователя выбрать красный, синий или зеленый сервер и ввести идентификатор пользователя и пароль. Процедура передает следующую информацию, \*указанную пользователем, обратно в *InConnectionString*, который приложение передает в **S'LBrowseConnect:**  
  
```  
"HOST=red;UID=Smith;PWD=Sesame"  
```  
  
 **СЗЛBrowseConnect** использует эту информацию для подключения к красному серверу, как Смит с паролем Sesame, а затем возвращает следующую строку в*OutConnectionString*:  
  
```  
"*DATABASE:Database={SalesEmployees,SalesGoals,SalesOrders}"  
```  
  
 Приложение передает эту строку в режим **GetUserInput,** который создает диалоговое окно, которое просит пользователя выбрать базу данных. Пользователь выбирает empdata, и приложение вызывает **S'LBrowseConnect** в последний раз с помощью этой строки:  
  
```  
"DATABASE=SalesOrders"  
```  
  
 Это последняя часть информации, необходимой водителю для подключения к источнику данных; **S'LBrowseConnect** возвращает сядки SQL_SUCCESS, а*OutConnectionString* содержит завершенную строку соединения:  
  
```cpp  
// SQLBrowseConnect_Function.cpp  
// compile with: odbc32.lib  
#include <windows.h>  
#include <sqltypes.h>  
#include <sqlext.h>  
  
#define BRWS_LEN 100  
SQLHENV henv;  
SQLHDBC hdbc;  
SQLHSTMT hstmt;  
SQLRETURN retcode;  
SQLCHAR szConnStrIn[BRWS_LEN], szConnStrOut[BRWS_LEN];  
SQLSMALLINT cbConnStrOut;  
  
void GetUserInput(SQLCHAR * szConnStrOut, SQLCHAR * szConnStrIn) {}  
  
int main() {  
   // Allocate the environment handle.  
   retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &henv);        
   if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
  
      // Set the version environment attribute.  
      retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER*)SQL_OV_ODBC3, 0);  
      if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
  
         // Allocate the connection handle.  
         retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &hdbc);  
         if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
            // Call SQLBrowseConnect until it returns a value other than SQL_NEED_DATA   
            // (pass data source name the first time).  If SQL_NEED_DATA is returned, call GetUserInput   
            // (not shown) to build a dialog from the values in szConnStrOut.  The user-supplied values   
            // are returned in szConnStrIn, which is passed in the next call to SQLBrowseConnect.  
  
            strcpy_s((char*)szConnStrIn, _countof(szConnStrIn), "DSN=Sales");  
            do {  
               retcode = SQLBrowseConnect(hdbc, szConnStrIn, SQL_NTS,  
                  szConnStrOut, BRWS_LEN, &cbConnStrOut);  
               if (retcode == SQL_NEED_DATA)  
                  GetUserInput(szConnStrOut, szConnStrIn);  
            } while (retcode == SQL_NEED_DATA);  
  
            if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO){  
  
               // Allocate the statement handle.  
               retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt);  
  
               if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO)  
                  // Process data after successful connection  
                  SQLFreeHandle(SQL_HANDLE_STMT, hstmt);  
               SQLDisconnect(hdbc);  
            }  
         }  
         SQLFreeHandle(SQL_HANDLE_DBC, hdbc);  
      }  
   }  
   SQLFreeHandle(SQL_HANDLE_ENV, henv);  
}  
```  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Выделение ручки соединения|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Подключение к источнику данных|[Функция S'LConnect](../../../odbc/reference/syntax/sqlconnect-function.md)|  
|Отключение от источника данных|[Функция SQLDisconnect](../../../odbc/reference/syntax/sqldisconnect-function.md)|  
|Подключение к источнику данных с помощью строки соединения или диалогового окна|[Функция SQLDriverConnect](../../../odbc/reference/syntax/sqldriverconnect-function.md)|  
|Возвращение описания и атрибутики драйвера|[Функция SQLDrivers](../../../odbc/reference/syntax/sqldrivers-function.md)|  
|Освобождение ручки соединения|[SQLFreeHandle, функция](../../../odbc/reference/syntax/sqlfreehandle-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справка aPI ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
