---
title: Функция SQLBrowseConnect | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLBrowseConnect
apilocation:
- sqlsrv32.dll
- odbc32.dll
apitype: dllExport
f1_keywords:
- SQLBrowseConnect
helpviewer_keywords:
- SQLBrowseConnect function [ODBC]
ms.assetid: b7f1be66-e6c7-4790-88ec-62b7662103c0
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: 3af78971a17035091ab8a72bf0c9a8fe90250dd3
ms.sourcegitcommit: 7a3243c45830cb3f49a7fa71c2991a9454fd6f5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2019
ms.locfileid: "65538189"
---
# <a name="sqlbrowseconnect-function"></a>Функция SQLBrowseConnect
**Соответствие стандартам**  
 Представленные версии: Соответствие стандартам 1.0 ODBC: интерфейс ODBC  
  
 **Сводка**  
 **SQLBrowseConnect** поддерживает итеративный метод обнаружения и перечисление атрибутов и значений атрибутов, необходимых для подключения к источнику данных. Каждый вызов **SQLBrowseConnect** возвращает последовательные уровни атрибутов и значений атрибутов. Если были перечислены все уровни, завершения подключения к источнику данных и возвращается полная строка подключения **SQLBrowseConnect**. Код возврата SQL_SUCCESS или SQL_SUCCESS_WITH_INFO указывает, что был указан всех сведений о соединении, и приложение теперь подключено к источнику данных.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLBrowseConnect(  
     SQLHDBC         ConnectionHandle,  
     SQLCHAR *       InConnectionString,  
     SQLSMALLINT     StringLength1,  
     SQLCHAR *       OutConnectionString,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   StringLength2Ptr);  
```  
  
## <a name="arguments"></a>Аргументы  
 *ConnectionHandle*  
 [Вход] Дескриптор соединения.  
  
 *InConnectionString*  
 [Вход] Найдите строку подключения для запроса (см. в разделе "*InConnectionString* аргумент» в «Комментарии»).  
  
 *StringLength1*  
 [Вход] Длина **InConnectionString* в символах.  
  
 *OutConnectionString*  
 [Выход] Указатель на символьный буфер, в которую будет возвращен обзора результирующую строку подключения (см. в разделе "*OutConnectionString* аргумент» в «Комментарии»).  
  
 Если *OutConnectionString* имеет значение NULL, *StringLength2Ptr* по-прежнему возвращает общее число символов (включая знак завершения null для символьных данных) для возврата в буфере Указывает *OutConnectionString*.  
  
 *BufferLength*  
 [Вход] Длина в символах, из **OutConnectionString* буфера.  
  
 *StringLength2Ptr*  
 [Выход] Общее число символов (исключая конечное значение null), доступных для возврата в \* *OutConnectionString*. Если количество символов, доступных для возврата больше или равно *BufferLength*, строку подключения в \* *OutConnectionString* усекается до  *BufferLength* минус длина знак завершения null.  
  
## <a name="returns"></a>Возвращает  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_NEED_DATA, SQL_ERROR, SQL_INVALID_HANDLE, or SQL_STILL_EXECUTING.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLBrowseConnect** возвращает значение SQL_ERROR, SQL_SUCCESS_WITH_INFO или SQL_NEED_DATA, соответствующее значение SQLSTATE можно получить, вызвав **SQLGetDiagRec** с *HandleType* значение SQL_HANDLE_STMT и *дескриптор ConnectionHandle*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые **SQLBrowseConnect** и объясняется каждый из них в контексте этой функции; описания SQLSTATE, возвращаемых диспетчером драйверов предшествует обозначение «(DM)». Возвращается связанный с каждого значения SQLSTATE значение SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Ошибка|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Специфические для драйвера информационное сообщение. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01004|Усечение данных строки справа|Буфер \* *OutConnectionString* не был достаточно большим, чтобы вернуть весь обзора результирующую строку подключения, чтобы строка была усечена. Буфер **StringLength2Ptr* содержит длину строки подключения результат неусеченный обзора. (Функция возвращает значение SQL_NEED_DATA.)|  
|01S00|Недопустимый атрибут строки подключения|Ключевое слово недопустимый атрибут был указан в строке подключения Обзор (*InConnectionString*). (Функция возвращает значение SQL_NEED_DATA.)<br /><br /> Ключевое слово атрибута был указан в строке подключения Обзор (*InConnectionString*), не применяется к текущему уровню подключения. (Функция возвращает значение SQL_NEED_DATA.)|  
|01S02|Значение изменено|Драйвер не поддерживает указанное значение *ValuePtr* аргумента в **SQLSetConnectAttr** и заменить примерно такое же значение. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|08001|Не удается установить подключение клиента|Драйвер не удалось установить соединение с источником данных.|  
|08002|Имя подключения используется|(DM) указанное соединение уже была использована для установления соединения с источником данных и подключение было открыто.|  
|08004|Сервер отклонил подключение|Источник данных отклонены установление соединения по причинам, определяемого реализацией.|  
|08S01|Отказ канала связи|Сбой в канале связи между драйвером и источника данных, к которому пытается подключиться драйвер перед обработкой функции было завершено.|  
|28000|Недопустимая спецификация авторизации|Идентификатор пользователя и строка авторизации либо оба, как указано в обзора запросить строку подключения (*InConnectionString*), нарушены ограничения, определенные в источнике данных.|  
|HY000|Общая ошибка|Произошла ошибка, для которой было нет конкретных SQLSTATE и SQLSTATE не зависящие от реализации, который был определен. Сообщение об ошибке, возвращенные **SQLGetDiagRec** в  *\*MessageText* буфера описывает ошибку и его причины.|  
|HY001|Ошибка выделения памяти|Диспетчер драйверов (DM) не удалось выделить память, необходимую для поддержки выполнения или завершения функции.<br /><br /> Драйвер не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Операция отменена|Асинхронная операция была отменена, вызвав [функция SQLCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md). Выберите исходную функцию был вызван снова на *ConnectionHandle*.<br /><br /> Операция была отменена, вызвав **SQLCancelHandle** на *ConnectionHandle* из другого потока в многопоточных приложениях.|  
|HY010|Ошибка последовательности функций|(DM) асинхронно выполняемой функции (не такой) был вызван для *ConnectionHandle* и еще выполнялась при вызове этой функции.|  
|HY013|Ошибка управления памятью|Не удалось обработать вызов функции, так как базовые объекты памяти оказываются недоступны, возможно из-за нехватки памяти.|  
|HY090|Недопустимая длина строки или буфера|(DM) значение, указанное для аргумента *StringLength1* меньше 0 и не равно SQL_NTS.<br /><br /> (DM) значение, указанное для аргумента *BufferLength* меньше 0.|  
|HY114|Драйвер не поддерживает выполнение уровня асинхронной функции подключения|(DM) приложения включен асинхронной операции на дескрипторе соединения перед подключением. Тем не менее драйвер не поддерживает асинхронные операции для дескриптора соединения.|  
|HYT00|Время ожидания истекло|Истекло время ожидания входа для подключения к источнику данных завершена. Период ожидания задается с помощью **SQLSetConnectAttr**, SQL_ATTR_LOGIN_TIMEOUT.|  
|HYT01|Время ожидания подключения истекло|Время ожидания подключения истекло раньше, чем ответил на запрос источника данных. Период времени ожидания задается с помощью **SQLSetConnectAttr**, sql_attr_connection_timeout не учитывается.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) драйвер, соответствующий заданным именем источника данных не поддерживает функцию.|  
|IM002|Не удалось найти источник данных и не указан драйвер, по умолчанию|Имя, указанное в строке подключения Обзор запроса источника данных (DM) (*InConnectionString*) не найден в сведениях о системе, а также была ли спецификацию драйвера по умолчанию.<br /><br /> (DM) ODBC данных по умолчанию драйвер сведения об источнике и не удалось найти сведения о системе.|  
|IM003|Не удалось загрузить указанный драйвер|(DM) драйвер, перечисленные в спецификации источника данных в сведения о системе или заданные **ДРАЙВЕР** ключевое слово не найден или не может быть загружен по другой причине.|  
|IM004|Драйвера **SQLAllocHandle** на _ENV SQL_HANDLE сбой|(DM) во время **SQLBrowseConnect**, диспетчер драйверов называемая драйвером **SQLAllocHandle** функционировать с *HandleType* SQL_HANDLE_ENV и драйвер возвращается Ошибка.|  
|IM005|Драйвера **SQLAllocHandle** на SQL_HANDLE_DBC сбой|(DM) во время **SQLBrowseConnect**, диспетчер драйверов называемая драйвером **SQLAllocHandle** функционировать с *HandleType* SQL_HANDLE_DBC и драйвер возвращается Ошибка.|  
|IM006|Драйвера **SQLSetConnectAttr** не удалось|(DM) во время **SQLBrowseConnect**, диспетчер драйверов называемая драйвером **SQLSetConnectAttr** функция и драйвер вернул ошибку.|  
|IM009|Не удалось загрузить DLL перевода|Драйвер не удалось загрузить преобразование библиотеки DLL, указанный для источника данных или для подключения.|  
|IM010|Слишком длинное имя источника данных|(DM), значение атрибута для ключевое слово DSN длилось больше SQL_MAX_DSN_LENGTH символов.|  
|IM011|Слишком длинное имя драйвера|(DM) значение атрибута для ключевое слово DRIVER длилось больше 255 символов.|  
|IM012|Синтаксическая ошибка ДРАЙВЕРА ключевое слово|(DM) пару ключевое_слово значение для ключевое слово DRIVER содержит синтаксическую ошибку.|  
|IM014|Указанное имя источника данных содержит несоответствие архитектуры драйвера и приложения|32-разрядное приложение (DM) использует имя DSN, подключении к 64-разрядный драйвер; и наоборот.|  
|IM017|Опрос недоступен в режиме асинхронное уведомление|Каждый раз, когда используется модель уведомлений, отключен опроса.|  
|IM018|**SQLCompleteAsync** не был вызван для завершения предыдущей асинхронной операции на этот дескриптор.|Если предыдущий вызов функции в дескриптор возвращает SQL_STILL_EXECUTING, и если включен режим уведомлений, **SQLCompleteAsync** должен вызываться с дескриптором постобработки и завершить операцию.|  
|S1118|Драйвер не поддерживает асинхронное уведомление|Если драйвер не поддерживает асинхронное уведомление, невозможно задать SQL_ATTR_ASYNC_DBC_EVENT или SQL_ATTR_ASYNC_DBC_RETCODE_PTR.|  
  
## <a name="inconnectionstring-argument"></a>Аргумент InConnectionString  
 Обзор запроса строки подключения имеет следующий синтаксис:  
  
 *connection-string* ::= *attribute*[`;`] &#124; *attribute* `;` *connection-string*;<br>
 *attribute* ::= *attribute-keyword*`=`*attribute-value* &#124; `DRIVER=`[`{`]*attribute-value*[`}`]<br>
 *attribute-keyword* ::= `DSN` &#124; `UID` &#124; `PWD` &#124; *driver-defined-attribute-keyword*<br>
 *attribute-value* ::= *character-string*<br>
 *driver-defined-attribute-keyword* ::= *identifier*<br>
  
 где *символьной строки* имеет ноль или несколько символов. *идентификатор* имеет один или несколько символов. *ключевым словом атрибутов* задается без учета регистра; *значение атрибута* возможно, с учетом регистра; и значение **DSN** ключевое слово не состоит исключительно из пробелов. Из-за строки и инициализации файла грамматики, ключевые слова и атрибут значения подключения, которые содержат символы **[]{}(),? \*=! @** следует избегать. Из-за грамматики в сведениях о системе, ключевые слова и имена источников данных не может содержать обратную косую черту (\\) символов. Для ODBC 2. *x* драйвера, значение атрибута для ключевое слово DRIVER можно заключать в фигурные скобки.  
  
 Если любые ключевые слова повторяются в строке подключения обзора, драйвер использует значение, связанное с первого вхождения ключевого слова. Если **DSN** и **ДРАЙВЕР** ключевые слова, включаются в ту же строку подключения для запроса обзора, диспетчер драйверов и драйверов используйте, занимающий первую позицию любого ключевого слова.  
  
 Сведения о том, как приложение выбирает источник данных или драйвера, см. в разделе [Выбор источника данных или драйвера](../../../odbc/reference/develop-app/choosing-a-data-source-or-driver.md).  
  
## <a name="outconnectionstring-argument"></a>Аргумент OutConnectionString  
 Обзор результирующей строке подключения приведен список атрибутов соединения. Атрибут соединения состоит ключевое слово атрибута и соответствующее значение атрибута. Обзор результирующей строке подключения имеет следующий синтаксис:  
  
 *connection-string* ::= *attribute*[`;`] &#124; *attribute* `;` *connection-string*<br>
 *attribute* ::= [`*`]*attribute-keyword*`=`*attribute-value*<br>
 *attribute-keyword* ::= *ODBC-attribute-keyword* &#124; *driver-defined-attribute-keyword*<br>
 *ODBC-attribute-keyword* = {`UID` &#124; `PWD`}[`:`*localized-identifier*] *driver-defined-attribute-keyword* ::= *identifier*[`:`*localized-identifier*] *attribute-value* ::= `{` *attribute-value-list* `}` &#124; `?` (The braces are literal; they are returned by the driver.)<br>
 *attribute-value-list* ::= *character-string* [`:`*localized-character string*] &#124; *character-string* [`:`*localized-character string*] `,` *attribute-value-list*<br>
  
 где *символьной строки* и *локализованные символьная строка* иметь ноль или несколько символов. *идентификатор* и *локализованный идентификатор* имеют один или несколько символов. *ключевым словом атрибутов* задается без учета регистра; и *значение атрибута* может учитываться регистр. Из-за подключения строка инициализации файлов грамматики, ключевые слова, локализованную идентификаторы и значения атрибутов, содержать символы **[]{}(),? \*=! @** следует избегать. Из-за грамматики в сведениях о системе, ключевые слова и имена источников данных не может содержать обратную косую черту (\\) символов.  
  
 Синтаксис строки соединения для обзора результат используется в соответствии с следующие семантические правила:  
  
-   Если звездочка (\*) предшествует *ключевым словом атрибутов*, *атрибут* является необязательным и может быть опущен в следующем вызове **SQLBrowseConnect**.  
  
-   Ключевые слова атрибута **UID** и **PWD** имеют одинаковое значение, как определено в **SQLDriverConnect**.  
  
-   Объект *драйвер определенные атрибут-ключевое слово* именует тип атрибута, для которого может быть предоставлен значение атрибута. Например, может быть **SERVER**, **базы данных**, **узла**, или **СУБД**.  
  
-   *Ключевые слова ODBC атрибут* и *драйвер определенные атрибут-ключевые слова* содержит локализованные или понятные версию ключевое слово. Это может использоваться приложениями как метка в диалоговом окне. Тем не менее **UID**, **PWD**, или *идентификатор* отдельно должен использоваться при передаче обзора строка запроса к драйверу.  
  
-   {*Списка значений атрибута*} является допустимым для соответствующего перечисления фактические значения *ключевым словом атрибутов*. Обратите внимание, что фигурные скобки ({}) не указывают на список вариантов; они возвращаются с помощью драйвера. Например он может быть список имен серверов или список имен баз данных.  
  
-   Если *значение атрибута* — один вопросительный знак (?), одно значение соответствует *ключевым словом атрибутов*. Например, UID = JohnS; PWD = пояснениями.  
  
-   Каждый вызов **SQLBrowseConnect** возвращает только сведения, необходимые для удовлетворения следующего уровня процесс подключения. Драйвер связывает сведения о состоянии с дескриптором соединения таким образом, чтобы всегда контекст можно определить при каждом вызове.  
  
## <a name="using-sqlbrowseconnect"></a>С помощью SQLBrowseConnect  
 **SQLBrowseConnect** требуется выделенное подключение. Диспетчер драйверов загружает драйвер, заданный в или, соответствующее имя источника данных, указанный в строке подключения начальной Обзор запроса; Чтобы узнать, когда это происходит, см. в разделе «Комментарии» в [функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md). Драйвер может установить соединение с источником данных во время просмотра веб-страниц. Если **SQLBrowseConnect** возвращает значение SQL_ERROR, ожидающих выполнения, соединения прерываются и соединение возвращается в состояние неподключенный.  
  
> [!NOTE]  
>  **SQLBrowseConnect** не поддерживает пулы соединений. Если **SQLBrowseConnect** вызывается, когда пул подключений включен, SQLSTATE HY000 возвращается (Общая ошибка).  
  
 Когда **SQLBrowseConnect** вызывается в первый раз в соединении, должен содержать строку подключения запрос обзора **DSN** ключевое слово или **ДРАЙВЕР** ключевое слово. Если строка подключения запрос обзора содержит **DSN** ключевое слово, диспетчер драйверов находит соответствующей спецификации источника данных в сведения о системе:  
  
-   Если диспетчер драйверов находит соответствующей спецификации источника данных, он загружает соответствующий драйвер DLL. драйвер можно получить сведения об источнике данных из информации о системе.  
  
-   Если диспетчер драйверов не удается найти в соответствующей спецификации источника данных, он находит спецификации источника данных по умолчанию и загружает соответствующий драйвер DLL. драйвер можно получить сведения об источнике данных по умолчанию из сведений о системе. «DEFAULT» передается драйвер для источника данных.  
  
-   Если нет спецификации источника данных по умолчанию, диспетчер драйверов не удается найти соответствующей спецификации источника данных, он возвращает ошибку SQL_ERROR с SQLSTATE IM002 (источник данных не найден и не указан драйвер, по умолчанию).  
  
 Если строка подключения запрос обзора содержит **ДРАЙВЕР** ключевое слово, диспетчер драйверов загружает указанный драйвер; он не пытается найти источник данных в сведения о системе. Так как **ДРАЙВЕР** ключевое слово не использует сведения из информации о системе, драйвер должен определить достаточно ключевые слова, что драйвер позволяет подключаться к источнику данных, используя только информацию в строке подключения, запрос обзора.  
  
 При каждом вызове **SQLBrowseConnect**, приложение задает значения атрибута соединения в строке подключения обзора. Драйвер возвращает последовательные уровни атрибуты и значения атрибутов в строке подключения обзора результат; он возвращает SQL_NEED_DATA, до тех пор, пока существуют атрибуты соединения, которые еще не были перечислены в строке подключения обзора. Приложение использует содержимое Обзор результирующей строки подключения для создания строки подключения запрос обзора для следующего вызова **SQLBrowseConnect**. Все обязательные атрибуты (тех не предшествует символ звездочки в *OutConnectionString* аргумент) должны быть включены в следующий вызов **SQLBrowseConnect**. Обратите внимание на то, что приложение не может использовать содержимое предыдущих строк подключения для обзора результат при формировании строки подключения текущего Обзор запроса; то есть его нельзя указать различные значения для атрибутов, задайте в предыдущих уровней.  
  
 При перечислении всех уровней подключения и связанные с ними атрибуты драйвер возвращает значение SQL_SUCCESS, подключение к источнику данных будет создано и полной строки соединения возвращается в приложение. Строку подключения можно использовать в сочетании с **SQLDriverConnect**, SQL_DRIVER_NOPROMPT возможность установить другое соединение. Полная строка подключения не может использоваться в другой вызов **SQLBrowseConnect**, но при этом; Если **SQLBrowseConnect** снова, вызывается всего последовательность вызовов необходимо будет повторить.  
  
 **SQLBrowseConnect** также возвращает значение SQL_NEED_DATA, если во время процесса обзора; например, неверный пароль или ключевым словом атрибутов, предоставляемая приложением восстанавливаемые, некритичные ошибки. Когда возвращается значение SQL_NEED_DATA и обзор результирующей строке подключения не изменился, произошла ошибка и приложение может вызвать **SQLGetDiagRec** для возврата SQLSTATE для ошибки во время обзора. Это позволяет приложению атрибут и по-прежнему обзора.  
  
 Приложение может завершить процесс обзора в любое время, вызвав **SQLDisconnect**. Драйвер завершит любое количество необработанных соединений и вернуть в неподключенный состояние подключения.  
  
 Если в этом дескрипторе соединения включены асинхронные операции **SQLBrowseConnect** также может возвращать значение SQL_STILL_EXECUTING. Когда возвращается значение SQL_NEED_DATA, приложение должно использовать **SQLDisconnect** для отмены обзора процесса. Если **SQLBrowseConnect** возвращает SQL_STILL_EXECUTING, приложение должно использовать **SQLCancelHandle** отменить выполняющуюся операцию. Вызов **SQLCancelHandle** после возврата функции не влияет значение SQL_NEED_DATA.  
  
 Дополнительные сведения см. в разделе [подключение с помощью SQLBrowseConnect](../../../odbc/reference/develop-app/connecting-with-sqlbrowseconnect.md).  
  
 Если драйвер поддерживает **SQLBrowseConnect**, должно содержать поле драйвера в сведениях о системе для драйвера **ConnectFunctions** ключевое слово с третьего знака значение «Y».  
  
## <a name="code-example"></a>Пример кода  
  
> [!NOTE]  
>  Если вы подключаетесь к поставщик источника данных, который поддерживает проверку подлинности Windows, следует указать `Trusted_Connection=yes` вместо идентификатора и пароля пользователя в строке подключения.  
  
 В следующем примере приложение вызывает **SQLBrowseConnect** несколько раз. Каждый раз **SQLBrowseConnect** возвращает SQL_NEED_DATA, он передает сведения о данные, необходимые в \* *OutConnectionString*. Приложение передает *OutConnectionString* подпрограммы, его **GetUserInput** (не показано). **GetUserInput** синтаксический анализ информации, создает и отображает диалоговое окно, а также возвращает сведения, введенные пользователем в \* *InConnectionString*. Приложение передает информацию о пользователе для драйвера в следующем вызове **SQLBrowseConnect**. После его предоставил всю необходимую информацию для драйвера для подключения к источнику данных, **SQLBrowseConnect** возвращает SQL_SUCCESS и приложение выполняется.  
  
 Более подробный пример подключения к SQL Server драйвер путем вызова **SQLBrowseConnect**, см. в разделе [пример просмотра SQL Server](../../../odbc/reference/develop-app/sql-server-browsing-example.md).  
  
 Например для подключения к данным источника продаж, возможны следующие действия. Во-первых, приложение передает следующую строку, чтобы **SQLBrowseConnect**:  
  
```  
"DSN=Sales"  
```  
  
 Диспетчер драйверов загружает драйвер, связанный с источником данных продаж. Затем он вызывает драйвера **SQLBrowseConnect** функцию с теми же аргументами, полученное от приложения. Драйвер возвращает следующую строку в **OutConnectionString*:  
  
```  
"HOST:Server={red,blue,green};UID:ID=?;PWD:Password=?"  
```  
  
 Приложение передает эту строку, чтобы его **GetUserInput** подпрограмм, какие сборки диалоговое окно запрашивает у пользователя выберите сервер, красный, синий или зеленый и введите идентификатор пользователя и пароль. Процедуры передает следующие сведения, указываемые пользователем обратно в \* *InConnectionString*, что приложение передает **SQLBrowseConnect**:  
  
```  
"HOST=red;UID=Smith;PWD=Sesame"  
```  
  
 **SQLBrowseConnect** использует эти сведения для подключения к серверу red как Смит паролем Sesame, а затем возвращает следующую строку в **OutConnectionString*:  
  
```  
"*DATABASE:Database={SalesEmployees,SalesGoals,SalesOrders}"  
```  
  
 Приложение передает эту строку, чтобы его **GetUserInput** подпрограмм, какие сборки диалоговое окно, пользователю предлагается выбрать базу данных. Empdata выбирает пользователь и приложение вызывает **SQLBrowseConnect** последний раз с помощью этой строки:  
  
```  
"DATABASE=SalesOrders"  
```  
  
 Это последнее, что сведения, необходимые драйверу для подключения к источнику данных; **SQLBrowseConnect** возвращает значение SQL_SUCCESS, и **OutConnectionString* содержит полную строку подключения:  
  
```cpp  
// SQLBrowseConnect_Function.cpp  
// compile with: odbc32.lib  
#include <windows.h>  
#include <sqltypes.h>  
#include <sqlext.h>  
  
#define BRWS_LEN 100  
SQLHENV henv;  
SQLHDBC hdbc;  
SQLHSTMT hstmt;  
SQLRETURN retcode;  
SQLCHAR szConnStrIn[BRWS_LEN], szConnStrOut[BRWS_LEN];  
SQLSMALLINT cbConnStrOut;  
  
void GetUserInput(SQLCHAR * szConnStrOut, SQLCHAR * szConnStrIn) {}  
  
int main() {  
   // Allocate the environment handle.  
   retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &henv);        
   if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
  
      // Set the version environment attribute.  
      retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER*)SQL_OV_ODBC3, 0);  
      if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
  
         // Allocate the connection handle.  
         retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &hdbc);  
         if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
            // Call SQLBrowseConnect until it returns a value other than SQL_NEED_DATA   
            // (pass data source name the first time).  If SQL_NEED_DATA is returned, call GetUserInput   
            // (not shown) to build a dialog from the values in szConnStrOut.  The user-supplied values   
            // are returned in szConnStrIn, which is passed in the next call to SQLBrowseConnect.  
  
            strcpy_s((char*)szConnStrIn, _countof(szConnStrIn), "DSN=Sales");  
            do {  
               retcode = SQLBrowseConnect(hdbc, szConnStrIn, SQL_NTS,  
                  szConnStrOut, BRWS_LEN, &cbConnStrOut);  
               if (retcode == SQL_NEED_DATA)  
                  GetUserInput(szConnStrOut, szConnStrIn);  
            } while (retcode == SQL_NEED_DATA);  
  
            if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO){  
  
               // Allocate the statement handle.  
               retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt);  
  
               if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO)  
                  // Process data after successful connection  
                  SQLFreeHandle(SQL_HANDLE_STMT, hstmt);  
               SQLDisconnect(hdbc);  
            }  
         }  
         SQLFreeHandle(SQL_HANDLE_DBC, hdbc);  
      }  
   }  
   SQLFreeHandle(SQL_HANDLE_ENV, henv);  
}  
```  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Выделение дескриптора соединения|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Подключение к источнику данных|[Функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md)|  
|Отключение от источника данных|[Функция SQLDisconnect](../../../odbc/reference/syntax/sqldisconnect-function.md)|  
|Подключение к источнику данных с помощью соединения строки или в диалоговом окне|[Функция SQLDriverConnect](../../../odbc/reference/syntax/sqldriverconnect-function.md)|  
|Возврат описания драйверов и атрибуты|[Функция SQLDrivers](../../../odbc/reference/syntax/sqldrivers-function.md)|  
|Освобождение дескриптора соединения|[Функция SQLFreeHandle](../../../odbc/reference/syntax/sqlfreehandle-function.md)|  
  
## <a name="see-also"></a>См. также  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
