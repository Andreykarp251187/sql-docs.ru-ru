---
title: Функция SQLDriverConnect | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLDriverConnect
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLDriverConnect
helpviewer_keywords:
- SQLDriverConnect function [ODBC]
ms.assetid: e299be1d-5c74-4ede-b6a3-430eb189134f
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: 225b882a6c48900e9a15a23e4073910315848985
ms.sourcegitcommit: 7a3243c45830cb3f49a7fa71c2991a9454fd6f5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2019
ms.locfileid: "65537643"
---
# <a name="sqldriverconnect-function"></a>Функция SQLDriverConnect
**Соответствие стандартам**  
 Представленные версии: Соответствие стандартам 1.0 ODBC: интерфейс ODBC  
  
 **Сводка**  
 **SQLDriverConnect** является альтернативой **SQLConnect**. Он поддерживает источников данных, которым требуются дополнительные сведения о соединении, чем три аргумента в **SQLConnect**, диалоговые окна для приглашение ввести все сведения о подключении и источников данных, которые не определены в системе сведения.  
  
 **SQLDriverConnect** предоставляет следующие атрибуты соединения:  
  
-   Установите подключение, используя строку подключения, которая содержит имя источника данных, один или несколько идентификаторов пользователей, один или несколько паролей и другие сведения, необходимые в источнике данных.  
  
-   Установить соединение с помощью частичной строки соединения или нет дополнительных сведений; в этом случае диспетчер драйверов и драйвер каждого запрашивать пользователя для сведений о соединении.  
  
-   Установите подключение к источнику данных, который не определен в сведениях о системе. Если приложение предоставляет частичную строку соединения, драйвер может запросить у пользователя сведения о соединении.  
  
-   Установите подключение к источнику данных, используя строку подключения, построенный на основе сведений в файле .dsn.  
  
 После того как соединение установлено, **SQLDriverConnect** возвращает полную строку подключения. Приложение может использовать эту строку для последующих запросов на соединение. Дополнительные сведения см. в разделе [подключение с помощью SQLDriverConnect](../../../odbc/reference/develop-app/connecting-with-sqldriverconnect.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLDriverConnect(  
     SQLHDBC         ConnectionHandle,  
     SQLHWND         WindowHandle,  
     SQLCHAR *       InConnectionString,  
     SQLSMALLINT     StringLength1,  
     SQLCHAR *       OutConnectionString,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   StringLength2Ptr,  
     SQLUSMALLINT    DriverCompletion);  
```  
  
## <a name="arguments"></a>Аргументы  
 *ConnectionHandle*  
 [Вход] Дескриптор соединения.  
  
 *WindowHandle*  
 [Вход] Дескриптор окна. Можно передать дескриптор родительского окна, если это применимо, или указатель null, если параметр неприменим дескриптор окна или **SQLDriverConnect** диалоговые не отображаются.  
  
 *InConnectionString*  
 [Вход] Строка подключения целиком (см. в разделе синтаксиса в «Комментарии»), частичная строка подключения, или пустая строка.  
  
 *StringLength1*  
 [Вход] Длина **InConnectionString*, в символах, если строка Юникода или байтов, если строка ANSI или DBCS.  
  
 *OutConnectionString*  
 [Выход] Указатель на буфер для полную строку подключения. После успешного подключения к целевому источнику данных этот буфер содержит полную строку подключения. Приложения необходимо выделить по крайней мере 1 024 символов для данного буфера.  
  
 Если *OutConnectionString* имеет значение NULL, *StringLength2Ptr* по-прежнему возвращает общее число символов (включая знак завершения null для символьных данных) для возврата в буфере Указывает *OutConnectionString*.  
  
 *BufferLength*  
 [Вход] Длина **OutConnectionString* буфера в символах.  
  
 *StringLength2Ptr*  
 [Выход] Указатель на буфер, в которую будет возвращено общее число символов (за исключением знака завершения null) для возврата в \* *OutConnectionString*. Если количество символов, доступных для возврата больше или равно *BufferLength*, завершения строку подключения в \* *OutConnectionString* усекается до  *BufferLength* минус длина знак завершения null.  
  
 *DriverCompletion*  
 [Вход] Флаг, указывающий, ли диспетчер драйверов или драйвер должен запрашивать дополнительные сведения о подключении:  
  
 SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE, SQL_DRIVER_COMPLETE_REQUIRED или SQL_DRIVER_NOPROMPT.  
  
 (Дополнительные сведения см. в разделе «Комментарии».)  
  
## <a name="returns"></a>Возвращает  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_ERROR, SQL_INVALID_HANDLE, or SQL_STILL_EXECUTING.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLDriverConnect** возвращает значение SQL_ERROR или SQL_SUCCESS_WITH_INFO, можно получить путем вызова связанного значения SQLSTATE **SQLGetDiagRec** с *fHandleType*из SQL_HANDLE_DBC и *hHandle* из *ConnectionHandle*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые **SQLDriverConnect** и объясняется каждый из них в контексте этой функции; описания SQLSTATE, возвращаемых диспетчером драйверов предшествует обозначение «(DM)». Возвращается связанный с каждого значения SQLSTATE значение SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Ошибка|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Специфические для драйвера информационное сообщение. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01004|Усечение данных строки справа|Буфер \* *OutConnectionString* не был достаточно велик для того, чтобы вернуть всю строку подключения, поэтому строка соединения была усечена. Длина строки неусеченный соединение возвращается в **StringLength2Ptr*. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01S00|Недопустимый атрибут строки подключения|В строке подключения указано ключевое слово недопустимый атрибут (*InConnectionString*), но драйвер не может подключиться к источнику данных в любом случае. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01S02|Значение параметра изменено|Драйвер не поддерживает указанное значение, на которые указывают *ValuePtr* аргумента в **SQLSetConnectAttr** и заменить примерно такое же значение. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01S08|Ошибка при сохранении файлового DSN|Строка, содержащаяся в  *\*InConnectionString* содержится **FILEDSN** ключевое слово, но .dsn файл не был сохранен. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|01S09|Недопустимое ключевое слово|(DM) строки в  *\*InConnectionString* содержится **SAVEFILE** ключевое слово, но не **ДРАЙВЕР** или **FILEDSN** Ключевое слово. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|08001|Не удается установить подключение клиента|Драйвер не удалось установить соединение с источником данных.|  
|08002|Имя подключения используется|(DM) указанного *ConnectionHandle* уже была использована для установления соединения с источником данных и подключение было еще открыт.|  
|08004|Сервер отклонил подключение|Источник данных отклонены установление соединения по причинам, определяемого реализацией.|  
|08S01|Отказ канала связи|Сбой в канале связи между драйвером и источника данных, к которому пытается подключиться драйвер перед **SQLDriverConnect** обработки функции было завершено.|  
|28000|Недопустимая спецификация авторизации|Идентификатор пользователя и строка авторизации либо оба, как указано в строке подключения (*InConnectionString*), нарушены ограничения, определенные в источнике данных.|  
|HY000|Общая ошибка|Произошла ошибка, для которой было нет конкретных SQLSTATE и SQLSTATE не зависящие от реализации, который был определен. Сообщение об ошибке, возвращенные **SQLGetDiagRec** в  *\*szMessageText* буфера описывает ошибку и его причины.|  
|HY000|Общая ошибка: Недопустимый файл dsn|(DM) строки в **InConnectionString* содержится ключевое слово FILEDSN, но не удалось найти имя файла .dsn.|  
|HY000|Общая ошибка: Не удалось создать буфер для файла|(DM) строки в **InConnectionString* содержится ключевое слово FILEDSN, но не удается прочитать файл .dsn.|  
|HY001|Ошибка выделения памяти|Диспетчер драйверов не удалось выделить память, необходимую для поддержки выполнения или завершения **SQLDriverConnect** функции.<br /><br /> Драйвер не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Операция отменена|Асинхронная обработка была включена для *ConnectionHandle*. Функция была вызвана, и до его завершения выполнения, [функция SQLCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md) был вызван для *ConnectionHandle*, а затем **SQLDriverConnect** функция была вызвана снова на *ConnectionHandle*.<br /><br /> Или **SQLDriverConnect** была вызвана функция, и до его завершения выполнения, **SQLCancelHandle** был вызван для *ConnectionHandle* из другого потока в многопоточные приложения.|  
|HY010|Ошибка последовательности функций|(DM) другой функции асинхронного выполнения (не **SQLDriverConnect**) был вызван для *ConnectionHandle* и еще выполнялась при **SQLDriverConnect** функция была вызвана.|  
|HY013|Ошибка управления памятью|**SQLDriverConnect** вызов функции не может быть обработан, так как базовые объекты памяти оказываются недоступны, возможно из-за нехватки памяти.|  
|HY090|Недопустимая длина строки или буфера|(DM) значение, указанное для аргумента *StringLength1* меньше 0 и не равно SQL_NTS.<br /><br /> (DM) значение, указанное для аргумента *BufferLength* меньше 0.|  
|HY092|Недопустимый атрибут/идентификатор параметра|(DM) *DriverCompletion* аргумент был SQL_DRIVER_PROMPT, а *WindowHandle* аргумент был пустым указателем.|  
|HY110|Недопустимый аргумент fdrivercompletion|(DM) значение, указанное для аргумента *DriverCompletion* не равно SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE, SQL_DRIVER_NOPROMPT или SQL_DRIVER_COMPLETE_REQUIRED.<br /><br /> (DM) организация пулов соединений была включена, и значение, указанное для аргумента *DriverCompletion* не равным SQL_DRIVER_NOPROMPT.|  
|HYC00|Дополнительная возможность не реализована|Драйвер не поддерживает версию ODBC поведение запрашиваемый приложением.|  
|HYT00|Время ожидания истекло|Истекло время ожидания входа для подключения к источнику данных завершена. Период ожидания задается с помощью **SQLSetConnectAttr**, SQL_ATTR_LOGIN_TIMEOUT.|  
|HYT01|Время ожидания подключения истекло|Время ожидания подключения истекло раньше, чем ответил на запрос источника данных. Период времени ожидания задается с помощью **SQLSetConnectAttr**, sql_attr_connection_timeout не учитывается.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) драйвер, соответствующий заданным именем источника данных не поддерживает функцию.|  
|IM002|Не удалось найти источник данных и не указан драйвер, по умолчанию|Имя, указанное в строке подключения источника данных (интеллектуальный анализ данных) (*InConnectionString*) не удалось найти сведения о системе и происходит без спецификации драйвера по умолчанию.<br /><br /> (DM) ODBC данных по умолчанию драйвер сведения об источнике и не удалось найти сведения о системе.|  
|IM003|Не удалось загрузить указанный драйвер|(DM) драйвер, перечисленные в спецификации источника данных в сведения о системе или заданные **ДРАЙВЕР** ключевое слово не найден или не может быть загружен по другой причине.|  
|IM004|Драйвера **SQLAllocHandle** на SQL_HANDLE_ENV сбой|(DM) во время **SQLDriverConnect**, диспетчер драйверов называемая драйвером **SQLAllocHandle** функционировать с *fHandleType* SQL_HANDLE_ENV и драйвер возвращается Ошибка.|  
|IM005|Драйвера **SQLAllocHandle** на SQL_HANDLE_DBC не удалось.|(DM) во время **SQLDriverConnect**, диспетчер драйверов называемая драйвером **SQLAllocHandle** функционировать с *fHandleType* SQL_HANDLE_DBC и драйвер возвращается Ошибка.|  
|IM006|Драйвера **SQLSetConnectAttr** не удалось|(DM) во время **SQLDriverConnect**, диспетчер драйверов называемая драйвером **SQLSetConnectAttr** функция и драйвер вернул ошибку.|  
|IM007|Нет источника данных или драйвера задан; Открытие диалогового окна невозможно|Нет имя источника данных или драйвер был указан в строке подключения и *DriverCompletion* был SQL_DRIVER_NOPROMPT.|  
|IM008|Ошибка диалогового окна|Драйвер пытается отобразить его диалоговое окно входа и не удалось.<br /><br /> *WindowHandle* был пустым указателем, и *DriverCompletion* не SQL_DRIVER_NO_PROMPT.|  
|IM009|Не удалось загрузить DLL перевода|Драйвер не удалось загрузить преобразование библиотеки DLL, указанный для источника данных или для подключения.|  
|IM010|Слишком длинное имя источника данных|(DM), значение атрибута для ключевое слово DSN длилось больше SQL_MAX_DSN_LENGTH символов.|  
|IM011|Слишком длинное имя драйвера|(DM), значение атрибута для **ДРАЙВЕР** ключевое слово длилось больше 255 символов.|  
|IM012|Синтаксическая ошибка ДРАЙВЕРА ключевое слово|Значение ключевого слова (DM), пары для **ДРАЙВЕР** ключевое слово содержит синтаксическую ошибку.<br /><br /> (DM) строки в  *\*InConnectionString* содержится **FILEDSN** ключевое слово, но .dsn файл не содержал **ДРАЙВЕР** ключевое слово или  **DSN** ключевое слово.|  
|IM014|Указанное имя источника данных содержит несоответствие архитектуры драйвера и приложения|32-разрядное приложение (DM) использует имя DSN, подключении к 64-разрядный драйвер; и наоборот.|  
|IM015|Не удалось SQLDriverConnect драйвера на SQL_HANDLE_DBC_INFO_HANDLE|Если драйвер возвращает значение SQL_ERROR, диспетчер драйверов вернет значение SQL_ERROR в приложение, и произойдет сбой подключения.<br /><br /> Дополнительные сведения о SQL_HANDLE_DBC_INFO_TOKEN, см. в разделе [драйвера ODBC с поддержкой пула подключений разработка](../../../odbc/reference/develop-driver/developing-connection-pool-awareness-in-an-odbc-driver.md).|  
|IM017|Опрос недоступен в режиме асинхронное уведомление|Каждый раз, когда используется модель уведомлений, отключен опроса.|  
|IM018|**SQLCompleteAsync** не был вызван для завершения предыдущей асинхронной операции на этот дескриптор.|Если предыдущий вызов функции в дескриптор возвращает SQL_STILL_EXECUTING, и если включен режим уведомлений, **SQLCompleteAsync** должен вызываться с дескриптором постобработки и завершить операцию.|  
|S1118|Драйвер не поддерживает асинхронное уведомление|Если драйвер не поддерживает асинхронное уведомление, невозможно задать SQL_ATTR_ASYNC_DBC_EVENT или SQL_ATTR_ASYNC_DBC_RETCODE_PTR.|  
  
## <a name="comments"></a>Комментарии  
 Строка подключения имеет следующий синтаксис:  
  
 *connection-string* ::= *empty-string*[;] &#124; *attribute*[;] &#124; *attribute*; *connection-string*  
  
 *empty-string* ::=*attribute* ::= *attribute-keyword*=*attribute-value* &#124; DRIVER=[{]*attribute-value*[}]  
  
 *attribute-keyword* ::= DSN &#124; UID &#124; PWD &#124; *driver-defined-attribute-keyword*  
  
 *attribute-value* ::= *character-string*  
  
 *driver-defined-attribute-keyword* ::= *identifier*  
  
 где *символьной строки* имеет ноль или несколько символов. *идентификатор* имеет один или несколько символов. *ключевым словом атрибутов* задается без учета регистра; *значение атрибута* возможно, с учетом регистра; и значение **DSN** ключевое слово не состоит исключительно из пробелов.  
  
 Из-за строки и инициализации файла грамматики, ключевые слова и атрибут значения подключения, которые содержат символы **[]{}(),? \*=! @** не заключено в фигурные скобки следует избегать. Значение **DSN** ключевое слово не может состоять только из пробелов и не должно содержать начальные пробелы. Из-за Грамматика сведения о системе, ключевые слова и имена источников данных не может содержать обратную косую черту (\\) символов.  
  
 Приложения не нужно добавить фигурные скобки вокруг значения атрибута после **ДРАЙВЕР** ключевое слово, если атрибут должен содержать точку с запятой (;), в этом случае требуются фигурные скобки. Если значение атрибута, который получает драйвер включает фигурные скобки, драйвер не следует удалять их, но они должны быть частью возвращаемой строки подключения.  
  
 Строковое значение имени DSN или подключения заключено в фигурные скобки ({}) содержащее знаки **[]{}(),? \*=! @** передается без изменений к драйверу. Тем не менее при использовании этих символов в ключевом слове, the Driver Manager возвращает ошибку при работе с файлом источников данных, но передает строку подключения к драйверу правильных строк подключения. Избегайте использования внедренных фигурных скобок в значение ключевого слова.  
  
 Строка подключения может содержать любое количество ключевых слов, определяемым драйвером. Так как **ДРАЙВЕР** ключевое слово не использует сведения из информации о системе, драйвер должен определить достаточно ключевые слова, что драйвер позволяет подключаться к источнику данных, используя только данные в строке подключения. (Дополнительные сведения см. в разделе «Драйвер правила,» далее в этом разделе.) Драйвер определяет, какие ключевые слова необходимы для подключения к источнику данных.  
  
 В следующей таблице описаны значения атрибута **DSN**, **FILEDSN**, **ДРАЙВЕР**, **UID**, **PWD**, и **SAVEFILE** ключевые слова.  
  
|Ключевое слово|Описание значения атрибута|  
|-------------|---------------------------------|  
|**DSN**|Имя источника данных, возвращенная **SQLDataSources** или диалоговом окне источников данных из **SQLDriverConnect**.|  
|**FILEDSN**|Имя файла .dsn из которого будет создаваться строку подключения для источника данных. Эти источники данных, называются файловые источники данных.|  
|**ДРАЙВЕР**|Описание драйвера, возвращенная **SQLDrivers** функции. Например Rdb или SQL Server.|  
|**UID**|Идентификатор пользователя.|  
|**PWD**|Пароль, соответствующий идентификатор пользователя, или пустая строка, если нет пароля для идентификатора пользователя (PWD =;).|  
|**SAVEFILE**|Имя файла .dsn файла, в котором следует сохранить значения атрибутов ключевых слов, используемых в соединении присутствует, успешно.|  
  
 Сведения о том, как приложение выбирает источник данных или драйвера, см. в разделе [Выбор источника данных или драйвера](../../../odbc/reference/develop-app/choosing-a-data-source-or-driver.md).  
  
 Если любые ключевые слова повторяются в строке подключения, драйвер использует значение, связанное с первого вхождения ключевого слова. Если **DSN** и **ДРАЙВЕР** ключевые слова, включаются в ту же строку подключения, диспетчер драйверов и драйвер используйте, занимающий первую позицию любого ключевого слова.  
  
 **FILEDSN** и **DSN** ключевые слова являются взаимоисключающими: какой ключевое слово встречается первый используется, и что второй игнорируется. **FILEDSN** и **ДРАЙВЕР** ключевые слова, с другой стороны, не являются взаимоисключающими. Если любой ключевое слово встречается в строке подключения с **FILEDSN**, то значение атрибута ключевое слово в строке подключения используется вместо значения атрибута в файле .dsn одно ключевое слово.  
  
 Если **FILEDSN** используется ключевое слово, ключевые слова, указанные в файле .dsn используются для создания строки подключения. (Дополнительные сведения см. в разделе «Файловые источники данных,» далее в этом разделе.) **UID** ключевое слово является необязательным; .dsn файл может быть создан только **ДРАЙВЕР** ключевое слово. **PWD** ключевое слово не хранится в файле .dsn. Каталог по умолчанию для сохранения и загрузки файла .dsn будет представлять собой сочетание пути, указанному свойством **CommonFileDir** HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ Windows\CurrentVersion и «ODBC\DataSources». (Если CommonFileDir «C:\Program Files\Common Files», каталог по умолчанию будет «C:\Program Files\Common Files\ODBC\Data источников».)  
  
> [!NOTE]  
>  Файл .dsn можно управлять напрямую путем вызова [SQLReadFileDSN](../../../odbc/reference/syntax/sqlreadfiledsn-function.md) и [SQLWriteFileDSN](../../../odbc/reference/syntax/sqlwritefiledsn-function.md) функции в DLL установщика.  
  
 Если **SAVEFILE** используется ключевое слово, значения атрибутов ключевых слов, используемых в соединении присутствует, успешно сохраняется как файл .dsn с именем значения атрибута **SAVEFILE** Ключевое слово. **SAVEFILE** слово должно использоваться в сочетании с **ДРАЙВЕР** ключевое слово, **FILEDSN** ключевое слово (или оба) или функция возвращает значение SQL_SUCCESS_WITH_INFO с SQLSTATE 01S09 (недопустимое ключевое слово). **SAVEFILE** ключевое слово должно стоять перед **ДРАЙВЕР** ключевое слово в строке подключения или результаты будут неопределенными.  
  
## <a name="driver-manager-guidelines"></a>Рекомендации по диспетчера драйверов  
 Диспетчер драйверов создает строку подключения для передачи драйверу в *InConnectionString* аргумент драйвера **SQLDriverConnect** функции. Диспетчер драйверов не изменяет *InConnectionString* аргумент, переданный в него приложением.  
  
 Действие диспетчера драйверов основан на значении *DriverCompletion* аргумент:  
  
-   SQL_DRIVER_PROMPT: Если строка подключения не содержит либо **ДРАЙВЕР**, **DSN**, или **FILEDSN** ключевое слово, диспетчер драйверов отображает диалоговое окно источников данных. Он создает строку подключения из имя источника данных, возвращаемых диалоговым окном и любые другие ключевые слова, переданного ему средой приложения. Если имя источника данных, возвращаемых диалоговым окном пуст, диспетчер драйверов задает пару значение ключевого слова DSN = значение по умолчанию. (Это диалоговое окно не отображается источник данных с именем «Default».)  
  
-   SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED: Если строка подключения, указанная для приложения включает в себя **DSN** ключевое слово, диспетчер драйверов копирует строку подключения, заданного приложением. В противном случае он принимает те же действия как в случае, когда *DriverCompletion* является SQL_DRIVER_PROMPT.  
  
-   SQL_DRIVER_NOPROMPT: Диспетчер драйверов копирует строку подключения, заданного приложением.  
  
 Если строка подключения, задаваемый приложением объект содержит **ДРАЙВЕР** ключевое слово, диспетчер драйверов копирует строку подключения, заданного приложением.  
  
 С помощью строки подключения, которую он создан, the Driver Manager определяет, какой драйвер следует использовать, подключается к этому драйверу и передает строку подключения, которую он создан для драйвера. Дополнительные сведения о взаимодействии между диспетчера драйверов и драйвер, см. в разделе «Комментарии» в [функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md). Если строка подключения не содержит **ДРАЙВЕР** ключевое слово, the Driver Manager определяет, какой драйвер следует использовать следующим образом:  
  
1.  Если строка подключения содержит **DSN** ключевое слово, диспетчер драйверов извлекает драйвера, связанного с источником данных из информации о системе.  
  
2.  Если строка подключения не содержит **DSN** ключевое слово или источник данных не найден, диспетчер драйверов извлекает драйвера, связанного с источником данных по умолчанию из сведений о системе. (Дополнительные сведения см. в разделе [по умолчанию подраздел](../../../odbc/reference/install/default-subkey.md).) Диспетчер драйверов изменяет значение **DSN** ключевое слово в строке подключения для «DEFAULT».  
  
3.  Если **DSN** ключевое слово в строке подключения задано значение «DEFAULT», диспетчер драйверов извлекает драйвера, связанного с источником данных по умолчанию из сведений о системе.  
  
4.  Если не удалось найти источник данных и источника данных по умолчанию не найден, диспетчер драйверов возвращает ошибку SQL_ERROR с SQLSTATE IM002 (источник данных не найден и не указан драйвер, по умолчанию).  
  
## <a name="file-data-sources"></a>Файловые источники данных  
 Если в строке подключения указан приложением при вызове **SQLDriverConnect** содержит **FILEDSN** ключевое слово и это ключевое слово не заменяется либо **DSN**или **ДРАЙВЕР** ключевое слово, а затем диспетчер драйверов создает строку подключения, используя сведения в файле .dsn и *InConnectionString* аргумент. Диспетчер драйверов продолжается следующим образом.  
  
1.  Проверяет, является ли допустимым имя файла, файла .dsn. Если нет, возвращается значение SQL_ERROR с SQLSTATE IM014 (недопустимое имя файла DSN). Если имя файла является пустой строкой ("») и SQL_DRIVER_NOPROMPT не указан, то **открывающей файл** диалоговое окно. Если имя файла содержит недопустимый путь, но не имя файла или недопустимое имя файла, а SQL_DRIVER_NOPROMPT не указан, то **открывающей файл** диалоговое окно с текущим каталогом, значение, указанное в имени файла. Если имя файла является пустой строкой ("») или имя файла содержит допустимый путь, но не имя файла или недопустимое имя файла и задано значение SQL_DRIVER_NOPROMPT, то возвращается значение SQL_ERROR с SQLSTATE IM014 (недопустимое имя файла DSN).  
  
2.  Считывает все ключевые слова в раздел [ODBC] файла .dsn. Если **ДРАЙВЕР** ключевое слово отсутствует, то возвращается значение SQL_ERROR с SQLSTATE IM012 (драйвер ключевое слово синтаксические ошибки), за исключением случаев, где .dsn файл непригоден для совместного использования и поэтому он содержит только **DSN** ключевое слово.  
  
     Если такие источнику данных, диспетчер драйверов считывает значение **DSN** ключевое слово и подключается при необходимости для пользователя или системного источника данных, на которые указывают такие источники данных. Шаги с 3 по 5 не выполняются.  
  
3.  Создает строку подключения для драйвера. Строка подключения драйвера — объединение ключевые слова, указанные в файле .dsn и теми, которые указаны в исходной строке подключения приложения. Используются следующие правила для создания строки подключения драйвера перекрытия ключевые слова:  
  
    -   Если **ДРАЙВЕР** существует ключевое слово в строке подключения приложения и драйверы, определяемое **ДРАЙВЕР** ключевые слова не совпадают в файле .dsn и в строке подключения приложения, то сведения о драйвере в файле .dsn игнорируется и используется сведений о драйвере в строке подключения приложения. Если драйверы, заданный параметром **ДРАЙВЕР** ключевое слово совпадают в файле .dsn и строки подключения приложения, то там, где пересекаются все ключевые слова, которые указаны в строке подключения приложения имеют приоритет по сравнению с тем указанный в файле .dsn.  
  
    -   В строке подключения новый **FILEDSN** больше не используется ключевое слово.  
  
4.  Загружает драйвер путем поиска в записи реестра HKEY_LOCAL_MACHINE\SOFTWARE\ODBC\ODBCINST. INI\\< имя драйвера\>\Driver где \<имя драйвера > задается **ДРАЙВЕР** ключевое слово.  
  
5.  Передает драйвер в новую строку подключения.  
  
 Примеры DSN-файлы, см. в разделе [подключение с использованием файловых источников данных](../../../odbc/reference/develop-app/connecting-using-file-data-sources.md).  
  
## <a name="savefile-keyword"></a>Ключевое слово SAVEFILE  
 Если строка подключения, задаваемый приложением объект содержит **SAVEFILE** ключевое слово, а затем диспетчер драйверов сохраняет строку подключения в файле .dsn. Диспетчер драйверов продолжается следующим образом.  
  
1.  Проверяет, включены ли имя файла, файла .dsn как значение атрибута **SAVEFILE** ключевое слово может использоваться. Если нет, возвращается значение SQL_ERROR с SQLSTATE IM014 (недопустимое имя файла DSN). Допустимость имени файла определяется по правилам именования стандартной системы. Если имя файла является пустой строкой ("») и *DriverCompletion* аргумент не SQL_DRIVER_NOPROMPT, то имя файла является допустимым. Если имя файла уже существует, то если *DriverCompletion* равно SQL_DRIVER_NOPROMPT, файл будет перезаписан. Если *DriverCompletion* SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED, диалоговое окно с предложением пользователю указать, следует ли перезаписывать файл. Если не введено, то **сохранить файл** откроется диалоговое окно.  
  
2.  Если драйвер возвращает SQL_SUCCESS и имя файла не является пустой строкой, то диспетчера драйверов записывает сведения о соединении, возвращаемых в *OutConnectionString* аргумента в указанный файл в формате, указанном в в разделе «Строки подключения» ранее в этом разделе.  
  
3.  Если драйвер возвращает значение SQL_SUCCESS, и имя файла является пустой строкой ("»), затем диспетчер драйверов вызывает **сохранить файл** общее диалоговое окно с *hwnd* указан и записывает сведения о соединении возвращается в *OutConnectionString* к файлу, указанному в общее диалоговое окно сохранения файла в формате, указанном в разделе «Строки подключения» ранее в этом разделе.  
  
4.  Если драйвер возвращает значение SQL_SUCCESS, он возвращает *OutConnectionString* аргумента, содержащего строку подключения к приложению.  
  
5.  Если драйвер возвращает SQL_SUCCESS_WITH_INFO или SQL_ERROR, диспетчер драйверов возвращает SQLSTATE приложению.  
  
## <a name="driver-guidelines"></a>Рекомендации по драйверов  
 Драйвер проверяет, содержит ли строка подключения, переданного ему диспетчером драйверов **DSN** или **ДРАЙВЕР** ключевое слово. Если строка подключения содержит **ДРАЙВЕР** ключевое слово, драйвер не удается получить сведения об источнике данных из информации о системе. Если строка подключения содержит **DSN** ключевое слово или не содержит либо **DSN** или **ДРАЙВЕР** ключевое слово, драйвер может получать сведения об источнике данных в сведениях о системе следующим образом:  
  
1.  Если строка подключения содержит **DSN** ключевое слово, драйвер возвращает сведения для указанного источника данных.  
  
2.  Если строка подключения не содержит **DSN** ключевое слово, не найден указанный источник данных, или **DSN** ключевое слово имеет значение «DEFAULT», драйвер возвращает сведения о источника данных по умолчанию .  
  
 Драйвер использует данные, получаемые от сведений о системе для расширения сведений, переданных в строке подключения. Если информация в сведениях о системе дублирует сведения в строке подключения, драйвер использует информацию в строке подключения.  
  
 На основе значения из *DriverCompletion*, драйвер запрашивает у пользователя сведения о соединении, например идентификатор пользователя и пароль и подключается к источнику данных:  
  
-   SQL_DRIVER_PROMPT: Драйвер отображает в диалоговом окне, используя значения из строки и системы сведения о соединении (если таковые имеются) как исходные значения. Когда пользователь выходит из диалоговом окне, драйвер подключается к источнику данных. Он также создает строку подключения из значения **DSN** или **ДРАЙВЕР** ключевое слово в \* *InConnectionString* и сведения, полученные из диалоговое окно. Он помещает эту строку подключения в **OutConnectionString* буфера.  
  
-   SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED: Если строка подключения содержит достаточно информации, и оно задано правильно, драйвер подключается к источнику данных и копирует \* *InConnectionString* для \* *OutConnectionString* . Если данные отсутствуют или неверны, драйвер принимает те же действия, как в случае, когда *DriverCompletion* является SQL_DRIVER_PROMPT, за исключением случаев, если *DriverCompletion* является SQL_DRIVER_COMPLETE_ ОБЯЗАТЕЛЬНО, драйвер отключает элементы управления, все данные, для подключения к источнику данных не требуется.  
  
-   SQL_DRIVER_NOPROMPT: Если строка подключения содержит достаточно информации, драйвер подключается к источнику данных и копирует \* *InConnectionString* для \* *OutConnectionString*. Драйвер в противном случае возвращает значение SQL_ERROR для **SQLDriverConnect**.  
  
 При успешном подключении к источнику данных, драйвер также задает \* *StringLength2Ptr* длине полученную строку подключения, которая доступна для возврата в **OutConnectionString*.  
  
 Если пользователь отменяет диалоговое окно, представленный диспетчера драйверов или драйвер, **SQLDriverConnect** не вернет значение SQL_NO_DATA.  
  
 Сведения о действиях диспетчера драйверов и драйвера во время подключения, см. в разделе [функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md).  
  
 Если драйвер поддерживает **SQLDriverConnect**, должен содержать раздел ключевое слово driver информация о системе для драйвера **ConnectFunctions** значение ключевого слова with второй символ «Y».  
  
## <a name="connecting-when-connection-pooling-is-enabled"></a>Подключение, когда включено использование пулов соединений  
 Организация пулов соединений позволяет приложению повторно использовать соединение, уже существует. Когда **SQLDriverConnect** называется диспетчер драйверов пытается подключиться с помощью подключения, который является частью пула подключений в среде, предназначенных для организации пулов соединений. Дополнительные сведения о пулах соединений см. в разделе [функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md).  
  
 Приложение может задать SQL_ATTR_RESET_CONNECTION перед вызовом SQLDisconnect для подключения, где пул включен. Дополнительные сведения см. в разделе [SQLSetConnectAttr, функция](../../../odbc/reference/syntax/sqlsetconnectattr-function.md).  
  
 Применяются следующие ограничения, когда приложение вызывает **SQLDriverConnect** для подключения к соединение из пула:  
  
-   Нет подключений в пул обработки выполняется при **SAVEFILE** указывается ключевое слово в строке подключения.  
  
-   Если включено использование пулов соединений, **SQLDriverConnect** может вызываться только с *DriverCompletion* аргумент SQL_DRIVER_NOPROMPT; Если **SQLDriverConnect** называется для любого другого *DriverCompletion*, SQLSTATE HY110 (недопустимый аргумент fdrivercompletion) будет возвращено.  
  
## <a name="connection-attributes"></a>Атрибуты соединения  
 Атрибут соединения SQL_ATTR_LOGIN_TIMEOUT, заданные с помощью **SQLSetConnectAttr**, определяет количество секунд ожидания для запроса имени входа для выполнения успешного соединения с помощью драйвера перед возвратом к приложению. Если пользователю будет предложено запустить строку подключения, период ожидания для каждого запроса на вход начинается, когда драйвер выполняет подключение.  
  
 Драйвер открывает соединение в режиме доступа SQL_MODE_READ_WRITE по умолчанию. Чтобы задать режим доступа к SQL_MODE_READ_ONLY, приложение должно вызвать **SQLSetConnectAttr** с атрибутом SQL_ATTR_ACCESS_MODE до вызова метода **SQLDriverConnect**.  
  
 Если библиотека преобразования по умолчанию указан в сведениях о системе для источника данных, драйвер загружает его. Можно загрузить библиотеку разных транслируемых путем вызова **SQLSetConnectAttr** с помощью настройки SQL_ATTR_TRANSLATE_LIB атрибута. Вариант перевода можно указать путем вызова **SQLSetConnectAttr** с параметром SQL_ATTR_TRANSLATE_OPTION.  
  
 Дополнительные сведения см. в разделе [подключение с помощью SQLDriverConnect](../../../odbc/reference/develop-app/connecting-with-sqldriverconnect.md).  
  
```cpp  
// SQLDriverConnect_ref.cpp  
// compile with: odbc32.lib user32.lib  
#include <windows.h>  
#include <sqlext.h>  
  
int main() {  
   SQLHENV henv;  
   SQLHDBC hdbc;  
   SQLHSTMT hstmt;  
   SQLRETURN retcode;  
  
   SQLCHAR OutConnStr[255];  
   SQLSMALLINT OutConnStrLen;  
  
   HWND desktopHandle = GetDesktopWindow();   // desktop's window handle  
  
   // Allocate environment handle  
   retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &henv);  
  
   // Set the ODBC version environment attribute  
   if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
      retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER*)SQL_OV_ODBC3, 0);   
  
      // Allocate connection handle  
      if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
         retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &hdbc);   
  
         // Set login timeout to 5 seconds  
         if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
            SQLSetConnectAttr(hdbc, SQL_LOGIN_TIMEOUT, (SQLPOINTER)5, 0);  
  
            retcode = SQLDriverConnect( // SQL_NULL_HDBC  
               hdbc,   
               desktopHandle,   
               (SQLCHAR*)"driver=SQL Server",   
               _countof("driver=SQL Server"),  
               OutConnStr,  
               255,   
               &OutConnStrLen,  
               SQL_DRIVER_PROMPT );  
  
            // Allocate statement handle  
            if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {                 
               retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt);   
  
               // Process data  
               if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
                  SQLFreeHandle(SQL_HANDLE_STMT, hstmt);  
               }  
  
               SQLDisconnect(hdbc);  
            }  
  
            SQLFreeHandle(SQL_HANDLE_DBC, hdbc);  
         }  
      }  
      SQLFreeHandle(SQL_HANDLE_ENV, henv);  
   }  
}  
```  
  
 Также см. в разделе [образец программы ODBC](../../../odbc/reference/sample-odbc-program.md).  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Выделение дескриптора|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Обнаружение и перечисление значений, необходимых для подключения к источнику данных|[Функция SQLBrowseConnect](../../../odbc/reference/syntax/sqlbrowseconnect-function.md)|  
|Подключение к источнику данных|[Функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md)|  
|Отключение от источника данных|[Функция SQLDisconnect](../../../odbc/reference/syntax/sqldisconnect-function.md)|  
|Возврат описания драйверов и атрибуты|[Функция SQLDrivers](../../../odbc/reference/syntax/sqldrivers-function.md)|  
|Освобождение дескриптора|[Функция SQLFreeHandle](../../../odbc/reference/syntax/sqlfreehandle-function.md)|  
|Присвоение атрибуту соединения|[Функция SQLSetConnectAttr](../../../odbc/reference/syntax/sqlsetconnectattr-function.md)|  
  
## <a name="see-also"></a>См. также  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
