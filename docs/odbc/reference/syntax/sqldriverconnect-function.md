---
title: Функция S'LDriverConnect Документы Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLDriverConnect
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLDriverConnect
helpviewer_keywords:
- SQLDriverConnect function [ODBC]
ms.assetid: e299be1d-5c74-4ede-b6a3-430eb189134f
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 88ec70d68b46beca97fd6b0d758e21aab5d4f4b2
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81302775"
---
# <a name="sqldriverconnect-function"></a>Функция SQLDriverConnect
**Соответствия**  
 Версия Введена: Соответствие стандартам ODBC 1.0: ODBC  
  
 **Сводка**  
 **СЗЛДрайверКоннект** является альтернативой **S'LConnect**. Он поддерживает источники данных, которые требуют больше информации о подключении, чем три аргумента в **диалоговых ящиках,** чтобы побудить пользователя для всей информации о подключении, и источники данных, которые не определены в системной информации.  
  
 **SLDriverConnect** предоставляет следующие атрибуты соединения:  
  
-   Установите соединение с помощью строки соединения, содержащей имя источника данных, один или несколько идентиматозов пользователей, один или несколько паролей и другую информацию, требуемую источником данных.  
  
-   Установить соединение с помощью частичной строки подключения или без дополнительной информации; в этом случае менеджер драйвера и водитель могут подсказать пользователю информацию о связи.  
  
-   Установить подключение к источнику данных, который не определен в информации системы. Если приложение предоставляет частичную строку соединения, драйвер может засказать пользователю информацию о связи.  
  
-   Установить подключение к источнику данных с помощью строки соединения, построенной из информации в файле .dsn.  
  
 После установления соединения **s'LDriverConnect** возвращает завершенную строку подключения. Приложение может использовать эту строку для последующих запросов на подключение. Для получения дополнительной [информации см.](../../../odbc/reference/develop-app/connecting-with-sqldriverconnect.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLDriverConnect(  
     SQLHDBC         ConnectionHandle,  
     SQLHWND         WindowHandle,  
     SQLCHAR *       InConnectionString,  
     SQLSMALLINT     StringLength1,  
     SQLCHAR *       OutConnectionString,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   StringLength2Ptr,  
     SQLUSMALLINT    DriverCompletion);  
```  
  
## <a name="arguments"></a>Аргументы  
 *ПодключениеРучка*  
 [Input] Дескриптор подключения  
  
 *Окно Ручка*  
 (Вход) Ручка окна. Приложение может передать ручку родительского окна, если это применимо, или указатель на неволе, если ручка окна не применима, либо **S'LDriverConnect** не представит никаких диалоговых коробок.  
  
 *InConnectionString*  
 (Вход) Строка полного соединения (см. синтаксис в "Комментарии"), частичная строка соединения или пустая строка.  
  
 *Струннаядлина1*  
 (Вход) Длина*InConnectionString*, в символах, если строка Unicode, или байты, если строка ANSI или DBCS.  
  
 *OutConnectionString*  
 (Выход) Указатель на буфер для завершенной строки соединения. При успешном подключении к целевому источнику данных этот буфер содержит завершенную строку соединения. Приложения должны выделять не менее 1024 символов для этого буфера.  
  
 Если *OutConnectionString* является NULL, *StringLength2Ptr* по-прежнему возвращает общее количество символов (за исключением символа с нулевым прекращением для данных символов), доступных для возврата в буфере, на который указывает *OutConnectionString.*  
  
 *BufferLength*  
 (Вход) Длина буфера*OutConnectionString* в символах.  
  
 *СтрунныйДлин2Птр*  
 (Выход) Указатель на буфер, в котором можно вернуть общее количество символов (за исключением символа нулевого прекращения), доступного для возврата в \* *OutConnectionString.* Если количество символов, доступных для возврата, больше или равно *BufferLength,* завершенная строка соединения в \* *OutConnectionString* усечена до *BufferLength* минус длина персонажа с нулевым прекращением.  
  
 *DriverCompletion*  
 (Вход) Пометить, должен ли менеджер или водитель запроса для получения дополнительной информации о подключении:  
  
 SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE, SQL_DRIVER_COMPLETE_REQUIRED или SQL_DRIVER_NOPROMPT.  
  
 (Для получения дополнительной информации см.  
  
## <a name="returns"></a>Результаты  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_ERROR, SQL_INVALID_HANDLE или SQL_STILL_EXECUTING.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **S'LDriverConnect** возвращается либо SQL_ERROR, либо SQL_SUCCESS_WITH_INFO, связанное с этим значение S'LSTATE может быть получено, позвонив по **телефону s'LGetDiagRec** с *помощью fHandleType* SQL_HANDLE_DBC и *hHandle* of *ConnectionHandle.* В следующей таблице перечислены значения S'LSTATE, обычно возвращаемые **S'LDriverConnect,** и приведены в контексте этой функции. нотация "(DM)" предшествует описаниям S'LSTATEs, возвращенным менеджером драйвера. Код возврата, связанный с каждым значением S'LSTATE, является SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Error|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение, конкретное для водителя. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01004|Строковые данные, правые усеченные|Буфер \* *OutConnectionString* не был достаточно большим, чтобы вернуть всю строку соединения, поэтому строка соединения была усечена. Длина непросеченной строки соединения возвращается в*строке StringLength2Ptr*. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01S00|Недействительный атрибут строки соединения|Недействительный ключевое слово атрибута было указано в строке соединения (*InConnectionString*), но водитель смог подключиться к источнику данных в любом случае. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01S02|Изменение значения опциона|Драйвер не поддержал указанное значение, указанное аргументом *ValuePtr* в **S'LSetConnectAttr,** и заменил аналогичное значение. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01S08|Сохранение ошибки файл DSN|Строка в * \*InConnectionString* содержала ключевое слово **FILEDSN,** но файл .dsn не был сохранен. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01S09|Недействительные ключевые слова|(DM) Строка в * \*InConnectionString* содержала ключевое слово **SAVEFILE,** но не **DRIVER** или ключевое слово **FILEDSN.** (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|08001|Клиент не может установить соединение|Водитель не смог установить связь с источником данных.|  
|08002|Имя соединения в использовании|(DM) Указанный *ConnectionHandle* уже использовался для установления связи с источником данных, и соединение по-прежнему открыто.|  
|08004|Сервер отклонил соединение|Источник данных отклонил установление соединения по причинам, определенным для реализации.|  
|08S01|Сбой связи|Связь между драйвером и источником данных, к которому пытался подключиться, не сработала до завершения обработки функции **S'LDriverConnect.**|  
|28000|Недействительная спецификация авторизации|Либо идентификатор пользователя или строка авторизации, либо и то, и другое, как указано в строке соединения *(InConnectionString),* нарушили ограничения, определенные источником данных.|  
|HY000|Общая ошибка|Произошла ошибка, в соответствии с которой не было конкретного S'LSTATE и для которой не было определено конкретное осуществление СЗЛСТАТ. Сообщение об ошибке, возвращенное **S'LGetDiagRec** в * \*буфере szMessageText,* описывает ошибку и ее причину.|  
|HY000|Общая ошибка: Недействительный файл dsn|(DM) Строка в*InConnectionString* содержала ключевое слово FILEDSN, но название файла .dsn не было найдено.|  
|HY000|Общая ошибка: Невозможно создать буфер файла|(DM) Строка в*InConnectionString* содержала ключевое слово FILEDSN, но файл .dsn был нечитаемым.|  
|HY001|Ошибка распределения памяти|Менеджер драйвера не смог выделить память, необходимую для поддержки выполнения или завершения функции **S'LDriverConnect.**<br /><br /> Водитель не смог выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Operation canceled|Асинхронная обработка была включена для *ConnectionHandle*. Функция была вызвана, и перед завершением выполнения [функция S'LCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md) была вызвана на *ConnectionHandle,* а затем функция **S'LDriverConnect** была снова вызвана на *ConnectionHandle.*<br /><br /> Или функция **S'LDriverConnect** была вызвана, и перед завершением **выполнения, S'LCancelHandle** был вызван на *ConnectionHandle* из другого потока в многопоточном приложении.|  
|HY010|Ошибка последовательности функций|(DM) Еще одна асинхронно исполняемые функции (не **S'LDriverConnect**) была вызвана для *ConnectionHandle* и по-прежнему выполнения, когда функция **S'LDriverConnect** был вызван.|  
|HY013|Ошибка управления памятью|Вызов функции **S'LDriverConnect** не может быть обработан, поскольку основные объекты памяти не могут быть доступны, возможно, из-за низких условий памяти.|  
|HY090|Недействительная длина строки или буфера|(DM) Значение, указанное для аргумента *StringLength1,* было меньше 0 и не было равно SQL_NTS.<br /><br /> (DM) Значение, указанное для *аргумента BufferLength* было меньше, чем 0.|  
|HY092|Недействительный идентификатор атрибута/опциона|(DM) Аргумент *DriverCompletion* был SQL_DRIVER_PROMPT, и аргумент *WindowHandle* был нулевым указателем.|  
|HY110|Недействительное завершение работы драйвера|(DM) Значение, указанное для аргумента *DriverCompletion,* не было равно SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE, SQL_DRIVER_COMPLETE_REQUIRED или SQL_DRIVER_NOPROMPT.<br /><br /> (DM) Объединение соединения было включено, и значение, указанное для аргумента *DriverCompletion,* не было равно SQL_DRIVER_NOPROMPT.|  
|HYC00|Дополнительная функция не реализована|Драйвер не поддерживает версию поведения ODBC, запрошенную приложением.|  
|HYT00|Время ожидания истекло|Период тайм-аута входа истек до завершения подключения к источнику данных. Период тайм-аута устанавливается с **помощью s'LSetConnectAttr,** SQL_ATTR_LOGIN_TIMEOUT.|  
|HYT01|Срок истечения времени подключения|Период тайм-аута соединения истек до того, как источник данных ответил на запрос. Период тайм-аута соединения устанавливается через **S'LSetConnectAttr,** SQL_ATTR_CONNECTION_TIMEOUT.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) Драйвер, соответствующий указанному названию источника данных, не поддерживает функцию.|  
|IM002|Источник данных не найден и не указан драйвер по умолчанию|(DM) Имя источника данных, указанное в строке соединения *(InConnectionString*), не было найдено в информации системы, и не было спецификации драйвера по умолчанию.<br /><br /> (DM) источник данных ODBC и информация о драйвере по умолчанию не были найдены в информации системы.|  
|IM003|Указанный драйвер не может быть загружен|(DM) Драйвер, указанный в спецификации источника данных в системной информации или указанный ключевым словом **DRIVER,** не найден или не может быть загружен по какой-либо другой причине.|  
|IM004|Водитель **S'LAllocHandle** на SQL_HANDLE_ENV не удалось|(DM) Во время **S'LDriverConnect**, менеджер драйвера назвал функцию **драйвера S'LAllocHandle** с *fHandleType* SQL_HANDLE_ENV и водитель вернулся ошибка.|  
|IM005|Водитель **s'LAllocHandle** на SQL_HANDLE_DBC не удалось.|(DM) Во время **S'LDriverConnect**, менеджер драйвера назвал функцию **драйвера S'LAllocHandle** с *fHandleType* SQL_HANDLE_DBC и водитель вернулся ошибка.|  
|IM006|Сбой **драйвера s'LSetConnectAttr**|(DM) Во время **S'LDriverConnect**, менеджер драйвера назвал функцию **драйвера S'LSetConnectAttr** и драйвер вернулся ошибка.|  
|IM007|Источник данных или драйвер не указаны; диалог запрещен|В строке соединения не было указано имя источника данных или драйвера, и *DriverCompletion* был SQL_DRIVER_NOPROMPT.|  
|IM008|Диалог не удалось|Водитель попытался отобразить свой диалоговый ящик входа и не справился с работой.<br /><br /> *WindowHandle* был нулевой указатель, и *DriverCompletion* не был SQL_DRIVER_NO_PROMPT.|  
|IM009|Невозможно загрузить перевод DLL|Водитель не смог загрузить перевод DLL, указанный для источника данных или для соединения.|  
|IM010|Имя источника данных слишком длинное|(DM) Значение атрибута для ключевого слова DSN было длиннее, чем SQL_MAX_DSN_LENGTH символов.|  
|IM011|Имя водителя слишком длинное|(DM) Значение атрибута для ключевого слова **DRIVER** было длиннее 255 символов.|  
|IM012|Driver ошибка синтаксиса ключевых слов|(DM) Пара значения ключевых слов для ключевого слова **DRIVER** содержала ошибку синтаксиса.<br /><br /> (DM) Строка в * \*InConnectionString* содержала ключевое слово **FILEDSN,** но файл .dsn не содержал ключевое слово **DRIVER** или ключевое слово **DSN.**|  
|IM014|Указанный DSN содержит несоответствие архитектуры между драйвером и приложением|(DM) 32-разрядное приложение использует DSN, соединяющийся с 64-разрядным драйвером; или наоборот.|  
|IM015|Драйвер s SLDriverConnect на SQL_HANDLE_DBC_INFO_HANDLE не удалось|Если водитель возвращается SQL_ERROR, менеджер драйвера возвращает SQL_ERROR в приложение, и подключение выйдет из строя.<br /><br /> Для получения дополнительной информации о SQL_HANDLE_DBC_INFO_TOKEN [см.](../../../odbc/reference/develop-driver/developing-connection-pool-awareness-in-an-odbc-driver.md)|  
|IM017|Опрос отключен в асинхронном режиме уведомления|Всякий раз, когда используется модель уведомления, опрос отключается.|  
|IM018|Для завершения предыдущей асинхронной операции на этой ручке не был вызван **S'LCompleteAsync.**|Если предыдущий вызов функции на ручке возвращается SQL_STILL_EXECUTING и если режим уведомления включен, **s'LCompleteAsync** должен быть вызван на ручку, чтобы сделать пост-обработку и завершить операцию.|  
|S1118|Водитель не поддерживает асинхронное уведомление|Если водитель не поддерживает асинхронное уведомление, вы не можете установить SQL_ATTR_ASYNC_DBC_EVENT или SQL_ATTR_ASYNC_DBC_RETCODE_PTR.|  
  
## <a name="comments"></a>Комментарии  
 Строка соединения имеет следующий синтаксис:  
  
 *соединение-строка* ::: *«пустая*строка»; &#124; *атрибута*&#124; *атрибута;* *соединение строки*  
  
 *empty-string* ::'*атрибут* ::: *атрибут-ключевое значение*=*атрибута-значения* &#124; DRIVER*attribute-value*  
  
 *атрибут-ключевое слово* :: DSN &#124; UID &#124; PWD &#124; *драйвер-определенный-атрибут-ключевое слово*  
  
 *атрибут-значение* ::: *строка персонажа*  
  
 *драйвер-определенный атрибут-ключевое слово* :: *идентификатор*  
  
 где *строка символов* имеет ноль или больше символов; *идентификатор* имеет один или несколько символов; *атрибут-ключевое слово* не является чувствительным к случаям; *атрибут-значение* может быть чувствительным к случаям; и значение ключевого слова **DSN** не состоит исключительно из пробелов.  
  
 Из-за строки соединения и инициализации грамматики файла, ключевые слова и значения атрибутов, которые содержат символы **{}();;? Не \*** следует избегать, не огоравленные скобками. Значение ключевого слова **DSN** не может состоять только из пробелов и не должно содержать ведущие пробелы. Из-за грамматики системной информации ключевые слова и\\имена источников данных не могут содержать символ backslash ()  
  
 Приложенияне не должны добавлять скобки вокруг значения атрибута после ключевого слова **DRIVER,** если атрибут не содержит запятую (;), и в этом случае требуется скобки. Если значение атрибута, получаемое водителем, включает скобки, водитель не должен их удалять, но они должны быть частью строки возврата соединения.  
  
 Значение строки DSN или строки{}соединения, заключенное с фигурными скобками (), содержащим любой из символов **{}();;? \*"! »** передается нетронутым и невредимым для водителя. Однако при использовании этих символов в ключевом слове менеджер драйвера возвращает ошибку при работе с dSNs-файлами, но передает строку соединения водителю для регулярных строк соединения. Избегайте использования встроенных скобки в значение ключевого слова.  
  
 Строка соединения может включать любое количество ключевых слов, определяемых драйверами. Поскольку ключевое слово **DRIVER** не использует информацию из системной информации, водитель должен определить достаточное количество ключевых слов, чтобы водитель мог подключиться к источнику данных, используя только информацию в строке соединения. (Для получения дополнительной информации см. Драйвер определяет, какие ключевые слова необходимы для подключения к источнику данных.  
  
 В следующей таблице описаны значения атрибутов ключевых слов **DSN,** **FILEDSN,** **DRIVER,** **UID,** **PWD**и **SAVEFILE.**  
  
|Ключевое слово|Описание значения атрибутов|  
|-------------|---------------------------------|  
|**Dsn**|Имя источника данных, возвращенного **S'LDataSources** или диалоговым ящиком источников данных **s'LDriverConnect.**|  
|**АКЛЕТиСН**|Имя файла .dsn, из которого будет построена строка соединения для источника данных. Эти источники данных называются источниками файловых данных.|  
|**Драйвер**|Описание драйвера, возвращенное функцией **S'LDrivers.** Например, Rdb или Сервер S'L.|  
|**ИД пользователя**|ИД пользователя.|  
|**Pwd**|Пароль, соответствующий идентификатору пользователя, или пустая строка, если нет пароля для идентификатора пользователя (PWD';).|  
|**САВФИЛи**|Имя файла файла .dsn, в котором должны быть сохранены значения атрибутов ключевых слов, используемых при создании настоящего успешного соединения.|  
  
 Для получения информации о том, как приложение выбирает источник данных или драйвер, [см.](../../../odbc/reference/develop-app/choosing-a-data-source-or-driver.md)  
  
 Если какие-либо ключевые слова повторяются в строке соединения, драйвер использует значение, связанное с первым появлением ключевого слова. Если ключевые слова **DSN** и **DRIVER** включены в одну и ту же строку соединения, менеджер драйвера и драйвер используют какое ключевое слово появляется первым.  
  
 Ключевые слова **FILEDSN** и **DSN** являются взаимоисключающими: используется ключевое слово, которое появляется первым, а то, что появляется вторым, игнорируется. Ключевые слова **FILEDSN** и **DRIVER,** с другой стороны, не являются взаимоисключающими. Если какое-либо ключевое слово появляется в строке соединения с **FILEDSN,** то используется значение атрибута ключевого слова в строке соединения, а не значение атрибута того же ключевого слова в файле .dsn.  
  
 При использовании ключевого слова **FILEDSN** ключевые слова, указанные в файле .dsn, используются для создания строки соединения. (Для получения дополнительной информации, см. Ключевое слово **UID** является необязательным; файл .dsn может быть создан только с ключевым словом **DRIVER.** Ключевое слово **PWD** не хранится в файле .dsn. Каталог по умолчанию для сохранения и загрузки файла .dsn будет комбинацией пути, указанного **CommonFileDir** в HKEY_LOCAL_MACHINE »SOFTWARE»Microsoft »Microsoft»CurrentVersion и «ODBC»DataSources». (Если бы CommonFileDir были "C:'Программные файлы", каталог по умолчанию был бы "C:"Программные файлы (Общие файлы) -ODBC (Источники данных).)  
  
> [!NOTE]  
>  Файлом .dsn можно манипулировать непосредственно, позвонив в функции [S'LReadFileDSN](../../../odbc/reference/syntax/sqlreadfiledsn-function.md) и [S'LWriteFileDSN](../../../odbc/reference/syntax/sqlwritefiledsn-function.md) в установщике DLL.  
  
 При использовании ключевого слова **SAVEFILE** значения атрибутов ключевых слов, используемых при создании настоящего, успешного соединения будут сохранены в виде файла .dsn с именем значения атрибута ключевого слова **SAVEFILE.** Ключевое слово **SAVEFILE** должно использоваться в сочетании с ключевым словом **DRIVER,** ключевым словом **FILEDSN** или обоими, или функция возвращается SQL_SUCCESS_WITH_INFO с помощью S'LSTATE 01S09 (недействительное ключевое слово). Ключевое слово **SAVEFILE** должно появиться перед ключевым словом **DRIVER** в строке соединения, иначе результаты будут неопределенными.  
  
## <a name="driver-manager-guidelines"></a>Руководящие принципы менеджера по водителю  
 Менеджер драйвера строит строку соединения, чтобы передать драйверу в аргументе *InConnectionString* функции **S'LDriverConnect** драйвера. Менеджер драйвера не изменяет аргумент *InConnectionString,* передаваемый ему приложением.  
  
 Действия менеджера драйвера основаны на значении аргумента *DriverCompletion:*  
  
-   SQL_DRIVER_PROMPT: Если строка соединения не содержит ни **DRIVER,** **Ни DSN,** ни ключевое слово **FILEDSN,** менеджер драйвера отображает диалоговое окно источников данных. Он строит строку соединения из имени источника данных, возвращенного диалоговым полем, и любых других ключевых слов, переданных ему приложением. Если имя источника данных, возвращенное диалоговым полем, пусто, менеджер драйвера определяет пару значений ключевых слов DSN-Default. (В этом диалоговом поле не отображается источник данных с именем "По умолчанию".)  
  
-   SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED: Если строка соединения, указанная приложением, включает ключевое слово **DSN,** менеджер драйвера копирует строку соединения, указанную приложением. В противном случае, он принимает те же действия, как это делает, когда *DriverCompletion* SQL_DRIVER_PROMPT.  
  
-   SQL_DRIVER_NOPROMPT: Менеджер драйвера копирует строку соединения, указанную приложением.  
  
 Если строка соединения, указанная приложением, содержит ключевое слово **DRIVER,** менеджер драйвера копирует строку соединения, указанную приложением.  
  
 Используя построенную строку соединения, менеджер драйвера определяет, какой драйвер использовать, подключается к драйверу и передает строку соединения, построенную им, водителю; Для получения более подробной информации о взаимодействии менеджера драйвера [SQLConnect Function](../../../odbc/reference/syntax/sqlconnect-function.md)и драйвера, см. Если строка соединения не содержит ключевое слово **DRIVER,** менеджер драйвера определяет, какой драйвер использовать следующим образом:  
  
1.  Если строка соединения содержит ключевое слово **DSN,** менеджер драйвера извлекает драйвер, связанный с источником данных, из системной информации.  
  
2.  Если строка соединения не содержит ключевое слово **DSN** или источник данных не найден, менеджер драйвера извлекает драйвер, связанный с источником данных по умолчанию, из системной информации. (Для получения дополнительной [информации см. Подключили по умолчанию](../../../odbc/reference/install/default-subkey.md).) Менеджер драйвера изменяет значение ключевого слова **DSN** в строке соединения на "DEFAULT".  
  
3.  Если ключевое слово **DSN** в строке соединения настроено на строку "DEFAULT", менеджер драйвера извлекает драйвер, связанный с источником данных по умолчанию, из системной информации.  
  
4.  Если источник данных не найден и источник данных по умолчанию не найден, менеджер драйвера возвращает SQL_ERROR с S'LSTATE IM002 (источник данных не найден и не указан драйвер по умолчанию).  
  
## <a name="file-data-sources"></a>Файловые источники данных  
 Если строка соединения, указанная приложением в вызове к **s'LDriverConnect,** содержит ключевое слово **FILEDSN,** и это ключевое слово не заменено ни **dSN,** ни **keyword DRIVER,** то менеджер драйвера создает строку соединения, используя информацию в файле .dsn и аргумент *InConnectionString.* Менеджер драйвера продолжает следующее:  
  
1.  Проверяет, является ли имя файла .dsn действительным. Если нет, то он возвращает SQL_ERROR с S'LSTATE IM014 (Недействительное название файла DSN). Если имя файла является пустой строкой ("") и SQL_DRIVER_NOPROMPT не указана, отображается диалоговое окно **File-Open.** Если имя файла содержит допустимый путь, но имя файла или недействительное имя файла SQL_DRIVER_NOPROMPT не указано, то диалоговое окно **File-Open** отображается с текущим набором каталога к тому, что указывается в названии файла. Если имя файла является пустой строкой ("") или имя файла содержит допустимый путь, но нет имени файла или недействительного имени файла, и SQL_DRIVER_NOPROMPT указана, то SQL_ERROR возвращается с помощью S'LSTATE IM014 (Недействительное имя файла DSN).  
  
2.  Читает все ключевые слова в разделе «ODBC» файла .dsn. Если ключевое слово **DRIVER** не присутствует, оно возвращает SQL_ERROR с s'LSTATE IM012 (ошибка синтаксиса ключевого слова драйвера), за исключением случаев, когда файл .dsn недоступен и, таким образом, содержит только ключевое слово **DSN.**  
  
     Если источник данных файла недораздельен, менеджер драйвера считывает значение ключевого слова **DSN** и подключается по мере необходимости к источнику данных пользователя или системы, на который указывает недораздельный источник данных файлов. Шаги 3 по 5 не выполняются.  
  
3.  Строит строку соединения для драйвера. Строка подключения драйвера — это объединение ключевых слов, указанных в файле .dsn, и те, которые указаны в исходной строке подключения приложения. Правила построения строки соединения драйвера, где ключевые слова перекрываются следующим образом:  
  
    -   Если ключевое слово **DRIVER** существует в строке подключения приложения и драйверы, указанные ключевыми словами **DRIVER,** не совпадают в файле .dsn и строке подключения приложения, то информация о драйвере в файле .dsn игнорируется и используется информация о драйвере строки подключения приложения. Если драйверы, указанные ключевым словом **DRIVER,** одинаковы в файле .dsn и строке соединения приложения, то, когда все ключевые слова перекрываются, те, которые указаны в строке подключения приложения, имеют приоритет над теми, которые указаны в файле .dsn.  
  
    -   В новой строке соединения ключевое слово **FILEDSN** устраняется.  
  
4.  Загружает драйвер, загнав в реестр запись HKEY_LOCAL_MACHINE-SOFTWARE-ODBC-ODBCINST. INI\\<\>имя водителя \<«Водитель, где имя водителя> указана по ключевому слову **DRIVER.**  
  
5.  Передает водителю новую строку соединения.  
  
 Для примеров файлов .dsn [см. Подключение с помощью файлововых источников данных](../../../odbc/reference/develop-app/connecting-using-file-data-sources.md).  
  
## <a name="savefile-keyword"></a>САВФИЛЕ Ключевое слово  
 Если строка соединения, указанная приложением, содержит ключевое слово **SAVEFILE,** то менеджер драйвера сохраняет строку соединения в файле .dsn. Менеджер драйвера продолжает следующее:  
  
1.  Проверяет, является ли действительно ли имя файла .dsn, включенного в качестве значения атрибута ключевого слова **SAVEFILE.** Если нет, то он возвращает SQL_ERROR с S'LSTATE IM014 (Недействительное название файла DSN). Достоверность имени файла определяется стандартными правилами именования системы. Если имя файла является пустой строкой ("") и аргумент *DriverCompletion* не является SQL_DRIVER_NOPROMPT, то имя файла является действительным. Если имя файла уже существует, то если *DriverCompletion* SQL_DRIVER_NOPROMPT, файл перезаписан. Если *DriverCompletion* является SQL_DRIVER_PROMPT, SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED, диалоговый ящик предлагает пользователю указать, следует ли переписать файл. Если нет введен, появляется диалоговый ящик **File-Save.**  
  
2.  Если драйвер возвращает SQL_SUCCESS и имя файла не было пустой строкой, то менеджер драйвера записывает информацию о подключении, возвращенную в аргументе *OutConnectionString,* в указанный файл с форматом, указанным в разделе "Строки подключения", ранее в этом разделе.  
  
3.  Если драйвер возвращает SQL_SUCCESS и имя файла было пустой строкой (""), то менеджер драйвера вызывает **файл-Сохранить** общий диалоговый ящик с *hwnd* указанным и записывает информацию о подключении, возвращенную в *OutConnectionString* к файлу, указанному в файле-Сохранить общий диалоговый ящик с форматом, указанным в разделе "Связь строки" ранее в этом разделе.  
  
4.  Если водитель возвращает SQL_SUCCESS, он возвращает аргумент *OutConnectionString,* содержащий строку соединения с приложением.  
  
5.  Если водитель возвращает SQL_SUCCESS_WITH_INFO или SQL_ERROR, то менеджер драйвера возвращает s'LSTATE в приложение.  
  
## <a name="driver-guidelines"></a>Руководящие принципы для водителей  
 Водитель проверяет, содержит ли строка соединения, передаваемую ему менеджером драйвера, ключевое слово **DSN** или **DRIVER.** Если строка соединения содержит ключевое слово **DRIVER,** драйвер не может получить информацию об источнике данных из системной информации. Если строка соединения содержит ключевое слово **DSN** или не содержит ни **DSN,** ни ключевое слово **DRIVER,** водитель может получить информацию об источнике данных из системной информации следующим образом:  
  
1.  Если строка соединения содержит ключевое слово **DSN,** драйвер получает информацию для указанного источника данных.  
  
2.  Если строка соединения не содержит ключевое слово **DSN,** не найден указанный источник данных или ключевое слово **DSN** настроено на "DEFAULT", драйвер получает информацию для источника данных по умолчанию.  
  
 Драйвер использует любую информацию, полученную из системной информации, для увеличения информации, передаваемых ему в строке соединения. Если информация в системе информации дублирует информацию в строке соединения, водитель использует информацию в строке соединения.  
  
 Основываясь на значении *DriverCompletion,* водитель подсказывает пользователю информацию о связи, такую как идентификатор пользователя и пароль, и подключается к источнику данных:  
  
-   SQL_DRIVER_PROMPT: Драйвер отображает диалоговый ящик, используя значения строки соединения и системную информацию (если таковые имеются) в качестве исходных значений. Когда пользователь выходит из окна диалога, драйвер подключается к источнику данных. Он также строит строку соединения из значения ключевого слова \* **DSN** или **DRIVER** в *InConnectionString* и информации, возвращенной из диалогового окна. Он помещает эту строку соединения в буфер*OutConnectionString.*  
  
-   SQL_DRIVER_COMPLETE или SQL_DRIVER_COMPLETE_REQUIRED: Если строка подключения содержит достаточно информации, и эта информация \*верна, \*драйвер подключается к источнику данных и копирует *InConnectionString* на *OutConnectionString.* Если какая-либо информация отсутствует или неверна, водитель предпринимает те же действия, что и при SQL_DRIVER_PROMPT *DriverCompletion,* за исключением того, что если *DriverCompletion* SQL_DRIVER_COMPLETE_REQUIRED, водитель отключает элементы управления для любой информации, не необходимой для подключения к источнику данных.  
  
-   SQL_DRIVER_NOPROMPT: Если строка подключения содержит достаточно информации, драйвер подключается к \*источнику данных и копирует *InConnectionString* на \* *OutConnectionString.* В противном случае, водитель возвращает SQL_ERROR для **S'LDriverConnect**.  
  
 При успешном подключении к источнику данных, драйвер также устанавливает \* *StringLength2Ptr* на длину строки вывода соединения, которая доступна для возврата в*OutConnectionString*.  
  
 Если пользователь отменяет диалоговую коробку, представленную менеджером драйвера или водителем, **s'LDriverConnect** возвращается SQL_NO_DATA.  
  
 Для получения информации о том, как диспетчер драйверов и драйвер взаимодействуют во время процесса подключения, [см.](../../../odbc/reference/syntax/sqlconnect-function.md)  
  
 Если драйвер поддерживает **s'LDriverConnect,** раздел ключевого слова драйвера системной информации для драйвера должен содержать ключевое слово **ConnectFunctions** со вторым символом, установленным на "Y".  
  
## <a name="connecting-when-connection-pooling-is-enabled"></a>Подключение при включении пулинга соединения  
 Объединение соединения позволяет приложению повторно использовать уже созданное соединение. При вызове **S'LDriverConnect** менеджер драйвера пытается сделать соединение, которое является частью пула соединений в среде, которая была назначена для объединения соединений. Для получения более подробной информации об объединении [соединения,](../../../odbc/reference/syntax/sqlconnect-function.md)см.  
  
 Приложение может установить SQL_ATTR_RESET_CONNECTION перед вызовом S'LDisconnect на соединение, где включено объединение. Для получения дополнительной информации, [см.](../../../odbc/reference/syntax/sqlsetconnectattr-function.md)  
  
 Следующие ограничения применяются при вызове **приложения S'LDriverConnect** для подключения к объединенному соединению:  
  
-   Обработка объединения соединения не выполняется, когда ключевое слово **SAVEFILE** указывается в строке соединения.  
  
-   Если объединение соединений включено, **S'LDriverConnect** можно назвать только с аргументом *DriverCompletion* SQL_DRIVER_NOPROMPT; Если **s'LDriverConnect** будет вызван с любым другим *DriverCompletion*, S'LSTATE HY110 (Недействительное завершение драйвера) будет возвращен.  
  
## <a name="connection-attributes"></a>Атрибуты соединения  
 Атрибут SQL_ATTR_LOGIN_TIMEOUT соединения, установленный с помощью **S'LSetConnectAttr,** определяет количество секунд ожидания запроса на входе в систему с успешным подключением драйвера перед возвращением в приложение. Если пользователю предлагается завершить строку подключения, период ожидания каждого запроса входа начинается, когда драйвер запускает процесс соединения.  
  
 По умолчанию драйвер открывает соединение в SQL_MODE_READ_WRITE режиме доступа. Чтобы настроить режим доступа к SQL_MODE_READ_ONLY, приложение должно вызвать **S'LSetConnectAttr** с SQL_ATTR_ACCESS_MODE атрибутом до вызова **S'LDriverConnect.**  
  
 Если библиотека перевода по умолчанию указана в системной информации для источника данных, драйвер загружает ее. Другая библиотека переводов может быть загружена, позвонив в **s'LSetConnectAttr** с SQL_ATTR_TRANSLATE_LIB атрибутом. Вариант перевода можно указать, позвонив по **телефону s'LSetConnectAttr** с SQL_ATTR_TRANSLATE_OPTION опцией.  
  
 Для получения дополнительной [информации см.](../../../odbc/reference/develop-app/connecting-with-sqldriverconnect.md)  
  
```cpp  
// SQLDriverConnect_ref.cpp  
// compile with: odbc32.lib user32.lib  
#include <windows.h>  
#include <sqlext.h>  
  
int main() {  
   SQLHENV henv;  
   SQLHDBC hdbc;  
   SQLHSTMT hstmt;  
   SQLRETURN retcode;  
  
   SQLCHAR OutConnStr[255];  
   SQLSMALLINT OutConnStrLen;  
  
   HWND desktopHandle = GetDesktopWindow();   // desktop's window handle  
  
   // Allocate environment handle  
   retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &henv);  
  
   // Set the ODBC version environment attribute  
   if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
      retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER*)SQL_OV_ODBC3, 0);   
  
      // Allocate connection handle  
      if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
         retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &hdbc);   
  
         // Set login timeout to 5 seconds  
         if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
            SQLSetConnectAttr(hdbc, SQL_LOGIN_TIMEOUT, (SQLPOINTER)5, 0);  
  
            retcode = SQLDriverConnect( // SQL_NULL_HDBC  
               hdbc,   
               desktopHandle,   
               (SQLCHAR*)"driver=SQL Server",   
               _countof("driver=SQL Server"),  
               OutConnStr,  
               255,   
               &OutConnStrLen,  
               SQL_DRIVER_PROMPT );  
  
            // Allocate statement handle  
            if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {                 
               retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt);   
  
               // Process data  
               if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
                  SQLFreeHandle(SQL_HANDLE_STMT, hstmt);  
               }  
  
               SQLDisconnect(hdbc);  
            }  
  
            SQLFreeHandle(SQL_HANDLE_DBC, hdbc);  
         }  
      }  
      SQLFreeHandle(SQL_HANDLE_ENV, henv);  
   }  
}  
```  
  
 Также смотрите [Пример программы ODBC](../../../odbc/reference/sample-odbc-program.md).  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Выделение ручки|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Обнаружение и перечисление значений, необходимых для подключения к источнику данных|[Функция SQLBrowseConnect](../../../odbc/reference/syntax/sqlbrowseconnect-function.md)|  
|Подключение к источнику данных|[Функция S'LConnect](../../../odbc/reference/syntax/sqlconnect-function.md)|  
|Отключение от источника данных|[Функция SQLDisconnect](../../../odbc/reference/syntax/sqldisconnect-function.md)|  
|Возвращение описания и атрибутики драйвера|[Функция SQLDrivers](../../../odbc/reference/syntax/sqldrivers-function.md)|  
|Освобождение ручки|[SQLFreeHandle, функция](../../../odbc/reference/syntax/sqlfreehandle-function.md)|  
|Установка атрибута соединения|[Функция SQLSetConnectAttr](../../../odbc/reference/syntax/sqlsetconnectattr-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справка aPI ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
