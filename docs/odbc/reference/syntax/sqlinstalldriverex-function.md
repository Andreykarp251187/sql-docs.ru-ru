---
title: Функция S'LInstallDriverDriverEx Документы Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLInstallDriverEx
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLInstallDriverEx
helpviewer_keywords:
- SQLInstallDriverEx function [ODBC]
ms.assetid: 1dd74544-f4e9-46e1-9b5f-c11d84fdab4c
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 054e8b6b9eae26bd5f973f3d46d7ef37363a8e79
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81302126"
---
# <a name="sqlinstalldriverex-function"></a>Функция SQLInstallDriverEx
**Соответствия**  
 Представлена версия: ODBC 3.0  
  
 **Сводка**  
 **SLInstallDriverEx** добавляет информацию о драйвере в запись Odbcinst.ini в системной информации и увеличивает потребление драйвера *на* 1. Однако, если версия драйвера уже существует, но значение *UseCount* для драйвера не существует, новое значение *UseCount* устанавливается на 2.  
  
 Эта функция на самом деле не копирует файлы. Программа вызова обязана правильно копировать файлы драйвера в целевой каталог.  
  
 Функциональность **S'LInstallDriverDriverEx** также может быть доступна с [ODBCCONF. EXE](../../../odbc/odbcconf-exe.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
BOOL SQLInstallDriverEx(  
     LPCSTR    lpszDriver,  
     LPCSTR    lpszPathIn,  
     LPSTR     lpszPathOut,  
     WORD      cbPathOutMax,  
     WORD *    pcbPathOut,  
     WORD      fRequest,  
     LPDWORD   lpdwUsageCount);  
```  
  
## <a name="arguments"></a>Аргументы  
 *lpszDriver*  
 (Вход) Описание драйвера (обычно название связанного DBMS) представлено пользователям вместо физического имени драйвера. Аргумент *lpszDriver* должен содержать вдвойне нулевой-прекратить список ключевых слов значение пар, описывающих драйвера. Для получения дополнительной информации о парах значения ключевых слов [см.](../../../odbc/reference/install/driver-specification-subkeys.md) Для получения дополнительной информации о строке с [ConfigDSN Function](../../../odbc/reference/syntax/configdsn-function.md)вдвойне нулевым завершением см.  
  
 *lpszPathIn*  
 (Вход) Полный путь целевого каталога установки, или нулевой указатель. Если *lpszPathIn* является нулевой указатель, драйверы будут установлены в каталоге системы.  
  
 *lpszPathOut*  
 (Выход) Путь целевого каталога, где должен быть установлен драйвер. Если драйвер ранее не был установлен, *lpszPathOut* должен быть таким же, как *lpszPathIn*. Если драйвер был ранее установлен, *lpszPathOut* является траекторией предыдущей установки.  
  
 *cbPathOutMax*  
 (Вход) Длина *lpszPathOut*.  
  
 *pcbPathOut*  
 (Выход) Общее количество байтов (за исключением символа нулевого прекращения), доступных для возврата в *lpszPathOut*. Если количество байтов, доступных для возврата, больше или равно *cbPathOutMax,* выходной путь в *lpszPathOut* усечен *до cbPathOutMax* минус символ нулевого прекращения. Аргумент *pcbPathOut* может быть нулевым указателем.  
  
 *fЗапрос*  
 (Вход) Тип запроса. Аргумент *fRequest* должен содержать одно из следующих значений:  
  
 ODBC_INSTALL_INQUIRY: Узнайте о том, где может быть установлен драйвер.  
  
 ODBC_INSTALL_COMPLETE: Заполните запрос на установку.  
  
 *lpdwUsageCount*  
 (Выход) Количество использования драйвера после вызова этой функции.  
  
 Приложения не должны устанавливать количество использования. ODBC будет поддерживать этот счет.  
  
## <a name="returns"></a>Результаты  
 Функция возвращает TRUE, если она успешна, FALSE, если она не удается.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **S'LInstallDriverDriverEx** возвращает FALSE, связанное * \*значение pfErrorCode* можно получить, позвонив по **телефону S'LInstallerError.** В следующей таблице перечислены * \*значения pfErrorCode,* которые могут быть возвращены **S'LInstallerError,** и приведены в изъяны каждое из них в контексте этой функции.  
  
|*\*pfErrorCode*|Error|Описание|  
|---------------------|-----------|-----------------|  
|ODBC_ERROR_GENERAL_ERR|Общая ошибка установки|Произошла ошибка, для которой не было конкретной ошибки установки.|  
|ODBC_ERROR_INVALID_BUFF_LEN|Недействительная длина буфера|Аргумент *lpszPathOut* не был достаточно большим, чтобы содержать путь вывода. Буфер содержит усеченный путь.<br /><br /> *CbPathOutMax* аргумент был 0, и *fRequest* был ODBC_INSTALL_COMPLETE.|  
|ODBC_ERROR_INVALID_REQUEST_TYPE|Недействительный тип запроса|Аргумент *fRequest* не был одним из следующих:<br /><br /> ODBC_INSTALL_INQUIRY ODBC_INSTALL_COMPLETE|  
|ODBC_ERROR_INVALID_KEYWORD_VALUE|Недействительные пары значения ключевых слов|Аргумент *lpszDriver* содержал ошибку синтаксиса.|  
|ODBC_ERROR_INVALID_PATH|Недействительный путь установки|Аргумент *lpszPathIn* содержал недействительный путь.|  
|ODBC_ERROR_LOAD_LIBRARY_FAILED|Не удалось загрузить библиотеку установки драйвера или переводчика|Библиотека установки драйвера не может быть загружена.|  
|ODBC_ERROR_INVALID_PARAM_SEQUENCE|Недействительная последовательность параметров|Аргумент *lpszDriver* не содержал список пар значения ключевых слов.|  
|ODBC_ERROR_USAGE_UPDATE_FAILED|Не удалось приравливание или decrement количество использования компонента|Установщик не смог приравнить количество использования драйвера.|  
  
## <a name="comments"></a>Комментарии  
 Аргумент *lpszDriver* представляет собой список атрибутов в виде пар значения ключевых слов. Каждая пара завершается с нулевым байтом, и весь список завершается с нулевым байтом. (То есть, два нулевых байта отмечают конец списка.) Формат этого списка:  
  
 _driver-desc_ **\\****=** 0Driver_driver-DLL-filename_**\\**0**=**(настройка-DLL-filename_setup-DLL-filename_<b>\\</b>0)  
  
 -_водитель-аттр-ключевое слово1_**=**_значение1_<b>\\</b>0 -_водитель-attr-keyword2_**=**_значение2_<b>\\</b>0"... <b>\\</b>0.00  
  
 где Q0 является нулевым байт и *драйвер-attr-keywordn* является любой драйвер атрибут ключевое слово. Ключевые слова должны отображаться в указанном порядке. Например, предположим, что драйвер для отформатированных текстовых файлов имеет отдельный драйвер и dLL-системы и может использовать файлы с расширениями .txt и .csv. Аргумент *lpszDriver* для этого драйвера может быть следующим:  
  
```  
Text\0Driver=TEXT.DLL\0Setup=TXTSETUP.DLL\0FileUsage=1\0  
FileExtns=*.txt,*.csv\0\0  
```  
  
 Предположим, что драйвер для S'L Server не имеет отдельной настройки DLL и не имеет ключевых слов атрибута драйвера. Аргумент *lpszDriver* для этого драйвера может быть следующим:  
  
```  
SQL Server\0Driver=SQLSRVR.DLL\0\0  
```  
  
 После того, как **S'LInstallDriverDriverEx** извлекает информацию о драйвере из аргумента *lpszDriver,* он добавляет описание драйвера в раздел «OdBC Drivers» входа Odbcinst.ini в системной информации. Затем он создает раздел под названием с описанием драйвера и добавляет полные пути драйвера DLL и установки DLL. Наконец, он возвращает траекторию целевого каталога установки, но не копирует файлы драйвера к нему. Программа вызова должна фактически скопировать файлы драйвера в целевой каталог.  
  
 **SLInstallDriverEx** приращает количество использования компонентов для установленного драйвера на 1. Если версия драйвера уже существует, но количество использования компонентов для драйвера не существует, значение количества нового компонента устанавливается на 2.  
  
 Программа настройки приложения отвечает за физическое копирование файла драйвера и поддержание количества использования файла. Если файл драйвера ранее не был установлен, программа настройки приложения должна скопировать файл в траектории *lpszPathIn* и создать количество использования файла. Если файл был ранее установлен, программа настройки просто наращает количество использования файла и возвращает путь предыдущей установки в аргументе *lpszPathOut.*  
  
> [!NOTE]  
>  Для получения дополнительной информации о количестве компонентов и количестве файлов, [см.](../../../odbc/reference/install/usage-counting.md)  
  
 Если старая версия файла драйвера была ранее установлена приложением, драйвер должен быть неустановлен, а затем переустановлен, так что количество использования компонента драйвера является действительным. Сначала следует вызвать **s'LConfigDriver** (с *ODBC_REMOVE_DRIVER)* **SQLRemoveDriver** для того, чтобы исключить количество использования компонентов. Затем следует вызвать **s'LInstallDriverDriverEx** для переустановки драйвера, что привививающее количество использования компонентов. Программа настройки приложения должна заменить старый файл новым файлом. Количество использования файлов останется прежним, и любое другое приложение, которое использовало старый файл версии, теперь будет использовать новую версию.  
  
> [!NOTE]  
>  Если драйвер был ранее установлен и **S'LInstallDriverEx** называется для установки драйвера в другой каталог, функция будет возвращаться TRUE, но *lpszPathOut* будет включать в себя каталог, где драйвер уже установлен. Он не будет включать каталог, введенный в аргумент *lpszDriver.*  
  
 Длина пути в *lpszPathOut* в **S'LInstallDriverDriverEx** позволяет осуществлять двухэтапный процесс установки, поэтому приложение может определить, каким должен быть *cbPathOutMax,* позвонив в **режим** *fRequest* of ODBC_INSTALL_INQUIRY. Это позволит вернуть общее количество байтов, доступных в буфере *pcbPathOut.* **S'LInstallDriverEx** можно тогда назвать *с fЗапрос* ODBC_INSTALL_COMPLETE и *cbPathOutMax* аргумент, установленный на значение в буфере *pcbPathOut,* а также нулевой прекращения характер.  
  
 Если вы решили не использовать двухфазную модель для **S'LInstallDriverDriverEx,** необходимо установить *cbPathOutMax*, который определяет размер хранилища для пути целевого каталога, к значению _MAX_PATH, как это определено в Stdlib.h, чтобы предотвратить усечение.  
  
 Когда *fRequest* ODBC_INSTALL_COMPLETE, **S'LInstallDriverEx** не позволяет *lpszPathOut* быть NULL (или *cbPathOutMax* быть 0). Если *fRequest* является ODBC_INSTALL_COMPLETE, FALSE возвращается, когда количество байтов, доступных для возврата, больше или равно *cbPathOutMax*, в результате чего происходит усечение.  
  
 После того, как **s'LInstallDriverDriverEx** был вызван и программа настройки приложения скопировала файл драйвера (при необходимости), установка драйвера DLL должна вызвать **S'LConfigDriver,** чтобы установить конфигурацию для драйвера.  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Установка диспетчера драйверов|[СЗЛУстановитьДрайверМенеджер](../../../odbc/reference/syntax/sqlinstalldrivermanager-function.md)|
