---
title: Функция ConfigDSN | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- ConfigDSN
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- ConfigDSN
helpviewer_keywords:
- ConfigDSN [ODBC]
ms.assetid: 01ced74e-c575-4a25-83f5-bd7d918123f8
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: 9387ffefe2fdcc9b30824018a763b87b81b831dc
ms.sourcegitcommit: 7a3243c45830cb3f49a7fa71c2991a9454fd6f5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2019
ms.locfileid: "65538099"
---
# <a name="configdsn-function"></a>Функция ConfigDSN
**Соответствие стандартам**  
 Представленные версии: ODBC 1.0  
  
 **Сводка**  
 **ConfigDSN** добавляет, изменяет или удаляет сведения о системе источников данных. Он может запросить у пользователя для сведений о соединении. Он может находиться в DLL-Библиотека драйвера или отдельные DLL-файлов установки.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
BOOL ConfigDSN(  
     HWND     hwndParent,  
     WORD     fRequest,  
     LPCSTR   lpszDriver,  
     LPCSTR   lpszAttributes);  
```  
  
## <a name="arguments"></a>Аргументы  
 *hwndParent*  
 [Вход] Дескриптор родительского окна. Функция не будет отображать все диалоговые окна, если дескриптор имеет значение null.  
  
 *fRequest*  
 [Вход] Тип запроса. *FRequest* аргумент должен иметь один из следующих значений:  
  
 ODBC_ADD_DSN: Добавьте новый источник данных.  
  
 ODBC_CONFIG_DSN: Настройка (изменить) существующего источника данных.  
  
 ODBC_REMOVE_DSN: Удаление существующего источника данных.  
  
 *lpszDriver*  
 [Вход] Описание драйвера (обычно имя связанного СУБД) предоставляемые пользователям вместо имени физического драйвера.  
  
 *lpszAttributes*  
 [Вход] Двойной завершающий список атрибутов в виде пар "ключевое слово значение". Дополнительные сведения см. в разделе «Примечания».  
  
## <a name="returns"></a>Возвращает  
 Функция возвращает значение TRUE при успешном выполнении, FALSE в случае неудачи.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **ConfigDSN** возвращает значение FALSE, связанным  *\*pfErrorCode* передано значение в буфер Ошибка установщика с помощью вызова **SQLPostInstallerError** и можно получить, вызвав **SQLInstallerError**. В следующей таблице перечислены  *\*pfErrorCode* значения, которые могут быть возвращены **SQLInstallerError** и объясняется каждый из них в контексте этой функции.  
  
|*\*pfErrorCode*|Ошибка|Описание|  
|---------------------|-----------|-----------------|  
|ODBC_ERROR_INVALID_HWND|Недопустимый дескриптор окна|*HwndParent* предоставил недопустимый аргумент.|  
|ODBC_ERROR_INVALID_KEYWORD_VALUE|Пары "недопустимое ключевое слово значение"|*LpszAttributes* аргумент содержит синтаксическую ошибку.|  
|ODBC_ERROR_INVALID_NAME|Недопустимое имя драйвера или перевода|*LpszDriver* предоставил недопустимый аргумент. Он не будет найден в реестре.|  
|ODBC_ERROR_INVALID_REQUEST_TYPE|Недопустимый тип запроса|*FRequest* аргумент не является одним из следующих:<br /><br /> ODBC_ADD_DSN ODBC_CONFIG_DSN ODBC_REMOVE_DSN|  
|ODBC_ERROR_REQUEST_FAILED|*Запросить* сбой|Не удалось выполнить операцию, запрошенную *fRequest* аргумент.|  
|ODBC_ERROR_DRIVER_SPECIFIC|Ошибка драйвера или перевода|Ошибка драйвера, для которого отсутствуют определенные ошибки установщика ODBC. *SzError* аргумента в вызове **SQLPostInstallerError** функция должна содержать сообщении об ошибке специфические для драйвера.|  
  
## <a name="comments"></a>Комментарии  
 **ConfigDSN** получает сведения о соединении из библиотеки DLL установщика в качестве список атрибутов в виде пар "ключевое слово значение". Каждая пара заканчивается нулевым байтом, а весь список заканчивается нулевым байтом. (То есть две пустые байты обозначения конца списка.) Не допускаются пробелы вокруг знака равенства в паре «ключевое_слово значение». **ConfigDSN** может принимать ключевые слова, которые не являются допустимым ключевые слова для **SQLBrowseConnect** и **SQLDriverConnect**. **ConfigDSN** не обязательно поддержки всех ключевых слов, допустимым в качестве ключевых для **SQLBrowseConnect** и **SQLDriverConnect**. (**ConfigDSN** не принимает **ДРАЙВЕР** ключевое слово.) Ключевые слова, используемые **ConfigDSN** функции должен поддерживать все параметры, необходимые для повторного создания источника данных, с помощью функции АВТОМАТИЧЕСКОЙ установки установщика. При использовании **ConfigDSN** значения и значения строки подключения совпадают, следует использовать же ключевые слова.  
  
 Как и в **SQLBrowseConnect** и **SQLDriverConnect**, ключевые слова и их значения не должна содержать **[]{}(),? \*=! @** символов, а для параметра **DSN** ключевое слово не может состоять только из пробелов. Из-за грамматики реестра, ключевые слова и имена источников данных не может содержать обратную косую черту (\\) символов.  
  
 **ConfigDSN** должны вызывать **SQLValidDSN** Чтобы проверить длину имени источника данных и убедиться, что недопустимых символов, включены в имя. Если имя источника данных, длиннее, чем SQL_MAX_DSN_LENGTH или содержит недопустимые символы, **SQLValidDSN** возвращает сообщение об ошибке и **ConfigDSN** возвращает сообщение об ошибке. Длина имени источника данных, кроме того, проверяется по **SQLWriteDSNToIni**.  
  
 Например чтобы настроить источник данных, который требуется идентификатор пользователя, пароль и имя базы данных, программа установки может передать следующие пары «ключевое слово значение»:  
  
```  
DSN=Personnel Data\0UID=Smith\0PWD=Sesame\0DATABASE=Personnel\0\0  
```  
  
 Дополнительные сведения об этих ключевых словах см. в разделе [SQLDriverConnect](../../../odbc/reference/syntax/sqldriverconnect-function.md) и документацию для каждого драйвера.  
  
 Чтобы отобразить диалоговое окно, *hwndParent* не может иметь значение null.  
  
## <a name="adding-a-data-source"></a>Добавление источника данных  
 Если передается имя источника данных **ConfigDSN** в *lpszAttributes*, **ConfigDSN** проверяет, что имя является допустимым. Если имя источника данных совпадает с существующим именем источника данных и *hwndParent* имеет значение null, **ConfigDSN** перезаписывает существующее имя. Если он совпадает с существующим именем и *hwndParent* не равно null, **ConfigDSN** пользователю будет предложено перезаписать существующее имя.  
  
 Если *lpszAttributes* содержит достаточно информации для подключения к источнику данных **ConfigDSN** можно добавить источник данных, или отобразить диалоговое окно, с помощью которого пользователь может изменить сведения о соединении. Если *lpszAttributes* не содержит достаточно информации для подключения к источнику данных **ConfigDSN** необходимо определить необходимые сведения; Если *hwndParent* не равно null, он отображает диалоговое окно для получения сведений от пользователя.  
  
 Если **ConfigDSN** отображает диалоговое окно, он должен отображать все сведения о соединении, переданный в *lpszAttributes*. В частности, если имя источника данных, переданный в него **ConfigDSN** отображает это имя, но не позволяет пользователю изменять его. **ConfigDSN** можно указать значения по умолчанию для сведений о соединении, не переданный в *lpszAttributes*.  
  
 Если **ConfigDSN** не удается получить сведения для завершения подключения для источника данных, возвращается значение FALSE.  
  
 Если **ConfigDSN** можно получить полный подключения для источника данных, он вызывает метод **SQLWriteDSNToIni** в установщике библиотеку DLL для добавления новой спецификации источника данных в файл Odbc.ini (или реестра). **SQLWriteDSNToIni** добавляет имя источника данных в разделе [источники данных ODBC], создает раздел спецификации источника данных и добавляет **ДРАЙВЕР** ключевого слова with Описание драйвера, как его значение. **ConfigDSN** вызовы **SQLWritePrivateProfileString** в установщике библиотеку DLL для добавления любые дополнительные ключевые слова и значения, используемые драйвером.  
  
## <a name="modifying-a-data-source"></a>Изменение источника данных  
 Чтобы изменить источник данных, имя источника данных должны быть переданы **ConfigDSN** в *lpszAttributes*. **ConfigDSN** проверяет, используется имя источника данных в файле Odbc.ini (или реестра).  
  
 Если *hwndParent* имеет значение null, **ConfigDSN** использует эти сведения в *lpszAttributes* позволяет изменить данные в файл Odbc.ini (или реестре). Если *hwndParent* не равно null, **ConfigDSN** отображает диалоговое окно, используя сведения в *lpszAttributes*; сведения, которые отсутствуют в *lpszAttributes* , он использует данные из информации о системе. Пользователь может изменять сведения, прежде чем **ConfigDSN** сохраняет его в сведениях о системе.  
  
 Если имя источника данных был изменен, **ConfigDSN** сначала вызывает **SQLRemoveDSNFromIni** в установщике спецификации из файла Odbc.ini (или реестра) источник библиотеки DLL, чтобы удалить существующие данные. Затем следует действия, описанные в предыдущем разделе, чтобы добавить новую спецификацию источника данных. Если имя источника данных не был изменен, **ConfigDSN** вызовы **SQLWritePrivateProfileString** в установщике библиотеки DLL, чтобы внести другие изменения. **ConfigDSN** не может удалить или изменить значение **драйвер** ключевое слово.  
  
## <a name="deleting-a-data-source"></a>Удаление источника данных  
 Чтобы удалить источник данных, имя источника данных должны быть переданы **ConfigDSN** в *lpszAttributes*. **ConfigDSN** проверяет, используется имя источника данных в файле Odbc.ini (или реестра). Затем он вызывает **SQLRemoveDSNFromIni** в установщике библиотеки DLL, чтобы удалить источник данных.  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Добавление, изменение или удаление источника данных|[SQLConfigDataSource](../../../odbc/reference/syntax/sqlconfigdatasource-function.md)|  
|Получение значения из файла Odbc.ini или реестру|[SQLGetPrivateProfileString](../../../odbc/reference/syntax/sqlgetprivateprofilestring-function.md)|  
|Удаление источника данных по умолчанию|[SQLRemoveDefaultDataSource](../../../odbc/reference/syntax/sqlremovedefaultdatasource-function.md)|  
|Удаление имени источника данных из файла Odbc.ini (или реестра)|[SQLRemoveDSNFromIni](../../../odbc/reference/syntax/sqlremovedsnfromini-function.md)|  
|Имя источника данных, добавление Odbc.ini (или реестра)|[SQLWriteDSNToIni](../../../odbc/reference/syntax/sqlwritedsntoini-function.md)|  
|Запись значения в файле Odbc.ini и реестр|[SQLWritePrivateProfileString](../../../odbc/reference/syntax/sqlwriteprivateprofilestring-function.md)|
