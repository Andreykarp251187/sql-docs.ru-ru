---
title: Функция ConfigDSN Документы Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- ConfigDSN
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- ConfigDSN
helpviewer_keywords:
- ConfigDSN [ODBC]
ms.assetid: 01ced74e-c575-4a25-83f5-bd7d918123f8
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: fbae126c819088bd277621b207454503a86c8955
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81306045"
---
# <a name="configdsn-function"></a>Функция ConfigDSN
**Соответствия**  
 Представлена версия: ODBC 1.0  
  
 **Сводка**  
 **ConfigDSN** добавляет, изменяет или удаляет источники данных из системной информации. Это может побудить пользователя для получения информации о связи. Это может быть в драйвере DLL или отдельной установке DLL.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
BOOL ConfigDSN(  
     HWND     hwndParent,  
     WORD     fRequest,  
     LPCSTR   lpszDriver,  
     LPCSTR   lpszAttributes);  
```  
  
## <a name="arguments"></a>Аргументы  
 *hwndParent*  
 (Вход) Ручка родительского окна. Функция не будет отображать диалоговые коробки, если ручка недействительна.  
  
 *fЗапрос*  
 (Вход) Тип запроса. Аргумент *fRequest* должен содержать одно из следующих значений:  
  
 ODBC_ADD_DSN: Добавьте новый источник данных.  
  
 ODBC_CONFIG_DSN: Налаживать (изменять) существующий источник данных.  
  
 ODBC_REMOVE_DSN: Удалите существующий источник данных.  
  
 *lpszDriver*  
 (Вход) Описание драйвера (обычно название связанного DBMS) представлено пользователям вместо физического имени драйвера.  
  
 *lpszАтрибуты*  
 (Вход) Вдвойне нулевой-завершенный список атрибутов в виде пар значения ключевых слов. Для получения дополнительной информации см.  
  
## <a name="returns"></a>Результаты  
 Функция возвращает TRUE, если она успешна, FALSE, если она не удается.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **ConfigDSN** возвращает FALSE, связанное * \*значение pfErrorCode* размещается в буфере ошибки установки по вызову на **s'LPostInstallerError** и может быть получено по телефону **S'LInstallerError.** В следующей таблице перечислены * \*значения pfErrorCode,* которые могут быть возвращены **S'LInstallerError,** и приведены в изъяны каждое из них в контексте этой функции.  
  
|*\*pfErrorCode*|Error|Описание|  
|---------------------|-----------|-----------------|  
|ODBC_ERROR_INVALID_HWND|Недействительная ручка окна|Аргумент *hwndParent* был недействительным.|  
|ODBC_ERROR_INVALID_KEYWORD_VALUE|Недействительные пары значения ключевых слов|Аргумент *lpszAttributes* содержал ошибку синтаксиса.|  
|ODBC_ERROR_INVALID_NAME|Имя недействительного водителя или переводчика|Аргумент *lpszDriver* был недействительным. Его не удалось найти в реестре.|  
|ODBC_ERROR_INVALID_REQUEST_TYPE|Недействительный тип запроса|Аргумент *fRequest* не был одним из следующих:<br /><br /> ODBC_ADD_DSN ODBC_CONFIG_DSN ODBC_REMOVE_DSN|  
|ODBC_ERROR_REQUEST_FAILED|*Запрос* не удался|Не удалось выполнить операцию, запрошенную аргументом *fRequest.*|  
|ODBC_ERROR_DRIVER_SPECIFIC|Ошибка водителя или переводчика|Ошибка, связанная с драйвером, для которой нет определенной ошибки установки ODBC. Аргумент *SzError* в вызове к функции **S'LPostInstallerError** должен содержать сообщение об ошибке, конкретное для драйвера.|  
  
## <a name="comments"></a>Комментарии  
 **ConfigDSN** получает информацию о подключении от установщика DLL в виде списка атрибутов в виде пар значения ключевых слов. Каждая пара завершается с нулевым байтом, и весь список завершается с нулевым байтом. (То есть, два нулевых байта отмечают конец списка.) Пространства не допускаются вокруг равного знака в паре значения ключевых слов. **ConfigDSN** может принимать ключевые слова, которые не являются действительными, для **S'LBrowseConnect** и **S'LDriverConnect.** **ConfigDSN** не обязательно поддерживает все ключевые слова, которые являются действительными ключевыми словами для **S'LBrowseConnect** и **S'LDriverConnect.** (**ConfigDSN** не принимает ключевое слово **DRIVER.)** Ключевые слова, используемые функцией **ConfigDSN,** должны поддерживать все параметры, необходимые для воссоздания источника данных с помощью функции установки AUTO установщика. Когда использование значений **ConfigDSN** и значений строки соединения одинаковое, следует использовать одни и те же ключевые слова.  
  
 Как и в **S'LBrowseConnect** и **S'LDriverConnect**, ключевые слова и их значения не должны содержать в себе **{}();?? \*** Символы и значение ключевого слова **DSN** не могут состоять только из пробелов. Из-за грамматики реестра ключевые слова и\\имена источников данных не могут содержать символ backslash ( )  
  
 **ConfigDSN** следует вызвать **S'LValidDSN,** чтобы проверить длину имени источника данных и убедиться, что в имени не включены недействительные символы. Если имя источника данных длиннее SQL_MAX_DSN_LENGTH или включает недействительные символы, **S'LValidDSN** возвращает ошибку, а **ConfigDSN** возвращает ошибку. Длина имени источника данных также проверяется **S'LWriteDSNToIni.**  
  
 Например, для настройки источника данных, требующего идентификатора пользователя, пароля и имени базы данных, приложение для настройки может передать следующие пары значения ключевых слов:  
  
```  
DSN=Personnel Data\0UID=Smith\0PWD=Sesame\0DATABASE=Personnel\0\0  
```  
  
 Для получения более подробной информации об этих ключевых словах, [см.](../../../odbc/reference/syntax/sqldriverconnect-function.md)  
  
 Для отображения диалогового окна *hwndParent* не должен быть нулевым.  
  
## <a name="adding-a-data-source"></a>Добавление источника данных  
 Если имя источника данных передается **ConfigDSN** в *lpszAttributes,* **ConfigDSN** проверяет, действительно ли это имя. Если имя источника данных совпадает с существующим именем источника данных и *hwndParent* является недействительным, **ConfigDSN** перезаписывает существующее имя. Если он соответствует существующему имени и *hwndParent* не является недействительным, **ConfigDSN** предлагает пользователю перезаписать существующее имя.  
  
 Если *lpszAttributes* содержит достаточно информации для подключения к источнику данных, **ConfigDSN** может добавить источник данных или отобразить диалоговый ящик, с помощью которого пользователь может изменить информацию о подключении. Если *lpszAttributes* не содержит достаточно информации для подключения к источнику данных, **ConfigDSN** должен определить необходимую информацию; если *hwndParent* не является недействительным, он отображает диалоговую коробку для получения информации от пользователя.  
  
 Если **ConfigDSN** отображает диалоговую коробку, он должен отображать любую информацию о подключении, переданную ему в *lpszAttributes.* В частности, если имя источника данных было передано ему, **ConfigDSN** отображает это имя, но не позволяет пользователю изменить его. **ConfigDSN** может предоставить значения по умолчанию для информации о подключении, не переданной ему в *lpszAttributes.*  
  
 Если **ConfigDSN** не может получить полную информацию о подключении к источнику данных, он возвращает FALSE.  
  
 Если **ConfigDSN** может получить полную информацию о подключении к источнику данных, он вызывает **S'LWriteDSNToIni** в установщике DLL, чтобы добавить новую спецификацию источника данных в файл Odbc.ini (или реестр). **S'LWriteDSNToIni** добавляет имя источника данных в раздел «Источники данных ODBC», создает раздел спецификации источника данных и добавляет ключевое слово **DRIVER** с описанием драйвера в качестве его значения. **ConfigDSN** вызывает **S'LWritePrivateProfileString** в установщике DLL, чтобы добавить любые дополнительные ключевые слова и значения, используемые водителем.  
  
## <a name="modifying-a-data-source"></a>Изменение источника данных  
 Чтобы изменить источник данных, имя источника данных должно быть передано **ConfigDSN** в *lpszAttributes.* **ConfigDSN** проверяет, что имя источника данных находится в файле Odbc.ini (или реестре).  
  
 Если *hwndParent* является нулевым, **ConfigDSN** использует информацию в *lpszAttributes* для изменения информации в файле Odbc.ini (или реестре). Если *hwndParent* не является недействительным, **ConfigDSN** отображает диалоговую коробку, используя информацию в *lpszAttributes;* для информации, не в *lpszAttributes*, он использует информацию из системной информации. Пользователь может изменить информацию до того, как **ConfigDSN** хранит ее в системе.  
  
 Если имя источника данных было изменено, **ConfigDSN** сначала вызывает **S'LRemoveDSNFromIni** в установщикd DLL, чтобы удалить существующую спецификацию источника данных из файла Odbc.ini (или реестра). Затем следует шаги в предыдущем разделе, чтобы добавить новую спецификацию источника данных. Если имя источника данных не было изменено, **ConfigDSN** вызывает **S'LWritePrivateProfileString** в установщике DLL, чтобы внести какие-либо другие изменения. **ConfigDSN** не может удалить или изменить значение ключевого слова **драйвера.**  
  
## <a name="deleting-a-data-source"></a>Удаляние источника данных  
 Чтобы удалить источник данных, имя источника данных должно быть передано **ConfigDSN** в *lpszAttributes*. **ConfigDSN** проверяет, что имя источника данных находится в файле Odbc.ini (или реестре). Затем он вызывает **S'LRemoveDSNFromIni** в установщике DLL, чтобы удалить источник данных.  
  
## <a name="note"></a>Примечание
 При написании версии Unicode этой рутины, она должна называться **ConfigDSNW**, с аргументами LPCWSTR вместо LPCSTR.
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Добавление, изменение или удаление источника данных|[SQLConfigDataSource](../../../odbc/reference/syntax/sqlconfigdatasource-function.md)|  
|Получение значения из файла Odbc.ini или реестра|[СЗЛГетПриТПрогрядТст](../../../odbc/reference/syntax/sqlgetprivateprofilestring-function.md)|  
|Удаление источника данных по умолчанию|[СЗЛУдалениеDefaultDataИсточник](../../../odbc/reference/syntax/sqlremovedefaultdatasource-function.md)|  
|Удаление имени источника данных из Odbc.ini (или реестра)|[СЗЛССНСНИзинини](../../../odbc/reference/syntax/sqlremovedsnfromini-function.md)|  
|Добавление имени источника данных в Odbc.ini (или реестр)|[СЗЛДуНТСНОниИ](../../../odbc/reference/syntax/sqlwritedsntoini-function.md)|  
|Написание значения в файл Odbc.ini или в реестр|[СЗЛСНайтПритПритПрогрядТ](../../../odbc/reference/syntax/sqlwriteprivateprofilestring-function.md)|
