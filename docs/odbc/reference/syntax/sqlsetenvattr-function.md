---
title: Функция S'LSetEnvAttr Документы Майкрософт
ms.custom: ''
ms.date: 07/18/2019
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLSetEnvAttr
apilocation:
- sqlsrv32.dll
- odbc32.dll
apitype: dllExport
f1_keywords:
- SQLSetEnvAttr
helpviewer_keywords:
- SQLSetEnvAttr function [ODBC]
ms.assetid: 0343241c-4b15-4d4b-aa2b-2e8ab5215cd2
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 640b1e6947d67b92e2b7f8e623597e1d99d4a877
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81299544"
---
# <a name="sqlsetenvattr-function"></a>SQLSetEnvAttr, функция
**Соответствия**  
 Представлена версия: Соответствие стандартам ODBC 3.0: ISO 92  
  
 **Сводка**  
 **SLSetEnvAttr** устанавливает атрибуты, которые регулируют аспекты сред.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLSetEnvAttr(  
     SQLHENV      EnvironmentHandle,  
     SQLINTEGER   Attribute,  
     SQLPOINTER   ValuePtr,  
     SQLINTEGER   StringLength);  
```  
  
## <a name="arguments"></a>Аргументы  
 *Окружающая средаРучка*  
 (Вход) Ручка окружающей среды.  
  
 *Атрибут*  
 (Вход) Атрибут для набора, перечисленные в "Комментарии".  
  
 *ValuePtr*  
 (Вход) Указатель на значение, связанное с *атрибутом.* В зависимости от значения *Attribute,* *ValuePtr* будет 32-битным значением или точкой к строке символов с нулевым завершением.  
  
 *Струнная длина*  
 (Вход) Если *ValuePtr* указывает на строку символов или бинарный буфер, этот аргумент должен быть длиной в значение*ValuePtr.* Для данных строки символов этот аргумент должен содержать количество байтов в строке.  
  
 Если *ValuePtr* является рядом, *StringLength* игнорируется.  
  
## <a name="returns"></a>Результаты  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **S'LSetEnvAttr** возвращается SQL_ERROR или SQL_SUCCESS_WITH_INFO, связанное с этим значение S'LSTATE можно получить, позвонив по **телефону S'LGetDiagRec** с *помощью HandleType* of SQL_HANDLE_ENV и *ручкой* *environmentHandle.* В следующей таблице перечислены значения S'LSTATE, обычно возвращаемые **S'LSetEnvAttr,** и разъясняется каждая из них в контексте этой функции; нотация "(DM)" предшествует описаниям S'LSTATEs, возвращенным менеджером драйвера. Код возврата, связанный с каждым значением S'LSTATE, является SQL_ERROR, если не указано иное. Если драйвер не поддерживает атрибут среды, ошибка может быть возвращена только во время подключения.  
  
|SQLSTATE|Error|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение, конкретное для водителя. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01S02|Изменение значения опциона|Водитель не поддержал значение, указанное в *ValuePtr,* и заменил аналогичное значение. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|HY000|Общая ошибка|Произошла ошибка, в соответствии с которой не было конкретного S'LSTATE и для которой не было определено конкретное осуществление СЗЛСТАТ. Сообщение об ошибке, возвращенное **S'LGetDiagRec** в * \*буфере MessageText,* описывает ошибку и ее причину.|  
|HY001|Ошибка распределения памяти|Водитель не смог выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY009|Недействительное использование нулевой указатель|Аргумент Attribute определил атрибут среды, который требует значения строки, а аргумент *ValuePtr* был нулевой указателем.|  
|HY010|Ошибка последовательности функций|(DM) Ручка соединения была выделена на *EnvironmentHandle.*<br /><br /> (DM) **SQL_ATTR_ODBC_VERSION** не был установлен с **S'LSetEnvAttr** и *атрибут* не равен **SQL_ATTR_ODBC_VERSION**. Вам не нужно устанавливать **SQL_ATTR_ODBC_VERSION** явно, если вы используете **S'LAllocHandleStd.**|  
|HY013|Ошибка управления памятью|Вызов функции не может быть обработан, поскольку основные объекты памяти не могут быть доступны, возможно, из-за низких условий памяти.|  
|HY024|Значение недействительных атрибутов|С учетом указанного значения *attribute,* недействительное значение было указано в *ValuePtr*.|  
|HY090|Недействительная длина строки или буфера|*Аргумент StringLength* был меньше, чем 0, но не был SQL_NTS.|  
|HY092|Недействительный идентификатор атрибута/опциона|(DM) Значение, указанное для аргумента *Attribute,* не было действительным для версии ODBC, поддерживаемой драйвером.|  
|HY117|Подключение приостанавливается из-за неизвестного состояния транзакции. Разрешены только отключить и прочитать только функции.|(DM) Для получения дополнительной информации о приостановленном состоянии, [см.](../../../odbc/reference/syntax/sqlendtran-function.md)|  
|HYC00|Дополнительная функция не реализована|Значение, указанное для аргумента *Attribute,* является допустимой атрибутом среды ODBC для версии ODBC, поддерживаемой водителем, но не поддерживается водителем.<br /><br /> (DM) Аргумент *attribute* был SQL_ATTR_OUTPUT_NTS, и *ValuePtr* был SQL_FALSE.|  
  
## <a name="comments"></a>Комментарии  
 Приложение может **вызыватьs S'LSetEnvAttr** только в том случае, если ручка соединения не выделяется на окружающую среду. Все атрибуты среды, успешно установленные приложением для среды, сохраняются до тех пор, пока **не** будет вызвана среда. Несколько рукояток среды могут быть выделены одновременно в ODBC *3.x*.  
  
 Формат информации, установленной через *ValuePtr,* зависит от указанного *атрибута.* **SLSetEnvAttr** будет принимать информацию о атрибутах в одном из двух различных форматов: строка с нулевым завершением символов или 32-битное значение integer. Формат каждого из них указан в описании атрибута.  
  
 Нет атрибутов среды, специфичной для драйвера.  
  
 Атрибуты подключения не могут быть установлены вызовом на **s'LSetEnvAttr.** Попытка сделать это вернет S'LSTATE HY092 (идентификатор недействительных атрибутов/опционов).  
  
|*Атрибут*|*Содержимое ValuePtr*|  
|-----------------|-------------------------|  
|SQL_ATTR_CONNECTION_POOLING (ODBC 3.8)|32-битное значение S-LUINTEGER, которое позволяет или отклоняет объединение соединения на уровне среды. Используются следующие значения:<br /><br /> SQL_CP_OFF - объединение соединения выключено. Это значение по умолчанию.<br /><br /> SQL_CP_ONE_PER_DRIVER для каждого драйвера поддерживается единый пул соединения. Каждое соединение в пуле связано с одним драйвером.<br /><br /> SQL_CP_ONE_PER_HENV - для каждой среды поддерживается единый пул подключений. Каждое соединение в пуле связано с одной средой.<br /><br /> SQL_CP_DRIVER_AWARE - Используйте функцию информирования водителя о пуле подключения, если она доступна. Если водитель не поддерживает осведомленность о пуле подключения, SQL_CP_DRIVER_AWARE игнорируется и используется SQL_CP_ONE_PER_HENV. Для получения дополнительной [Driver-Aware Connection Pooling](../../../odbc/reference/develop-app/driver-aware-connection-pooling.md)информации см. В среде, где некоторые драйверы поддерживают, а некоторые драйверы не поддерживают осведомленность о пуле соединения, SQL_CP_DRIVER_AWARE может включить функцию информирования о пуле соединения на тех, кто поддерживает драйверы, но это эквивалентно установке SQL_CP_ONE_PER_HENV на тех драйверах, которые не поддерживают функцию информирования о пуле соединения.<br /><br /> Объединение соединения включено, вызывая **S'LSetEnvAttr** для установки атрибута SQL_ATTR_CONNECTION_POOLING SQL_CP_ONE_PER_DRIVER или SQL_CP_ONE_PER_HENV. Этот вызов должен быть сделан до того, как приложение выделит общую среду, для которой должно быть включено объединение соединения. Обработка среды в вызове на **S'LSetEnvAttr** сведена на нет, что делает SQL_ATTR_CONNECTION_POOLING атрибутом уровня процесса. После включения объединения соединения приложение выделяет неявную общую среду, вызывая **аргумент S'LAllocHandle** с аргументом *InputHandle,* установленным для SQL_HANDLE_ENV.<br /><br /> После включения объединения соединения и выбора общей среды для приложения SQL_ATTR_CONNECTION_POOLING не могут быть сброса для этой среды, так как при настройке этого атрибута **s'LSetEnvAttr** вызывается с ручкой нулевой среды. Если этот атрибут настроен во время объединения соединения, уже включенного в общей среде, атрибут влияет только на общие среды, которые выделены впоследствии.<br /><br /> Также возможно объединение соединения в среде. Обратите внимание на объединение соединения среды:<br /><br /> - Включение объединения соединения на рукоятке NULL является атрибутом уровня процесса. Впоследствии выделенные среды будут общей средой и унаследуют настройки объединения соединения на уровне процесса.<br />- После выделения среды приложение все еще может изменить настройки пула соединения.<br />- Если объединение соединения среды включено и драйвер соединения использует объединение драйверов, объединение среды отдает предпочтение.<br /><br /> SQL_ATTR_CONNECTION_POOLING реализован внутри менеджера драйвера. Водитель не нуждается в реализации SQL_ATTR_CONNECTION_POOLING. Приложения ODBC 2.0 и 3.0 могут настроить этот атрибут среды.<br /><br /> Дополнительные сведения см. в статье [Организация пулов соединений ODBC](../../../odbc/reference/develop-app/driver-manager-connection-pooling.md).|  
|SQL_ATTR_CP_MATCH (ODBC 3.0)|32-битное значение S-LUINTEGER, определяющее, как выбирается соединение из пула соединения. При вызове **S'LConnect** или **S'LDriverConnect** менеджер определяет, какое соединение используется повторно из пула. Менеджер драйвера пытается сопоставить параметры соединения в вызове и атрибуты соединения, установленные приложением, с ключевыми словами и атрибутами соединения в пуле. Значение этого атрибута определяет уровень точности соответствующих критериев.<br /><br /> Для настройки значения этого атрибута используются следующие значения:<br /><br /> SQL_CP_STRICT_MATCH - повторно используются только соединения, которые точно соответствуют вариантам соединения в вызове и атрибутам соединения, установленным приложением. Это значение по умолчанию.<br /><br /> SQL_CP_RELAXED_MATCH - можно использовать соединения с ключевыми словами строки соединения. Ключевые слова должны совпадать, но не все атрибуты соединения должны совпадать.<br /><br /> Для получения более подробной информации о том, как менеджер драйверов выполняет матч при подключении к объединенному соединению, [см.](../../../odbc/reference/syntax/sqlconnect-function.md) Для получения дополнительной информации [ODBC Connection Pooling](../../../odbc/reference/develop-app/driver-manager-connection-pooling.md)об объединении соединения см.|  
|SQL_ATTR_ODBC_VERSION (ODBC 3.0)|32-битный ряд, который определяет, является ли определенная функциональность экспонатами поведения ODBC *2.x* или поведения ODBC *3.x.* Для настройки значения этого атрибута используются следующие значения:<br /><br /> SQL_OV_ODBC3_80 - Менеджер и водитель выставляют следующее поведение ODBC 3.8:<br /><br /> - Водитель возвращается и ожидает КОДы ODBC *3.x* для даты, времени и метки времени.<br />- Водитель возвращает коды ODBC *3.x* S'Lstate, когда называется **S'LError,** **S'LGetDiagField**, или **S'LGetDiagRec.**<br />- Аргумент *CatalogName* в вызове к **S'LTables** принимает шаблон поиска.<br />- Менеджер драйвера поддерживает расширяемость типа C. Для получения дополнительной информации о расширяемости типа c [см.](../../../odbc/reference/develop-app/c-data-types-in-odbc.md)<br /><br /> Для получения дополнительной информации, [см. Что нового в ODBC 3.8](../../../odbc/reference/what-s-new-in-odbc-3-8.md).<br /><br /> SQL_OV_ODBC3 - Менеджер драйвера и водитель демонстрируют следующее поведение ODBC *3.x:*<br /><br /> - Водитель возвращается и ожидает КОДы ODBC *3.x* для даты, времени и метки времени.<br />- Водитель возвращает коды ODBC *3.x* S'Lstate, когда называется **S'LError,** **S'LGetDiagField**, или **S'LGetDiagRec.**<br />- Аргумент *CatalogName* в вызове к **S'LTables** принимает шаблон поиска.<br />- Менеджер драйвера не поддерживает расширяемость типа C.<br /><br /> SQL_OV_ODBC2 - Менеджер драйвера и водитель демонстрируют следующее поведение ODBC *2.x.* Это особенно полезно для приложения ODBC *2.x,* работающего с драйвером ODBC *3.x.*<br /><br /> - Водитель возвращается и ожидает КОДы ODBC *2.x* для даты, времени и метки времени.<br />- Водитель возвращает коды ODBC *2.x* S'Lstate, когда называется **S'LError,** **S'LGetDiagField**, или **S'LGetDiagRec.**<br />- Аргумент *CatalogName* в вызове к **S'LTables** не принимает шаблон поиска.<br />- Менеджер драйвера не поддерживает расширяемость типа C.<br /><br /> Приложение должно установить атрибут этой среды, прежде чем он вызывает любую функцию, которая имеет аргумент S'LHENV, или вызов будет возвращать S'LSTATE HY010 (ошибка последовательности функций). Для этих экологических флагов существует конкретное поведение.<br /><br /> - Для получения дополнительной информации [Behavioral Changes](../../../odbc/reference/develop-app/behavioral-changes.md)см. [Declaring the Application's ODBC Version](../../../odbc/reference/develop-app/declaring-the-application-s-odbc-version.md)|  
|SQL_ATTR_OUTPUT_NTS (ODBC 3.0)|32-битный ряд, определяющий, как драйвер возвращает данные строки. Если SQL_TRUE, драйвер возвращает данные строки с нулевым истечением. Если SQL_FALSE, драйвер не возвращает данные строки с нуля.<br /><br /> Этот атрибут по умолчанию SQL_TRUE. Звонок в **S'LSetEnvAttr,** чтобы установить его, чтобы SQL_TRUE возвращает сяSQL_SUCCESS. Призыв к **S'LSetEnvAttr** установить его SQL_FALSE возвращает SQL_ERROR и S'LSTATE HYC00 (необязательная функция не реализована).|  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Выделение ручки|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Возвращение атрибута среды|[Функция SQLGetEnvAttr](../../../odbc/reference/syntax/sqlgetenvattr-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справка aPI ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовка ODBC](../../../odbc/reference/install/odbc-header-files.md)   
 [Новые возможности ODBC 3.8](../../../odbc/reference/what-s-new-in-odbc-3-8.md)
