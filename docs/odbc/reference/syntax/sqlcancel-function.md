---
title: Функция S'LCancel (англ.) Документы Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLCancel
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLCancel
helpviewer_keywords:
- SQLCancel function [ODBC]
ms.assetid: ac0b5972-627f-4440-8c5a-0e8da728726d
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: fcc2afce495a1481692ba1f20162a2df5d9a9458
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81301314"
---
# <a name="sqlcancel-function"></a>Функция SQLCancel
**Соответствия**  
 Представлена версия: Соответствие стандартам ODBC 1.0: ISO 92  
  
 **Сводка**  
 **S'LCancel** отменяет обработку оператора.  
  
 Для отмены обработки на подключение или выписку используйте [функцию S'LCancelHandle.](../../../odbc/reference/syntax/sqlcancelhandle-function.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLCancel(  
     SQLHSTMT     StatementHandle);  
```  
  
## <a name="arguments"></a>Аргументы  
 *Обработка заявления*  
 (Вход) Ручка оператора.  
  
## <a name="returns"></a>Результаты  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **S'LCancel** возвращается SQL_ERROR или SQL_SUCCESS_WITH_INFO, связанное с этим значение S'LSTATE можно получить, позвонив по **телефону S'LGetDiagRec** с *помощью handleType* of SQL_HANDLE_STMT и *ручки* *statementHandle.* В следующей таблице перечислены значения S'LSTATE, обычно возвращаемые **S'LCancel,** и разъясняются каждое из них в контексте этой функции; нотация "(DM)" предшествует описаниям S'LSTATEs, возвращенным менеджером драйвера. Код возврата, связанный с каждым значением S'LSTATE, является SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Error|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение, конкретное для водителя. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|HY000|Общая ошибка|Произошла ошибка, в соответствии с которой не было конкретного S'LSTATE и для которой не было определено конкретное осуществление СЗЛСТАТ. Сообщение об ошибке, возвращенное [S'LGetDiagRec](../../../odbc/reference/syntax/sqlgetdiagrec-function.md) в буфере * \*MessageText,* описывает ошибку и ее причину.|  
|HY001|Ошибка распределения памяти|Водитель не смог выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY010|Ошибка последовательности функций|(DM) Асинхронно функция выполнения была вызвана для ручки соединения, которая связана с *StatementHandle.* Эта асинхронная функция по-прежнему исполнялась, когда была вызвана функция **S'LCancel.**<br /><br /> (DM) Отмена операции не удалось, потому что асинхронная операция находится в процессе на ручке соединения, которая связана с *StatementHandle.*|  
|HY013|Ошибка управления памятью|Вызов функции не может быть обработан, поскольку основные объекты памяти не могут быть доступны, возможно, из-за низких условий памяти.|  
|HY018|Сервер отклонил запрос на отмену|Сервер отклонил запрос на отмену.|  
|HY117|Подключение приостанавливается из-за неизвестного состояния транзакции. Разрешены только отключить и прочитать только функции.|(DM) Для получения дополнительной информации о приостановленном состоянии, [см.](../../../odbc/reference/syntax/sqlendtran-function.md)|  
|HYT01|Срок истечения времени подключения|Период тайм-аута соединения истек до того, как источник данных ответил на запрос. Период тайм-аута соединения устанавливается через **S'LSetConnectAttr,** SQL_ATTR_CONNECTION_TIMEOUT.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) Драйвер, связанный с *StatementHandle,* не поддерживает функцию.|  
  
## <a name="comments"></a>Комментарии  
 **S'LCancel** может отменить следующие типы обработки в выписке:  
  
-   Функция, работая асинхронно на выписке.  
  
-   Функция на выписке, которая нуждается в данных.  
  
-   Функция, работана на отчете на другом потоке.  
  
 В ODBC 2. *x*, если приложение вызывает **S'LCancel,** когда в выписке не выполняется обработка, **S'LCancel** имеет тот же эффект, что и **s-LFreeStmt** с SQL_CLOSE опцией; такое поведение определяется только для полноты, и приложения должны вызывать **S'LFreeStmt** или **S'LCloseCursor,** чтобы закрыть курсоры.  
  
 При вызове **S'LCancel** для отмены функции, работая асинхронно в выписке или функции в выписке, которая нуждается в данных, диагностические записи, размещенные отменой функции, осваиваются, а **S'LCancel** публикует свои собственные диагностические записи; однако, когда **s'LCancel** вызывается для отмены функции, работая на отчете на другом потоке, он не очищает диагностические записи от отмененной функции и не публикует свои собственные диагностические записи.  
  
## <a name="canceling-asynchronous-processing"></a>Отмена асинхронной обработки  
 После того, как приложение вызывает функцию асинхронно, оно вызывает функцию повторно, чтобы определить, закончила ли она обработку. Если функция все еще обрабатывается, она возвращает SQL_STILL_EXECUTING. Если функция закончила обработку, она возвращает другой код.  
  
 После любого вызова к функции, которая возвращается SQL_STILL_EXECUTING, приложение может вызвать **S'LCancel,** чтобы отменить функцию. Если запрос на отмену будет успешным, водитель возвращается SQL_SUCCESS. Это сообщение не указывает на то, что функция была фактически отменена; он указывает, что запрос на отмену был обработан. Когда или если функция фактически отменена, зависит от драйвера и зависит источник данных. Приложение должно продолжать вызывать исходную функцию до тех пор, пока код возврата не будет SQL_STILL_EXECUTING. Если функция была успешно отменена, код возврата SQL_ERROR и S'LSTATE HY008 (Операция отменена). Если функция завершила нормальную обработку, код возврата SQL_SUCCESS или SQL_SUCCESS_WITH_INFO если функция выполнена или SQL_ERROR, и S'LSTATE, кроме HY008 (Операция отменена) в случае сбой функции.  
  
> [!NOTE]  
>  В ODBC 3.5 звонок в **S'LCancel,** когда в выписке не выполняется обработка, не рассматривается как **S'LFreeStmt** с SQL_CLOSE опцией, но не имеет никакого эффекта. Чтобы закрыть курсор, приложение должно позвонить в **s'LCloseCursor,** а не на **S'LCancel.**  
  
 Для получения дополнительной информации о асинхронной обработке [см.](../../../odbc/reference/develop-app/asynchronous-execution-polling-method.md)  
  
## <a name="canceling-functions-that-need-data"></a>Отмена функций, необходимых для данных  
 После того, как **S'LExecute** или **S'LExecDirect** возвращается SQL_NEED_DATA и до того, как данные были отправлены по всем параметрам выполнения данных, приложение может вызвать **S'LCancel,** чтобы отменить выполнение оператора. После того, как выписка была отменена, приложение может снова вызвать **S'L'LExecute** или **S'LExecDirect.** Для получения более подробной информации, [см.](../../../odbc/reference/syntax/sqlbindparameter-function.md)  
  
 После того, как **s'LBulkOperations** или **S'LSetPos** возвращается SQL_NEED_DATA и до того, как данные были отправлены для всех столбцов данных по исполнению, приложение может вызвать **S'LCancel,** чтобы отменить операцию. После того, как операция была отменена, приложение может снова вызвать **S'LBulkOperations** или **S'LSetPos;** отмена не влияет на состояние курсора или текущее положение курсора. Для получения более подробной информации, [SQLSetPos](../../../odbc/reference/syntax/sqlsetpos-function.md)см. [SQLBulkOperations](../../../odbc/reference/syntax/sqlbulkoperations-function.md)  
  
## <a name="canceling-functions-executing-on-another-thread"></a>Отмена функций выполнения на другой нити  
 В многопоточном приложении приложение может отменить функцию, которая выполняется на другом потоке. Чтобы отменить функцию, приложение вызывает **S'LCancel** с той же ручкой оператора, что и в целевой функции, но на другом потоке. Способ отмены функции зависит от драйвера и операционной системы. Как и при отмене функции, работающей асинхронно, код возврата **S'LCancel** указывает только на то, успешно ли водитель обработал запрос. Вернуть можно только SQL_SUCCESS или SQL_ERROR; диагностическая информация не возвращается. Если исходная функция отменена, она возвращает SQL_ERROR и S'Lstate HY008 (Операция отменена).  
  
 Если выписка по S'L выполняется, когда **s'LCancel** вызывается на другой поток, чтобы отменить выполнение оператора, возможно, что выполнение выполняется успешно и возвращается SQL_SUCCESS в то время как отмена также является успешной. В этом случае менеджер драйвера предполагает, что курсор, открытый выполнением оператора, закрывается отменой, поэтому приложение не сможет использовать курсор.  
  
 Для получения дополнительной информации о потоке [см.](../../../odbc/reference/develop-app/multithreading.md)  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Привязка буфера к параметру|[Функция SQLBindParameter](../../../odbc/reference/syntax/sqlbindparameter-function.md)|  
|Выполнение операций по массовой вставке или обновлению|[Функция SQLBulkOperations](../../../odbc/reference/syntax/sqlbulkoperations-function.md)|  
|В дополнение к функциональности S'LCancel, в дополнение к функциональности **S'LCancel,** отменяет функцию, работая асинхронно на ручке соединения.|[Функция SQLCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md)|  
|Выполнение оператора S'L|[Функция SQLExecDirect](../../../odbc/reference/syntax/sqlexecdirect-function.md)|  
|Выполнение подготовленного заявления по S'L|[Функция «СЗЛВы»](../../../odbc/reference/syntax/sqlexecute-function.md)|  
|Освобождение ручки оператора|[Функция SQLFreeStmt](../../../odbc/reference/syntax/sqlfreestmt-function.md)|  
|Получение поля диагностической записи или поля диагностического заголовка|[Функция SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md)|  
|Получение нескольких полей структуры диагностических данных|[Функция SQLGetDiagRec](../../../odbc/reference/syntax/sqlgetdiagrec-function.md)|  
|Возвращение следующего параметра для отправки данных для|[Функция SQLParamData](../../../odbc/reference/syntax/sqlparamdata-function.md)|  
|Отправка данных параметров во время выполнения|[Функция SQLPutData](../../../odbc/reference/syntax/sqlputdata-function.md)|  
|Позиционирование курсора в строке, обновление данных в строке или обновление или удаляние данных в наборе результатов|[Функция SQLSetPos](../../../odbc/reference/syntax/sqlsetpos-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справка aPI ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
