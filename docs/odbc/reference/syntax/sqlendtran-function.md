---
title: Функция SQLEndTran | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLEndTran
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLEndTran
helpviewer_keywords:
- SQLEndTran function [ODBC]
ms.assetid: ff375ce1-eb50-4693-b1e6-70181a6dbf9f
author: MightyPen
ms.author: genemi
ms.openlocfilehash: 82045d5dbbee356f084d587100edfbafd4947f54
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68104635"
---
# <a name="sqlendtran-function"></a>Функция SQLEndTran
**Соответствие стандартам**  
 Представленные версии: ODBC 3.0 стандартов соответствия: ISO-92  
  
 **Сводка**  
 **SQLEndTran** запрашивает операции фиксации или отката для всех активных операций для всех инструкций, ассоциированные с соединением. **SQLEndTran** можно также запросить выполнение операции фиксации или отката всех подключений, связанных со средой.  
  
> [!NOTE]  
>  Дополнительные сведения о какие диспетчера драйверов сопоставляет эту функцию, чтобы при ODBC 3. *x* при работе с ODBC 2. *x* драйвера, см. в разделе [сопоставление замещающих функций для обеспечения обратной совместимости приложений](../../../odbc/reference/develop-app/mapping-replacement-functions-for-backward-compatibility-of-applications.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLEndTran(  
     SQLSMALLINT   HandleType,  
     SQLHANDLE     Handle,  
     SQLSMALLINT   CompletionType);  
```  
  
## <a name="arguments"></a>Аргументы  
 *HandleType*  
 [Вход] Идентификатор дескриптора типа. Содержит либо SQL_HANDLE_ENV (если *обрабатывать* является дескриптор среды) или SQL_HANDLE_DBC (если *обрабатывать* является дескриптор соединения).  
  
 *Дескриптор*  
 [Вход] Дескриптор типа, указанного *HandleType*, указывающий область транзакции. Дополнительные сведения см. «Комментарии».  
  
 *CompletionType*  
 [Вход] Один из следующих двух значений:  
  
 ПАРАМЕТРОМ SQL_COMMIT SQL_ROLLBACK  
  
## <a name="returns"></a>Возвращает  
 Значение SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, значение SQL_ERROR, SQL_INVALID_HANDLE или SQL_STILL_EXECUTING.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLEndTran** возвращает значение SQL_ERROR или SQL_SUCCESS_WITH_INFO, а связанное значение SQLSTATE может быть получен путем вызова **SQLGetDiagRec** с соответствующим *HandleType*и *обрабатывать*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые **SQLEndTran** и объясняется каждый из них в контексте этой функции; описания SQLSTATE, возвращаемых диспетчером драйверов предшествует обозначение «(DM)». Возвращается связанный с каждого значения SQLSTATE значение SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Ошибка|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Специфические для драйвера информационное сообщение. (Функция возвращает значение SQL_SUCCESS_WITH_INFO).|  
|08003|Соединение не открыто|(DM) *HandleType* был SQL_HANDLE_DBC и *обрабатывать* не находился в подключенном состоянии.|  
|08007|Сбой подключения во время транзакции|*HandleType* был SQL_HANDLE_DBC, и соединение, связанный с *обрабатывать* сбой во время выполнения функции, и не может быть определено ли запрошенный  **ЗАФИКСИРОВАТЬ** или **ОТКАТА** произошло до сбоя.|  
|25S01|Состояние транзакции неизвестно|Один или несколько подключений в *обрабатывать* не удалось завершить транзакцию с результатом указано, и результат выполнения неизвестен.|  
|25S02|Транзакция все еще активна|Драйвер не может гарантировать, что атомарным образом удалось выполнить всю работу в глобальную транзакцию, и транзакция все еще активна.|  
|25S03|Выполняется откат транзакции|Драйвер не смог гарантирует, что атомарным образом удалось выполнить всю работу в глобальную транзакцию, и все работают в транзакции, активной в *обрабатывать* был выполнен откат.|  
|40001|Сбой сериализации|Выполнен откат транзакции из-за взаимоблокировки ресурсов с другой транзакцией.|  
|40002|Нарушение ограничения целостности|*CompletionType* был параметром SQL_COMMIT и фиксации изменений вызвал нарушение ограничения целостности. Таким образом выполнен откат транзакции.|  
|HY000|Общая ошибка|Произошла ошибка, для которой было нет конкретных SQLSTATE и SQLSTATE не зависящие от реализации, который был определен. Сообщение об ошибке, возвращенные **SQLGetDiagRec** в  *\*szMessageText* буфера описывает ошибку и его причины.|  
|HY001|Ошибка выделения памяти|Драйвер не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Операция отменена|Асинхронная обработка была включена для *ConnectionHandle*. Функция была вызвана, и до завершения выполнения [функция SQLCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md) был вызван для *ConnectionHandle*. Затем функция был снова вызван для *ConnectionHandle*.<br /><br /> Функция была вызвана, и до завершения выполнения **SQLCancelHandle** был вызван для *ConnectionHandle* из другого потока в многопоточных приложениях.|  
|HY010|Ошибка последовательности функций|(DM) был вызван асинхронно выполняемой функции для дескриптора инструкции, связанные с *ConnectionHandle* и еще выполнялась при **SQLEndTran** был вызван.<br /><br /> (DM) асинхронно выполняемой функции (не такой) был вызван для *ConnectionHandle* и еще выполнялась при вызове этой функции.<br /><br /> (DM) **SQLExecute**, **SQLExecDirect**, **SQLBulkOperations**, или **SQLSetPos** был вызван для дескриптора инструкции, связанные с *ConnectionHandle* и возвращается значение SQL_NEED_DATA. Эта функция был вызван перед отправкой данных для всех параметров данных времени выполнения или столбцов.<br /><br /> (DM) асинхронно выполняемой функции (не такой) был вызван для *обрабатывать* с *HandleType* значение SQL_HANDLE_DBC и все еще выполняется, при вызове этой функции.<br /><br /> (DM) **SQLExecute**, **SQLExecDirect**, или **SQLMoreResults** был вызван для одного из дескрипторов инструкций, связанных с *обрабатывать* и Возвращаемый SQL_PARAM_DATA_AVAILABLE. Прежде чем данные были получены для всех параметров потоковой вызове этой функции.|  
|HY012|Недопустимый код операции транзакции|(DM) значение, указанное для аргумента *CompletionType* ни параметром SQL_COMMIT или SQL_ROLLBACK.|  
|HY013|Ошибка управления памятью|Не удалось обработать вызов функции, так как базовые объекты памяти оказываются недоступны, возможно из-за нехватки памяти.|  
|HY092|Недопустимый атрибут/идентификатор параметра|(DM) значение, указанное для аргумента *HandleType* был ни SQL_HANDLE_ENV, ни SQL_HANDLE_DBC.|  
|HY115|SQLEndTran не допускается для среды, содержащий соединение с поддержкой выполнения асинхронной функции|(DM) *HandleType* не может быть присвоено SQL_HANDLE_ENV активна асинхронное выполнение функций подключения для подключения в среде.|  
|HY117|Подключение будет приостановлена из-за состояние транзакции неизвестно. Только отключиться и разрешены функции, доступные только для чтения.|(DM) Дополнительные сведения о состоянии приостановки, см. в разделе "Примечания" данного раздела.|  
|HYC00|Дополнительная возможность не реализована|Драйвер или источник данных не поддерживает **ОТКАТА** операции.|  
|HYT01|Время ожидания подключения истекло|Время ожидания подключения истекло раньше, чем ответил на запрос источника данных. Период времени ожидания задается с помощью **SQLSetConnectAttr**, sql_attr_connection_timeout не учитывается.|  
|IM001|Драйвер не поддерживает эту функцию|Драйвер (DM), связанные с *ConnectionHandle* не поддерживает функцию.|  
|IM017|Опрос недоступен в режиме асинхронное уведомление|Каждый раз, когда используется модель уведомлений, отключен опроса.|  
|IM018|**SQLCompleteAsync** не был вызван для завершения предыдущей асинхронной операции на этот дескриптор.|Если предыдущий вызов функции в дескриптор возвращает SQL_STILL_EXECUTING, и если включен режим уведомлений, **SQLCompleteAsync** должен вызываться с дескриптором постобработки и завершить операцию.|  
  
## <a name="comments"></a>Комментарии  
 Для ODBC 3. *x* драйвера, если *HandleType* — SQL_HANDLE_ENV и *обрабатывать* является дескриптором допустимые среды, а затем вызовет диспетчер драйверов **SQLEndTran**каждого драйвера, связанное с данной средой. *Обрабатывать* аргумент для вызова в драйвер будет дескриптора среды драйвера. Для ODBC 2. *x* драйвера, если *HandleType* — SQL_HANDLE_ENV и *обрабатывать* является дескриптором допустимое окружение и несколько подключений в подключенном состоянии в этой среде, затем диспетчер драйверов вызывает **SQLTransact** в драйвере один раз для каждого соединения в подключенном состоянии в этой среде. *Обрабатывать* аргумент в каждом вызове будет дескриптора соединения. В любом случае драйвер попытается выполнить фиксацию или откат транзакции, в зависимости от значения *CompletionType*, для всех подключений, которые находятся в подключенном состоянии на этой среды. Неактивные соединения не влияют на транзакцию.  
  
> [!NOTE]  
>  **SQLEndTran** не может использоваться для фиксации или отката транзакции в общей среде. SQLSTATE HY092 (недопустимый атрибута или параметра идентификатора), будет возвращено в том случае, если **SQLEndTran** вызывается с *обрабатывать* дескриптор среде с общим доступом или дескриптор подключения в общем Среда.  
  
 Диспетчер драйверов возвращает значение SQL_SUCCESS, указывая только в том случае, если он получает значение SQL_SUCCESS, указывая для каждого подключения. Если диспетчер драйверов получает значение SQL_ERROR на одно или несколько соединений, он возвращает значение SQL_ERROR в приложение и диагностических сведений помещается в структуре диагностических данных среды. Чтобы определить, какие соединения или соединения, сбой во время операции фиксации или отката, приложение может вызвать **SQLGetDiagRec** для каждого подключения.  
  
> [!NOTE]  
>  Диспетчер драйверов не поддерживает глобальные транзакции через все подключения и поэтому не использует протоколы двухфазной фиксации.  
  
 Если *CompletionType* является параметром SQL_COMMIT, **SQLEndTran** выдает запрос на фиксацию для всех активных операций для любой инструкции, связанные с подключением к уязвимой. Если *CompletionType* является SQL_ROLLBACK, **SQLEndTran** выдает запрос отката для всех активных операций для любой инструкции, связанные с подключением к уязвимой. Если транзакции не активны, **SQLEndTran** возвращает значение SQL_SUCCESS без влияния на все источники данных. Дополнительные сведения см. в разделе [Committing и отката транзакций](../../../odbc/reference/develop-app/committing-and-rolling-back-transactions.md).  
  
 Если драйвер находится в режиме ручной фиксации (путем вызова **SQLSetConnectAttr** с SQL_ATTR_AUTOCOMMIT атрибут к SQL_AUTOCOMMIT_OFF), новая транзакция неявно начинается, когда инструкция SQL, могут содержаться в транзакция выполняется в текущем источнике данных. Дополнительные сведения см. в разделе [режим фиксации](../../../odbc/reference/develop-app/commit-mode.md).  
  
 Чтобы определить влияние операций транзакций на курсоры, приложение вызывает **SQLGetInfo** параметры SQL_CURSOR_ROLLBACK_BEHAVIOR и SQL_CURSOR_COMMIT_BEHAVIOR. Дополнительные сведения см. в разделе ниже, а также см. в разделе [влияние транзакций на курсоры и подготовленных инструкций](../../../odbc/reference/develop-app/effect-of-transactions-on-cursors-and-prepared-statements.md).  
  
 Если значение SQL_CURSOR_ROLLBACK_BEHAVIOR или SQL_CURSOR_COMMIT_BEHAVIOR — SQL_CB_DELETE, **SQLEndTran** закрывает и удаляет все открытые курсоры закрываются при всех инструкций, связанный с подключением и отменяет все ожидающие результаты. **SQLEndTran** оставляет любая инструкция, в состоянии выделенной (неподготовленных); приложения, их можно использовать повторно для последующих запросов SQL, либо путем вызова **SQLFreeStmt** или **SQLFreeHandle** с *HandleType* значение SQL_HANDLE_STMT освободить их.  
  
 Если значение SQL_CURSOR_ROLLBACK_BEHAVIOR или SQL_CURSOR_COMMIT_BEHAVIOR — SQL_CB_CLOSE, **SQLEndTran** закрывает все открытые курсоры во всех инструкциях, связанный с подключением. **SQLEndTran** оставляет любая инструкция, присутствующих в подготовленном состоянии; приложение может вызвать **SQLExecute** для инструкции, связанные с подключением без предварительного вызова функции **SQLPrepare**.  
  
 Если значение SQL_CURSOR_ROLLBACK_BEHAVIOR или SQL_CURSOR_COMMIT_BEHAVIOR — SQL_CB_PRESERVE, **SQLEndTran** не влияет на открытые курсоры, связанный с подключением. Курсоры остаются в строке, они, на который указывает до вызова **SQLEndTran**.  
  
 Для драйверов и источников данных, которые поддерживают транзакции, вызвав **SQLEndTran** с параметром SQL_COMMIT или SQL_ROLLBACK при активном транзакция не возвращает значение SQL_SUCCESS, (показывает, что нет заданий необходимости фиксации или отката) и не оказывает влияния на источнике данных.  
  
 Когда драйвер находится в режиме автоматической фиксации, диспетчер драйверов не вызывает **SQLEndTran** в драйвере. **SQLEndTran** всегда возвращает значение SQL_SUCCESS независимо от того, является ли он вызывается с *CompletionType* параметром SQL_COMMIT или SQL_ROLLBACK.  
  
 Драйверы или источники данных, которые не поддерживают транзакции (**SQLGetInfo** *параметр* SQL_TXN_CAPABLE — SQL_TC_NONE) эффективно всегда находятся в режиме автоматической фиксации и поэтому всегда возвращает значение SQL_SUCCESS, указывая для **SQLEndTran** ли они вызываются с помощью *CompletionType* параметром SQL_COMMIT или SQL_ROLLBACK. Такие драйверы и источники данных не выполнять откат фактически транзакции при запросе на это.  
  
## <a name="suspended-state"></a>Приостановленного состояния  
 В диспетчере драйверов, выпущенных до Windows 7, транзакция была активна при **SQLEndTran** возвращает значение SQL_ERROR в драйвере. Тем не менее можно было транзакции бы она была успешно зафиксирована на сервере, что драйвер на стороне клиента не было были уведомлены (например, из-за сетевой ошибки). Это бы оставить подключение в неисправном состоянии. Начиная с Windows 7, когда **SQLEndTran** возвращает значение SQL_ERROR, соединение может быть в приостановленном состоянии. В приостановленном состоянии можно вызвать функции только для чтения. В конечном счете, приложение должно вызвать **SQLDisconnect** приостановленные подключения для освобождения ресурсов.  
  
 Если все следующие условия верны, соединение будет отправляться в приостановленном состоянии:  
  
-   Драйвер возвращает ошибку SQL_ERROR из **SQLEndTran**.  
  
-   Драйвер ODBC версии 3.8 или более поздней версии.  
  
-   Версия приложения — 3.8 или более поздней версии; или перекомпилированной приложение ODBC 2.x или 3.x успешно отменяет **SQLEndTran** работать через **SQLCancelHandle**.  
  
-   Драйвер не возвращать одно из следующих сообщений, которые убедитесь, что транзакция не была завершена.  
  
    -   25S03: Выполняется откат транзакции  
  
    -   40001: Сбой сериализации  
  
    -   40002: ограничение целостности  
  
    -   HYC00: Дополнительная возможность не реализована  
  
 Если **SQLEndTran** был вызван в среде дескриптор и одного из подключений выполнил выше условий, все подключения, подключение к тот же драйвер будет отправляться в приостановленном состоянии.  
  
 После приложение вызывает **SQLDisconnect** приостановленной соединения, соединение может использоваться для повторного подключения к другому источнику данных или тот же источник данных.  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Отмена функции работающего асинхронно на дескриптор соединения.|[Функция SQLCancelHandle](../../../odbc/reference/syntax/sqlcancelhandle-function.md)|  
|Возврат сведений о драйверу или источнику данных|[Функция SQLGetInfo](../../../odbc/reference/syntax/sqlgetinfo-function.md)|  
|Освобождение дескриптора|[Функция SQLFreeHandle](../../../odbc/reference/syntax/sqlfreehandle-function.md)|  
|Освобождение дескриптора инструкции|[Функция SQLFreeStmt](../../../odbc/reference/syntax/sqlfreestmt-function.md)|  
  
## <a name="see-also"></a>См. также  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)   
 [Асинхронное выполнение (метод опроса)](../../../odbc/reference/develop-app/asynchronous-execution-polling-method.md)
