---
title: Роль диспетчера драйверов&#39;в процессе подключения | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- driver manager [ODBC], role in connection process
- connecting to data source [ODBC], driver manager
- connecting to driver [ODBC], driver manager
- ODBC driver manager [ODBC]
ms.assetid: 77c05630-5a8b-467d-b80e-c705dc06d601
author: MightyPen
ms.author: genemi
ms.openlocfilehash: fdc7f82059579f23c9a1a1203aee5e45c87693e9
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "68046940"
---
# <a name="driver-manager39s-role-in-the-connection-process"></a>Роль диспетчера драйверов&#39;в процессе подключения
Помните, что приложения не вызывают функции драйвера напрямую. Вместо этого они вызывают функции диспетчера драйверов с тем же именем, а диспетчер драйверов вызывает функции драйвера. Как правило, это происходит практически сразу же. Например, приложение вызывает **SQLExecute** в диспетчере драйверов и после нескольких проверок ошибок диспетчер драйверов вызывает **SQLExecute** в драйвере.  
  
 Процесс подключения отличается. Когда приложение вызывает **функцию SQLAllocHandle** с параметрами SQL_HANDLE_ENV и SQL_HANDLE_DBC, функция выделяет дескрипторы только в диспетчере драйверов. Диспетчер драйверов не вызывает эту функцию в драйвере, так как не знает, какой драйвер следует вызывать. Аналогичным образом, если приложение передает маркер неподключенного подключения к **SQLSetConnectAttr** или **SQLGetConnectAttr**, функция выполняется только диспетчером драйверов. Он сохраняет или получает значение атрибута из своего обработчика соединения и возвращает значение SQLSTATE 08003 (соединение не открыто) при получении значения для атрибута, который не был задан и для которого ODBC не определяет значение по умолчанию.  
  
 Когда приложение вызывает **SQLConnect**, **SQLDriverConnect**или **SQLBrowseConnect**, диспетчер драйверов сначала определяет, какой драйвер следует использовать. Затем он проверяет, загружен ли в данный момент драйвер для подключения:  
  
-   Если в подключении не загружен драйвер, диспетчер драйверов проверяет, загружен ли указанный драйвер в другое подключение в той же среде. В противном случае диспетчер драйверов загружает драйвер в подключение и вызывает **функцию SQLAllocHandle** в драйвере с параметром SQL_HANDLE_ENV.  
  
     Затем Диспетчер драйверов вызывает **функцию SQLAllocHandle** в драйвере с параметром SQL_HANDLE_DBC, независимо от того, был ли он загружен. Если приложение устанавливает какие бы то ни было атрибуты подключения, диспетчер драйверов вызывает **SQLSetConnectAttr** в драйвере. При возникновении ошибки функция подключения диспетчера драйверов возвращает значение SQLSTATE IM006 (сбой драйвера **SQLSetConnectAttr** ). Наконец, диспетчер драйверов вызывает функцию подключения в драйвере.  
  
-   Если указанный драйвер загружен в соединение, диспетчер драйверов вызывает только функцию подключения в драйвере. В этом случае драйвер должен убедиться, что все атрибуты соединения в соединении сохраняют свои текущие параметры.  
  
-   Если в подключении загружен другой драйвер, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере, чтобы освободить подключение. Если других соединений, использующих этот драйвер, нет, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере, чтобы освободить среду и выгрузить драйвер. Затем Диспетчер драйверов выполняет те же операции, что и когда драйвер не загружен в соединении.  
  
 Диспетчер драйверов блокирует обработчик среды (*хенв*) перед вызовом **функцию SQLAllocHandle** драйвера и **SQLFreeHandle** , когда *параметром handletype* имеет значение **SQL_HANDLE_DBC**.  
  
 Когда приложение вызывает **SQLDisconnect**, диспетчер драйверов вызывает **SQLDisconnect** в драйвере. Однако он оставляет драйвер загруженным, если приложение повторно подключится к драйверу. Когда приложение вызывает **SQLFreeHandle** с параметром SQL_HANDLE_DBC, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере. Если драйвер не используется какими-либо другими соединениями, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере с параметром SQL_HANDLE_ENV и выгружает драйвер.
