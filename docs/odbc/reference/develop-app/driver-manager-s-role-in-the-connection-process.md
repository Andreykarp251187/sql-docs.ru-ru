---
title: Менеджер драйвера&#39;роль в процессе подключения (ru) Документы Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- driver manager [ODBC], role in connection process
- connecting to data source [ODBC], driver manager
- connecting to driver [ODBC], driver manager
- ODBC driver manager [ODBC]
ms.assetid: 77c05630-5a8b-467d-b80e-c705dc06d601
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 0227a4063573cb05ecaa9434605ba35f2811bd06
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81305805"
---
# <a name="driver-manager39s-role-in-the-connection-process"></a>Роль менеджера драйвера&#39;в процессе подключения
Помните, что приложения не вызывают функции драйвера напрямую. Вместо этого они вызывают функции менеджера драйвера с тем же именем, а менеджер драйвера вызывает функции драйвера. Как правило, это происходит почти сразу. Например, приложение вызывает **S'LExecute** в менеджере драйвера, и после нескольких ошибок менеджер вызывает **S'LExecute** в драйвере.  
  
 Процесс подключения отличается. Когда приложение вызывает **S'LAllocHandle** с SQL_HANDLE_ENV и SQL_HANDLE_DBC опций, функция распределяет ручки только в менеджере драйвера. Менеджер драйвера не вызывает эту функцию в драйвере, потому что он не знает, какой драйвер звонить. Аналогичным образом, если приложение проходит ручку неподключенного соединения к **S'LSetConnectAttr** или **S'LGetConnectAttr,** только менеджер драйвера выполняет функцию. Он хранит или получает значение атрибута из своей ручки соединения и возвращает S'LSTATE 08003 (Соединение не открывается) при получении значения для атрибута, который не был установлен и для которого ODBC не определяет значение по умолчанию.  
  
 Когда приложение вызывает **s'LConnect,** **S'LDriverConnect**, или **S'LBrowseConnect**, менеджер драйвера сначала определяет, какой драйвер использовать. Затем он проверяет, загружен ли водитель в настоящее время на соединение:  
  
-   Если водитель не загружается на соединение, менеджер драйвера проверяет, загружен ли указанный драйвер на другое соединение в той же среде. В противном случае менеджер водителя загружает водителя на соединение и вызывает **s'LAllocHandle** в драйвере с SQL_HANDLE_ENV опцией.  
  
     Затем менеджер драйвера вызывает **s'LAllocHandle** в драйвере с SQL_HANDLE_DBC опцией, независимо от того, был ли он просто загружен. Если приложение устанавливает какие-либо атрибуты соединения, менеджер драйвера вызывает **s'LSetConnectAttr** в драйвере; в случае ошибки функция подключения менеджера драйвера возвращает функцию S'Lstate IM006 (сбой драйвера **S'LSetConnectAttr).** Наконец, менеджер драйвера вызывает функцию соединения в драйвере.  
  
-   Если указанный драйвер загружен на соединение, менеджер драйвера вызывает только функцию соединения в драйвере. В этом случае драйвер должен убедиться, что все атрибуты соединения в соединении сохраняют свои текущие настройки.  
  
-   Если другой драйвер загружен на соединение, менеджер драйвера вызывает **s'LFreeHandle** в драйвере, чтобы освободить соединение. Если нет других соединений, которые используют драйвер, менеджер драйвера вызывает **s'LFreeHandle** в драйвере, чтобы освободить среду и выгружает драйвер. Затем менеджер драйвера выполняет те же операции, что и при незагрузке драйвера на соединение.  
  
 Менеджер драйвера заблокирует ручку среды *(henv*), прежде чем звонить водителю **s'LAllocHandle** и **S'LFreeHandle,** когда *HandleType* будет **SQL_HANDLE_DBC.**  
  
 Когда приложение вызывает **S'LDisconnect,** менеджер драйвера вызывает **S'LDisconnect** в драйвере. Тем не менее, он оставляет драйвер загружен в случае, если приложение повторно подключается к драйверу. Когда приложение вызывает **s'LFreeHandle** с SQL_HANDLE_DBC опцией, менеджер драйвера вызывает **s'LFreeHandle** в драйвере. Если драйвер не используется какими-либо другими соединениями, менеджер драйвера вызывает **s'LFreeHandle** в драйвере с SQL_HANDLE_ENV опцией и выгружает драйвер.
