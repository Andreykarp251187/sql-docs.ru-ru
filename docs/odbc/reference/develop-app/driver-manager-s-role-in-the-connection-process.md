---
title: Диспетчер драйверов&#39;s роль в процессе подключения | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- driver manager [ODBC], role in connection process
- connecting to data source [ODBC], driver manager
- connecting to driver [ODBC], driver manager
- ODBC driver manager [ODBC]
ms.assetid: 77c05630-5a8b-467d-b80e-c705dc06d601
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: af81fd6c4b0b56474497a829985a754ccf88f3ff
ms.sourcegitcommit: f7fced330b64d6616aeb8766747295807c92dd41
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63238029"
---
# <a name="driver-manager39s-role-in-the-connection-process"></a>Диспетчер драйверов&#39;s роль в процессе подключения
Помните, что приложения не вызывают функции драйверов напрямую. Вместо этого они вызывают функции диспетчера драйверов с тем же именем, и диспетчер драйверов вызывает функции драйвера. Обычно это происходит почти мгновенно. Например, приложение вызывает **SQLExecute** диспетчера драйверов и после проверки несколько ошибок, диспетчер драйверов вызывает **SQLExecute** в драйвере.  
  
 Процесс подключения отличается. Когда приложение вызывает **SQLAllocHandle** с SQL_HANDLE_ENV и SQL_HANDLE_DBC, функция выделяет обрабатывает только диспетчера драйверов. Диспетчер драйверов вызывает эту функцию в драйвере, поскольку он не знает, какой драйвер следует вызвать. Аналогично Если приложение передает дескриптор неподключенный подключения к **SQLSetConnectAttr** или **SQLGetConnectAttr**, только для диспетчера драйверов выполняет функцию. Он сохраняет или получает значение атрибута из его подключения, обработки и возвращает SQLSTATE 08003 (соединение не открыто) при получении значения для атрибута не было задано и для ODBC не определяет значение по умолчанию.  
  
 Когда приложение вызывает **SQLConnect**, **SQLDriverConnect**, или **SQLBrowseConnect**, диспетчер драйверов сначала определяет, какой драйвер следует использовать. Затем он проверяет, чтобы определить, загружается ли в настоящее время драйвером для подключения:  
  
-   Если драйвер не загружается в соединении, диспетчер драйверов проверяет, загружается ли драйвер на другое соединение в одной среде. Если нет, диспетчер драйверов загружает драйвер на подключение и вызывает **SQLAllocHandle** в драйвере с параметром SQL_HANDLE_ENV.  
  
     Диспетчер драйверов вызывает **SQLAllocHandle** в драйвере с параметром SQL_HANDLE_DBC ли он был только что загруженный. Если для приложения настроен любых атрибутов соединения, диспетчер драйверов вызывает **SQLSetConnectAttr** в драйвере; при возникновении ошибки, функция подключения диспетчер драйверов возвращает SQLSTATE IM006 (драйвера  **SQLSetConnectAttr** сбой). Наконец диспетчер драйверов вызывает функцию подключения в драйвере.  
  
-   Если указанный драйвер загружается в соединении, диспетчер драйверов вызывает только функцию подключения в драйвере. В этом случае необходимо убедиться в том, что все атрибуты соединения для соединения поддерживать свои текущие параметры драйвера.  
  
-   Если другой драйвер загружается в соединении, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере для освобождения соединения. Если отсутствуют другие соединения, использующие драйвер, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере для освобождения среды и выгружает драйвер. Диспетчер драйверов выполняет те же операции, что если драйвер не загружается в соединении.  
  
 Диспетчер драйверов заблокирует дескриптора среды (*henv*) перед вызовом драйвера **SQLAllocHandle** и **SQLFreeHandle** при *HandleType* присваивается **SQL_HANDLE_DBC**.  
  
 Когда приложение вызывает **SQLDisconnect**, диспетчер драйверов вызывает **SQLDisconnect** в драйвере. Тем не менее оно оставляет драйвер загружен в случае, если приложение выполняет повторное подключение к драйверу. Когда приложение вызывает **SQLFreeHandle** с параметром SQL_HANDLE_DBC, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере. Если драйвер не используется для любых других соединений, диспетчер драйверов вызывает **SQLFreeHandle** в драйвере с SQL_HANDLE_ENV параметр и выгружает драйвер.
