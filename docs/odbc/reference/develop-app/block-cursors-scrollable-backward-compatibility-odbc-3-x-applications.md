---
title: Совместимость блочных и прокручиваемых курсоров для ODBC 3. x | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- compatibility [ODBC], cursors
- backward compatibility [ODBC], cursors
- SQLExtendedFetch function [ODBC], block cursors
- cursors [ODBC], compatibility issues
- SQLFetchScroll function [ODBC], block cursors
ms.assetid: 82f6cf68-cfde-4417-9788-d6382ca14bf8
author: MightyPen
ms.author: genemi
ms.openlocfilehash: 7d12906f8dec0bfb12fc861c067e6e615e758a3b
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "68134992"
---
# <a name="block-cursors-scrollable-cursors-and-backward-compatibility-for-odbc-3x-applications"></a>Блочные курсоры, прокручиваемые курсоры и обратная совместимость для приложений ODBC 3.x
Существование обеих **SQLFetchScroll** и **SQLExtendedFetch** представляет собой первое четкое разделение в ODBC между интерфейсом прикладного программирования (API), который представляет собой набор функций, которые вызывает приложение, и интерфейс поставщика услуг (SPI), который представляет собой набор функций, реализуемых драйвером. Этот разбиение необходимо для балансировки требований в ODBC *3. x*, который использует **SQLFetchScroll**, для согласования с стандартами и совместимости с ODBC *2. x*, который использует **SQLExtendedFetch**.  
  
 API ODBC *3. x* , который представляет собой набор функций, которые вызывает приложение, содержит **SQLFetchScroll** и связанные с ним атрибуты инструкции. Параметр SPI ODBC *3. x* , который представляет собой набор функций, реализуемых драйвером, включает **SQLFetchScroll**, **SQLExtendedFetch**и связанные атрибуты инструкции. Так как ODBC не обеспечивает такую раздельную разбивку между API и SPI, приложения ODBC *3. x* могут вызывать **SQLExtendedFetch** и связанные с ними атрибуты инструкции. Однако для этого нет причин для приложений ODBC *3. x* . Дополнительные сведения об интерфейсах API и спис см. в статье Введение в [архитектуру ODBC](../../../odbc/reference/odbc-architecture.md).  
  
 Сведения о том, как диспетчер драйверов ODBC *3. x* сопоставляется с драйверами ODBC *2. x* и ODBC *3. x* , а также с какими функциями и атрибутами инструкции должен реализовывать драйвер ODBC *3. x* для блочных и прокручиваемых курсоров, см. в разделе [что делает драйвер](../../../odbc/reference/appendixes/what-the-driver-does.md) в приложении G: рекомендации по использованию драйверов для обеспечения обратной совместимости.  
  
 В следующей таблице перечислены функции и атрибуты инструкций, которые приложение ODBC *3. x* должно использовать с блоками и прокручиваемыми курсорами. В нем также перечислены изменения между ODBC *2. x* и ODBC *3. x* в этой области, что приложения ODBC *3. x* должны быть совместимы с драйверами ODBC *2. x* .  
  
|Функция или<br /><br /> атрибут инструкции|Комментарии|  
|-----------------------------------------|--------------|  
|SQL_ATTR_FETCH_BOOKMARK_PTR|Указывает на закладку для использования с **SQLFetchScroll**.<br /><br /> Когда приложение устанавливает это в драйвере ODBC *2. x* , это должно указывать на закладку фиксированной длины.|  
|SQL_ATTR_ROW_STATUS_PTR|Указывает на массив состояний строк, заполненный **SQLFetch**, **SQLFetchScroll**, **SQLBulkOperations**и **SQLSetPos**.<br /><br /> Если приложение устанавливает это в драйвере ODBC *2. x* и вызывает **склбулкоператион** с *операцией* SQL_ADD перед вызовом **SQLFetchScroll**, **SQLFetch**или **SQLExtendedFetch**, возвращается значение SQLSTATE HY011 (атрибут не может быть задан).<br /><br /> Когда приложение вызывает **SQLFetch** в драйвере ODBC *2. x* , **SQLFetch** сопоставляется с **SQLExtendedFetch** и, следовательно, возвращает значения в этом массиве.|  
|SQL_ATTR_ROWS_FETCHED_PTR|Указывает на буфер, в котором **SQLFetch** и **SQLFetchScroll** возвращают количество выбранных строк.<br /><br /> Когда приложение вызывает **SQLFetch** в драйвере ODBC *2. x* , **SQLFetch** сопоставляется с **SQLExtendedFetch** и, следовательно, возвращает значение в этом буфере.|  
|SQL_ATTR_ROW_ARRAY_SIZE|Задает размер набора строк.<br /><br /> Если приложение вызывает **SQLBulkOperations** с *операцией* SQL_ADD в драйвере ODBC *2. x* , SQL_ROWSET_SIZE будет использоваться для вызова, а не SQL_ATTR_ROW_ARRAY_SIZE, так как вызов сопоставляется с **SQLSetPos** с *операцией* SQL_ADD, в которой используется SQL_ROWSET_SIZE.<br /><br /> Вызов функции **SQLSetPos** с *операцией* SQL_ADD или **SQLExtendedFetch** в драйвере ODBC *2. x* использует SQL_ROWSET_SIZE.<br /><br /> Вызов **SQLFetch** или **SQLFetchScroll** в драйвере ODBC *2. x* использует SQL_ATTR_ROW_ARRAY_SIZE.|  
|**SQLBulkOperations**|Выполняет операции вставки и закладки. Когда **SQLBulkOperations** с *операцией* SQL_ADD вызывается в драйвере ODBC *2. x* , он сопоставляется с **SQLSetPos** с *операцией* SQL_ADD. Ниже приведены сведения о реализации.<br /><br /> — При работе с драйвером ODBC *2. x* приложение должно использовать только неявно ВЫДЕЛЕНные АРД, связанные с *статеменсандле*; Он не может выделить другой АРД для добавления строк, поскольку явные операции дескриптора не поддерживаются в драйвере ODBC *2. x* . Приложение должно использовать **SQLBindCol** для привязки к АРД, а не **SQLSetDescField** или **SQLSetDescRec**.<br />— При вызове драйвера ODBC *3. x* приложение может вызвать **SQLBulkOperations** с *операцией* SQL_ADD перед вызовом **SQLFetch** или **SQLFetchScroll**. При вызове драйвера ODBC *2. x* приложение должно вызвать **SQLFetchScroll** перед вызовом **SQLBulkOperations** с операцией SQL_ADD.|  
|**SQLFetch**|Возвращает следующий набор строк. Ниже приведены сведения о реализации.<br /><br /> — Когда приложение вызывает **SQLFetch** в драйвере ODBC *2. x* , оно сопоставляется с **SQLExtendedFetch**.<br />— Когда приложение вызывает **SQLFetch** в драйвере ODBC *3. x* , он возвращает число строк, указанное с помощью атрибута SQL_ATTR_ROW_ARRAY_SIZE инструкции.|  
|**SQLFetchScroll**|Возвращает указанный набор строк. Ниже приведены сведения о реализации.<br /><br /> — Когда приложение вызывает **SQLFetchScroll** в драйвере ODBC *2. x* , оно возвращает значение SQLSTATE 01S01 (ошибка в строке) перед каждой ошибкой, которая применяется к одной строке. Это происходит только потому, что диспетчер драйверов ODBC *3. x* сопоставляет это с **SQLExtendedFetch** , а **SQLExtendedFetch** возвращает это значение SQLSTATE. Когда приложение вызывает **SQLFetchScroll** в драйвере ODBC *3. x* , оно никогда не возвращает значение SQLSTATE 01S01 (ошибка в строке).<br />— Когда приложение вызывает **SQLFetchScroll** в драйвере ODBC *2. x* с *фетчориентатион* , для которого задано значение SQL_FETCH_BOOKMARK, аргумент *фетчоффсет* должен иметь значение 0. Значение SQLSTATE HYC00 (Необязательная функция не реализована) возвращается, если предпринимается попытка выборки закладке с использованием смещения с помощью драйвера ODBC *2. x* .|  
  
> [!NOTE]  
>  Приложения ODBC *3. x* не должны использовать **SQLExtendedFetch** или атрибут инструкции SQL_ROWSET_SIZE. Вместо этого они должны использовать **SQLFetchScroll** и атрибут инструкции SQL_ATTR_ROW_ARRAY_SIZE. Приложения ODBC *3. x* не должны использовать **SQLSetPos** с *операцией* SQL_ADD но должны использовать **SQLBulkOperations** с *операцией* SQL_ADD.
