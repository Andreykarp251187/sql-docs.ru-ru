---
title: Отправка длинных данных | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- long data [ODBC]
- sending long data [ODBC]
ms.assetid: ea989084-a8e6-4737-892e-9ec99dd49caf
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: aeeeb716aa2f9a72338f3aeb586dffce86f84069
ms.sourcegitcommit: e042272a38fb646df05152c676e5cbeae3f9cd13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2020
ms.locfileid: "81304185"
---
# <a name="sending-long-data"></a>Отправка данных типа Long
СУБД определяет *длинные данные* как любые символьные или двоичные данные определенного размера, например 254 символов. Сохранение в памяти всего элемента длинных данных может оказаться невозможным, например, когда элемент представляет длинный текстовый документ или точечный рисунок. Так как такие данные не могут храниться в одном буфере, источник данных отправляет его драйверу в частях с **SQLPutData** при выполнении инструкции. Параметры, для которых данные отправляются во время выполнения, называются *параметрами выполнения*.  
  
> [!NOTE]  
>  Приложение может фактически отправлять данные любого типа во время выполнения с помощью **SQLPutData**, хотя части могут отправляться только символьные и двоичные данные. Однако если данные достаточно малы для размещения в одном буфере, обычно нет причин использовать **SQLPutData**. Гораздо проще привязать буфер и позволить драйверу получать данные из буфера.  
  
 Для отправки данных во время выполнения приложение выполняет следующие действия.  
  
1.  Передает 32-разрядное значение, идентифицирующее параметр в аргументе *параметервалуептр* в **SQLBindParameter** , вместо передачи адреса буфера. Это значение не анализируется драйвером. Оно будет возвращено в приложение позже, поэтому оно должно означать что-то в приложении. Например, это может быть номер параметра или маркер файла, содержащего данные.  
  
2.  Передает адрес буфера длины или индикатора в аргументе *StrLen_or_IndPtr* **SQLBindParameter**.  
  
3.  Сохраняет SQL_DATA_AT_EXEC или результат макроса SQL_LEN_DATA_AT_EXEC (*length*) в буфере длины/индикатора. Оба эти значения указывают драйверу, что данные для параметра будут отправляться с помощью **SQLPutData**. SQL_LEN_DATA_AT_EXEC (*length*) используется при отправке длинных данных в источник данных, который должен определять, сколько байт данных будет отправлено, чтобы можно было предварительно выделить место. Чтобы определить, требуется ли для источника данных это значение, приложение вызывает **SQLGetInfo** с параметром SQL_NEED_LONG_DATA_LEN. Все драйверы должны поддерживать этот макрос; Если для источника данных длина байта не требуется, драйвер может проигнорировать его.  
  
4.  Вызывает **SQLExecute** или **SQLExecDirect**. Драйвер обнаруживает, что буфер длины или индикатора содержит значение SQL_DATA_AT_EXEC или результат макроса SQL_LEN_DATA_AT_EXEC (*length*) и возвращает SQL_NEED_DATA в качестве возвращаемого значения функции.  
  
5.  Вызывает **метод SQLParamData** в ответ на возвращаемое значение SQL_NEED_DATA. Если необходимо отправить данные типа Long, **метод SQLParamData** возвращает SQL_NEED_DATA. В буфере, на который указывает аргумент *валуептрптр* , драйвер возвращает значение, идентифицирующее параметр данных при выполнении. Если имеется более одного параметра данных при выполнении, приложение должно использовать это значение для определения параметра, для которого отправляются данные. драйвер не требуется для запроса данных параметров выполнения в каком-либо определенном порядке.  
  
6.  Вызывает **SQLPutData** для отправки данных параметров драйверу. Если данные параметра не помещаются в один буфер, то, как это часто бывает в случае с длинными данными, приложение вызывает **SQLPutData** несколько раз для отправки данных в части. для сборки данных используется драйвер и источник данных. Если приложение передает строковые данные, заканчивающиеся нулем, драйвер или источник данных должен удалить символ завершения, заканчивающийся нулем, как часть процесса пересборки.  
  
7.  Вызывает **метод SQLParamData** еще раз, чтобы указать, что он отправил все данные для параметра. При наличии параметров, для которых данные не были отправлены, драйвер возвращает SQL_NEED_DATA и значение, идентифицирующее следующий параметр. приложение вернется к шагу 6. Если данные были отправлены для всех параметров, выполняемых при выполнении, выполняется инструкция. **Метод SQLParamData** возвращает SQL_SUCCESS или SQL_SUCCESS_WITH_INFO и может возвращать любое возвращаемое значение или диагностику, которое может возвращать **SQLExecute** или **SQLExecDirect** .  
  
 После того как **SQLExecute** или **SQLExecDirect** возвращает SQL_NEED_DATA и перед полной отправкой данных для последнего параметра data-on-Execution, инструкция находится в состоянии "требуется данные". В то время как оператору требуется состояние данных, приложение может вызывать только **SQLPutData**, **метод SQLParamData**, **SQLCancel**, **SQLGetDiagField**или **SQLGetDiagRec**; все остальные функции возвращают SQLSTATE HY010 (ошибка последовательности функций). Вызов **SQLCancel** отменяет выполнение инструкции и возвращает его в предыдущее состояние. Дополнительные сведения см. в [приложении б: таблицы переходов состояния ODBC](../../../odbc/reference/appendixes/appendix-b-odbc-state-transition-tables.md).  
  
 Пример отправки данных во время выполнения см. в описании функции [SQLPutData](../../../odbc/reference/syntax/sqlputdata-function.md) .
