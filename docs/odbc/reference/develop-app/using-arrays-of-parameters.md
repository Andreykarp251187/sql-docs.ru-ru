---
title: Использование массивов параметров | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- arrays of parameter values [ODBC]
- parameter arrays [ODBC]
ms.assetid: 5a28be88-e171-4f5b-bf4d-543c4383c869
author: MightyPen
ms.author: genemi
ms.openlocfilehash: cf6b5127bac7aedf9e67918d38020c73a4afe186
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68079602"
---
# <a name="using-arrays-of-parameters"></a>Использование массивов параметров
Использование массивов параметров, приложение вызывает **SQLSetStmtAttr** с *атрибут* аргумент SQL_ATTR_PARAMSET_SIZE, чтобы указать число наборов параметров. Он вызывает **SQLSetStmtAttr** с *атрибут* аргумент SQL_ATTR_PARAMS_PROCESSED_PTR, чтобы указать адрес переменной, в котором драйвер может возвращать число наборов параметров обработки Задает включая ошибки. Он вызывает **SQLSetStmtAttr** с *атрибут* аргумент SQL_ATTR_PARAM_STATUS_PTR, чтобы указывать на массив, в котором для возвращения сведений о состоянии для каждой строки значений параметров. Драйвер хранит эти адреса в структуре, которые он поддерживает для инструкции.  
  
> [!NOTE]  
>  В ODBC 2. *x*, **SQLParamOptions** был вызван для указания нескольких значений для параметра. В ODBC 3. *x*, вызов **SQLParamOptions** был заменен классом вызовы **SQLSetStmtAttr** для задания атрибутов SQL_ATTR_PARAMSET_SIZE и SQL_ATTR_PARAMS_PROCESSED_ARRAY .  
  
 Перед выполнением инструкции, приложение задает значение каждого элемента массива каждого ограниченного массива. При выполнении инструкции, драйвер использует сведения, сохраненные для получения значений параметров и отправки их в источник данных; Если это возможно драйвер должен отправлять эти значения как массивы. Несмотря на то, что использование массивов параметров лучше всего реализуется путем выполнения инструкции SQL, со всеми параметрами в массиве, с помощью одного вызова к источнику данных, эта возможность не общедоступно в СУБД уже сегодня. Тем не менее драйверы ее можно имитировать, выполнив инструкцию SQL несколько раз, каждый из которых один набор параметров.  
  
 Прежде чем приложение использует массивы параметров, необходимо убедиться, что они поддерживаются драйверы, используемые приложением. Для этого имеется два способа.  
  
-   Используйте только те драйверы, которые поддерживает массивы параметров. Приложение можно жестко закодировать имена этих драйверов, или пользователь может получить указание использовать только эти драйверы. Пользовательские приложения и вертикальные приложения обычно используют ограниченный набор драйверов.  
  
-   Проверьте наличие поддержки массивов параметров во время выполнения. Драйвер поддерживает массивы параметров, если это возможно задать атрибут инструкции SQL_ATTR_PARAMSET_SIZE значение больше 1. Универсальные приложения и вертикальные приложения обычно проверки поддержки массивов параметров во время выполнения.  
  
 Количество строк и результирующие наборы в параметризованных выполнения можно определить путем вызова **SQLGetInfo** параметры SQL_PARAM_ARRAY_ROW_COUNTS и SQL_PARAM_ARRAY_SELECTS. Для **вставить**, **обновление**, и **удалить** инструкций, SQL_PARAM_ARRAY_ROW_COUNTS параметр указывает, являются ли количество отдельных строк (по одному для каждого набора параметров) Доступные (SQL_PARC_BATCH) или ли свертки количество строк в одну (SQL_PARC_NO_BATCH). Для **ВЫБЕРИТЕ** инструкций, параметр SQL_PARAM_ARRAY_SELECTS том, доступен ли результирующий набор для каждого набора параметров (SQL_PAS_BATCH) или только один результирующий набор доступных (SQL_PAS_NO_BATCH). Если драйвер не поддерживает результат формирования набора операторов для выполнения с помощью массива параметров, SQL_PARAM_ARRAY_SELECTS возвращает SQL_PAS_NO_SELECT. Это данные, зависящие от источника, особенно в том случае, поскольку использование параметров в этих инструкциях будет источника данных и не выполнить SQL-грамматику ODBC с помощью других типов инструкций, можно ли использовать массивы параметров.  
  
 Массив, на которые указывают атрибут SQL_ATTR_PARAM_OPERATION_PTR инструкции можно использовать на игнорирование параметров. Если элемент массива имеет значение SQL_PARAM_IGNORE, набор параметров, соответствующей этому элементу не будет производиться **SQLExecute** или **SQLExecDirect** вызова. Массив, на которые указывают атрибут SQL_ATTR_PARAM_OPERATION_PTR выделенной и заполняется приложением и считывать с помощью драйвера. Если извлеченных строк используются в качестве входных параметров, значения массив статусов строк можно использовать в массиве параметров операции.  
  
## <a name="error-processing"></a>Ошибка при обработке  
 При возникновении ошибки во время выполнения инструкции, выполнения функция возвращает ошибку и присваивает переменной номеров строк номер строки, содержащей ошибку. Это данные, зависящие от источника ли все строки, за исключением того, набором ошибке, выполняются или выполняются ли все строки до (но не после) набором ошибке. Так как она обрабатывает наборы параметров, драйвер задает буфер, определяемое атрибутом инструкции SQL_ATTR_PARAMS_PROCESSED_PTR для номер строки, который сейчас обрабатывается. Если все наборы, за исключением того, набором ошибке, выполняются, драйвер устанавливает этот буфера SQL_ATTR_PARAMSET_SIZE после обработки всех строк.  
  
 Если атрибут инструкции SQL_ATTR_PARAM_STATUS_PTR **SQLExecute** или **SQLExecDirect** возвращает *массив состояний параметров,* который предоставляет сведения о состоянии из каждого набора параметров. Массив состояний параметров выделяется приложением и заполнена с помощью драйвера. Его элементы которого указывают ли инструкция SQL была выполнена успешно для строки параметров или от того, произошла ли ошибка при обработке набора параметров. Если возникает ошибка, драйвер задает соответствующее значение в массиве параметров состояния для SQL_PARAM_ERROR и возвращает значение SQL_SUCCESS_WITH_INFO. Приложение может проверить массив состояний, чтобы определить, какие строки были обработаны. С помощью номер строки, приложение часто исправьте ошибку и возобновить обработку.  
  
 Как используется массив состояний параметров определяется параметрами SQL_PARAM_ARRAY_ROW_COUNTS и SQL_PARAM_ARRAY_SELECTS, возвращенный вызовом к **SQLGetInfo**. Для **вставить**, **обновление**, и **удалить** инструкций, этот параметр массив заполняется сведения о состоянии, если SQL_PARC_BATCH возвращается для SQL_PARAM_ARRAY_ ROW_COUNTS, но не в случае SQL_PARC_NO_BATCH возвращается. Для **ВЫБЕРИТЕ** инструкций, массив состояний параметров заполняется при возвращении SQL_PAS_BATCH для SQL_PARAM_ARRAY_SELECT, но не в том случае, если возвращается SQL_PAS_NO_BATCH или SQL_PAS_NO_SELECT.  
  
## <a name="data-at-execution-parameters"></a>Параметры данных времени выполнения  
 Если какой-либо из значений в массиве длины и индикатора значение SQL_DATA_AT_EXEC, ни результатом значение SQL_LEN_DATA_AT_EXEC (*длина*) макрос, данные для этих значений отправляются с **SQLPutData** обычным способом. Следующие аспекты этого процесса берете специальный комментарий, поскольку они не являются очевидным:  
  
-   Когда драйвер возвращает SQL_NEED_DATA, его необходимо задать адрес переменной номеров строк к строке, для которой ему требуются данные. Как и в случае одно приложение не может вносить каких-либо предположений о порядке, в котором драйвер будет запрашивать значения параметров в рамках единого набора параметров. Если произошла ошибка при выполнении параметра данных во время выполнения, буфера, заданного атрибутом инструкции SQL_ATTR_PARAMS_PROCESSED_PTR присваивается номер строки, на которой возникла ошибка, состояние для строки в массив статусов строк, определяемое значение атрибута инструкции SQL_ATTR_PARAM_STATUS_PTR SQL_PARAM_ERROR, а при вызове **SQLExecute**, **SQLExecDirect**, **SQLParamData**, или  **SQLPutData** возвращает ошибку SQL_ERROR. Содержимое этого буфера не определено, если **SQLExecute**, **SQLExecDirect**, или **SQLParamData** возвращают значение SQL_STILL_EXECUTING.  
  
-   Так как драйвер не интерпретирует значение в *ParameterValuePtr* аргумент **SQLBindParameter** для параметров данных времени выполнения, если приложение предоставляет указатель на массив,  **SQLParamData** не извлечь и вернуть элемент этого массива в приложение. Вместо этого он возвращает скалярное значение приложения указано. Это означает, что значение, возвращенное **SQLParamData** является не достаточно указать параметр, для которого приложение должно отправлять данные; приложение необходимо также учесть номер текущей строки.  
  
     Когда только некоторые из элементов массива параметров параметров данных времени выполнения, приложение должно передать адрес массива в *ParameterValuePtr* , содержащий элементы для всех параметров. Этот массив интерпретируется обычно для параметров, которые не являются параметров данных времени выполнения. Для параметров данных времени выполнения, а значение, **SQLParamData** обеспечивает для приложения, который обычно может использоваться для определения данных, которые драйвер запрашивает в этом случае, это всегда адрес массива.
