---
title: Использование массивов параметров Документы Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- arrays of parameter values [ODBC]
- parameter arrays [ODBC]
ms.assetid: 5a28be88-e171-4f5b-bf4d-543c4383c869
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: b584dc3d635e9fa8ce3228e4e89b0f24451fe165
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81306805"
---
# <a name="using-arrays-of-parameters"></a>Использование массивов параметров
Для использования массивов параметров приложение вызывает **S'LSetStmtAttr** с аргументом *attributeSQL_ATTR_PARAMSET_SIZE* указать количество наборов параметров. Он вызывает **S'LSetStmtAttr** с аргументом *атрибута* SQL_ATTR_PARAMS_PROCESSED_PTR указать адрес переменной, в которой драйвер может вернуть количество наборов обработанных параметров, включая наборы ошибок. Он вызывает **S'LSetStmtAttr** с аргументом *атрибута* SQL_ATTR_PARAM_STATUS_PTR указать на массив, в котором можно вернуть информацию о статусе для каждой строки значений параметров. Драйвер хранит эти адреса в структуре, которая поддерживается для оператора.  
  
> [!NOTE]  
>  В ODBC 2. *x*, **S'LParamOptions** был вызван для указания нескольких значений для параметра. В ODBC 3. *x*, звонок в **S'LParamOptions** был заменен звонками в **S'LSetStmtAttr** для установки SQL_ATTR_PARAMSET_SIZE и SQL_ATTR_PARAMS_PROCESSED_ARRAY атрибутов.  
  
 Перед выполнением оператора приложение устанавливает значение каждого элемента каждого связанного массива. Когда выписка выполняется, драйвер использует хранящуюся информацию для получения значений параметров и отправки их в источник данных; если это возможно, драйвер должен отправить эти значения в виде массивов. Хотя использование массивов параметров лучше всего реализовать путем выполнения оператора S'L со всеми параметрами в массиве с одним вызовом к источнику данных, эта возможность не является широко доступной в DBMS сегодня. Тем не менее, драйверы могут имитировать его, выполнив несколько раз, каждый из которых имеет единый набор параметров.  
  
 Прежде чем приложение использует массивы параметров, оно должно быть уверено, что они поддерживаются драйверами, используемыми приложением. Это можно сделать двумя способами.  
  
-   Используйте только драйверы, которые, как известно, поддерживают массивы параметров. Приложение может жестко кодировать имена этих драйверов, или пользователь может быть проинструктирован использовать только эти драйверы. Пользовательские приложения и вертикальные приложения обычно используют ограниченный набор драйверов.  
  
-   Проверьте наличие массивов параметров во время выполнения. Драйвер поддерживает массивы параметров, если возможно установить атрибут SQL_ATTR_PARAMSET_SIZE оператора к значению, превышающее 1. Общие приложения и вертикальные приложения обычно проверяют на наличие массивов параметров во время выполнения.  
  
 Наличие количества строк и наборов результатов в параметризированном исполнении может быть определено, позвонив в **S'LGetInfo** с SQL_PARAM_ARRAY_ROW_COUNTS и SQL_PARAM_ARRAY_SELECTS опций. Для **инструкций INSERT,** **UPDATE**и **DELETE** SQL_PARAM_ARRAY_ROW_COUNTS опция указывает на то, доступны ли отдельные строки (по одному для каждого набора параметров) (SQL_PARC_BATCH) или же количество строк сворачивается в один (SQL_PARC_NO_BATCH). Для инструкций **SELECT** SQL_PARAM_ARRAY_SELECTS опция указывает, доступен ли набор результатов для каждого набора параметров (SQL_PAS_BATCH) или доступен только один набор результатов (SQL_PAS_NO_BATCH). Если драйвер не позволяет выполнять инструкции, генерирующие результаты, с помощью массива параметров, SQL_PARAM_ARRAY_SELECTS возвращает SQL_PAS_NO_SELECT. Это данные источника конкретных ли массивы параметров могут быть использованы с другими типами заявлений, особенно потому, что использование параметров в этих заявлениях будет данных источника конкретных и не будет следовать грамматике ODBC S'L.  
  
 Массив, на который указывает SQL_ATTR_PARAM_OPERATION_PTR атрибута оператора, может использоваться для игнорирования строк параметров. Если элемент массива установлен на SQL_PARAM_IGNORE, набор параметров, соответствующих этому элементу, исключается из вызова **S'L'LExecute** или **S'LExecDirect.** Массив, на который указывает SQL_ATTR_PARAM_OPERATION_PTR атрибут, выделяется и заполняется приложением и читается водителем. Если извлеченные строки используются в качестве параметров ввода, значения массива состояния строки могут быть использованы в массиве операции параметра.  
  
## <a name="error-processing"></a>Обработка ошибок  
 При возникновении ошибки при выполнении оператора функция выполнения возвращает ошибку и устанавливает переменную строки к номеру строки, содержащей ошибку. Это данные источника конкретных ли все строки, кроме набора ошибок выполняются или все строки до (но не после) набор ошибок выполняются. Поскольку он обрабатывает наборы параметров, драйвер устанавливает буфер, указанный атрибутом SQL_ATTR_PARAMS_PROCESSED_PTR оператора, к числу обрабатываемых строк. Если все наборы, кроме набора ошибок, выполнены, драйвер устанавливает этот буфер для SQL_ATTR_PARAMSET_SIZE после обработки всех строк.  
  
 Если атрибут SQL_ATTR_PARAM_STATUS_PTR оператора установлен, **S'LExecute** или **S'LExecDirect** возвращает *массив статуса параметра,* который обеспечивает статус каждого набора параметров. Массив статуса параметра выделяется приложением и заполняется драйвером. Его элементы указывают, была ли выписка s'L успешно выполнена для ряда параметров или же ошибка произошла при обработке набора параметров. При возникновении ошибки драйвер устанавливает соответствующее значение в массиве состояния параметра для SQL_PARAM_ERROR и возвращает SQL_SUCCESS_WITH_INFO. Приложение может проверить массив статуса, чтобы определить, какие строки были обработаны. Используя номер строки, приложение часто может исправить ошибку и возобновить обработку.  
  
 Способ использования массива статуса параметров определяется SQL_PARAM_ARRAY_ROW_COUNTS и SQL_PARAM_ARRAY_SELECTS опций, возвращенных по вызову в **S'LGetInfo.** Для **инструкций INSERT,** **UPDATE**и **DELETE** массив статуса параметра заполняется информацией о состоянии, если SQL_PARC_BATCH возвращается для SQL_PARAM_ARRAY_ROW_COUNTS, но не в случае возврата SQL_PARC_NO_BATCH. Для инструкций **SELECT** массив статуса параметра заполняется, если SQL_PAS_BATCH возвращается для SQL_PARAM_ARRAY_SELECT, но не при возвращении SQL_PAS_NO_BATCH или SQL_PAS_NO_SELECT.  
  
## <a name="data-at-execution-parameters"></a>Параметры «данные по исполнению»  
 Если какое-либо из значений в массиве длины/индикатора SQL_DATA_AT_EXEC или результат макроса SQL_LEN_DATA_AT_EXEC *(длина),* данные для этих значений отправляются с **помощью S'LPutData** обычным способом. Следующие аспекты этого процесса несут особое замечание, поскольку они не очевидны:  
  
-   Когда водитель возвращается SQL_NEED_DATA, он должен установить адрес переменной номера строки к строке, для которой ему нужны данные. Как и в случае с одной стоимостью, приложение не может делать никаких предположений о порядке, в котором драйвер будет запрашивать значения параметров в пределах одного набора параметров. При возникновении ошибки при выполнении параметра данных по выполнению буфера буфер, указанный атрибутом SQL_ATTR_PARAMS_PROCESSED_PTR оператора, устанавливается к числу строки, на которой произошла ошибка, статус для строки в массиве состояния строки, указанный атрибутом SQL_ATTR_PARAM_STATUS_PTR оператора, установлен на SQL_PARAM_ERROR, а вызов на **S'L-Выполняет**, **S'LExecDirect**, **S'LParamData**, или **S'LPutData** возвращается SQL_ERROR. Содержимое этого буфера не определено, если **s'LExecute**, **S'LExecDirect**, или **S'LParamData** возвращения SQL_STILL_EXECUTING.  
  
-   Поскольку драйвер не интерпретирует значение в **SQLBindParameter** аргументе *ParameterValuePtr* для параметров data-at-execution, если приложение предоставляет указатель массива, **S'LParamData** не извлекает и не возвращает элемент этого массива в приложение. Вместо этого он возвращает масштабируемое значение, предоставленное приложением. Это означает, что значения, возвращенного **S'LParamData,** недостаточно для указания параметра, по которому приложение должно отправлять данные; приложение также должно учитывать текущее число строк.  
  
     Когда только некоторые элементы массива параметров являются параметрами data-at-execution, приложение должно пройти адрес массива в *ParameterValuePtr,* который содержит элементы для всех параметров. Этот массив интерпретируется обычно для параметров, которые не являются параметрами data-at-execution. Для параметров данных по выполнению значение, которое обеспечивает **приложение,** обычно которое может быть использовано для идентификации данных, запрашиваемых драйвером в данном случае, всегда является адресом массива.
