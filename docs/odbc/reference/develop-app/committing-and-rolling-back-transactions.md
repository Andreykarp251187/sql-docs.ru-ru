---
title: Фиксация и откат транзакций | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- rolling back transactions [ODBC]
- committing transactions [ODBC]
- transactions [ODBC], rolling back
- transactions [ODBC], committing
ms.assetid: 800f2c1a-6f79-4ed1-830b-aa1a62ff5165
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 1c272d60242d31622452c4dcb0f6a16c4838768f
ms.sourcegitcommit: e042272a38fb646df05152c676e5cbeae3f9cd13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2020
ms.locfileid: "81299114"
---
# <a name="committing-and-rolling-back-transactions"></a>Фиксация и откат транзакций
Чтобы зафиксировать или откатить транзакцию в режиме ручной фиксации, приложение вызывает **SQLEndTran**. Драйверы для СУБД, которые поддерживают транзакции, обычно реализуют эту функцию, выполняя инструкцию **commit** или **ROLLBACK** . Диспетчер драйверов не вызывает **SQLEndTran** , если соединение находится в режиме автоматической фиксации. Он просто возвращает SQL_SUCCESS, даже если приложение пытается выполнить откат транзакции. Поскольку драйверы для СУБД, которые не поддерживают транзакции, всегда находятся в режиме автоматической фиксации, они могут либо реализовать **SQLEndTran** для возврата SQL_SUCCESS без выполнения каких-либо действий, либо вообще не реализовывать их.  
  
> [!NOTE]  
>  Приложения не должны зафиксировать или откатывать транзакции, выполняя инструкции **commit** или **ROLLBACK** с **SQLExecute** или **SQLExecDirect**. Результат этого не определен. В число возможных проблем входит драйвер, который больше не может знать, когда транзакция активна и эти инструкции завершаются сбоем в источниках данных, которые не поддерживают транзакции. Вместо этого эти приложения должны вызывать **SQLEndTran** .  
  
 Если приложение передает обработчику среды значение **SQLEndTran** , но не передает маркер подключения, диспетчер драйверов концептуально вызывает **SQLEndTran** с помощью обработчика для каждого драйвера, имеющего одно или несколько активных соединений в среде. Затем драйвер фиксирует транзакции для каждого подключения в среде. Однако важно понимать, что ни драйвер, ни диспетчер драйверов не выполняют двухфазной фиксации соединений в среде. Это просто удобство программирования для одновременного вызова **SQLEndTran** для всех соединений в среде.  
  
 (Для фиксации транзакций, распределенных по нескольким источникам данных, обычно используется двухфазной *фиксация* . На первом этапе источники данных опрашиваются в зависимости от того, могут ли они зафиксировать свою часть транзакции. На втором этапе транзакция фактически фиксируется во всех источниках данных. Если какие-либо источники данных отвечают на первый этап, который не может зафиксировать транзакцию, второй этап не происходит.)
