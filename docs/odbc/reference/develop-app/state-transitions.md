---
description: Переходы состояния
title: Переходы состояния | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- state transitions [ODBC]
- unallocated state [ODBC]
- handles [ODBC], state transitions
- allocated state [ODBC]
- connection state [ODBC]
ms.assetid: fc741611-6535-43cc-8156-6d897d04664e
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 947be49fc0a77f94c1641bb7c735db3276b49f58
ms.sourcegitcommit: e700497f962e4c2274df16d9e651059b42ff1a10
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "88476366"
---
# <a name="state-transitions"></a>Переходы состояния
ODBC определяет дискретные *состояния* для каждой среды, каждого соединения и каждой инструкции. Например, у среды есть три возможных состояния: не распределено (в которых не выделяется среда), выделяется (в котором выделяется среда, но не выделяются подключения) и подключение (в котором выделяется среда и одно или несколько подключений). Подключения имеют семь состояний; инструкции имеют 13 возможных состояний.  
  
 Определенный элемент, определяемый его обработчиком, перемещается из одного состояния в другое, когда приложение вызывает определенную функцию или функции и передает этот элемент. Такое перемещение называется *переходом состояния*. Например, при выделении обработчика среды с **функцию SQLAllocHandle** перемещает среду из невыделенного в выделенный, а освобождение этого маркера с помощью **SQLFreeHandle** возвращает его из области выделения в нераспределенное. ODBC определяет ограниченное число переходов между допустимыми состояниями. это еще один способ сказать, что функции должны вызываться в определенном порядке.  
  
 Некоторые функции, такие как **SQLGetConnectAttr**, не влияют на состояние вообще. Другие функции влияют на состояние одного элемента. Например, **SQLDisconnect** перемещает соединение из состояния соединения в выделенное состояние. Наконец, некоторые функции влияют на состояние более чем одного элемента. Например, при выделении маркера соединения с **функцию SQLAllocHandle** перемещается подключение из нераспределенного в выделенное состояние и перемещается среда из выделенного состояния в состояние соединения.  
  
 Если приложение вызывает функцию в неопределенном порядке, функция возвращает *ошибку перехода состояния*. Например, если среда находится в состоянии соединения и приложение вызывает **SQLFreeHandle** с этим обработчиком среды, **SQLFREEHANDLE** возвращает SQLSTATE HY010 (ошибка последовательности функций), так как он может вызываться только в том случае, если среда находится в выделенном состоянии. Определяя это как недопустимое изменение состояния, ODBC не позволяет приложению освобождать среду при наличии активных соединений.  
  
 Некоторые переходы состояний свойственны структуре ODBC. Например, невозможно выделить маркер соединения без предварительного выделения обработчика среды, так как функция, которая выделяет маркер соединения, требует наличия обработчика среды. Другие переходы состояния применяются диспетчером драйверов и драйверами. Например, **SQLExecute** выполняет подготовленную инструкцию. Если переданный в него обработчик не находится в состоянии PREPARED, **SQLExecute** ВОЗВРАЩАЕТ значение SQLSTATE HY010 (ошибка последовательности функций).  
  
 С точки зрения приложения переходы между состояниями обычно просты: допустимые переходы состояния, как правило, направляют руки в поток хорошо написанного приложения. Переходы состояния более сложны для диспетчера драйверов и драйверов, так как они должны отслеживаниь состояния среды, каждого соединения и каждой инструкции. Большая часть этой работы выполняется диспетчером драйверов. Большая часть работы, которая должна быть выполнена драйверами, возникает с инструкциями с ожидающими результатами.  
  
 Части 1 и 2 этого руководства («введение в ODBC» и «разработка приложений и драйверов») не задают явное упоминание переходов между состояниями. Вместо этого они описывают порядок, в котором должны вызываться функции. Например, "выполнение инструкций" указывает, что инструкция должна быть подготовлена с помощью **SQLPrepare** , прежде чем ее можно будет выполнить с помощью **SQLExecute**. Полное описание состояний и переходов состояний, включая, какие переходы проверяются диспетчером драйверов и должны быть проверены драйверами, см. в [приложении б: таблицы переходов состояния ODBC](../../../odbc/reference/appendixes/appendix-b-odbc-state-transition-tables.md).
