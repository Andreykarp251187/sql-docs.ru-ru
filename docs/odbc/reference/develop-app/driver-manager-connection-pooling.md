---
title: Организация пулов соединений диспетчера драйверов | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- connection pooling [ODBC]
- pooled connections [ODBC]
- connecting to driver [ODBC], connection pooling
- connecting to data source [ODBC], connection pooling
ms.assetid: ee95ffdb-5aa1-49a3-beb2-7695b27c3df9
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: 96a48d60cc0c127f41e6e1b79b9faf29ea4392cf
ms.sourcegitcommit: eacc2d979f1f13cfa07e0aa4887eb9d48824b633
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2019
ms.locfileid: "67533827"
---
# <a name="driver-manager-connection-pooling"></a>Организация пулов соединений диспетчера драйверов
Организация пулов соединений позволяет приложению использовать соединение из пула подключений, которые не нужно заново установить для каждого использования. После подключения создан и помещен в пул, приложение можно повторно использовать это подключение без выполнения полного процесса.  
  
 Использование в пуле, соединение может привести к значительный прирост производительности, так как приложения можно сохранить нагрузка, возникающая при установке подключения. Это может быть особенно важно для приложений среднего уровня, которые подключаются по сети или для приложений, которые повторно подключаться и отключаться, таких как веб-приложений.  
  
 Помимо увеличения производительности архитектура пула подключений позволяет среде и его связанные соединения для использования в нескольких компонентах в одном процессе. Это означает, что автономные компоненты в одном процессе могут взаимодействовать друг с другом без сведений о друг с другом. Соединения в пуле соединений, можно многократно использовать в нескольких компонентах.  
  
> [!NOTE]
>  Организация пулов соединений может использоваться приложением ODBC, с ODBC 2. *x* поведение, условии, что приложение может вызвать *SQLSetEnvAttr*. При использовании пула подключений, приложение не должно выполнить инструкции SQL, изменяющие базу данных или контексте базы данных, таких как изменение \< *имя базы данных*>, которая изменяет каталог, используемый данным источник.  


 Драйвер ODBC должен быть полностью потокобезопасный и подключения должен не поддерживают сходство потоков для поддержки пулов соединений. Это означает, что драйвер может обработать вызов в любом потоке в любое время и возможность подключения в одном потоке, чтобы использовать соединение в другом потоке, а также для отключения на третий поток.  
  
 Пул соединений поддерживается диспетчером драйверов. Соединения выбираются из пула, когда приложение вызывает **SQLConnect** или **SQLDriverConnect** и возвращаются в пул, когда приложение вызывает **SQLDisconnect**. Размер пула увеличивается динамически, исходя из выделения запрошенного ресурса. Уменьшается на время ожидания в бездействии основе: Если подключение не используется в течение определенного периода времени (он не использовался в соединении), он удаляется из пула. Размер пула ограничивается только объемом доступной памяти и ограничения на сервере.  
  
 Диспетчер драйверов определяет, следует ли использовать определенного подключения в пуле в соответствии с аргументами, переданными **SQLConnect** или **SQLDriverConnect**и в соответствии с атрибуты соединения Set после подключения был выделен.  
  
 Когда диспетчер драйверов организация пулов соединений, ему необходимо иметь возможность определить, работает ли по-прежнему соединения перед передачей ожидания подключения. В противном случае диспетчер драйверов хранит на любезно предоставить ее недействующего соединения в приложение при каждом возникновении временного сбоя сети. В ODBC 3 был определен новый атрибут соединения *.x*: SQL_ATTR_CONNECTION_DEAD. Это атрибут подключения только для чтения, которое возвращает значение SQL_CD_TRUE либо значение SQL_CD_FALSE. Значение SQL_CD_TRUE означает, что соединение было потеряно, пока значение SQL_CD_FALSE означает, что соединение все еще активен. (Драйверы, соответствующий требованиям к более ранним версиям ODBC может также поддерживать этот атрибут).  
  
 Драйвер эффективно должен реализовывать этот параметр или будет привести к снижению производительности пула подключений. В частности вызов, чтобы получить этот атрибут подключения не должна вызывать обращение к серверу. Вместо этого драйвер должен просто возвращать последнего известного состояния подключения. Подключение dead, если не удалось последнего обращения к серверу, а не dead успешности последней обработки.  
  
## <a name="remarks"></a>Примечания  
 Если подключение потеряно (указывается с помощью SQL_ATTR_CONNECTION_DEAD), диспетчер драйверов ODBC удалим это подключение, вызвав SQLDisconnect в драйвере. Новые запросы на соединение не может найти пригодные соединения в пуле. Со временем диспетчера драйверов может создать новое подключение, при условии, что пул пуст.  
  
 Чтобы использовать пул подключений, приложение выполняет следующие действия:  
  
1.  Обеспечивает пул подключений путем вызова **SQLSetEnvAttr** присвоить атрибуту окружения SQL_ATTR_CONNECTION_POOLING SQL_CP_ONE_PER_DRIVER или SQL_CP_ONE_PER_HENV. Этот вызов необходимо выполнить, прежде чем приложение выделяет общей среды для какое подключение пулов которого необходимо включить. Дескриптора среды в вызове **SQLSetEnvAttr** должно быть присвоено значение null, что делает SQL_ATTR_CONNECTION_POOLING атрибут уровня процесса. Если атрибут имеет значение SQL_CP_ONE_PER_DRIVER, одно соединение пула поддерживается для каждого драйвера. Если приложение работает с большое число драйверов и несколько сред, это может быть эффективнее так, как может потребоваться меньшее число сравнений. Если задано SQL_CP_ONE_PER_HENV пулу одно подключение поддерживается для каждой среды. Если приложение работает во многих средах и несколько драйверов, это может быть более эффективным так, как может потребоваться меньшее число сравнений. Пул подключений отключен, задав SQL_ATTR_CONNECTION_POOLING SQL_CP_OFF.  
  
2.  Выделяет среде путем вызова **SQLAllocHandle** с *HandleType* аргумент значение SQL_HANDLE_ENV. Среды, выделенной с помощью этого вызова будет неявное общей среды, так как пул подключений включен. Среду, которая будет использоваться не определен, но до **SQLAllocHandle** с *HandleType* SQL_HANDLE_DBC, называется этой среды.  
  
3.  Выделяет соединение путем вызова **SQLAllocHandle** с *InputHandle* значение SQL_HANDLE_DBC и *InputHandle* присвоено дескриптор среды для организация пулов соединений. Диспетчер драйверов пытается найти существующую среду, соответствующую атрибуты среды, установленный приложением. Если среда не существует, он создается, с числом ссылок (поддерживается диспетчером драйверов) 1. Если найден соответствующий совместно используемой среде, среде возвращается в приложение и его счетчик ссылок увеличивается. (Фактическое подключение использоваться не определяется диспетчером драйверов до **SQLConnect** или **SQLDriverConnect** называется.)  
  
4.  Вызовы **SQLConnect** или **SQLDriverConnect** для подключения. Диспетчер драйверов использует параметры подключения в вызове **SQLConnect** (или ключевых слов подключения в вызове **SQLDriverConnect**) и задать атрибуты соединения после выделения подключения Определите, какие соединения в пуле должен использоваться.  
  
    > [!NOTE]  
    >  Сопоставления запрошенного подключения соединение из пула, определяется атрибут SQL_ATTR_CP_MATCH среды. Дополнительные сведения см. в разделе [SQLSetEnvAttr](../../../odbc/reference/syntax/sqlsetenvattr-function.md).  
  
     Использование пулов соединений приложения ODBC должны вызывать метод [CoInitializeEx](https://go.microsoft.com/fwlink/?LinkID=116307) во время инициализации приложения и [CoUninitialize](https://go.microsoft.com/fwlink/?LinkId=116310) при закрытии приложения.  
  
5.  Вызовы **SQLDisconnect** завершении с соединением. Соединение возвращается в пул подключений и становится доступным для повторного использования.  
  
 Приводится подробное описание см. в разделе [пула в Microsoft Data Access Components](https://go.microsoft.com/fwlink/?LinkId=120776).  
  
## <a name="connection-pooling-considerations"></a>Объединение подключений в пул вопросы  
 Выполнить какие-либо из следующих действий, с помощью команды SQL (а не через API-Интерфейс ODBC) могут повлиять на состояние подключения и вызывать непредвиденные проблемы при активном организация пулов соединений:  
  
-   Открытие соединения и изменение базы данных по умолчанию.  
  
-   Используя инструкцию SET, чтобы изменить параметры можно настроить (включая SET ROWCOUNT, ANSI_NULL, IMPLICIT_TRANSACTIONS, инструкции SHOWPLAN, СТАТИСТИКИ, TEXTSIZE и DATEFORMAT).  
  
-   Создание временных таблиц и хранимых процедур.  
  
 Если любое из этих действий выполняются за пределами ODBC API, следующий пользователь, который использует соединение автоматически наследуют предыдущие параметры, таблицы или процедуры.  
  
> [!NOTE]  
>  Некоторые параметры должны присутствовать в состоянии подключения не ожидается. Всегда следует задать состояние подключения в приложении и убедитесь, что приложение удаляет все неиспользуемые подключений в пул параметры.  
  
## <a name="driver-aware-connection-pooling"></a>Организация пулов соединений с учетом драйвера  
 Начиная с Windows 8, драйвер ODBC могут использовать подключения в пуле более эффективно. Дополнительные сведения см. в разделе [Driver-Aware Connection Pooling](../../../odbc/reference/develop-app/driver-aware-connection-pooling.md).  
  
## <a name="see-also"></a>См. также  
 [Подключение к данным источника или драйвер](../../../odbc/reference/develop-app/connecting-to-a-data-source-or-driver.md)   
 [Разработка драйвера ODBC](../../../odbc/reference/develop-driver/developing-an-odbc-driver.md)   
 [Создание пулов в Microsoft Data Access Components](https://go.microsoft.com/fwlink/?LinkId=120776)
