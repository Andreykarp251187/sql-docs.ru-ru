---
title: Курсоры, управляемые набором ключей | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- keyset-driven cursors [ODBC]
- cursors [ODBC], key-set driven
ms.assetid: 01769f43-1d9c-4685-84fa-15a6465335e9
author: MightyPen
ms.author: genemi
ms.openlocfilehash: 0c40fe8c823115c3131a1719185bce8f1506df81
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "68138841"
---
# <a name="keyset-driven-cursors"></a>Управляемые ключевым набором курсоры
Курсор, управляемый набором ключей, находится между статическим и динамическим курсором в возможности обнаружения изменений. Так же как статический курсор, он не всегда обнаруживает изменения, внесенные в членство и порядок элементов результирующего набора. Как и динамический курсор, он обнаруживает изменения значений строк в результирующем наборе (в зависимости от уровня изоляции транзакции, заданного атрибутом подключения SQL_ATTR_TXN_ISOLATION).  
  
 При открытии курсора, управляемого набором ключей, сохраняются ключи для всего результирующего набора. в результате будет исправлена очевидное членство и порядок результирующего набора. Когда курсор прокручивается по результирующему набору, он использует ключи в этом *наборе ключей* для получения текущих значений данных для каждой строки. Например, предположим, что курсор, управляемый набором ключей, выбирает строку, а другое приложение обновляет эту строку. Если курсор повторно извлекает строку, отображаемые им значения являются новыми, так как она перебирала строку с помощью ключа. По этой причине курсоры, управляемые набором ключей, всегда обнаруживают изменения, вносимые собственными и другими.  
  
 Когда курсор пытается извлечь строку, которая была удалена, эта строка отображается в результирующем наборе как "отверстие": ключ для этой строки присутствует в наборе ключей, но строка больше не существует в результирующем наборе. Если значения ключей в строке обновляются, строка считается удаленной, а затем вставлена, поэтому такие строки также отображаются в результирующем наборе как отверстия. Хотя курсор, управляемый набором ключей, всегда может обнаруживать строки, удаленные другими пользователями, при необходимости можно удалить ключи для строк, которые он удаляет из набора ключей. Курсоры, управляемые набором ключей, которые делают это, не могут обнаруживать свои собственные удаления. Будет ли определенный курсор, управляемый набором ключей, обнаруживать свои собственные удаления, выводится с помощью параметра SQL_STATIC_SENSITIVITY в **SQLGetInfo**.  
  
 Строки, вставленные другими пользователями, никогда не видны курсору, управляемому набором ключей, так как в наборе ключей не существует ключей для этих строк. Однако курсор, управляемый набором ключей, при необходимости может добавлять ключи для строк, которые он вставляет в набор ключей. Курсоры, управляемые набором ключей, позволяют обнаруживать собственные вставки. Определяет, обнаруживает ли определенный курсор, управляемый набором ключей, собственные вставки, с помощью параметра SQL_STATIC_SENSITIVITY в **SQLGetInfo**.  
  
 Массив состояний строк, заданный атрибутом SQL_ATTR_ROW_STATUS_PTR инструкции, может содержать SQL_ROW_SUCCESS, SQL_ROW_SUCCESS_WITH_INFO или SQL_ROW_ERROR для любой строки. Он возвращает SQL_ROW_UPDATED, SQL_ROW_DELETED или SQL_ROW_ADDED для строк, которые он обнаруживает как обновленный, удаленный или вставленный.  
  
 Курсоры, управляемые набором ключей, обычно реализуются путем создания временной таблицы, содержащей ключи для каждой строки в результирующем наборе. Поскольку курсор также должен определить, были ли обновлены строки, эта таблица также обычно содержит столбец со сведениями об управлении версиями строк.  
  
 Для прокрутки исходного результирующего набора курсор, управляемый набором ключей, открывает статический курсор во временной таблице. Чтобы получить строку исходного результирующего набора, курсор сначала извлекает соответствующий ключ из временной таблицы, а затем извлекает текущие значения для строки. Если используются блочные курсоры, курсор должен получить несколько ключей и строк.
