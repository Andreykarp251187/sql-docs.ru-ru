---
title: Переходы подключения Документы Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- transitioning states [ODBC], connection
- connection transitions [ODBC]
- state transitions [ODBC], connection
ms.assetid: 6b6e1a47-4a52-41c8-bb9e-7ddeae09913e
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 225f8517a78f8e9d4d765163649da174d72e490c
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81284774"
---
# <a name="connection-transitions"></a>Переходы подключения
Соединения ODBC имеют следующие состояния.  
  
|Состояние|Описание|  
|-----------|-----------------|  
|C0|Нераспределенная среда, нераспределенное соединение|  
|C1|Выделенная среда, нераспределенное соединение|  
|C2|Выделенная среда, выделенное соединение|  
|C3|Функция подключения нуждается в данных|  
|C4|Подключенное соединение|  
|C5|Подключенное соединение, выделенное заявление|  
|C6|Подключенное соединение, транзакция в процессе. Подключение возможно в состоянии C6 без каких-либо инструкций, выделенных на соединение. Например, предположим, что соединение находится в режиме ручного коммитов и находится в состоянии C4. Если оператор выделен, выполнен (запуск транзакции), а затем освобожден, транзакция остается активной, но в подключении нет никаких выписок.|  
  
 Следующие таблицы показывают, как каждая функция ODBC влияет на состояние соединения.  
  
## <a name="sqlallochandle"></a>СЗЛАллокХэндл  
  
|C0<br /><br /> Нет Env.|C1 Нераспределенный|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|--------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|C1|--[5]|--[5]|--[5]|--[5]|--[5]|--[5]|  
|(IH) [2]|C2|--[5]|--[5]|--[5]|--[5]|--[5]|  
|(IH) [3]|(IH)|(08003)|(08003)|C5|--[5]|--[5]|  
|(IH) [4]|(IH)|(08003)|(08003)|--[5]|--[5]|--[5]|  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_ENV.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_DBC.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_STMT.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_DESC.  
  
 Вызов **S'LAllocHandle** с *помощью OutputHandlePtr,* указывающий на действительную ручку, перезаписывает эту ручку без учета предыдущего содержимого этой ручки и может вызвать проблемы для драйверов ODBC. Неправильно едить приложение ODBC, чтобы дважды вызвать **s'LAllocHandle** с той же переменной приложения, определенной для * \*OutputHandlePtr* без вызова **S'LFreeHandle,** чтобы освободить ручку перед ее перераспределением. Перезапись ручек ODBC таким образом может привести к несогласованному поведению или ошибкам со стороны драйверов ODBC.  
  
## <a name="sqlbrowseconnect"></a>SQLBrowseConnect  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|C3 (d) C4|-- (d) C2 (е) C4|(08002)|(08002)|(08002)|  
  
## <a name="sqlclosecursor"></a>SQLCloseCursor  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--|--1' C5|  
  
 Соединение было в режиме ручного коммит.  
  
 Соединение было в режиме автоматического коммит.  
  
## <a name="sqlcolumnprivileges-sqlcolumns-sqlforeignkeys-sqlgettypeinfo-sqlprimarykeys-sqlprocedurecolumns-sqlprocedures-sqlspecialcolumns-sqlstatistics-sqltableprivileges-and-sqltables"></a>СЗЛКолобАТиВы, СЗЛКолобы, СЗЛФОффи, СЗЛДиФДиИнфо, СЗЛИПики, СЗЛПроцедури, S'LProcedures, S'LSpecialProcedures, S'LStatistics, S'LTablePrivileges,  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--1' C6|--|  
  
 Соединение находилось в режиме автоматического коммита, или источник данных не начал транзакцию.  
  
 Соединение находилось в режиме ручного коммита, и источник данных начал транзакцию.  
  
## <a name="sqlconnect"></a>SQLConnect  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|C4|(08002)|(08002)|(08002)|(08002)|  
  
## <a name="sqlcopydesc-sqlgetdescfield-sqlgetdescrec-sqlsetdescfield-and-sqlsetdescrec"></a>СЗЛКопиДеск, СЗЛГетДескФилд, СЗЛГетДеск, СЗЛЕтДескЧ, СЗЛЕтДескФилд,  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|--[1]|--|--|  
  
 В этом состоянии единственными дескрипторами, доступными для приложения, являются явно выделенные дескрипторы.  
  
## <a name="sqldatasources-and-sqldrivers"></a>СЗЛДатаИсточники и S'LDrivers  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|--|--|--|--|--|--|  
  
## <a name="sqldisconnect"></a>СЗЛДИСКоннект  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(08003)|C2|C2|C2|25000|  
  
## <a name="sqldriverconnect"></a>SQLDriverConnect  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|C4 s -- n'f|(08002)|(08002)|(08002)|(08002)|  
  
## <a name="sqlendtran"></a>SQLEndTran  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH) [1]|--[3]|--[3]|--[3]|--|--|---4, или (no5), и «8») C4 и C5,|  
|(IH) [2]|(IH)|(08003)|(08003)|--|--|C5|  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_ENV.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_DBC.  
  
 Поскольку соединение не находится в подключенном состоянии, оно не зависит от транзакции.  
  
 Коммит или откат не удалось на соединение. Функция возвращается SQL_ERROR в этом случае.  
  
 Коммит или откат удалось на соединение. Функция возвращается SQL_ERROR, если коммит или откат не удалось на другом подключении, или функция возвращается SQL_SUCCESS если коммит или откат удалось на всех соединениях.  
  
 По словам одного заявления, выделенного на подключение.  
  
 Не было никаких заявлений, выделенных на соединение.  
  
 Соединение имело по крайней мере одно утверждение, для которого был открытый курсор, и источник данных сохраняет курсоры при совершении транзакций или откате, в зависимости от того, был ли *CompletionType* SQL_COMMIT или SQL_ROLLBACK). Для получения более подробной информации, см. SQL_CURSOR_COMMIT_BEHAVIOR и SQL_CURSOR_ROLLBACK_BEHAVIOR атрибуты в [S'LGetInfo](../../../odbc/reference/syntax/sqlgetinfo-function.md).  
  
 Если в соединении были какие-либо операторы, для которых были открытые курсоры, курсоры не были сохранены, когда транзакция была совершена или отката.  
  
## <a name="sqlexecdirect-and-sqlexecute"></a>СЗЛЕсекПрямл и СЗЛВы  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|C6,6|--|  
  
 Соединение находилось в режиме автоматического коммита, и выполненное заявление не было *спецификацией* *курсора* (например, выписка SELECT); или соединение находилось в режиме ручного коммита, и выполненное заявление не начинало транзакцию.  
  
 Соединение находилось в режиме автоматического коммита, а выполненное заявление было *спецификацией* *курсора* (например, выписка SELECT).  
  
 Соединение находилось в режиме ручного коммита, и источник данных начал транзакцию.  
  
## <a name="sqlfreehandle"></a>SQLFreeHandle  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH) [1]|C0|(HY010)|(HY010)|(HY010)|(HY010)|(HY010)|  
|(IH) [2]|(IH)|(C1)|(HY010)|(HY010)|(HY010)|(HY010)|  
|(IH) [3]|(IH)|(IH)|(IH)|(IH)|C4 ------------------------------|--7» C4 и C5 и|  
|(IH) [4]|(IH)|(IH)|(IH)|--|--|--|  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_ENV.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_DBC.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_STMT.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_DESC.  
  
 На соединение было выделено только одно заявление.  
  
 На соединение было выделено несколько утверждений.  
  
 Соединение было в режиме ручного коммит.  
  
 Соединение было в режиме автоматического коммит.  
  
## <a name="sqlfreestmt"></a>Функция SQLFreeStmt  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH) [1]|(IH)|(IH)|(IH)|(IH)|--|C5 ------------------------------|  
|(IH) [2]|(IH)|(IH)|(IH)|(IH)|--|--|  
  
 В этой строке показаны транзакции, когда аргумент *Опциона* SQL_CLOSE.  
  
 В этой строке показаны транзакции, когда аргумент *Опциона* SQL_UNBIND или SQL_RESET_PARAMS.  
  
 Соединение было в режиме автоматического коммит, и никакие курсоры не были открыты ни на каких заявлениях, кроме этого.  
  
 Соединение было в режиме ручного коммита, или оно было в режиме автоматического коммита, и курсор был открыт по крайней мере по одному другому заявлению.  
  
## <a name="sqlgetconnectattr"></a>SQLGetConnectAttr  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|Ih|Ih|--[1] 08003[2]|HY010|--|--|--|  
  
 Аргумент *attribute* был SQL_ATTR_ACCESS_MODE, SQL_ATTR_AUTOCOMMIT, SQL_ATTR_LOGIN_TIMEOUT, SQL_ATTR_ODBC_CURSORS, SQL_ATTR_TRACE или SQL_ATTR_TRACEFILE, или значение было установлено для атрибута соединения.  
  
 Аргумент *Attribute* не был SQL_ATTR_ACCESS_MODE, SQL_ATTR_AUTOCOMMIT, SQL_ATTR_LOGIN_TIMEOUT, SQL_ATTR_ODBC_CURSORS, SQL_ATTR_TRACE или SQL_ATTR_TRACEFILE, и значение не было установлено для атрибута соединения.  
  
## <a name="sqlgetdiagfield-and-sqlgetdiagrec"></a>СЗЛГетДиагФилд и СЗЛГетДиагРе  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH) [1]|--|--|--|--|--|--|  
|(IH) [2]|(IH)|--|--|--|--|--|  
|(IH) [3]|(IH)|(IH)|(IH)|(IH)|--|--|  
|(IH) [4]|(IH)|(IH)|(IH)|--|--|--|  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_ENV.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_DBC.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_STMT.  
  
 В этой строке показаны переходы, когда *HandleType* был SQL_HANDLE_DESC.  
  
## <a name="sqlgetenvattr"></a>СЗЛГетЕнвТтр  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|Ih|--|--|--|--|--|--|  
  
## <a name="sqlgetfunctions"></a>SQLGetFunctions  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|Ih|Ih|HY010|HY010|--|--|--|  
  
## <a name="sqlgetinfo"></a>SQLGetInfo  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|Ih|Ih|--[1] 08003[2]|08003|--|--|--|  
  
 Аргумент *InfoType* был SQL_ODBC_VER.  
  
 Аргумент *InfoType* не был SQL_ODBC_VER.  
  
## <a name="sqlmoreresults"></a>SQLMoreResults  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--1' C6|---3' C5|  
  
 Соединение было в режиме автоматического коммита, и вызов в **S'LMoreResults** не инициализировал обработку набора результатов спецификации курсора.  
  
 Соединение было в режиме автоматического коммита, и вызов к **S'LMoreResults** инициализировал обработку набора результатов спецификации курсора.  
  
 Соединение было в режиме ручного коммит.  
  
## <a name="sqlnativesql"></a>SQLNativeSql  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(08003)|(08003)|--|--|--|  
  
## <a name="sqlprepare"></a>SQLPrepare  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--1' C6|--|  
  
 Соединение находилось в режиме автоматического коммита, или источник данных не начал транзакцию.  
  
 Соединение находилось в режиме ручного коммита, и источник данных начал транзакцию.  
  
## <a name="sqlsetconnectattr"></a>SQLSetConnectAttr  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|Ih|Ih|--[1] 08003[2]|HY010|--3» 08002 х 0011 х 5|--3» 08002 х 0011 х 5|---3» и C5 »8002 »4» HY011 или|  
  
 Аргумент *Attribute* не был SQL_ATTR_TRANSLATE_LIB или SQL_ATTR_TRANSLATE_OPTION.  
  
 Аргумент *Attribute* был SQL_ATTR_TRANSLATE_LIB или SQL_ATTR_TRANSLATE_OPTION.  
  
 Аргумент *Attribute* не был SQL_ATTR_ODBC_CURSORS или SQL_ATTR_PACKET_SIZE.  
  
 Аргумент *Attribute* был SQL_ATTR_ODBC_CURSORS.  
  
 Аргумент *Attribute* был SQL_ATTR_PACKET_SIZE.  
  
 Аргумент *Attribute* не был SQL_ATTR_AUTOCOMMIT, или аргумент *Attribute* был SQL_ATTR_AUTOCOMMIT и установка этого атрибута не совершила транзакцию.  
  
 Аргумент *Attribute* был SQL_ATTR_TXN_ISOLATION.  
  
 Аргумент *Attribute* был SQL_ATTR_AUTOCOMMIT, и установка этого атрибута совершила транзакцию.  
  
## <a name="sqlsetenvattr"></a>SQLSetEnvAttr  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|--|--|(HY010)|--|--|--|  
  
## <a name="all-other-odbc-functions"></a>Все остальные функции ODBC  
  
|C0<br /><br /> Нет Env.|C1<br /><br /> Не выделено|C2<br /><br /> Allocated|C3<br /><br /> Нужны данные|C4<br /><br /> Подключен|C5<br /><br /> .|C6<br /><br /> Транзакция|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--|--|
