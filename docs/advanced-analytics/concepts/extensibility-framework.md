---
title: Архитектура расширения для языка R и Python-script - машинного обучения SQL Server
description: Поддержка внешнего кода для ядра СУБД SQL Server, с помощью двухуровневую архитектуру для выполнения скрипта R и Python на реляционных данных.
ms.prod: sql
ms.technology: machine-learning
ms.date: 10/17/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 3d4d8108fda500d48425abfb52fd9f72c6faa147
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "67963057"
---
# <a name="extensibility-architecture-in-sql-server-machine-learning-services"></a>Архитектура расширения в службах машинного обучения SQL Server 
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

SQL Server имеет платформу расширения для выполнения внешних скриптов, например R или Python на сервере. Сценарий выполняется в среде CLR в качестве расширения ядром СУБД. 

## <a name="background"></a>Историческая справка

Инфраструктура расширяемости появилась в SQL Server 2016 для поддержки среды выполнения R. SQL Server 2017 добавлена поддержка Python

Инфраструктура расширяемости предназначена для обеспечения интерфейса между SQL Server и языков обработки и анализа данных, таких как R и Python, уменьшения числа несоответствий при предоставлении скользящего решения для обработки и анализа данных в производственной среде и защиты данных во время разработки процесс. Выполняя доверенных язык сценариев в безопасную инфраструктуру, под управлением SQL Server, администраторы баз данных можно обеспечения безопасности, предоставляя доступ к данным предприятия по обработке и анализу данных.

Следующая схема визуально описывает возможности и преимущества расширяемой архитектуры.

  ![Цель интеграции с SQL Server](../media/ml-service-value-add.png "добавить значение службы машины обучения")

Любой сценарий R или Python можно запустить путем вызова хранимой процедуры, а результаты возвращаются в виде табличных результатов непосредственно в SQL Server, облегчая процесс создания и использования машинного обучения из любого приложения, которое может отправить SQL-запроса и обработки результатов.

+ Выполнение внешнего скрипта подчиняется защиты данных SQL Server, где пользователь, запускающий внешний скрипт можно только для доступа к данным, который одинаково доступен в SQL-запрос. Если запрос завершается сбоем из-за недостатка разрешений, сценарий, запущенный монитором тот же пользователь будет невозможно по той же причине. Безопасность SQL Server обеспечивается на уровне экземпляра, базы данных и таблицы. База данных администраторы могут управлять доступом пользователей, ресурсы, используемые внешних скриптов и библиотек внешнего кода, добавлены на сервер.  

+ Возможности масштабирования и оптимизации имеют два основы: за счет платформе базы данных (индексы ColumnStore [ресурсами](../../advanced-analytics/r/resource-governance-for-r-services.md)), прибыли и относящихся к модулю при использовании библиотек Microsoft R и Python для данных модели обработки и анализа. В то время как R является однопоточным, функций RevoScaleR: несколькими потоками, может распределять рабочую нагрузку на несколько ядер.

+ Развертывание использует SQL Server методологий: хранимые процедуры, упаковки внешних скриптов, embedded SQL или T-SQL запрашивает вызов функций, такие как PREDICT для возвращения результатов из моделей прогнозирования сохраняются на сервере.

+ Разработчики R и Python с установить навыки в соответствии с конкретным средствам и интегрированными средами разработки можно написать код в этих средствах и затем перенести код в SQL Server.

## <a name="architecture-diagram"></a>Диаграмма архитектуры

Архитектура разработана таким образом, что внешние скрипты выполняться в отдельном процессе от SQL Server, однако компонентов, которые внутренне управляют цепочки запросов для данных и операций на сервере SQL Server. В зависимости от версии SQL Server поддерживаемые языковые расширения включают R и Python. 

  ![Архитектура компонентов](../media/generic-architecture.png "архитектура компонентов")

Компоненты включают **панель запуска** службы, используемые для вызова средства запуска конкретного языка (R или Python), язык и библиотеки логику для загрузки интерпретаторов и библиотек. Средство запуска загружает времени выполнения языка, а также все собственные модули. Например если код включает функции RevoScaleR, загружает интерпретатор RevoScaleR. **BxlServer** и **вспомогательное соединение SQL** управление передачей связью и передачи данных с SQL Server.

<a name="launchpad"></a>

## <a name="launchpad"></a>Панель запуска

[!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] — Это служба, осуществляющая управление и выполнение внешних скриптов, аналогично тому, как, что служба полнотекстового индексирования и выполнения запросов запускается на отдельном узле для обработки полнотекстовых запросов. Служба панели запуска можно запустить только доверенные средства, которые публикуются корпорацией Майкрософт, или, сертифицированных корпорацией Майкрософт как собрания требования к производительности и управление ресурсами.

| Доверенные средства | Расширение | Версии SQL Server |
|-------------------|-----------|---------------------|
| RLauncher.dll для языка R | [Расширения R](extension-r.md) | SQL Server 2016, SQL Server 2017 |
| Pythonlauncher.dll для Python 3.5 | [Расширение Python](extension-python.md) | SQL Server 2017 |

Служба [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] выполняется со своей собственной учетной записью пользователя. Если изменить учетную запись, для запуска панели запуска, не забудьте сделать это с помощью диспетчера конфигурации SQL Server, чтобы обеспечить запись изменений в связанные файлы.

Отдельный [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] служба создается для каждого экземпляра ядра базы данных, к которому вы добавили службы машинного обучения SQL Server. Имеется один панель запуска службы для каждого экземпляра ядра базы данных, поэтому если у вас есть несколько экземпляров с поддержкой внешнего скрипта, имеется служба панели запуска для каждого из них. Экземпляр ядра СУБД привязан к службе панели запуска, созданный для него. Все вызовы внешних скриптов в хранимой процедуре или результат T-SQL в службе SQL Server, вызывая службу панели запуска, создан для одного экземпляра.

Для выполнения задач в определенные поддерживаемого языка, панель запуска получает с защищенной рабочей учетной записью из пула и запускает вспомогательный процесс для управления внешней среды выполнения. Каждый вспомогательный процесс наследует учетной записи пользователя панели запуска и использует ее в течение выполнения скрипта. Если скрипт использует параллельных процессов, они будут созданы под тем же, одной рабочей учетной записью.

## <a name="bxlserver-and-sql-satellite"></a>BxlServer и вспомогательное соединение SQL

**BxlServer** — это исполняемый файл, предоставляемый корпорацией Майкрософт, управляет связью между SQL Server и Python или R. Он создает объекты заданий Windows, которые содержат сеансы внешних скриптов, подготавливает безопасные рабочие папки для каждого задания внешнего скрипта и использует вспомогательное соединение SQL для управления передачей данных между внешней среды выполнения и SQL Server. При запуске [Process Explorer](https://technet.microsoft.com/sysinternals/processexplorer.aspx) пока задание выполняется, может появиться один или несколько экземпляров BxlServer.

По сути BxlServer является дополнением к языка, запустите среду времени, который работает с SQL Server для передачи данных и управления задачами. BXL расшифровывается как двоичный язык Exchange и ссылается на формат данных, используемый для эффективного перемещения данных между SQL Server и внешними процессами. BxlServer также является важной частью связанных продуктов, таких как Microsoft R Client и Microsoft R Server.

**Вспомогательное соединение SQL** API расширяемости, включенных в компоненте database engine, начиная с SQL Server 2016, которая поддерживает внешний код или внешних сред выполнения, реализованные с помощью C или C++.

BxlServer использует вспомогательное соединение SQL для следующих задач:

+ чтение входных данных;
+ запись выходных данных;
+ получение входных аргументов;
+ запись входных аргументов;
+ Обработка ошибок
+ обратная запись StdOut и StdErr в клиент.

Вспомогательное соединение SQL использует пользовательский формат данных, оптимизированный для быструю передачу данных между SQL Server и языками внешних скриптов. Он выполняет преобразования типов и определяет схемы входных и выходных наборов данных во время обмена данными между SQL Server и среды выполнения внешнего скрипта.

Вспомогательное соединение SQL можно отслеживать с помощью windows расширенные события (xEvents). Дополнительные сведения см. в разделе [расширенных событий для R](../../advanced-analytics/r/extended-events-for-sql-server-r-services.md) и [расширенных событий для Python](../../advanced-analytics/python/extended-events-for-python.md).

## <a name="communication-channels-between-components"></a>Каналы связи между компонентами

В этом разделе описаны протоколы связи между компонентами, а также платформ данных.

+ **TCP/IP**

  По умолчанию для внутреннего взаимодействия между SQL Server и вспомогательное соединение SQL используется протокол TCP/IP.

+ **Именованные каналы**

  Внутренней передачи данных между BxlServer и SQL Server через вспомогательное соединение SQL использует формат собственности сжатых данных для повышения производительности. Обмен данными между времени выполнения языка и BxlServer в формате BXL, с использованием именованных каналов.

+ **интерфейс ODBC**

  Связь между клиентами обработки и анализа внешних данных и удаленного экземпляра SQL Server использует ODBC. Учетная запись, который отправляет задания скрипта SQL Server, должна иметь оба разрешения для подключения к экземпляру и выполнения внешних скриптов.

  Кроме того в зависимости от задачи, учетной записи могут потребоваться следующие разрешения:

  + Чтение данных, используемые заданием
  + Записи данных в таблицы: например, при сохранении результатов в таблицу
  + Создание объектов базы данных: например, если сохранение внешнего скрипта как часть новую хранимую процедуру.

  Если SQL Server используется как контекст вычислений для скрипта, выполняемого из удаленного клиента и исполняемого файла должно получать данные из внешнего источника, ODBC используется для обратной записи. SQL Server сопоставляет удостоверение пользователя, выполняющего удаленной команды к удостоверению пользователя в текущем экземпляре и выполняет команду ODBC, используя учетные данные этого пользователя. Строка подключения, необходимая для выполнения этого вызова ODBC, получается из клиентского кода.

+ **RODBC (R)** 

  Дополнительные вызовы ODBC можно вносить в скрипт с помощью **RODBC**. RODBC — это популярный пакет R, используемый для доступа к данным в реляционных базах данных; Тем не менее его производительность обычно медленнее, чем поставщиков, используемых сервером SQL Server. Многие скрипты R используют встроенные вызовы RODBC как способ получения "вторичных" наборов данных для использования при анализе. Например, хранимая процедура, которая обучает модель, может определить SQL-запрос, чтобы получить данные для обучения модели, но использовать встроенный вызов RODBC, чтобы получить дополнительные факторы для выполнения операций поиска или для получения новых данных из внешних источников, таких как текстовые файлы или Excel.

  Следующий код иллюстрирует вызов RODBC, встроенный в скрипт R:

    ```R
    library(RODBC);
    connStr <- paste("Driver=SQL Server;Server=", instance_name, ";Database=", database_name, ";Trusted_Connection=true;", sep="");
    dbhandle <- odbcDriverConnect(connStr)
    OutputDataSet <- sqlQuery(dbhandle, "select * from table_name");
    ```

+ **Другие протоколы**

  Можно также использовать процессы, которые могут понадобиться для работы в виде «фрагментов» или передавать данные обратно к удаленному клиенту [формат файлов XDF](https://docs.microsoft.com/machine-learning-server/r/concept-what-is-xdf). Фактические данные передаются с помощью закодированных больших двоичных объектов.

## <a name="see-also"></a>См. также

+ [Расширения R в SQL Server](extension-r.md)
+ [Расширение Python в SQL Server](extension-python.md)