---
title: Расширение языка программирования R
description: Сведения о выполнении кода R и встроенных библиотеках R в SQL Server 2016 R Services или SQL Server 2017 Службы машинного обучения.
ms.prod: sql
ms.technology: machine-learning
ms.date: 09/05/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 300b5d25d62be24c1e5590f5cd9795d08da7f2c1
ms.sourcegitcommit: 9062c5e97c4e4af0bbe5be6637cc3872cd1b2320
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2019
ms.locfileid: "68470498"
---
# <a name="r-language-extension-in-sql-server"></a>Расширение языка R в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

Расширение R является частью SQL Server Службы машинного обучения надстройку для ядра реляционной базы данных. Она добавляет среду выполнения R, базовое распределение R с стандартными библиотеками и инструментами, а также библиотеки Microsoft R. [RevoScaleR](../r/ref-r-revoscaler.md) для аналитики в масштабе, [MicrosoftML](../r/ref-r-microsoftml.md) для алгоритмов машинного обучения и других библиотек для доступа к данным или коду R в SQL Server.

Интеграция R доступна в SQL Server, начиная с SQL Server 2016, со [службами R](../r/sql-server-r-services.md)и продолжая пересылаться в рамках [SQL Server службы машинного обучения](../what-is-sql-server-machine-learning.md).

## <a name="r-components"></a>Компоненты R

SQL Server содержит пакеты с открытым исходным кодом и частные. Базовые библиотеки R устанавливаются с помощью дистрибутива R с открытым кодом Майкрософт: Microsoft R Open (MRO). Текущие пользователи R должны иметь возможность перенести код R и выполнить его как внешний процесс на SQL Server с незначительными изменениями или без них. MRO устанавливается независимо от средств SQL и выполняется вне базовых процессов ядра в платформе расширяемости. Во время установки необходимо согласиться с условиями лицензии с открытым исходным кодом. После этого можно выполнять стандартные пакеты R, не внося дальнейших изменений точно так же, как в любом другом дистрибутиве R с открытым кодом. 

SQL Server не изменяет базовые исполняемые файлы R, но необходимо использовать версию R, установленную программой установки, так как эта версия является той, на которой создаются и тестируются частные пакеты. Дополнительные сведения о том, как MRO отличается от базового распределения R, который вы можете получить из CRAN, см. в статье [взаимодействие с языком r и продуктами и компонентами Microsoft r](https://docs.microsoft.com/r-server/what-is-r-server-interoperability).

Дистрибутив базового пакета R, установленный программой установки, можно найти в папке, связанной с экземпляром. Например, если вы установили службы R на экземпляре SQL Server 2016 по умолчанию, библиотеки R по умолчанию расположены в этой папке `C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\R_SERVICES\library`:. Аналогичным образом инструменты R, связанные с экземпляром по умолчанию, по умолчанию будут находиться `C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\R_SERVICES\bin`в этой папке:.

Пакеты R, добавленные корпорацией Майкрософт для параллельных и распределенных рабочих нагрузок, включают следующие библиотеки.

| Библиотека | Описание |
|---------|-------------|
| [**RevoScaleR**](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler) | Поддерживает объекты источников данных и просмотр данных, обработку, преобразование и визуализацию. Она поддерживает создание контекстов удаленного вычислений, а также различных масштабируемых моделей машинного обучения, таких как **rxLinMod**. API-интерфейсы оптимизированы для анализа наборов данных, которые слишком велики для размещения в памяти, и для выполнения вычислений, распределенных по нескольким ядрам или процессорам. Пакет RevoScaleR также поддерживает формат файлов Xdf-для ускорения перемещения и хранения данных, используемых для анализа. XDF-файлы используют хранилище столбцов, их можно переносить и использовать для загрузки и обработки данных из различных источников, включая текст, SPSS или подключения ODBC. |
| [**MicrosoftML**](https://docs.microsoft.com/r-server/r/concept-what-is-the-microsoftml-package) | Содержит алгоритмы машинного обучения, оптимизированные для скорости и точности, а также встроенные преобразования для работы с текстом и изображениями. Дополнительные сведения см. [в разделе MicrosoftML in SQL Server](../r/ref-r-microsoftml.md). | 

## <a name="using-r-in-sql-server"></a>Использование R в SQL Server

Можно создать скрипты для R с помощью базовых функций, но чтобы воспользоваться преимуществами многопроцессорной обработки, необходимо импортировать модули **RevoScaleR** и **MicrosoftML** в код R, а затем вызывать его функции для создания моделей, которые выполняются параллельно. 
 
К поддерживаемым источникам данных относятся базы данных ODBC, SQL Server и формат файлов Xdf-для обмена данными с другими источниками или с решениями R. Входные данные должны быть табличными. Все результаты R должны возвращаться в виде кадра данных.

Поддерживаемые контексты вычислений включают в себя локальный или удаленный SQL Server контексте вычислений. Удаленный контекст вычислений относится к выполнению кода, который начинается на одном компьютере, например на рабочей станции, но затем переключается на удаленный компьютер. Для переключения контекста вычислений требуется, чтобы обе системы имели одну и ту же библиотеку RevoScaleR.

Локальный контекст вычислений, как можно было бы ожидать, включает выполнение кода R на том же сервере, что и экземпляр ядра СУБД, с кодом внутри T-SQL или внедренным в хранимую процедуру. Можно также запустить код из локальной среды R IDE и выполнить сценарий на SQL Server компьютере, определив контекст удаленного вычислений.

## <a name="execution-architecture"></a>Архитектура выполнения

На следующих схемах показано взаимодействие компонентов SQL Server с средой выполнения R в каждом из поддерживаемых сценариев: выполнение сценария в базе данных и удаленное выполнение из командной строки R с использованием контекста вычислений SQL Server.

### <a name="r-scripts-executed-from-sql-server-in-database"></a>Скрипты R, выполненные из SQL Server в базе данных

Код R, запускаемый из SQL Server "внутри", выполняется путем вызова хранимой процедуры. Таким образом, любое приложение, которое может сделать вызов хранимой процедуры, может также инициировать выполнение кода R.  После этого SQL Server управляет выполнением кода R, как показано на следующей схеме.

![rsql_indb780-01](../r/media/script_in-db-r.png)

1. Запрос к среде выполнения R, указанный с помощью параметра _@language='R'_ , передается хранимой процедуре [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md). SQL Server отправляет этот запрос в службу панели запуска.
2. Служба панели запуска запускает соответствующее средство запуска. В данном случае RLauncher.
3. RLauncher запускает внешний процесс R.
4. BxlServer координирует использование среды выполнения R для управления обменом данными с SQL Server и хранением результатов работы.
5. Вспомогательная лицензия SQL управляет связью связанных задач и процессов с SQL Server.
6. BxlServer использует вспомогательную лицензию SQL для передачи состояния и результатов в SQL Server.
7. SQL Server получает результаты и закрывает связанные задачи и процессы.

### <a name="r-scripts-executed-from-a-remote-client"></a>Скрипты R, выполняемые из удаленного клиента

При подключении из удаленного клиента обработки и анализа данных, поддерживающего Microsoft R, можно выполнять функции R в контексте SQL Server с помощью функций RevoScaleR. Этот рабочий процесс отличается от предыдущего и показан на следующей схеме.

![rsql_fromR2db-01](../r/media/remote-sqlcc-from-r2.png)

1. Для функций RevoScaleR среда выполнения R вызывает функцию связывания, которая, в свою очередь, вызывает BxlServer.
2. BxlServer входит в состав Microsoft R и выполняется в процессе, отдельном от среды выполнения R.
3. BxlServer определяет целевой объект подключения и инициирует подключение с использованием ODBC, передавая учетные данные, предоставленные в виде части строки подключения в объекте источника данных R.
4. BxlServer открывает подключение к экземпляру SQL Server.
5. Для вызова R вызывается служба панели запуска, которая, в свою очередь, запускает соответствующее средство запуска, RLauncher. После этого обработка кода R происходит аналогично процессу выполнения кода R из T-SQL.
6. RLauncher вызывает экземпляр среды выполнения R, установленной на компьютере SQL Server.
7. Результаты возвращаются в BxlServer.
8. Вспомогательная программа SQL управляет связью с SQL Server и очисткой связанных объектов заданий.
9. SQL Server передает результаты обратно клиенту.

## <a name="see-also"></a>См. также

+ [Инфраструктура расширяемости в SQL Server](extensibility-framework.md)
+ [Модули Python и машинного обучения в SQL Server](extension-python.md)