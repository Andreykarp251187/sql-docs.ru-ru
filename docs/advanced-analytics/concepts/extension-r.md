---
title: Программирования расширение языка - машинного обучения SQL Server R
description: Дополнительные сведения о выполнении кода R и встроенные библиотеки R в SQL Server 2016 R Services или службы машинного обучения SQL Server 2017.
ms.prod: sql
ms.technology: machine-learning
ms.date: 09/05/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 216adc526f558152d90f4c8639b4ca1ba5dc67ac
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "67963068"
---
# <a name="r-language-extension-in-sql-server"></a>Расширение языка R в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Расширения R является частью надстройки служб машинного обучения SQL Server к ядру реляционной СУБД. Он добавляет в среду выполнения R, базовое распределение R с помощью стандартных библиотек и средств и библиотеки Microsoft R: [RevoScaleR](../r/ref-r-revoscaler.md) для аналитики в нужном масштабе, [MicrosoftML](../r/ref-r-microsoftml.md) для алгоритмов машинного обучения и другие библиотеки для доступа к данным или коду R в SQL Server.

Интеграция R доступна в SQL Server, начиная с SQL Server 2016 с [служб R](../r/sql-server-r-services.md)и продолжая вперед, как часть [службы машинного обучения SQL Server](../what-is-sql-server-machine-learning.md).

## <a name="r-components"></a>Компоненты R

SQL Server включает в себя как открытый, так и закрытых пакетов. Базовые библиотеки R устанавливаются с использованием распространяемого корпорацией Майкрософт R: открытым исходным кодом Microsoft R Open (MRO). Текущим пользователям R должны иметь возможность перенести свой код R и выполнять его как внешний процесс на сервере SQL Server с незначительных изменений. MRO устанавливается независимо от средства SQL, а также выполняется за пределами ядра основные процессы, в структуре расширяемости. Во время установки вы должны согласиться с условиями лицензии открытым исходным кодом. После этого можно выполнять стандартные пакеты R без изменений, так же, как и в других открытым исходным кодом распределение R. 

SQL Server не изменяет базовый исполняемые файлы R, но необходимо использовать версию R, установленные программой установки, так как эта версия является то, что частные пакеты разработан и протестирован на. Дополнительные сведения о отличия MRO от базовое распределение R, который можно получить из CRAN, см. в разделе [взаимодействие с помощью языка R с продуктами Microsoft R и функции](https://docs.microsoft.com/r-server/what-is-r-server-interoperability).

Базовый дистрибутив пакета R устанавливается программой установки можно найти в папке, связанной с экземпляром. Например, если вы установили службы R в экземпляр SQL Server 2016 по умолчанию, библиотеки R находятся в этой папке по умолчанию: `C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\R_SERVICES\library`. Аналогичным образом, средства R, связанные с экземпляром по умолчанию будет находиться в этой папке по умолчанию: `C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\R_SERVICES\bin`.

Пакеты R, добавлены корпорацией Майкрософт для параллельных и распределенных рабочих нагрузок включают перечисленные ниже библиотеки.

| Библиотека | Описание |
|---------|-------------|
| [**RevoScaleR**](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler) | Поддерживает объекты источников данных и просмотр данных, обработки, преобразования и визуализации. Он поддерживает создание удаленных контекстов вычислений, а также различные масштабируемые модели машинного обучения, такие как **rxLinMod**. API-интерфейсы оптимизированы для анализа наборов данных, которые слишком велики для размещения в памяти, и для выполнения вычислений, распределенных по нескольким ядрам или процессорам. В состав пакета RevoScaleR также поддерживает формат файла XDF для быстрого перемещения и сохранения данных, используемых для анализа. XDF-файлы используют хранилище столбцов, их можно переносить и использовать для загрузки и обработки данных из различных источников, включая текст, SPSS или подключения ODBC. |
| [**MicrosoftML**](https://docs.microsoft.com/r-server/r/concept-what-is-the-microsoftml-package) | Содержит алгоритмы машинного обучения, которые оптимизированы для скорости и точности, а также преобразования, для работы с текстом и изображениями в строке. Дополнительные сведения см. в разделе [MicrosoftML в SQL Server](../r/ref-r-microsoftml.md). | 

## <a name="using-r-in-sql-server"></a>С помощью языка R в SQL Server

Можно создать скрипт R с помощью базовой функции, но можно было использовать мультипроцессорной обработки, необходимо импортировать **RevoScaleR** и **MicrosoftML** модулей в коде R и ее функций для создания моделей, затем вызовите метод выполните в параллельном режиме. 
 
Среди поддерживаемых источников данных ODBC баз данных SQL Server и формат файла XDF для обмена данными с другими источниками, или с помощью решений R. Входные данные должны быть табличных. Все результаты R должен быть возвращен в виде кадра данных.

Поддерживаемые контексты вычислений включают локальный или удаленный контекст вычислений SQL Server. Контекст удаленных вычислений ссылается на выполнение кода, который начинается на одном компьютере, такие как рабочая станция, но параметры скрипта для выполнения на удаленном компьютере. Переключение контекста вычисления требуется наличие одной и той же библиотеки RevoScaleR в обеих систем.

Локальный Контекст вычислений, как можно догадаться, включает в себя выполнение кода R на одном сервере с экземпляром компонента database engine, с кодом в T-SQL или внедренных в хранимую процедуру. Можно также выполнить код из локальной интегрированной среды разработки R и скрипта, выполните на компьютере SQL Server, путем определения удаленного контекста вычислений.

## <a name="execution-architecture"></a>Архитектура выполнения

На следующей схеме показан взаимодействие компонентов SQL Server со средой выполнения R в каждой из поддерживаемых сценариев: запуск скрипта в базе данных и удаленного выполнения из командной строки R, с помощью контекста вычислений SQL Server.

### <a name="r-scripts-executed-from-sql-server-in-database"></a>Скрипты R, выполняемые из SQL Server в базе данных

Код R, который запускается «внутри» SQL Server выполняется с помощью вызова хранимой процедуры. Таким образом, любое приложение, которое может сделать вызов хранимой процедуры, может также инициировать выполнение кода R.  После этого SQL Server управляет выполнением кода R, как показано на следующей схеме.

![rsql_indb780-01](../r/media/script_in-db-r.png)

1. Запрос к среде выполнения R, указанный с помощью параметра _@language='R'_ , передается хранимой процедуре [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md). SQL Server отправляет этот запрос в службу панели запуска.
2. Служба панели запуска запускает соответствующее средство запуска. В данном случае RLauncher.
3. RLauncher запускает внешний процесс R.
4. BxlServer координирует со средой выполнения R для управления обмен данными с SQL Server и хранилищем результатов работы.
5. Вспомогательное соединение SQL контролирует взаимодействие связанных задач и процессов с помощью SQL Server.
6. BxlServer использует вспомогательное соединение SQL для взаимодействия, состояние и результаты в SQL Server.
7. SQL Server получает результаты и закрывает связанные задачи и процессы.

### <a name="r-scripts-executed-from-a-remote-client"></a>Скрипты R, выполняемые из удаленного клиента

При подключении из удаленного клиента обработки и анализа, поддерживающего Microsoft R, функции R в контексте SQL Server можно запустить с помощью функций RevoScaleR. Этот рабочий процесс отличается от предыдущего и показан на следующей схеме.

![rsql_fromR2db-01](../r/media/remote-sqlcc-from-r2.png)

1. Для функции RevoScaleR среда выполнения R вызывает связующую функцию, которая в свою очередь, вызывает BxlServer.
2. BxlServer входит в состав Microsoft R и выполняется в процессе, отдельном от среды выполнения R.
3. BxlServer определяет целевой объект подключения и инициирует подключение с использованием ODBC, передавая учетные данные, предоставленные в виде части строки подключения в объекте источника данных R.
4. BxlServer устанавливает подключение к экземпляру SQL Server.
5. Для вызова R вызывается служба, панель запуска которой — Включение запускает соответствующее средство запуска — RLauncher. После этого обработка кода R происходит аналогично процессу выполнения кода R из T-SQL.
6. Rlauncher вызывает экземпляр среды выполнения R, установленной на компьютере с SQL Server.
7. Результаты возвращаются в BxlServer.
8. Вспомогательное соединение SQL управляет взаимодействием с SQL Server и очистки связанных объектов задания.
9. SQL Server передает результаты клиенту.

## <a name="see-also"></a>См. также

+ [Extensibility framework в SQL Server](extensibility-framework.md)
+ [Python и машинного обучения расширений в SQL Server](extension-python.md)