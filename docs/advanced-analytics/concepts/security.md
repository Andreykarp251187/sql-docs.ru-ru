---
title: Общие сведения о безопасности для расширений R и Python
description: Общие сведения о безопасности для платформы расширяемости в SQL Server Службы машинного обучения. Безопасность входа и учетных записей пользователей, панель запуска SQL Server службы, рабочих учетных записей, запуска нескольких сценариев и разрешений для файлов.
ms.prod: sql
ms.technology: machine-learning
ms.date: 10/17/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 51587878d4a16145ff53eaa397da69130c04d7d5
ms.sourcegitcommit: c1382268152585aa77688162d2286798fd8a06bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/19/2019
ms.locfileid: "68343371"
---
# <a name="security-overview-for-the-extensibility-framework-in-sql-server-machine-learning-services"></a>Общие сведения о безопасности для платформы расширяемости в SQL Server Службы машинного обучения

[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье описывается общая архитектура безопасности, используемая для интеграции ядра СУБД SQL Server и связанных компонентов с платформой расширяемости. Он проверяет защищаемые объекты, службы, удостоверение процесса и разрешения. Дополнительные сведения о ключевых понятиях и компонентах расширяемости в SQL Server см. в разделе [Архитектура расширяемости в SQL Server службы машинного обучения](extensibility-framework.md)].

## <a name="securables-for-external-script"></a>Защищаемые объекты для внешнего скрипта

Внешний скрипт, написанный на языке R или Python, передается в качестве входного параметра в [системную хранимую процедуру](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md) , созданную для этой цели, или упаковывается в определяемую пользователем хранимую процедуру. Кроме того, вы можете использовать модели, которые предварительно обучены и сохранены в двоичном формате в таблице базы данных, вызываемые в функции [Predict](../../t-sql/queries/predict-transact-sql.md) T-SQL.

Так как скрипт предоставляется через существующие объекты схемы базы данных, хранимые процедуры и таблицы, для SQL Server Службы машинного обучения не существует новых [защищаемых](../../relational-databases/security/securables.md) объектов.

Независимо от того, как используется сценарий или что они состоят из, объекты базы данных будут созданы и, возможно, сохранены, но для хранения скрипта не будет введен новый тип объекта. В результате возможность использования, создания и сохранения объектов базы данных в значительной степени зависит от разрешений базы данных, уже определенных для пользователей.

<a name="permissions"></a>

## <a name="permissions"></a>Разрешения

Модель безопасности данных SQL Server для имен входа и ролей базы данных распространяется на скрипты R и Python. Для запуска внешних скриптов, использующих SQL Server данные или выполняемых с SQL Server в качестве контекста вычислений, требуется имя входа SQL Server или учетная запись пользователя Windows. Пользователи базы данных, имеющие разрешения на выполнение нерегламентированного запроса, могут обращаться к тем же данным из скрипта R или Python.

Имя входа или учетная запись пользователя определяет *субъекта безопасности*, которому может потребоваться несколько уровней доступа в зависимости от требований внешнего скрипта:

+ Разрешение на доступ к базе данных, в которой включены внешние скрипты.
+ Разрешения на чтение данных из защищенных объектов, таких как таблицы.
+ Возможность записи новых данных в таблицу, такую как модель, или результаты оценки.
+ Возможность создания новых объектов, например таблиц, хранимых процедур, использующих внешний скрипт, или пользовательских функций, использующих задание R или Python.
+ Право на установку новых пакетов на SQL Server компьютере или использование пакетов, предоставленных группе пользователей.

Каждый пользователь, запускающий внешний скрипт с использованием SQL Server в качестве контекста выполнения, должен быть сопоставлен с пользователем в базе данных. Вместо индивидуальной установки разрешений пользователя базы данных можно создавать роли для управления наборами разрешений и назначать пользователям эти роли, а не индивидуально устанавливать разрешения пользователя.

Дополнительные сведения см. [в разделе Предоставление пользователям разрешения на SQL Server службы машинного обучения](../../advanced-analytics/security/user-permission.md).

## <a name="permissions-when-using-an-external-client-tool"></a>Разрешения при использовании внешнего клиентского средства

Пользователи, которые используют R или Python во внешнем клиентском средстве, должны иметь свое имя входа или учетную запись, сопоставленную с пользователем в базе данных, если им нужно запустить внешний скрипт в базе данных или получить доступ к объектам и данным базы данных. Те же разрешения необходимы независимо от того, отправляется ли внешний скрипт из удаленного клиента обработки и анализа данных или выполняется с помощью хранимой процедуры T-SQL.

Например, предположим, что вы создали внешний скрипт, который выполняется на локальном компьютере, и вы хотите запустить этот скрипт на SQL Server. Для этого должны быть выполнены приведенные ниже условия.

+ База данных должна разрешать удаленные подключения.
+ Имя входа SQL или учетная запись Windows, использованная для доступа к базе данных, была добавлена в SQL Server на уровне экземпляра.
+ Имя входа SQL или пользователь Windows должны иметь разрешение на выполнение внешних скриптов. Обычно это разрешение может добавить только администратор базы данных.
+ Имя входа SQL или пользователь окна должны быть добавлены в качестве пользователя с соответствующими разрешениями в каждой базе данных, где внешний сценарий выполняет любую из следующих операций:
  + Получение данных.
  + Запись или обновление данных.
  + Создание новых объектов, например таблиц или хранимых процедур.

После того как имя входа или учетная запись пользователя Windows подготовлены и предоставлены необходимые разрешения, можно запустить внешний скрипт на SQL Server с помощью объекта источника данных в R или библиотеки **revoscalepy** в Python или путем вызова хранимой процедуры, которая содержит внешний скрипт.

При каждом запуске внешнего скрипта из SQL Server безопасность ядра СУБД получает контекст безопасности пользователя, запустившего задание, и управляет сопоставлениями пользователя или имени входа с защищаемыми объектами.

Таким образом, все внешние скрипты, инициированные удаленным клиентом, должны указывать имя входа или сведения о пользователе как часть строки подключения.

<a name="launchpad"></a>

## <a name="services-used-in-external-processing-launchpad"></a>Службы, используемые во внешней обработке (панель запуска)

Платформа расширяемости добавляет одну новую службу NT в [список служб](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md#Service_Details) в SQL Server установки: [**Панель запуска SQL Server (мсссклсервер)** ](extensibility-framework.md#launchpad).

Ядро СУБД использует службу панель запуска SQL Server для создания экземпляра сеанса R или Python в качестве отдельного процесса. Этот процесс выполняется с учетной записью с низким уровнем прав; отличается от SQL Server, самой панели запуска и идентификатора пользователя, под которым выполнялась хранимая процедура или запрос узла. Выполнение скрипта в отдельном процессе под учетной записью с низким уровнем прав является основанием модели безопасности и изоляции для R и Python в SQL Server.

Кроме запуска внешних процессов, панель запуска также отвечает за отслеживание удостоверения вызывающего пользователя и сопоставление этого удостоверения с учетной записью рабочей роли с низким уровнем прав, используемой для запуска процесса. В некоторых сценариях, где скрипт или код возвращаются к SQL Server для данных и операций, панель запуска обычно может легко управлять передачей удостоверений. Скрипты, содержащие инструкции SELECT или вызывающие функции и другие программные объекты, обычно проходят успешно, если вызывающий пользователь имеет достаточные разрешения.

> [!NOTE]
> По умолчанию [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] настраивается для запуска в среде **NT Service\MSSQLLaunchpad**, которая подготовлена со всеми необходимыми разрешениями для выполнения внешних скриптов. Дополнительные сведения о настраиваемых параметрах см. в разделе [панель запуска SQL Server Service Configuration](../security/sql-server-launchpad-service-account.md).

<a name="sqlrusergroup"></a>

## <a name="identities-used-in-processing-sqlrusergroup"></a>Идентификаторы, используемые при обработке (SQLRUserGroup)

**SQLRUserGroup** (Группа пользователей с ограниченным доступом к SQL) создается SQL Server установки и содержит пул локальных учетных записей пользователей Windows с низким уровнем прав. Когда требуется внешний процесс, панель запуска принимает доступную рабочую учетную запись и использует ее для выполнения процесса. В частности, панель запуска активирует доступную рабочую учетную запись, сопоставляет ее с удостоверением вызывающего пользователя и запускает сценарий под рабочей учетной записью.

+ **SQLRUserGroup** связан с конкретным экземпляром. Для каждого экземпляра, на котором включено машинное обучение, требуется отдельный пул рабочих учетных записей. Учетные записи не могут совместно использоваться разными экземплярами.

+ Размер пула учетных записей пользователей является статическим, а значение по умолчанию — 20, которое поддерживает 20 одновременных сеансов. Количество сеансов внешней среды выполнения, которые могут быть запущены одновременно, ограничено размером этого пула учетных записей пользователей. 

+ Имена рабочих учетных записей в пуле имеют формат SQLInstanceName*nn*. Например, в экземпляре по умолчанию **SQLRUserGroup** содержит учетные записи с именами MSSQLSERVER01, MSSQLSERVER02 и т. д. до MSSQLSERVER20.

Параллельные задачи не используют дополнительные учетные записи. Например, если пользователь запускает задачу оценки, которая использует параллельную обработку, то одна и та же Рабочая учетная запись повторно используется для всех потоков. Если вы планируете активно использовать машинное обучение, можно увеличить число учетных записей, используемых для выполнения внешних скриптов. Дополнительные сведения см. [в статье Изменение пула учетных записей пользователей для машинного обучения](../../advanced-analytics/administration/modify-user-account-pool.md).

::: moniker range=">=sql-server-ver15||=sqlallproducts-allversions"
### <a name="appcontainer-isolation-in-sql-server-2019"></a>Изоляция AppContainer в SQL Server 2019

В SQL Server 2019 программа установки больше не создает рабочие учетные записи для **SQLRUserGroup**. Вместо этого изоляция достигается через [аппконтаинерс](https://docs.microsoft.com/windows/desktop/secauthz/appcontainer-isolation). Во время выполнения при обнаружении внешнего скрипта в хранимой процедуре или запросе SQL Server вызывает панель запуска с запросом на выполнение модуля, зависящего от расширения. Панель запуска вызывает соответствующую среду выполнения в процессе с удостоверением и создает для него контейнер AppContainer. Это изменение выгодно, поскольку локальная учетная запись и управление паролями больше не требуются. Кроме того, при установке, в которой запрещены локальные учетные записи пользователей, при закрытии зависимости локальной учетной записи пользователя теперь можно использовать эту функцию.

Как реализовано SQL Server, Аппконтаинерс являются внутренним механизмом. Несмотря на то, что физическое свидетельство Аппконтаинерс в мониторе процессов не отображается, их можно найти в правилах брандмауэра для исходящих подключений, созданных программой установки, чтобы предотвратить выполнение процессов через сетевые вызовы. Дополнительные сведения см. в разделе [Настройка брандмауэра для SQL Server службы машинного обучения](../../advanced-analytics/security/firewall-configuration.md).

> [!Note]
> В SQL Server 2019 **SQLRUserGroup** имеет только один элемент, который теперь является единственной панель запуска SQL Server учетной записью службы, а не несколькими рабочими учетными записями.
::: moniker-end

### <a name="permissions-granted-to-sqlrusergroup"></a>Разрешения, предоставленные SQLRUserGroup

По умолчанию члены **SQLRUserGroup** имеют разрешения на чтение и выполнение для файлов в каталогах SQL Server **Binn**, **R_SERVICES**и **PYTHON_SERVICES** с доступом к исполняемым файлам, библиотекам и встроенным наборам данных в R и дистрибутивы Python, установленные с SQL Server. 

Чтобы защитить конфиденциальные ресурсы на SQL Server, можно дополнительно определить список управления доступом (ACL), который запрещает доступ к **SQLRUserGroup**. И наоборот, можно также предоставить разрешения на локальные ресурсы данных, которые существуют на главном компьютере, помимо SQL Server. 

По проекту **SQLRUserGroup** не имеет имени входа в базу данных или разрешений на доступ к данным. При определенных обстоятельствах может потребоваться создать имя входа, чтобы разрешить обратные соединения циклов, особенно если доверенное удостоверение Windows является вызывающим пользователем. Эта возможность называется [*подразумеваемой проверкой*](#implied-authentication)подлинности. Дополнительные сведения см. в разделе [Добавление SQLRUserGroup в качестве пользователя базы данных](../../advanced-analytics/security/create-a-login-for-sqlrusergroup.md).

## <a name="identity-mapping"></a>Сопоставление удостоверений

При запуске сеанса панель запуска сопоставляет удостоверение вызывающего пользователя с рабочей учетной записью. Сопоставление внешнего пользователя Windows или допустимого имени входа SQL с рабочей учетной записью допустимо только в течение времени существования хранимой процедуры SQL, которая выполняет внешний скрипт. Параллельные запросы, выполняемые с тем же именем входа, сопоставляются с той же рабочей учетной записью пользователя.

Во время выполнения панель запуска создает временные папки для хранения данных сеанса, удаляя их при завершении сеанса. Каталоги имеют ограничения доступа. Для R RLauncher выполняет эту задачу. Для Python Писонлаунчер выполняет эту задачу. Каждая отдельная Рабочая учетная запись ограничена собственной папкой и не может обращаться к файлам в папках, которые находятся над ее собственным уровнем. Однако Рабочая учетная запись может читать, записывать или удалять дочерние элементы в созданной рабочей папке сеанса. Если вы являетесь администратором компьютера, вы можете просмотреть каталоги, созданные для каждого процесса. Каждый каталог определяется собственным идентификатором GUID сеанса.

<a name="implied-authentication"></a>

## <a name="implied-authentication-loop-back-requests"></a>Неявная проверка подлинности (запросы обратного цикла)

*Подразумеваемая проверка* подлинности описывает поведение запросов на подключение, при котором внешние процессы, работающие в качестве рабочих учетных записей с низким уровнем привилегий, представляются в качестве доверенного удостоверения пользователя для SQL Server запросов данных или операций в цикле. Как понятие, подразумеваемая проверка подлинности уникальна для проверки подлинности Windows, в SQL Server строки подключения, указывающие доверенное соединение, в запросах, исходящих из внешних процессов, таких как скрипты R или Python. Иногда он также называется *циклом*.

Доверенные подключения работают из сценария R и Python, но только с дополнительной конфигурацией. В архитектуре расширяемости процессы R и Python выполняются под рабочими учетными записями, наследуя разрешения от родительского **SQLRUserGroup**. Если в строке подключения указано `Trusted_Connection=True`, то удостоверение рабочей учетной записи представляется в запросе на подключение, что неизвестно по умолчанию SQL Server.

Чтобы доверенные подключения были успешными, необходимо создать имя входа базы данных для **SQLRUserGroup**. После этого любое доверенное соединение от любого члена **SQLRUserGroup** имеет права входа для SQL Server. Пошаговые инструкции см. в разделе [Добавление SQLRUserGroup к имени входа базы данных](../../advanced-analytics/security/create-a-login-for-sqlrusergroup.md).

Доверенные соединения не являются наиболее широко используемыми формулировку запроса на подключение. Если в скрипте R или Python задано соединение, может оказаться более распространенным использование имени для входа SQL или полностью заданное имя пользователя и пароль, если соединение установлено с источником данных ODBC.

### <a name="how-implied-authentication-works-for-r-and-python-sessions"></a>Как действует подразумеваемая проверка подлинности для сеансов R и Python

На следующей схеме показано взаимодействие компонентов SQL Server с исполняющей средой R и как она выполняет подразумеваемую проверку подлинности для R.

![Подразумеваемая проверка подлинности для R](../security/media/implied-auth-rsql.png)

На следующей схеме показано взаимодействие компонентов SQL Server с средой выполнения Python и его неявная проверка подлинности для Python.

![Неявная проверка подлинности для Python](../security/media/implied-auth-python2.png)

## <a name="no-support-for-transparent-data-encryption-at-rest"></a>Отсутствие поддержки неактивных прозрачное шифрование данных

[Прозрачное шифрование данных (TDE)](../../relational-databases/security/encryption/transparent-data-encryption.md) не поддерживается для данных, отправляемых или получаемых из среды выполнения внешнего скрипта. Причина заключается в том, что внешний процесс (R или Python) выполняется вне SQL Server процесса. Таким образом, данные, используемые внешней средой выполнения, не защищаются функциями шифрования ядра СУБД. Это поведение отличается от любого другого клиента, работающего на SQL Server компьютере, который считывает данные из базы данных и создает копию.

Как следствие, TDE **не** применяется к данным, которые используются в скриптах R или Python, а также к сохраненным на диску данным или к любым сохраненным промежуточным результатам. Однако по-прежнему применяются другие типы шифрования, такие как шифрование Windows BitLocker или шифрование стороннего производителя, применяемое на уровне файла или папки.

В случае [Always encrypted](../../relational-databases/security/encryption/overview-of-key-management-for-always-encrypted.md)внешние среды выполнения не имеют доступа к ключам шифрования. Поэтому данные не могут быть отправлены в скрипты.

## <a name="next-steps"></a>Следующие шаги

В этой статье вы узнали о компонентах и модели взаимодействия архитектуры безопасности, встроенной в [платформу расширяемости](../../advanced-analytics/concepts/extensibility-framework.md). Ключевые моменты, описываемые в этой статье, включают назначение панели запуска, SQLRUserGroup и рабочих учетных записей, изоляцию процессов R и Python и сопоставление удостоверений пользователей с учетными записями рабочих ролей. 

В качестве следующего шага ознакомьтесь с инструкциями по [предоставлению разрешений](../../advanced-analytics/security/user-permission.md). Для серверов, использующих проверку подлинности Windows, следует также проверить [Добавление SQLRUserGroup к имени входа базы данных](../../advanced-analytics/security/create-a-login-for-sqlrusergroup.md) , чтобы узнать, когда требуется дополнительная настройка.