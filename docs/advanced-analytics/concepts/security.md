---
title: Общие сведения о безопасности для расширений R и Python — машинного обучения SQL Server
description: Общие сведения о безопасности инфраструктуры расширяемости в службах машинного обучения SQL Server. Безопасность для учетных записей входа и пользователя, службы панели запуска SQL Server, рабочих учетных записей, под управлением нескольких сценариев и разрешения для файлов.
ms.prod: sql
ms.technology: machine-learning
ms.date: 10/17/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
manager: cgronlun
ms.openlocfilehash: 1f19e3322b8aee78fdb5a76a29a719148cc6a0c7
ms.sourcegitcommit: 944af0f6b31bf07c861ddd4d7960eb7f018be06e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66454536"
---
# <a name="security-overview-for-the-extensibility-framework-in-sql-server-machine-learning-services"></a>Общие сведения о безопасности для инфраструктуры расширяемости в службах машинного обучения SQL Server

[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье описывается общая архитектура безопасности, используемый для интеграции SQL Server database engine и связанных компонентов с помощью платформы расширяемости. Он проверяет, защищаемые объекты, служб, удостоверение процесса и разрешения. Дополнительные сведения о ключевых понятиях и компонентах расширяемости в SQL Server, см. в разделе [архитектуру расширяемости в службах машинного обучения SQL Server](extensibility-framework.md)].

## <a name="securables-for-external-script"></a>Защищаемые объекты для внешних скриптов

Передачи внешний скрипт на языке R или Python в качестве входного параметра для [системной хранимой процедуры](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md) для этой цели, либо упаковывается в хранимую процедуру, которая определяется. Кроме того, возможно, моделей, которые хранятся в двоичном формате в таблицу базы данных, вызываемой в T-SQL и обученная [PREDICT](../../t-sql/queries/predict-transact-sql.md) функции.

Как сценарий предоставляется через существующие объекты схемы базы данных, хранимые процедуры и таблицы, существуют новые [защищаемые объекты](../../relational-databases/security/securables.md) для службы машинного обучения SQL Server.

Независимо от того, как вы используете скрипт, или они состоят из объекты базы данных будет создана и скорее всего, сохраняются, но новый тип объекта не введено для хранения скрипта. Таким образом возможность использования, создайте и сохраните базу данных объектов в значительной степени зависит разрешения базы данных, уже определен для пользователей.

<a name="permissions"></a>

## <a name="permissions"></a>Разрешения

Модель безопасности SQL Server данных имена входа базы данных и ролей расширение в скрипт R и Python. Для выполнения внешних скриптов, которые используют данные SQL Server или выполняющихся с SQL Server в качестве контекста вычисления требуется имя входа SQL Server или учетной записи пользователя Windows. Базы данных пользователей, имеющих разрешения на выполнение нерегламентированного запроса можно получить доступ к тех же данных из скрипта R или Python.

Определяет имя входа или учетной записи пользователя *субъекта безопасности*, кто может потребоваться несколько уровней доступа, в зависимости от требований внешнего скрипта:

+ Разрешение на доступ к базе данных, где включены внешних скриптов.
+ Разрешения на чтение данных из защищенных объектов, таких как таблицы.
+ Возможность записи новых данных в таблицу, например модели или результаты оценки.
+ Возможность создания новых объектов, таких как таблицы, хранимые процедуры, использующие внешних скриптов, или пользовательских функций, использующих R или Python задания.
+ Право установить новые пакеты на компьютере SQL Server, или использовать пакеты, предоставленные группе пользователей.

Каждый пользователь, запускающий внешний скрипт с помощью SQL Server в качестве контекста выполнения должны сопоставляться с пользователем в базе данных. Вместо того чтобы отдельно установить разрешения пользователя базы данных можно создать роли для управления наборами разрешений и назначить эти роли пользователей, а не по отдельности настроить разрешения.

Дополнительные сведения см. в разделе [предоставление пользователям разрешения на службы машинного обучения SQL Server](../../advanced-analytics/security/user-permission.md).

## <a name="permissions-when-using-an-external-client-tool"></a>Разрешения, при использовании средства внешнего клиента

Пользователей, использующих R или Python в средстве внешний клиент должен иметь их имени входа или учетной записи, сопоставлено с пользователем в базе данных, если им нужно запускать внешних скриптов в базе данных, или доступ к объектам базы данных и данных. Те же разрешения, требуются ли внешнего скрипта отправляется из удаленного клиента обработки и анализа или выполните с помощью T-SQL, хранимая процедура.

Например предположим, вы создали внешнего скрипта, который выполняется на локальном компьютере, что вы хотите запустить этот скрипт на сервере SQL Server. Для этого должны быть выполнены приведенные ниже условия.

+ База данных должна разрешать удаленные подключения.
+ Имя входа SQL или учетной записи Windows, которая использовалась для доступа к базе данных был добавлен к SQL Server на уровне экземпляра.
+ Имя входа SQL или пользователя Windows должна иметь разрешение на выполнение внешних скриптов. Обычно это разрешение может добавить только администратор базы данных.
+ Имя входа SQL или пользователь Windows должен быть добавлен в качестве пользователя с соответствующими разрешениями, в каждой базе данных, где внешний скрипт выполняет любой из этих операций:
  + Извлечение данных.
  + Запись или обновление данных.
  + Создание новых объектов, например таблиц или хранимых процедур.

После имени входа или учетной записи пользователя Windows был подготовлен и предоставления необходимых разрешений, можно запустить внешний скрипт на сервере SQL Server с помощью объекта источника данных в R или **revoscalepy** библиотеки на языке Python, или путем обращения к хранимому процедура, которая содержит внешний скрипт.

Каждый раз, когда внешний скрипт запускается из SQL Server, безопасности ядра СУБД получает контекст безопасности пользователя, который запустил задание, а также управляет сопоставлением пользователя или имени входа к защищаемым объектам.

Таким образом все внешних скриптов, которые инициируются из удаленного клиента необходимо указать данные имени входа или пользователя как часть строки подключения.

<a name="launchpad"></a>

## <a name="services-used-in-external-processing-launchpad"></a>Службы, используемые в звукозапись обрабатывалась (Launchpad)

Инфраструктура расширяемости добавляет одну новую службу NT для [список служб](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md#Service_Details) в установке SQL Server: [**Панель запуска SQL Server (MSSSQLSERVER)** ](extensibility-framework.md#launchpad).

Ядро СУБД использует службу панели запуска SQL Server для создания экземпляра в сеансе R или Python, как отдельный процесс. Процесс выполняется под учетной записью с низким уровнем прав; отличается от SQL Server, панель запуска самого и удостоверения пользователя, под которой был выполнен запрос хранимой процедуры или узла. Выполнение сценария в отдельном процессе, от имени учетной записи с низким уровнем прав, лежит в основе модели безопасности и изоляции для R и Python в SQL Server.

Помимо запуска внешних процессов, панель запуска также несет ответственность за отслеживанием удостоверения вызывающего пользователя и этот идентификатор работника с низким уровнем прав учетная запись, используемая для запуска процесса. В некоторых сценариях, где скрипт или код осуществляет обратный вызов SQL Server для данных и операций, панель запуска обычно смогут легко управлять передачи удостоверений. Скрипт, содержащий инструкции SELECT или вызов функции и другие программные объекты обычно выполняются успешно, если вызывающий пользователь имеет достаточные разрешения.

> [!NOTE]
> По умолчанию [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] настроен для запуска под **NT Service\MSSQLLaunchpad**, которой предоставлены все необходимые разрешения для выполнения внешних скриптов. Дополнительные сведения о настраиваемых параметрах см. в разделе [конфигурации службы панели запуска SQL Server](../security/sql-server-launchpad-service-account.md).

<a name="sqlrusergroup"></a>

## <a name="identities-used-in-processing-sqlrusergroup"></a>Удостоверения, используемые при обработке (SQLRUserGroup)

**SQLRUserGroup** создается программой установки SQL Server (SQL ограниченная группа пользователей) и содержит пул учетных записей пользователей с низким уровнем прав локального Windows. Когда требуется внешний процесс, панель запуска принимает доступную рабочую учетную запись и использует его для запуска процесса. В частности панель запуска активирует доступную рабочую учетную запись, сопоставляет его с удостоверением вызывающего пользователя и запускает сценарий с использованием учетной записи рабочего.

+ **SQLRUserGroup** связана с определенным экземпляром. Для каждого экземпляра, на компьютер, на котором работает обучения требуется отдельный пул рабочих учетных записей. Учетные записи не могут совместно использоваться разными экземплярами.

+ Размер пула учетных записей пользователей является статическим, и значение по умолчанию — 20, который поддерживает 20 одновременных сеансов. Размер этого пула учетных записей пользователей, ограничивается число сеансов внешней среды выполнения, которые могут запускаться одновременно. 

+ Имена рабочих учетных записей в пуле имеют формат SQLInstanceName*nn*. Например, для экземпляра по умолчанию **SQLRUserGroup** содержит учетные записи с именем MSSQLSERVER01, MSSQLSERVER02 и так далее вплоть до MSSQLSERVER20.

Распараллеленное задачи не используют дополнительные учетные записи. Например если пользователь запускает задачу оценки, которая использует параллельную обработку, одну и ту же учетную запись рабочей роли используется повторно для всех потоков. Если вы собираетесь активно использовать машинное обучение, можно увеличить количество учетных записей, используемых для выполнения внешних скриптов. Дополнительные сведения см. в разделе [изменение пула учетных записей пользователей для машинного обучения](../../advanced-analytics/administration/modify-user-account-pool.md).

::: moniker range=">=sql-server-ver15||=sqlallproducts-allversions"
### <a name="appcontainer-isolation-in-sql-server-2019"></a>Изоляция AppContainer в SQL Server 2019

В SQL Server 2019, программа установки больше не создает рабочих учетных записей для **SQLRUserGroup**. Вместо этого, изоляция достигается за счет [AppContainers](https://docs.microsoft.com/windows/desktop/secauthz/appcontainer-isolation). Во время выполнения, когда в хранимой процедуры или запроса обнаружен внешний скрипт, SQL Server вызывает панель запуска с помощью запроса, относящихся к модулю средства запуска. Панель запуска вызывает необходимой среды выполнения в процессе его удостоверением, а также создает экземпляр AppContainer для его размещения. Это изменение является полезным, поскольку локальную учетную запись и пароль больше не требуется. Кроме того в установках, где запрещены локальные учетные записи пользователей, устраняя зависимость учетной записи локального пользователя означает, что теперь вы можете использовать эту функцию.

Реализованное в SQL Server, AppContainers представляют собой внутренний механизм. Пока вы не увидите вещественных доказательств из AppContainers в Process Monitor, их можно найти в правилах брандмауэра для исходящего трафика, созданный программой установки, чтобы предотвратить внесение сетевых вызовов процессов. Дополнительные сведения см. в разделе [конфигурации брандмауэра для службы машинного обучения SQL Server](../../advanced-analytics/security/firewall-configuration.md).

> [!Note]
> В SQL Server 2019 **SQLRUserGroup** имеет только один член, который теперь является одной учетной записи службы панели запуска SQL Server вместо нескольких рабочих учетных записей.
::: moniker-end

### <a name="permissions-granted-to-sqlrusergroup"></a>Разрешения, предоставленные SQLRUserGroup

По умолчанию, члены **SQLRUserGroup** разрешения read и execute для файлов в SQL Server **Binn**, **R_SERVICES**, и **PYTHON_SERVICES** каталогов с доступом для исполняемых файлов, библиотек и встроенные наборы данных в дистрибутивах R и Python, установленная с SQL Server. 

Чтобы защитить конфиденциальные ресурсы на сервере SQL Server, при необходимости можно определить список управления доступом (ACL), которое запрещает доступ к **SQLRUserGroup**. И наоборот можно также предоставить разрешения для локальных данных ресурсов, которые существуют на главном компьютере, помимо SQL Server. 

По своей структуре **SQLRUserGroup** не имеет имени входа базы данных или разрешений на любые данные. В некоторых случаях может потребоваться создать имя входа для подключений на задней цикл, особенно если удостоверение Windows вызывающего пользователя. Эта функция называется [ *неявной проверки подлинности*](#implied-authentication). Дополнительные сведения см. в разделе [Добавление SQLRUserGroup в качестве пользователя базы данных](../../advanced-analytics/security/create-a-login-for-sqlrusergroup.md).

## <a name="identity-mapping"></a>Сопоставления удостоверений

При запуске сеанса, панель запуска сопоставляет удостоверения вызывающего пользователя с рабочей учетной записью. Сопоставление внешнего пользователя Windows или допустимого имени входа SQL с рабочей учетной записью является допустимым только в том случае, для времени существования SQL хранимой процедуры, которая выполняет внешний скрипт. Параллельные запросы, выполняемые с тем же именем входа, сопоставляются с той же рабочей учетной записью пользователя.

Во время выполнения панель запуска создает временные папки для хранения данных сеанса, удалять их, когда сеанс завершается. Каталоги имеют доступ только. Для R RLauncher выполняет эту задачу. Для Python PythonLauncher выполняет эту задачу. Каждая учетная запись отдельным рабочим предназначен только для его собственной папке и нет доступа к файлам в папках выше свой собственный уровень. Тем не менее рабочая учетная запись может чтения, записи или удаления дочерних элементов в сеансе рабочей папки, который был создан. Если вы являетесь администратором компьютера, вы можете просмотреть каталоги, созданные для каждого процесса. Каждый каталог определяется собственным идентификатором GUID сеанса.

<a name="implied-authentication"></a>

## <a name="implied-authentication-loop-back-requests"></a>Неявная проверка подлинности (цикл обратной запросов)

*Неявная проверка подлинности* описывает поведение запроса подключения, под которой внешних процессов, запущенных как работника с низким уровнем прав учетные записи указываются как доверенные удостоверения пользователей в SQL Server на цикл обратной запросы для данных или операций. В качестве концепции неявная проверка подлинности является уникальным для проверки подлинности Windows, в строках подключения SQL Server, задание доверительное соединение, для запросов, исходящих от внешних процессов, например, сценарий R или Python. Он также называется *в цикле*.

Доверенные соединения поддающейся из сценария R и Python, но только с помощью дополнительной настройки. В архитектуру расширяемости, R и Python процессы выполняются в группе рабочих учетных записей, наследование разрешений от родительского **SQLRUserGroup**. Если в строке соединения указывается `Trusted_Connection=True`, удостоверение учетной записи рабочего представлен на запрос на соединение и неизвестном по умолчанию для SQL Server.

Для успешного доверенные соединения, необходимо создать имя входа базы данных для **SQLRUserGroup**. После этого любой доверенное_соединение из любой член **SQLRUserGroup** есть права входа на SQL Server. Пошаговые инструкции см. в разделе [Добавление SQLRUserGroup для входа в базу данных](../../advanced-analytics/security/create-a-login-for-sqlrusergroup.md).

Доверенные соединения не являются наиболее широко используемых формулировку запроса на подключение. Когда скрипт R или Python указывает соединение, бывает чаще всего используется имя входа SQL, или пользователь полностью указанное имя и пароль, если подключение к источнику данных ODBC.

### <a name="how-implied-authentication-works-for-r-and-python-sessions"></a>Как подразумеваемой проверки подлинности работает для сеансов R и Python

На следующей схеме показано взаимодействие компонентов SQL Server со средой R и как работает неявная проверка подлинности для R.

![Неявная проверка подлинности для R](../security/media/implied-auth-rsql.png)

На следующей схеме показано взаимодействие компонентов SQL Server со средой Python, и как оно проделывает неявной проверки подлинности для Python.

![Неявная проверка подлинности для Python](../security/media/implied-auth-python2.png)

## <a name="no-support-for-transparent-data-encryption-at-rest"></a>Отсутствует поддержка прозрачного шифрования данных при хранении

[Прозрачное шифрование данных (TDE)](../../relational-databases/security/encryption/transparent-data-encryption.md) не поддерживается для данных, отправленных или полученных из среды выполнения внешнего скрипта. Причина в том, что внешний процесс (R или Python) выполняется вне процесса SQL Server. Таким образом данные, используемые внешней среды выполнения не защищен функции шифрования компонента database engine. Это поведение не отличается от любой другой клиент, запущенных на компьютере SQL Server, которая считывает данные из базы данных и создает копию.

Как следствие, прозрачное шифрование данных **не** применяется к данным, используемым в сценариях R или Python, или к любым данным, сохраненные на диске или сохраненным промежуточным результатам. Тем не менее, другие типы шифрования, такие как шифрование BitLocker для Windows или сторонних шифрования применяется на уровне файла или папки, по-прежнему применяются.

В случае использования [Always Encrypted](../../relational-databases/security/encryption/overview-of-key-management-for-always-encrypted.md), внешних сред выполнения не имеют доступа к ключам шифрования. Таким образом невозможно отправить данные в сценарии.

## <a name="next-steps"></a>Следующие шаги

В этой статье вы узнали, компоненты и модель взаимодействия архитектуры безопасности встроены в [extensibility framework](../../advanced-analytics/concepts/extensibility-framework.md). Ключевые моменты, описанные в этой статье включают назначение панели запуска, SQLRUserGroup и рабочие учетные записи, изоляция процессов R и Python и сопоставление удостоверений пользователей рабочих учетных записей. 

На следующем шаге, ознакомьтесь с инструкциями для [предоставление разрешений](../../advanced-analytics/security/user-permission.md). Для серверов, использующих проверку подлинности Windows, следует также просмотреть [Добавление SQLRUserGroup для входа в базу данных](../../advanced-analytics/security/create-a-login-for-sqlrusergroup.md) чтобы узнать, когда необходима дополнительная настройка.