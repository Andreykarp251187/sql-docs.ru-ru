---
title: Расширения языка - машинного обучения SQL Server программирования Python
description: Дополнительные сведения о выполнении кода Python и встроенных библиотек Python в службах машинного обучения SQL Server 2017.
ms.prod: sql
ms.technology: machine-learning
ms.date: 09/05/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: abf7028c8b55f4f97770586f2a678a538f01b29a
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "67963042"
---
# <a name="python-language-extension-in-sql-server"></a>Расширение языка Python в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Расширение Python является частью надстройки служб машинного обучения SQL Server к ядру реляционной СУБД. Он добавляет в среду выполнения Python, дистрибутив Anaconda, с помощью среды выполнения Python 3.5 и интерпретатора, стандартные библиотеки и средства и библиотеки продукта корпорации Майкрософт для Python: [revoscalepy](../python/ref-py-revoscalepy.md) для аналитики в масштабе и [microsoftml](../python/ref-py-microsoftml.md) для машинного обучения алгоритмов. 

Интеграция Python устанавливается как [службы машинного обучения SQL Server](../what-is-sql-server-machine-learning.md).

Установка среды выполнения Python 3.5 и интерпретатор обеспечивает практически полную совместимость с обычными средствами Python. Python выполняется в отдельном процессе с SQL Server, чтобы гарантировать, что операции базы данных не были скомпрометированы.

## <a name="python-components"></a>Компоненты Python

SQL Server включает в себя как открытый, так и закрытых пакетов. Среда выполнения Python, программа установки устанавливает — 4.2 Anaconda Python 3.5. Среда выполнения Python устанавливается независимо от средства SQL, а также выполняется за пределами ядра основные процессы, в структуре расширяемости. В процессе установки служб машинного обучения с помощью Python вы должны согласиться с условиями открытой лицензии GNU. 

SQL Server не изменяет исполняемые файлы Python, но необходимо использовать версию устанавливается программой установки, так как эта версия является то, что частные пакеты разработан и протестирован на Python. Список пакетов, поддерживаемый дистрибутив Anaconda см. в разделе на сайте Continuum analytics: [Список пакетов anaconda](https://docs.continuum.io/anaconda/packages/pkg-docs).

Дистрибутив Anaconda, связанная с экземпляром ядра конкретной базы данных можно найти в папке, связанной с экземпляром. Например, если вы установили ядро СУБД SQL Server 2017 с помощью служб машинного обучения и Python на экземпляре по умолчанию, найдите его в разделе `C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\PYTHON_SERVICES`.

Пакеты Python, добавлены корпорацией Майкрософт для параллельных и распределенных рабочих нагрузок включают перечисленные ниже библиотеки.

| Библиотека | Описание |
|---------|-------------|
| [**revoscalepy**](https://docs.microsoft.com/machine-learning-server/python-reference/revoscalepy/revoscalepy-package) | Поддерживает объекты источников данных и просмотр данных, обработки, преобразования и визуализации. Он поддерживает создание удаленных контекстов вычислений, а также различные масштабируемые модели машинного обучения, такие как **rxLinMod**. Дополнительные сведения см. в разделе [revoscalepy модуль с SQL Server](../python/ref-py-revoscalepy.md).  |
| [**microsoftml**](https://docs.microsoft.com/machine-learning-server/python-reference/microsoftml/microsoftml-package) | Содержит алгоритмы машинного обучения, которые оптимизированы для скорости и точности, а также преобразования, для работы с текстом и изображениями в строке. Дополнительные сведения см. в разделе [microsoftml модуль с SQL Server](../python/ref-py-microsoftml.md). |

Microsoftml и revoscalepy тесно связаны; Источники данных в microsoftml определяются как объекты revoscalepy. Вычислительные ограничения контекста в передачу revoscalepy в microsoftml. А именно все функциональные возможности доступны для локальных операций, но переключение контекста удаленных вычислений требует RxInSqlServer.

## <a name="using-python-in-sql-server"></a>С помощью Python в SQL Server

Импортом **revoscalepy** модуля в коде Python и затем вызывают функции из модуля, такие как любые другие функции Python.

Среди поддерживаемых источников данных ODBC баз данных SQL Server и формат файла XDF для обмена данными с другими источниками, или с помощью решений R. Входные данные для Python должен быть табличных. Все результаты Python должен возвращаться в виде **pandas** кадра данных.

Поддерживаемые контексты вычислений включают локальный или удаленный контекст вычислений SQL Server. Контекст удаленных вычислений ссылается на выполнение кода, который начинается на одном компьютере, такие как рабочая станция, но параметры скрипта для выполнения на удаленном компьютере. Переключение контекста вычислений требуется наличие одной и той же библиотеке revoscalepy обеих систем.

Локальный Контекст вычислений, как можно догадаться, включает в себя выполнение кода Python на одном сервере с экземпляром компонента database engine, с кодом в T-SQL или внедренных в хранимую процедуру. Можно также выполнить код из локального интегрированную среду разработки Python и сценарий выполнения на компьютере SQL Server, путем определения удаленного контекста вычислений.

## <a name="execution-architecture"></a>Архитектура выполнения

На следующей схеме показан взаимодействие компонентов SQL Server со средой выполнения Python в каждой из поддерживаемых сценариев: запуск скрипта в базе данных и удаленным выполнением из терминала Python, с помощью контекста вычислений SQL Server.

### <a name="python-scripts-executed-in-database"></a>Python скриптов, выполненных в базе данных

Когда вы запускаете Python «в» SQL Server, необходимо инкапсулировать скрипт Python в специальных хранимой процедуре, [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md).

После скрипт внедрен в хранимой процедуре, любое приложение, которое можно сделать вызов хранимой процедуры можно инициировать выполнение кода Python.  После этого SQL Server управляет выполнение кода, как показано на следующей схеме.

![скрипт в db-python](../../advanced-analytics/python/media/script-in-db-python2.png)

1. Запрос для среды выполнения Python, указанную параметром `@language='Python'` передается хранимой процедуре. SQL Server отправляет этот запрос в службу панели запуска.
2. Служба панели запуска запускает соответствующее средство запуска; в этом случае PythonLauncher.
3. PythonLauncher запускает внешний процесс Python35.
4. BxlServer координирует со средой выполнения Python для управления обменом данными между и хранилищем результатов работы.
5. Вспомогательное соединение SQL контролирует взаимодействие связанных задач и процессов с помощью SQL Server.
6. BxlServer использует вспомогательное соединение SQL для взаимодействия, состояние и результаты в SQL Server.
7. SQL Server получает результаты и закрывает связанные задачи и процессы.

### <a name="python-scripts-executed-from-a-remote-client"></a>Python скрипты, выполняемые из удаленного клиента

Можно выполнять сценарии Python с удаленного компьютера, например на ноутбуке и выполнять их в контексте компьютера SQl Server, при соблюдении этих условий:

+ Соответствующим образом разработке сценариев
+ Удаленный компьютер установил расширяемость библиотеки, в которых используются службы машинного обучения. [Revoscalepy](../python/ref-py-revoscalepy.md) пакет необходим для использования удаленных контекстов вычислений.

На следующей схеме показаны общий рабочий процесс, при отправке скриптов с удаленного компьютера.

![удаленное sqlcc из python](../../advanced-analytics/python/media/remote-sqlcc-from-python3.png)

1. Для функций, которые поддерживаются в **revoscalepy**, среда выполнения Python вызывает связующую функцию, которая, в свою очередь, вызывает BxlServer.
2. BxlServer входит в состав службы машинного обучения (в базе данных) и выполняется в отдельном процессе от среды выполнения Python.
3. BxlServer определяет целевой объект соединения и инициирует подключение с помощью ODBC, передавая учетные данные, поставляемые как часть строки подключения в сценарий Python.
4. BxlServer устанавливает подключение к экземпляру SQL Server.
5. При вызове среды выполнения внешнего скрипта вызывается служба панели запуска, которая, в свою очередь, запускает соответствующее средство запуска: в данном случае PythonLauncher.dll. После этого кода Python, обрабатываются в рабочем процессе аналогичны при вызове кода Python из хранимой процедуры в T-SQL.
6. PythonLauncher делает вызов к экземпляру Python, установленной на компьютере с SQL Server.
7. Результаты возвращаются в BxlServer.
8. Вспомогательное соединение SQL управляет взаимодействием с SQL Server и очистки связанных объектов задания.
9. SQL Server передает результаты клиенту.

## <a name="see-also"></a>См. также

+ [модуль revoscalepy в SQL Server](../python/ref-py-revoscalepy.md)
+ [Справочник по функциям revoscalepy](https://docs.microsoft.com/r-server/python-reference/revoscalepy/revoscalepy-package) 
+ [Extensibility framework в SQL Server](extensibility-framework.md)
+ [R и машинного обучения расширений в SQL Server](extension-r.md)