---
title: Расширение языка программирования Python
description: Сведения о выполнении кода Python и встроенных библиотеках Python в SQL Server 2017 Службы машинного обучения.
ms.prod: sql
ms.technology: machine-learning
ms.date: 09/05/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: f85392f8bfbb7ee89b8387b0f7d27038b9a8303b
ms.sourcegitcommit: 9062c5e97c4e4af0bbe5be6637cc3872cd1b2320
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2019
ms.locfileid: "68470467"
---
# <a name="python-language-extension-in-sql-server"></a>Расширение языка Python в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

Расширение Python входит в состав SQL Server Службы машинного обучения надстройки для ядра реляционной базы данных. Она добавляет среду выполнения Python, Anaconda распространение с помощью среды выполнения и интерпретатора Python 3,5, стандартных библиотек и средств, а также библиотек продуктов Майкрософт для Python: [revoscalepy](../python/ref-py-revoscalepy.md) для аналитики в масштабе и [microsoftml](../python/ref-py-microsoftml.md) для алгоритмы машинного обучения. 

Интеграция Python устанавливается как [SQL Server службы машинного обучения](../what-is-sql-server-machine-learning.md).

Установка среды выполнения и интерпретатора Python 3,5 гарантирует почти полную совместимость со стандартными решениями Python. Python выполняется в отдельном процессе от SQL Server, чтобы гарантировать, что операции с базой данных не будут скомпрометированы.

## <a name="python-components"></a>Компоненты Python

SQL Server содержит пакеты с открытым исходным кодом и частные. Среда выполнения Python, установленная программой установки, — Anaconda 4,2 с Python 3,5. Среда выполнения Python устанавливается независимо от средств SQL и выполняется вне базовых процессов ядра в платформе расширяемости. В процессе установки Службы машинного обучения с помощью Python необходимо согласиться с условиями публичной лицензии GNU. 

SQL Server не изменяет исполняемые файлы Python, но необходимо использовать версию Python, установленную программой установки, так как эта версия является той, на которой создаются и тестируются частные пакеты. Список пакетов, поддерживаемых дистрибутивом Anaconda, см. на сайте аналитики Continuum: [Список пакетов Anaconda](https://docs.continuum.io/anaconda/packages/pkg-docs).

Распределение Anaconda, связанное с конкретным экземпляром ядра СУБД, можно найти в папке, связанной с экземпляром. Например, если вы установили ядро СУБД SQL Server 2017 с Службы машинного обучения и Python на экземпляре по умолчанию, `C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\PYTHON_SERVICES`найдите в разделе.

Пакеты Python, добавленные корпорацией Майкрософт для параллельных и распределенных рабочих нагрузок, включают следующие библиотеки.

| Библиотека | Описание |
|---------|-------------|
| [**revoscalepy**](https://docs.microsoft.com/machine-learning-server/python-reference/revoscalepy/revoscalepy-package) | Поддерживает объекты источников данных и просмотр данных, обработку, преобразование и визуализацию. Она поддерживает создание контекстов удаленного вычислений, а также различных масштабируемых моделей машинного обучения, таких как **rxLinMod**. Дополнительные сведения см. [в разделе Модуль revoscalepy с SQL Server](../python/ref-py-revoscalepy.md).  |
| [**microsoftml**](https://docs.microsoft.com/machine-learning-server/python-reference/microsoftml/microsoftml-package) | Содержит алгоритмы машинного обучения, оптимизированные для скорости и точности, а также встроенные преобразования для работы с текстом и изображениями. Дополнительные сведения см. [в разделе Модуль microsoftml с SQL Server](../python/ref-py-microsoftml.md). |

Microsoftml и revoscalepy тесно связаны. источники данных, используемые в microsoftml, определяются как объекты revoscalepy. Ограничения контекста вычислений в revoscalepy, передаваемые в microsoftml. А именно, все функции доступны для локальных операций, но для переключения на удаленный контекст вычислений требуется RxInSqlServer.

## <a name="using-python-in-sql-server"></a>Использование Python в SQL Server

Модуль **revoscalepy** импортируется в код Python, а затем вызывайте функции из модуля, как и любые другие функции Python.

К поддерживаемым источникам данных относятся базы данных ODBC, SQL Server и формат файлов Xdf-для обмена данными с другими источниками или с решениями R. Входные данные для Python должны быть табличными. Все результаты Python должны возвращаться в виде кадра данных **Pandas** .

Поддерживаемые контексты вычислений включают в себя локальный или удаленный SQL Server контексте вычислений. Удаленный контекст вычислений относится к выполнению кода, который начинается на одном компьютере, например на рабочей станции, но затем переключается на удаленный компьютер. Для переключения контекста вычислений требуется, чтобы обе системы имели одну и ту же библиотеку revoscalepy.

Локальный контекст вычислений, как можно было бы ожидать, включает выполнение кода Python на том же сервере, что и экземпляр ядра СУБД, с кодом внутри T-SQL или внедренным в хранимую процедуру. Можно также запустить код из локальной среды IDE Python и выполнить сценарий на SQL Server компьютере, определив контекст удаленного вычислений.

## <a name="execution-architecture"></a>Архитектура выполнения

На следующих схемах показано взаимодействие компонентов SQL Server с средой выполнения Python в каждом из поддерживаемых сценариев: выполнение сценария в базе данных и удаленное выполнение из терминала Python с использованием контекста вычислений SQL Server.

### <a name="python-scripts-executed-in-database"></a>Сценарии Python, выполняемые в базе данных

При запуске Python "Inside" SQL Server необходимо инкапсулировать скрипт Python в специальную хранимую процедуру [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md).

После внедрения скрипта в хранимую процедуру любое приложение, которое может сделать вызов хранимой процедуры, может инициировать выполнение кода Python.  После этого SQL Server управляет выполнением кода, как показано на следующей схеме.

![Скрипт — in-DB-Python](../../advanced-analytics/python/media/script-in-db-python2.png)

1. Запрос к среде выполнения Python указывается параметром `@language='Python'` , передаваемым в хранимую процедуру. SQL Server отправляет этот запрос в службу панели запуска.
2. Служба панели запуска запускает соответствующее средство запуска; в данном случае это Писонлаунчер.
3. Писонлаунчер запускает внешний процесс Python35.
4. BxlServer координирует работу с средой выполнения Python для управления обменом данными и хранения результатов работы.
5. Вспомогательная лицензия SQL управляет связью связанных задач и процессов с SQL Server.
6. BxlServer использует вспомогательную лицензию SQL для передачи состояния и результатов в SQL Server.
7. SQL Server получает результаты и закрывает связанные задачи и процессы.

### <a name="python-scripts-executed-from-a-remote-client"></a>Скрипты Python, выполняемые с удаленного клиента

Сценарии Python можно запускать с удаленного компьютера, например с ноутбука, и выполнять их в контексте компьютера SQl Server, если выполняются следующие условия.

+ Вы разрабатываете сценарии соответствующим образом.
+ На удаленном компьютере установлены библиотеки расширяемости, используемые Службы машинного обучения. Для использования удаленных контекстов вычислений требуется пакет [revoscalepy](../python/ref-py-revoscalepy.md) .

Следующая диаграмма обобщает общий рабочий процесс при отправке сценариев с удаленного компьютера.

![Remote-sqlcc-from-Python](../../advanced-analytics/python/media/remote-sqlcc-from-python3.png)

1. Для функций, поддерживаемых в **revoscalepy**, среда выполнения Python вызывает функцию связывания, которая, в свою очередь, вызывает BxlServer.
2. BxlServer входит в состав Службы машинного обучения (в базе данных) и выполняется в отдельном процессе из среды выполнения Python.
3. BxlServer определяет целевой объект подключения и инициирует подключение с помощью ODBC, передавая учетные данные, передаваемые в качестве части строки подключения в скрипте Python.
4. BxlServer открывает подключение к экземпляру SQL Server.
5. При вызове среды выполнения внешнего скрипта вызывается служба панели запуска, которая, в свою очередь, запускает подходящее средство. в данном случае это Писонлаунчер. dll. После этого обработка кода Python обрабатывается в рабочем процессе аналогично тому, как при вызове кода Python из хранимой процедуры в T-SQL.
6. Писонлаунчер вызывает экземпляр Python, установленный на компьютере SQL Server.
7. Результаты возвращаются в BxlServer.
8. Вспомогательная программа SQL управляет связью с SQL Server и очисткой связанных объектов заданий.
9. SQL Server передает результаты обратно клиенту.

## <a name="see-also"></a>См. также

+ [модуль revoscalepy в SQL Server](../python/ref-py-revoscalepy.md)
+ [Справочник по функциям revoscalepy](https://docs.microsoft.com/r-server/python-reference/revoscalepy/revoscalepy-package) 
+ [Инфраструктура расширяемости в SQL Server](extensibility-framework.md)
+ [Расширения R и машинного обучения в SQL Server](extension-r.md)