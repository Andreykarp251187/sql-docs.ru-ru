---
title: Создание SQL Serverных объектов данных с помощью RxSqlServerData RevoScaleR
description: Пошаговое руководство по созданию объектов данных с помощью языка R на SQL Server.
ms.prod: sql
ms.technology: machine-learning
ms.date: 11/26/2018
ms.topic: tutorial
author: dphansen
ms.author: davidph
ms.openlocfilehash: f78087e226f41c53555cf3356705f8b84a185392
ms.sourcegitcommit: c1382268152585aa77688162d2286798fd8a06bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/19/2019
ms.locfileid: "68344703"
---
# <a name="create-sql-server-data-objects-using-rxsqlserverdata-sql-server-and-revoscaler-tutorial"></a>Создание SQL Serverных объектов данных с помощью RxSqlServerData (учебник по SQL Server и RevoScaleR)
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Это занятие является частью [учебника RevoScaleR](deepdive-data-science-deep-dive-using-the-revoscaler-packages.md) по использованию [функций RevoScaleR](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler) с SQL Server.

Урок 2 — это продолжение создания базы данных: Добавление таблиц и загрузка данных. Если администратор базы данных создал ее и имя входа на [одном занятии](deepdive-work-with-sql-server-data-using-r.md), можно добавить таблицы с помощью R IDE, например RStudio, или встроенного средства, такого как **RGUI**.

Из R подключитесь к SQL Server и используйте функции **RevoScaleR** для выполнения задач следующие аспекты:

> [!div class="checklist"]
> * Создание таблиц для обучающих данных и прогнозов
> * Загрузка таблиц с данными из локального CSV-файла

Демонстрационные данные моделируют данные о мошенничестве с кредитными картами (набор данных ccFraud), которые разделены на обучающие и оценочные наборы данных. Файл данных включен в **RevoScaleR**.

Используйте R IDE или **RGUI** для выполнения этих такс. Не забудьте использовать исполняемые файлы R, найденные в этом расположении: C:\Program Филес\микрософт\р Client\R_SERVER\bin\x64 (либо RGUI. exe, если вы используете это средство, либо R IDE, указывающий на C:\Program Филес\микрософт\р Client\R_SERVER). Наличие [клиентской рабочей станции R](../r/set-up-a-data-science-client.md) с этими исполняемыми файлами считается необходимым условием этого учебника.

## <a name="create-the-training-data-table"></a>Создание таблицы обучающих данных

1. Сохраните строку подключения к базе данных в переменной R. Ниже приведены два примера допустимых строк подключения ODBC для SQL Server: один с использованием имени входа SQL и один для встроенной проверки подлинности Windows. 

   Не забудьте изменить имя сервера, имя пользователя и пароль соответствующим образом.

    **Имя входа SQL**
    ```R
    sqlConnString <- "Driver=SQL Server;Server=<server-name>; Database=RevoDeepDive;Uid=<user_name>;Pwd=<password>"
    ```

    **Проверка подлинности Windows**
    ```R
    sqlConnString <- "Driver=SQL Server;Server=<server-name>;Database=RevoDeepDive;Trusted_Connection=True"
    ```

2. Укажите имя таблицы, которую нужно создать, и сохраните его в переменной R.
  
    ```R
    sqlFraudTable <- "ccFraudSmall"
    ```
  
    Поскольку экземпляр сервера и имя базы данных уже указаны как часть строки подключения, при объединении этих двух переменных *полное имя новой* таблицы превращается в *экземпляр. Database. Schema. ccFraudSmall*.
  
3.  При необходимости укажите *rowsPerRead* , чтобы управлять количеством строк данных, считываемых в каждом пакете.
  
    ```R
    sqlRowsPerRead = 5000
    ```
  
    Хотя этот параметр является необязательным, его установка может привести к более эффективным вычислениям. Большая часть расширенных аналитических функций в **RevoScaleR** и **MicrosoftML** обрабатывает данные в виде фрагментов. Параметр *rowsPerRead* определяет количество строк в каждом фрагменте.
  
    Возможно, потребуется поэкспериментировать с этим параметром, чтобы найти правильный баланс. Если значение слишком велико, доступ к данным может оказаться слишком большим, если недостаточно памяти для обработки данных в блоках такого размера. И наоборот, в некоторых системах, если значение *rowsPerRead* слишком мало, производительность также может замедлиться.
  
    В качестве начального значения используйте размер пакетной обработки по умолчанию, определенный экземпляром ядра СУБД, для управления количеством строк в каждом фрагменте (5 000 строк). Сохраните это значение в переменной *склровсперреад*.
  
4.  Определите переменную для нового объекта источника данных и передайте аргументы, определенные ранее, в конструктор **RxSqlServerData** . Обратите внимание, что при этом происходит только создание, но не заполнение объекта источника данных. Загрузка данных — это отдельный шаг.
  
    ```R
    sqlFraudDS <- RxSqlServerData(connectionString = sqlConnString,
       table = sqlFraudTable,
       rowsPerRead = sqlRowsPerRead)
    ```

## <a name="create-the-scoring-data-table"></a>Создание таблицы данных оценки

Используя те же действия, создайте таблицу, содержащую данные оценки, с помощью того же процесса.

1. Создайте переменную R *sqlScoreTable*для хранения имени таблицы, используемой для оценки.
  
    ```R
    sqlScoreTable <- "ccFraudScoreSmall"
    ```
  
2. Передайте эту переменную в качестве аргумента в функцию **RxSqlServerData** , чтобы определить еще один объект источника данных *sqlScoreDS*.
  
    ```R
    sqlScoreDS <- RxSqlServerData(connectionString = sqlConnString,
       table = sqlScoreTable, rowsPerRead = sqlRowsPerRead)
    ```

Так как вы уже определили строку подключения и другие параметры в качестве переменных в рабочей области R, ее можно повторно использовать для новых источников данных, представляющих различные таблицы, представления или запросы.

> [!NOTE]
> Функция использует различные аргументы для определения источника данных на основе всей таблицы, чем для источника данных на основе запроса. Это обусловлено тем, что ядро СУБД SQL Server должно по-разному подготавливать запросы. Далее в этом руководстве вы узнаете, как создать объект источника данных на основе SQL-запроса.

## <a name="load-data-into-sql-tables-using-r"></a>Загрузка данных в таблицы SQL с помощью языка R

Теперь, когда вы создали таблицы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , можете загрузить в них данные с помощью соответствующей функции **Rx** .

Пакет **RevoScaleR** содержит функции, относящиеся к типам источников данных. Для текстовых данных используйте [функцию rxtextdata](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxtextdata) для создания объекта источника данных. Имеются также дополнительные функции для создания объектов источников данных на основе Hadoop, ODBC и других типов данных.

> [!NOTE]
> Для этого раздела необходимо иметь разрешения на **выполнение DDL** для базы данных.

### <a name="load-data-into-the-training-table"></a>Загрузка данных в таблицу обучения

1. Создайте переменную R *ccFraudCsv*и присвойте переменной путь к файлу CSV, содержащему образец данных. Этот набор данных предоставляется в **RevoScaleR**. "Сампледатадир" — это ключевое слово в функции **rxGetOption** .
  
    ```R
    ccFraudCsv <- file.path(rxGetOption("sampleDataDir"), "ccFraudSmall.csv")
    ```
  
    Обратите внимание на вызов **rxGetOption**, который является методом GET, связанным с [рксоптионс](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxoptions) в **RevoScaleR**. Используйте эту служебную программу для задания и перечисления параметров, относящихся к локальным и удаленным контекстам вычисления, например к общему каталогу по умолчанию или количеству процессоров (ядер), используемых в вычислениях.
    
    Этот конкретный вызов получает образцы из правильной библиотеки независимо от того, где выполняется код. Например, запустите функцию на сервере SQL Server и на компьютере разработчика и посмотрите различия.
  
2. Определите переменную для хранения новых данных и используйте функцию **RxTextData** , чтобы указать источник текстовых данных.
  
    ```R
    inTextData <- RxTextData(file = ccFraudCsv,      colClasses = c(
        "custID" = "integer", "gender" = "integer", "state" = "integer",
        "cardholder" = "integer", "balance" = "integer",
        "numTrans" = "integer",
        "numIntlTrans" = "integer", "creditLine" = "integer",
        "fraudRisk" = "integer"))
    ```
  
    Аргумент *colClasses* важен. С его помощью указывается тип данных, который назначается каждому столбцу данных, загружаемому из текстового файла. В этом примере все столбцы обрабатываются как текстовые, кроме именованных столбцов, которые обрабатываются как целочисленные.
  
3. На этом этапе может потребоваться приостановка и просмотр базы данных в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. Обновите список таблиц в базе данных.
  
    Вы видите, что, хотя объекты данных R были созданы в локальной рабочей области, таблицы не были созданы в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] базе данных. Кроме того, данные из текстового файла не загружаются в переменную R.
  
4. Вставьте данные, вызвав функцию [rxDataStep](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxdatastep) .
  
    ```R
    rxDataStep(inData = inTextData, outFile = sqlFraudDS, overwrite = TRUE)
    ```
    
    При отсутствии проблем со строкой подключения после небольшой паузы должны появиться результаты наподобие следующих:
  
    *Всего строк записано: 10000, общее время:*  0,466*строк считано: 10000, всего обработано строк: 10000, общее время фрагмента: 0,577 секунд*
  
5. Обновите список таблиц. Чтобы убедиться, что каждая переменная имеет правильные типы данных и была успешно импортирована, можно также щелкнуть правой кнопкой мыши таблицу в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] и выбрать **пункт выбрать первые 1000 строк**.

### <a name="load-data-into-the-scoring-table"></a>Загрузка данных в таблицу оценки

1. Повторите шаги, чтобы загрузить набор данных, используемый для оценки в базе данных.
  
    Сначала укажите путь к исходному файлу.
  
    ```R
    ccScoreCsv <- file.path(rxGetOption("sampleDataDir"), "ccFraudScoreSmall.csv")
    ```
  
2. Используйте функцию **RxTextData** , чтобы получить данные и сохранить их в переменной *inTextData*.
  
    ```R
    inTextData <- RxTextData(file = ccScoreCsv,      colClasses = c(
        "custID" = "integer", "gender" = "integer", "state" = "integer",
        "cardholder" = "integer", "balance" = "integer",
        "numTrans" = "integer",
        "numIntlTrans" = "integer", "creditLine" = "integer"))
    ```
  
3.  Вызовите функцию **rxDataStep** , чтобы перезаписать текущую таблицу, используя новую схему и данные.
  
    ```R
    rxDataStep(inData = inTextData, sqlScoreDS, overwrite = TRUE)
    ```
  
    - Аргумент *inData* определяет используемый источник данных.
  
    - Аргумент *outFile* определяет таблицу в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , в которой нужно сохранить данные.
  
    - Если таблица уже существует и не используется параметр перезаписи  , то результаты вставляются без усечения.
  
Если соединение установлено успешно, вы увидите сообщение, информирующее о завершении и указывающее время, необходимое для записи данных в таблицу:

*Всего строк записано: 10000, общее время: 0,384*
строксчитано *: 10000, всего обработано строк: 10000, общее время фрагмента: 0,456 секунд*

## <a name="more-about-rxdatastep"></a>Дополнительные сведения о функции rxDataStep

[rxDataStep](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxdatastep) — это мощная функция, которая может выполнять несколько преобразований в кадре данных R. RxDataStep можно также использовать для преобразования данных в представление, необходимое для назначения. в этом случае — [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].

При необходимости можно указать преобразования данных с помощью функций R в аргументах **rxDataStep**. Примеры этих операций приведены далее в этом руководстве.

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Запрос и изменение данных SQL Server](../../advanced-analytics/tutorials/deepdive-query-and-modify-the-sql-server-data.md)