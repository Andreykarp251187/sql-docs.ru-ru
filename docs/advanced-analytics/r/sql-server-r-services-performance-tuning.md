---
title: Настройка производительности служб R SQL Server
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 9d6dbc55281a725dea0373f2a4d61293b2ddb9c0
ms.sourcegitcommit: 9062c5e97c4e4af0bbe5be6637cc3872cd1b2320
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2019
ms.locfileid: "68469935"
---
# <a name="performance-tuning-for-r-in-sql-server"></a>Настройка производительности для R в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

Эта статья является первой в серии из четырех статей, описывающих оптимизацию производительности для служб R, на основе двух примеров.

- Тесты производительности, проводимые группой разработки продукта для проверки профиля производительности решений R

- Оптимизация производительности группой обработки и анализа данных Майкрософт для конкретного сценария машинного обучения, который часто запрашивается клиентами.

Цель этой серии — предоставить рекомендации по типам методов настройки производительности, которые наиболее полезны для выполнения заданий R в SQL Server.

+ В этом разделе приводится обзор архитектуры и некоторые распространенные проблемы при оптимизации для задач обработки и анализа данных.
+ Во второй статье рассматриваются определенные оптимизации оборудования и SQL Server.
+ В третьей статье рассматривается оптимизация кода R и ресурсов для их эксплуатации.
+ В четвертой статье подробно описываются методы теста и выводятся отчеты о полученных и выводах.

**Применимо к:** SQL Server 2016 служб R SQL Server 2017 Службы машинного обучения

## <a name="performance-goals-and-targeted-scenarios"></a>Цели и целевые сценарии производительности

Функция R Services появилась в SQL Server 2016 для поддержки выполнения скриптов R с SQL Server. При использовании этой функции среда выполнения R работает в отдельном процессе из ядра СУБД, но обеспечивает безопасный обмен данными с ядром СУБД, используя ресурсы сервера и службы, которые взаимодействуют с SQL Server, например с доверенной панелью запуска.

В SQL Server 2017 поддержка была объявлена для выполнения сценариев Python с использованием той же архитектуры, с дополнительным языком для дальнейших действий.

По мере роста количества поддерживаемых версий и языка важно, чтобы администратор базы данных и архитектор базы данных знал о потенциальных состязаниях за ресурсы из-за заданий машинного обучения и что они могут настроить сервер для поддержки новые рабочие нагрузки. Несмотря на то, что аналитика близко к данным устраняет небезопасные перемещения данных, она также перемещает аналитические рабочие нагрузки за пределы ноутбука анализу данных и обратно на сервер, на котором размещены данные.

Оптимизация производительности для машинного обучения явным образом не подходит для всего одного размера. Следующие стандартные задачи могут иметь очень разные профили производительности.

- Обучающие задачи: создание и обучение модели регрессии или обучение нейронной сети
- Проектирование характеристик с использованием R и извлечения компонентов с помощью T-SQL
- Оценка количества отдельных строк или небольших пакетов, сравнение массовой оценки с помощью табличных входных данных
- Выполнение оценки в R и развертывание моделей в рабочей среде на SQL Server в хранимых процедурах
- Изменение кода R для снижения объема передаваемых данных или удаления дорогостоящих преобразований данных
- Включение автоматического тестирования и повторного обучения моделей

Поскольку выбор методов оптимизации зависит от того, какая задача является критической для вашего приложения или варианта использования, примеры внедрения охватывают как общие советы по производительности, так и рекомендации по оптимизации для конкретного сценария, а также оптимизации пакетной оценки.

+ **Индивидуальные параметры оптимизации в SQL Server**

    В первом практическом примере производительности несколько тестов выполнялись на одном наборе данных с использованием модели одного типа. Алгоритм rxLinMod в RevoscaleR использовался для создания модели и формирования оценок из него, но код и базовые таблицы данных были систематически изменены для проверки влияния каждого изменения.

    Например, в одном тестовом запуске код R был изменен, чтобы сравнение было выполнено между проектированием признаков с помощью функции преобразования и предварительным вычислением функций и последующей загрузкой функций из таблицы. В другом тестовом запуске в связи с использованием стандартной индексированной таблицы и данных в таблице с различными типами сжатия или новыми типами индексов было выполнено сравнение эффективности обучения модели.

+ **Оптимизация для конкретного сценария оценки больших объемов**

    Задача машинного обучения во втором практическом примере включает обработку множества резюме, отправленных для нескольких позиций, и поиск лучшего кандидата для каждой позиции задания. Сама модель машинного обучения определяется как проблема с двоичной классификацией: она принимает описание возобновления и задания в качестве входных данных и создает вероятность для каждой пары возобновляемых заданий. Поскольку целью является поиск наилучшего соответствия, для дальнейшей фильтрации и получения только удачных совпадений используется пороговое значение вероятности, определяемое пользователем.

    Для этого решения основной целью было достижение низкой задержки во время оценки. Однако эта задача является дорогостоящей даже в процессе оценки, так как каждое новое задание должно быть сопоставлено миллионам резюме в течение разумного интервала времени. Более того, этап проектирования признаков позволяет получить более 2000 функций для каждого возобновления или задания, и это значительно узкое место в производительности.

Мы рекомендуем просмотреть все результаты из первого примера, чтобы определить, какие методы применимы к решению, и оценить их потенциальное влияние.

Затем просмотрите результаты примера оптимизации оценки, чтобы увидеть, как автор применил различные методы и оптимизирует сервер для поддержки определенной рабочей нагрузки.

## <a name="performance-optimization-process"></a>Процесс оптимизации производительности

Для настройки и настройки производительности необходимо создать твердую базу, на основе которой можно оптимизировать слои для конкретных рабочих нагрузок.

- Выберите подходящий сервер для размещения аналитики. Как правило, предпочтительнее использовать вторичный, хранилище данных или другой сервер отчетов, который уже используется для других отчетов или аналитики. Однако в гибридном решении для обработки транзакций (HTAP) операционные данные можно использовать в качестве входных данных R для быстрой оценки.

- Настройте экземпляр SQL Server для балансировки операций ядра СУБД, выполнения скриптов R или Python на соответствующих уровнях. Это может быть изменение SQL Server значений по умолчанию для использования памяти и ЦП, параметров NUMA и соответствия процессоров, а также создания групп ресурсов.

- Оптимизируйте серверный компьютер для поддержки эффективного использования внешних скриптов. Это может включать увеличение количества учетных записей, используемых для выполнения внешних скриптов, включение управления пакетами и назначение пользователей связанным ролям безопасности.

- Применение оптимизаций, относящихся к хранению и переносу данных, в SQL Server, включая стратегии индексирования и статистики, оптимизацию проектирования запросов и запросов, а также структуру таблиц, используемых для машинного обучения. Вы также можете проанализировать источники данных и методы передачи данных или изменить процессы ETL, чтобы оптимизировать извлечение компонентов.

- Настройте аналитическую модель, чтобы избежать неэффективности. Объем возможных оптимизаций зависит от сложности кода R и используемых пакетов и данных. Основные задачи включают устранение дорогостоящих преобразований данных или разгрузка подготовки данных или задач проектирования признаков из R или Python в процессы ETL или SQL. Вы также можете выполнить рефакторинг сценариев, исключить встроенные установки пакетов, разделить код R на отдельные процедуры для обучения, оценки и оценки или упростить код для более эффективной работы в качестве хранимой процедуры.

## <a name="articles-in-this-series"></a>Статьи в этой серии

+ [Настройка производительности R в SQL Server — оборудование](../r/sql-server-configuration-r-services.md)

    Содержит рекомендации по настройке оборудования [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] , установленного на, а также по настройке экземпляра SQL Server для лучшей поддержки внешних скриптов. Это особенно удобно для **администраторов баз данных**.

+ [Настройка производительности для R в SQL Server — код и оптимизация данных](../r/r-and-data-optimization-r-services.md)

    Предоставляет конкретные советы по оптимизации внешнего сценария во избежание известных проблем. Он наиболее удобен для специалистов по обработке и анализу **данных**.

    > [!NOTE]
    > Хотя большая часть информации в этом разделе применяется к R в целом, некоторые сведения относятся к RevoScaleR аналитическим функциям. Подробное руководство по производительности недоступно для **revoscalepy** и других поддерживаемых библиотек Python.
    >

+ [Настройка производительности для R в SQL Server методы и результаты](../r/performance-case-study-r-services.md)

    Содержит сводные данные по двум примерам внедрения, проверке производительности и влиянию результатов оптимизации.
