---
title: Управление рабочими нагрузками машинного обучения и их интеграция
description: В качестве SQL Server администратора баз данных ознакомьтесь с задачами администрирования для развертывания подсистемы R и Python машинного обучения на экземпляре ядра СУБД.
ms.prod: sql
ms.technology: machine-learning
ms.date: 10/10/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: fab91e142fad3bcb1ce23816d6705f7a7d208851
ms.sourcegitcommit: c1382268152585aa77688162d2286798fd8a06bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/19/2019
ms.locfileid: "68345317"
---
# <a name="manage-and-integrate-machine-learning-workloads-on-sql-server"></a>Управление рабочими нагрузками машинного обучения и их интеграция на SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Эта статья предназначена для SQL Server администраторов баз данных, ответственных за развертывание эффективной инфраструктуры обработки и анализа данных в ресурсе сервера, поддерживающем несколько рабочих нагрузок. ИТ-подкадровое пространство с административными проблемами, относящееся к управлению выполнением кода R и Python на SQL Server. 

## <a name="what-is-feature-integration"></a>Что такое интеграция функций

Машинное обучение R и Python предоставляется [SQL Server службы машинного обучения](../what-is-sql-server-machine-learning.md) как расширение для экземпляра ядра СУБД. Интеграция заключается в основном через уровень безопасности и язык описания данных, приведенный ниже.

+ Хранимые процедуры обладают способностью принимать код R и Python в качестве входных параметров. Разработчики и специалисты по обработке и анализу данных могут использовать [системную хранимую процедуру](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql?view=sql-server-2017) или создать пользовательскую процедуру, которая заключает в оболочку код.
+ Функции T-SQL (а именно, [Predict](https://docs.microsoft.com/sql/t-sql/queries/predict-transact-sql)), которые могут использовать ранее обученную модель данных. Эта возможность доступна в T-SQL. Таким образом, он может вызываться в системе, на которой не установлены модули машинного обучения.
+ Существующие имена входа в базу данных и разрешения на основе ролей охватывают пользовательские сценарии, использующие эти же данные. Как правило, если пользователи не могут получить доступ к данным через запрос, они не смогут получить к ним доступ через сценарий.

## <a name="feature-availability"></a>Доступность функций

Интеграция R и Python будет доступна в ходе выполнения действий. Первый — Настройка, при [включении или добавлении функции **службы машинного обучения** ](../install/sql-machine-learning-services-windows-install.md) в экземпляр ядра СУБД. В качестве последующего шага необходимо включить внешние скрипты в экземпляре ядра СУБД (по умолчанию он отключен).

На этом этапе только администраторы баз данных имеют полный набор разрешений на создание и запуск внешних скриптов, Добавление и удаление пакетов, а также создание хранимых процедур и других объектов.

Всем остальным пользователям должно быть предоставлено разрешение выполнение любого внешнего СКРИПТа. Дополнительные [стандартные разрешения базы данных](../security/user-permission.md) определяют, могут ли пользователи создавать объекты, выполнять сценарии, использовать сериализованные и обученные модели и т. д. 

## <a name="resource-allocation"></a>Выделение ресурсов

Хранимые процедуры и запросы T-SQL, которые вызывают внешнюю обработку, используют ресурсы, доступные для пула ресурсов по умолчанию. В рамках конфигурации по умолчанию внешние процессы, такие как сеансы R и Python, допускаются до 20% от общего объема памяти в главной системе. 

Если вы хотите перенастроить переопределение источников, можно изменить пул по умолчанию с учетом соответствующего влияния на рабочие нагрузки машинного обучения, выполняющиеся в этой системе.

Другим вариантом является создание пользовательского пула внешних ресурсов для записи сеансов, исходящих из конкретных программ, узлов или действий, происходящих за определенный интервал времени. Дополнительные сведения см. [в статье Управление ресурсами для изменения уровней ресурсов для выполнения R и Python](../administration/resource-governance.md) и [создания пула ресурсов](../administration/how-to-create-a-resource-pool.md) для пошаговых инструкций.

## <a name="isolation-and-containment"></a>Изоляция и включение

Архитектура обработки разработана для изоляции внешних скриптов от обработки ядра. Сценарии R и Python выполняются в виде отдельных процессов в разделе локальные рабочие учетные записи. В диспетчере задач можно отслеживать процессы R и Python, выполняющиеся под учетной записью локального пользователя с низким уровнем привилегий, которая отличается от учетной записи службы SQL Server. 

Выполнение процессов R и Python в отдельных учетных записях с низким уровнем привилегий имеет следующие преимущества.

+ Изоляция процессов ядра в сеансах R и Python. Вы можете завершить процесс R или Python, не влияя на основные операции с базой данных. 

+ Сокращает привилегии для процессов среды выполнения внешнего сценария на главном компьютере.

Учетные записи с минимальными правами доступа создаются во время установки и помещаются в *пул учетных записей пользователей* Windows с именем **SQLRUserGroup**. По умолчанию эта группа имеет разрешение на использование исполняемых файлов, библиотек и встроенных наборов данных в папке Program для R и Python в разделе SQL Server. 

В качестве администратора баз данных вы можете использовать SQL Server Data Security, чтобы указать, кто имеет разрешение на выполнение скриптов, и что данные, используемые в заданиях, управляются с помощью тех же ролей безопасности, которые управляют доступом с помощью запросов T-SQL. Как системный администратор вы можете явно запретить **SQLRUserGroup** доступ к конфиденциальным данным на локальном сервере, создав списки ACL.

>[!NOTE]
> По умолчанию **SQLRUserGroup** не имеет имени входа или разрешений в SQL Server. Если учетным записям рабочих ролей требуется имя входа для доступа к данным, необходимо создать его самостоятельно. Сценарий, в частности, вызывает создание имени входа для поддержки запросов к данным или операциям в экземпляре ядра СУБД, когда удостоверение пользователя является пользователем Windows, а строка подключения указывает доверенного пользователя. Дополнительные сведения см. в разделе [Добавление SQLRUserGroup в качестве пользователя базы данных](../../advanced-analytics/security/create-a-login-for-sqlrusergroup.md).

## <a name="disable-script-execution"></a>Отключить выполнение скрипта

В случае невыполненных скриптов можно отключить все выполнение скрипта, отменив предыдущие шаги, чтобы включить выполнение внешнего скрипта в первую очередь.

1. В SQL Server Management Studio или другом инструменте запроса выполните эту команду, чтобы `external scripts enabled` установить значение 0 или false.

    ```sql
    EXEC sp_configure  'external scripts enabled', 0
    RECONFIGURE WITH OVERRIDE
    ```
2. Перезапустите службу ядра СУБД.

После устранения проблемы не забудьте повторно включить выполнение скрипта на экземпляре, если вы хотите возобновить поддержку скриптов R и Python в экземпляре ядра СУБД. Дополнительные сведения см. в разделе [Включение выполнения скриптов](../install/sql-machine-learning-services-windows-install.md#enable-script-execution) .

## <a name="extend-functionality"></a>Расширение функциональности

В процессе обработки и анализа данных часто вводятся новые требования к развертыванию и администрированию пакетов. Для анализу данных распространенной практикой является использование пакетов с открытым кодом и сторонних разработчиков в пользовательских решениях. Некоторые из этих пакетов будут иметь зависимости от других пакетов. в этом случае для достижения цели может потребоваться оценить и установить несколько пакетов.

В качестве администратора баз данных, ответственного за серверный ресурс, развертывание произвольных пакетов R и Python на рабочем сервере представляет собой неизвестную проблему. Перед добавлением пакетов следует оценить, действительно ли требуются функции, предоставляемые внешним пакетом, без эквивалентов встроенного [языка R](r-libraries-and-data-types.md) и [библиотек Python](../python/python-libraries-and-data-types.md) , установленных SQL Server программой установки. 

В качестве альтернативы установке пакета сервера анализу данных может быть способен [создавать и запускать решения на внешней рабочей станции](../r/set-up-a-data-science-client.md), получая данные из SQL Server, но при этом все операции анализа выполняются локально на рабочей станции, а не на сервере. загрузить. 

Если впоследствии вы решите, что требуются внешние функции библиотеки и не создаете риска для операций сервера или данных в целом, можно выбрать один из нескольких методологий для добавления пакетов. В большинстве случаев для добавления пакетов в SQL Server требуются права администратора. Дополнительные сведения см. в статьях [Установка пакетов Python в SQL Server](../python/install-additional-python-packages-on-sql-server.md) и [Установка пакетов R в SQL Server](install-additional-r-packages-on-sql-server.md).

> [!NOTE]
> Для пакетов R права администратора сервера не требуются специально для установки пакета, если используются альтернативные методы. Дополнительные сведения см. [в разделе Install R Packages in SQL Server](install-additional-r-packages-on-sql-server.md) .

## <a name="monitoring-script-execution"></a>Мониторинг выполнения скрипта

Скрипты R и Python, выполняемые в [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] , запускаются [!INCLUDE[rsql_launchpad_md](../../includes/rsql-launchpad-md.md)] интерфейсом. Однако панель запуска не управляется ресурсами или отслеживается отдельно, так как это безопасная служба, предоставляемая корпорацией Майкрософт, которая управляет ресурсами соответствующим образом.

Внешние скрипты, выполняемые в службе панели запуска, управляются с помощью [объекта задания Windows](/windows/desktop/ProcThread/job-objects). Объект задания позволяет управлять группой процессов как единым целым. Каждый объект задания является иерархическим и управляет атрибутами всех связанных с ним процессов. Операции, выполняемые объектом задания, влияют на все связанные с ним процессы.

Таким образом, если необходимо завершить одно задание, связанное с объектом, учтите, что все связанные с ним процессы также будут завершены. Если вы используете скрипт R, который назначен объекту задания Windows и выполняет задание, связанное с ODBC, которое необходимо завершить, родительский процесс скрипта R также будет завершен.

При запуске внешнего скрипта, использующего параллельную обработку, один объект задания Windows управляет всеми параллельными дочерними процессами.

Чтобы определить, выполняется ли процесс в задании, используйте функцию `IsProcessInJob`.

## <a name="next-steps"></a>Следующие шаги

+ Чтобы получить дополнительные сведения, ознакомьтесь с основными понятиями и компонентами [архитектуры расширяемости](../concepts/extensibility-framework.md) и [безопасности](../concepts/security.md) .

+ В процессе установки компонентов вы уже знакомы с контролем доступа к данным конечного пользователя, но если нет, см. Дополнительные сведения [в разделе Предоставление пользователям разрешений SQL Server машинного обучения](../security/user-permission.md) . 

+ Узнайте, как настроить системные ресурсы для рабочих нагрузок машинного обучения с интенсивным использованием вычислений. Дополнительные сведения см. [в разделе Создание пула ресурсов](../administration/how-to-create-a-resource-pool.md).
