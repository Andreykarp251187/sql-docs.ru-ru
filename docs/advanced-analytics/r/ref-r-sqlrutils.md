---
title: вспомогательные функции sqlrutils
description: Используйте библиотеку функций sqlrutils в службах SQL Server 2016 R и SQL Server 2017 Службы машинного обучения с R для создания хранимых процедур, содержащих скрипт R.
ms.prod: sql
ms.technology: machine-learning
ms.date: 12/15/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 361093be372e77a869996e6ffb67a6bd6e701c44
ms.sourcegitcommit: c1382268152585aa77688162d2286798fd8a06bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/19/2019
ms.locfileid: "68345093"
---
# <a name="sqlrutils-r-library-in-sql-server"></a>sqlrutils (библиотека R в SQL Server)
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Пакет **sqlrutils** предоставляет пользователям R механизм для помещения скриптов R в хранимую процедуру T-SQL, регистрации этой хранимой процедуры с базой данных и ее запуска из среды разработки R. 

Преобразование кода R для выполнения в рамках одной хранимой процедуры позволяет более эффективно использовать службы SQL Server R Services, которые требуют внедрить скрипт R в качестве параметра в [sp_execute_external_script](../../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md). Пакет **sqlrutils** помогает создать такой внедренный скрипт R и правильно настроить соответствующие параметры.

Пакет **sqlrutils** выполняет следующие задачи.

- Сохраняет созданный скрипт T-SQL в виде строки внутри структуры данных R.
- При необходимости создает SQL-файл для скрипта T-SQL, который можно изменить или выполнить, чтобы создать хранимую процедуру.
- Регистрирует созданную хранимую процедуру в экземпляре SQL Server из среды разработки R.

Вы также можете выполнить хранимую процедуру из среды R, передав параметры с правильным форматом и обработав результаты. Или вы можете использовать хранимую процедуру из SQL Server для поддержки стандартных сценариев интеграции базы данных, таких как извлечение, преобразование и загрузка, обучение модели и оценка большого объема.

  > [!NOTE]
  > Если планируется выполнить хранимую процедуру из среды R путем вызова функции *executeStoredProcedure* , следует использовать поставщик ODBC 3.8, например драйвер ODBC 13 для SQL Server.  
  
## <a name="full-reference-documentation"></a>Полная справочная документация

Библиотека **sqlrutils** распространяется в нескольких продуктах Майкрософт, но их использование одинаково при получении библиотеки в SQL Server или другом продукте. Поскольку функции одинаковы, [Документация по отдельным функциям sqlrutils](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler) публикуется только в одном расположении в справочнике по [R](https://docs.microsoft.com/machine-learning-server/r-reference/introducing-r-server-r-package-reference) для Microsoft Machine Learning Server. Если существуют какие-либо поведения конкретного продукта, расхождения будут указаны на странице справки по функциям.

## <a name="functions-list"></a>Список функций

В следующем разделе приводится обзор функций, которые можно вызывать из пакета **sqlrutils** для разработки хранимой процедуры, содержащей внедренный код R. Дополнительные сведения о параметрах для каждого метода или функции см. в справке R для пакета.`help(package="sqlrutils")`

|Компонент | Описание |
|------|-------------|
|[executeStoredProcedure](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/executestoredprocedure)| Выполните хранимую процедуру SQL.|
|[жетинпутпараметерс](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/getinputparameters)| Возвращает список входных параметров для хранимой процедуры.| 
|[InputData](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/inputdata)| Определяет источник данных в SQL Server, который будет использоваться в кадре данных R. Укажите имя data.frame для хранения входных данных и запрос для получения данных или значение по умолчанию. Поддерживаются только простые запросы SELECT. | 
|[InputParameter](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/inputparameter)| Определяет отдельный входной параметр, который будет внедрен в скрипт T-SQL. Необходимо указать имя параметра и его тип данных R.| 
|[аутпутдата](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/outputdata)| Cоздает объект промежуточных данных, который требуется, когда функция R возвращает список, содержащий data.frame. Объект *OutputData* используется для хранения имени отдельного data.frame, полученного из списка.| 
|[OutputParameter](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/outputparameter) | Cоздает объект промежуточных данных, который требуется, когда функция R возвращает список. Объект *OutputParameter* хранит имя и тип данных для одного элемента списка при условии, что он **не** является кадром данных. |
|[регистерсторедпроцедуре](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/registerstoredprocedure) | Зарегистрируйте хранимую процедуру в базе данных.|
|[сетинпутдатакуери](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/setinputdataquery)| Назначьте запрос параметру входных данных хранимой процедуры.| 
|[сетинпутпараметервалуе](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/setinputparametervalue)| Присвойте значение входному параметру хранимой процедуры.| 
|[StoredProcedure](https://docs.microsoft.com/machine-learning-server/r-reference/sqlrutils/storedprocedure)| Объект хранимой процедуры.|


## <a name="how-to-use-sqlrutils"></a>Как использовать sqlrutils

Функции библиотеки **sqlrutils** должны выполняться на компьютере с SQL Server машинное обучение с R. Если вы работаете на клиентской рабочей станции, задайте для удаленного контекста вычислений значение "сдвиг выполнения" на SQL Server. Рабочий процесс для использования этого пакета включает следующие шаги:

+ Определите параметры хранимой процедуры (входные, выходные или и то, и другое). 
+ Создание и регистрация хранимой процедуры    
+ Выполнение хранимой процедуры  

В сеансе R Загрузите **sqlrutils** из командной строки, введя `library(sqlrutils)`.

> [!Note]
> Эту библиотеку можно загрузить на компьютер, на котором нет SQL Server (например, на экземпляре клиента R), если изменить контекст вычислений на SQL Server и выполнить код в этом контексте вычислений.


### <a name="define-stored-procedure-parameters-and-inputs"></a>Определение параметров и входных данных хранимой процедуры

`StoredProcedure` является основным конструктором, используемым для создания хранимой процедуры. Этот конструктор создает объект *хранимой процедуры SQL Server* и при необходимости создает текстовый файл, содержащий запрос, который можно использовать для создания хранимой процедуры с помощью команды T-SQL. 

При необходимости функция *StoredProcedure* может зарегистрировать хранимую процедуру с помощью указанного экземпляра и базы данных.

+ Используйте аргумент `func` для указания допустимой функции R. Все переменные, которые использует функция, должны быть определены внутри функции либо представления в виде входных параметров. Эти параметры могут включать не более одного кадра данных.

+ Функция R должна возвращать кадр данных, именованный список или значение NULL. Если функция возвращает список, он может содержать не более одного data.frame.

+ Используйте аргумент `spName` для указания имени создаваемой хранимой процедуры.

+ Можно передать необязательные входные и выходные параметры с помощью объектов, созданных следующими вспомогательными функциями: `setInputData`, `setInputParameter`и `setOutputParameter`.

+  При необходимости используйте `filePath` для указания пути и имени создаваемого SQL-файла. Этот файл можно запустить на экземпляре SQL Server для создания хранимой процедуры с помощью T-SQL.

+ Для определения сервера и базы данных, где будет сохранена хранимая процедура, используйте аргументы `dbName` и  `connectionString`.

+ Чтобы получить список объектов *InputData* и *InputParameter* , которые использовались для создания определенного объекта *StoredProcedure* , вызовите `getInputParameters`. 

+ Чтобы зарегистрировать хранимую процедуру в указанной базе данных, используйте `registerStoredProcedure`.

Объект хранимой процедуры обычно не имеет связанных с ним данных или значений, если только не указано значение по умолчанию. Данные не извлекаются до выполнения хранимой процедуры. 

### <a name="specify-inputs-and-execute"></a>Укажите входные данные и выполните

+ Используйте `setInputDataQuery` для назначения запроса объекту *InputParameter* . Например, если вы создали объект хранимой процедуры в R, можно использовать `setInputDataQuery` для передачи аргументов в *StoredProcedure* для выполнения хранимой процедуры с нужными входными данными.

+ Используйте `setInputValue` для назначения конкретного значения параметру, сохраненному в виде объекта *InputParameter* . Затем передайте объект параметра и его назначение значения в *StoredProcedure* , чтобы выполнить хранимую процедуру с заданными значениями.

+ Используйте `executeStoredProcedure` для выполнения хранимой процедуры, определенной в виде объекта *StoredProcedure* . Вызывайте эту функцию только при выполнении хранимой процедуры из кода R. Не используйте ее при запуске хранимой процедуры из SQL Server с помощью T-SQL.

> [!NOTE]
> Функции *executeStoredProcedure* требуется поставщик ODBC 3.8, например драйвер ODBC 13 для SQL Server.  

## <a name="see-also"></a>См. также

[Создание хранимой процедуры с помощью sqlrutils](how-to-create-a-stored-procedure-using-sqlrutils.md)

