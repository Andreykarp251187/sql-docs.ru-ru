---
title: Использование данных из кубов OLAP в R
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 3063758e1186dc81e5ce9e70891403e7afd3a89f
ms.sourcegitcommit: c1382268152585aa77688162d2286798fd8a06bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/19/2019
ms.locfileid: "68345110"
---
# <a name="using-data-from-olap-cubes-in-r"></a>Использование данных из кубов OLAP в R
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Пакет для **OLAP** — это пакет R, предоставляемый корпорацией Майкрософт для использования с Machine Learning Server и SQL Server, который позволяет выполнять запросы многомерных выражений для получения данных из кубов OLAP. В этом пакете нет необходимости создавать связанные серверы или очищать плоские наборы строк. данные OLAP можно получить непосредственно из R.

В этой статье описывается API, а также общие сведения о OLAP и многомерных выражениях для пользователей R, которые могут быть новыми для баз данных многомерных кубов.

> [!IMPORTANT]
> Экземпляр Analysis Services может поддерживать как обычные многомерные Кубы, так и табличные модели, но экземпляр не поддерживает оба типа моделей. Таким образом, прежде чем пытаться построить запрос многомерных выражений к кубу, убедитесь, что Analysis Services экземпляр содержит многомерные модели.

## <a name="what-is-an-olap-cube"></a>Что такое куб OLAP?

OLAP является коротким для оперативной аналитической обработки. Решения OLAP широко используются для сбора и хранения важных бизнес-данных с течением времени. Многие инструменты, панели мониторинга и визуализации используют данные OLAP для бизнес-аналитики. Дополнительные сведения см. в разделе [оперативная аналитическая обработка](https://en.wikipedia.org/wiki/Online_analytical_processing).

Корпорация Майкрософт предоставляет [Analysis Services](https://docs.microsoft.com/sql/analysis-services/analysis-services), который позволяет проектировать, развертывать и запрашивать данные OLAP в виде _кубов_ или _табличных моделей_. Куб — это многомерная база данных. _Измерения_ подобны аспектам данных или коэффициентам в R: вы используете измерения для выявления определенного подмножества данных, которые необходимо суммировать или анализировать. Например, время является важным измерением, так что многие решения OLAP включают в себя несколько календарей, определенных по умолчанию, для использования при создании срезов и суммирования данных. 

Из соображений производительности база данных OLAP часто вычисляет сводки (или агрегаты ) заранее, а затем сохраняет их для более быстрого извлечения. Сводки основаны на *мерах*, которые представляют формулы, которые могут быть применены к числовым данным. Измерения используются для определения подмножества данных, а затем для расчета меры по этим данным. Например, с помощью меры можно вычислить общую сумму продаж для определенной линии продукта за несколько кварталов минус налоги, чтобы сообщить о среднем затратах на доставку для конкретного поставщика, оплаченной совокупной стоимости за год и т. д.

МНОГОМЕРные выражения, короткие для многомерных выражений, — это язык, используемый для выполнения запросов к кубам. Запрос многомерных выражений обычно содержит определение данных, которое включает одно или несколько измерений, и, по крайней мере, одну меру, хотя запросы многомерных выражений могут значительно более сложны и включать в себя чередующиеся окна, совокупные средние значения, суммы, ранжирования или процентили. 

Ниже приведены некоторые другие термины, которые могут быть полезны при начале создания запросов многомерных выражений.

+ *Фрагментирование* принимает подмножество куба, используя значения из одного измерения.

+ При*сегментировании* создается вложенный куб посредством указания диапазона значений для нескольких измерений.

+ *Детализация* позволяет перейти от сводки к подробностям.

+ *Подъем* позволяет перейти от подробностей к более высокому уровню статистической обработки.

+ *Свертка* дает сводные данные по данным в измерении.

+ *Сводка* поворачивает куб или выбранные данные.

## <a name="how-to-use-olapr-to-create-mdx-queries"></a>Использование OLAP для создания запросов многомерных выражений

В следующей статье приведены подробные примеры синтаксиса для создания или выполнения запросов к кубу.

+ [Создание запросов многомерных выражений с помощью языка R](../../advanced-analytics/r/how-to-create-mdx-queries-using-olapr.md)

## <a name="olapr-api"></a>API-интерфейс OLAP

Пакет **OlapR** поддерживает два метода создания запросов многомерных выражений:

- **Используйте конструктор многомерных выражений.** Используйте функции R в пакете, чтобы создать простой запрос многомерных выражений, выбрав куб и установив оси и срезы. Это простой способ создания допустимого запроса многомерных выражений, если у вас нет доступа к традиционным средствам OLAP или нет глубоких знаний о языке многомерных выражений.

    Не все запросы многомерных выражений могут быть созданы с помощью этого метода, так как многомерные выражения могут быть сложными. Однако этот API поддерживает большинство наиболее распространенных и полезных операций, включая срезы, кости, углубленную детализацию, свертку и сведение в N измерений.

+ **Скопируйте и вставьте правильно сформированное многомерное выражение.** Вручную создайте и вставьте любой запрос многомерных выражений. Этот параметр лучше подходит при наличии существующих запросов многомерных выражений, которые вы хотите повторно использовать, или если запрос, который требуется собрать, слишком сложен для **работы с ним** .

    После создания многомерных выражений с помощью любой клиентской программы, например SSMS или Excel, сохраните строку запроса. Укажите эту строку многомерных выражений в качестве аргумента для *обработчика запросов SSAS* в пакете **OLAP** . Поставщик отправляет запрос на указанный сервер Analysis Services и передает результаты в R. 

Примеры создания запроса МНОГОМЕРных выражений или выполнения существующего запроса МНОГОМЕРных выражений см. в разделе [Создание запросов](../../advanced-analytics/r/how-to-create-mdx-queries-using-olapr.md)многомерных выражений с помощью языка R.

## <a name="known-issues"></a>Известные проблемы

В этом разделе перечислены некоторые известные проблемы и распространенные вопросы о пакете **OLAP** .

### <a name="tabular-model-support"></a>Поддержка табличных моделей

При подключении к экземпляру Analysis Services, содержащему табличную модель, `explore` функция сообщает об успешном выполнении с возвращаемым значением true. Однако объекты табличной модели отличаются от многомерных объектов, а структура многомерной базы данных отличается от структуры табличной модели.

Хотя DAX (выражения анализа данных) — это язык, который обычно используется в табличных моделях, можно разработать допустимые запросы многомерных выражений к табличной модели, если вы уже знакомы с многомерными выражениями. Нельзя использовать конструкторы OLAP для построения допустимых запросов многомерных выражений к табличной модели.

Однако запросы многомерных выражений являются неэффективным способом извлечения данных из табличной модели. Если необходимо получить данные из табличной модели для использования в R, рассмотрите следующие методы:

+ Включите DirectQuery в модели и добавьте сервер в качестве связанного сервера в SQL Server. 
+ Если табличная модель построена на витрине реляционных данных, получите данные непосредственно из источника.

### <a name="how-to-determine-whether-an-instance-contains-tabular-or-multidimensional-models"></a>Как определить, содержит ли экземпляр табличные или многомерные модели

Один экземпляр Analysis Services может содержать только один тип модели, хотя может содержать несколько моделей. Причина заключается в том, что существуют фундаментальные различия между табличными и многомерными моделями, которые управляют способом хранения и обработки данных. Например, табличные модели хранятся в памяти и используют индексы columnstore для выполнения очень быстрых вычислений. В многомерных моделях данные хранятся на диске, а агрегаты определяются заранее и извлекаются с помощью запросов многомерных выражений.

При подключении к Analysis Services с помощью клиента, например SQL Server Management Studio, можно определить, какой тип модели поддерживается, просмотрев значок для базы данных.

Можно также просмотреть и запросить свойства сервера, чтобы определить, какой тип модели поддерживает экземпляр. Свойство **режим сервера** поддерживает два значения: _многомерные_ или табличные .

Общие сведения о двух типах моделей см. в следующей статье:

+ [Сравнение многомерных и табличных моделей](https://docs.microsoft.com/sql/analysis-services/comparing-tabular-and-multidimensional-solutions-ssas)

Сведения о запросе свойств сервера см. в следующей статье:

+ [Наборы строк схемы OLE DB для OLAP](https://docs.microsoft.com/bi-reference/schema-rowsets/ole-db-olap/ole-db-for-olap-schema-rowsets)

### <a name="writeback-is-not-supported"></a>Обратная запись не поддерживается

Невозможно записать результаты пользовательских вычислений R обратно в куб.

Как правило, даже если куб включен для обратной записи, поддерживаются только ограниченные операции и может потребоваться дополнительная настройка. Для таких операций рекомендуется использовать многомерные выражения.

+ [Измерения, доступные для записи](https://docs.microsoft.com/sql/analysis-services/multidimensional-models-olap-logical-dimension-objects/write-enabled-dimensions)
+ [Секции, доступные для записи](https://docs.microsoft.com/sql/analysis-services/multidimensional-models-olap-logical-cube-objects/partitions-write-enabled-partitions)
+ [Настройка пользовательского доступа к данным ячейки](https://docs.microsoft.com/sql/analysis-services/multidimensional-models/grant-custom-access-to-cell-data-analysis-services)

### <a name="long-running-mdx-queries-block-cube-processing"></a>Долгосрочные запросы многомерных выражений блокируют обработку куба

Хотя пакет **OLAP** выполняет только операции чтения, длительные запросы многомерных выражений могут создавать блокировки, препятствующие обработке куба. Всегда проверяйте запросы многомерных выражений заранее, чтобы иметь представление о том, сколько данных следует вернуть.

При попытке подключиться к заблокированному Кубу может появиться сообщение об ошибке, которая не может быть SQL Server к хранилищу данных. Предлагаемые разрешения включают в себя включение удаленных соединений, проверку имени сервера или экземпляра и т. д. Однако рассмотрим возможность предварительного открытого соединения.

Администратор SSAS может предотвратить проблемы блокировки, определяя и прерывая открытые сеансы. Свойство Timeout может также применяться к запросам многомерных выражений на уровне сервера для принудительного завершения всех долго выполняющихся запросов.

## <a name="resources"></a>Ресурсы

Если вы не знакомы с OLAP или запросами многомерных выражений, см. следующие статьи в Википедии: 

+ [Кубы OLAP](https://en.wikipedia.org/wiki/OLAP_cube)
+ [Запросы многомерных выражений](https://en.wikipedia.org/wiki/MultiDimensional_eXpressions)
