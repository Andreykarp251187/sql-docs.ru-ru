---
title: Создание локального репозитория пакетов R с помощью miniCRAN - службы машинного обучения SQL Server
description: С помощью miniCran обнаружения, собрать и установить зависимости пакетов R в один пакет консолидированные.
ms.prod: sql
ms.technology: machine-learning
ms.date: 06/13/2019
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 2e976e66212fffa63547db160a06941456229d93
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "67962707"
---
# <a name="create-a-local-r-package-repository-using-minicran"></a>Создание локального репозитория пакетов R с помощью miniCRAN
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

[miniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) пакета, созданного с [Андре де Врие](https://blog.revolutionanalytics.com/2016/05/minicran-sql-server.html), определяет и скачивает пакеты и зависимости в одну папку, которую можно копировать на другие компьютеры для автономной установки пакета R.

В качестве входных данных укажите один или несколько пакетов. **miniCRAN** рекурсивно считывает дерево зависимостей для этих пакетов и загружает только перечисленных пакетов и их зависимости из CRAN или аналогичные репозиториев.

На выходе **miniCRAN** создает репозиторием внутреннего согласования, состоящий из выбранных пакетов и все необходимые зависимости. Затем можно переместить этот локальный репозиторий на сервер и продолжить установку пакетов без подключения к Интернету.

> [!NOTE]
> Опытным пользователям R часто найдите список зависимых пакетов в файле ОПИСАНИЯ для загруженного пакета. Тем не менее, пакетов, указанных в **Imports** могут иметь зависимости второго уровня. По этой причине мы рекомендуем **miniCRAN** для монтажа полной коллекцией необходимые пакеты.

## <a name="why-create-a-local-repository"></a>Почему Создание локального репозитория

Создание локального репозитория пакетов предназначена для предоставления единого местоположения, администратор сервера или другим пользователям в организации можно использовать для установки новых пакетов R на сервере, особенно тот, который не имеет доступа к Интернету. После создания репозитория, можно изменить его, добавив новые пакеты или обновления версии существующих пакетов.

Пакет репозитории удобны в следующих сценариях:

- **Безопасность**: Многие пользователи R привыкли к загрузке и установке новых пакетов R, при этом из CRAN или одного из его зеркальных сайтов. Тем не менее, по соображениям безопасности рабочих серверов под управлением [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] обычно не имеют подключения к Интернету.

- **Проще автономной установки**: Чтобы установить пакет на сервер вне сети необходимо, также загрузить все зависимости пакета Using miniCRAN упрощает получение всех зависимостей в правильном формате.

    С помощью miniCRAN, можно избежать ошибок зависимостей пакетов при подготовке пакетов для установки с [CREATE EXTERNAL LIBRARY](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) инструкции.

- **Улучшенное управление версиями**: В многопользовательской среде имеются веские причины, чтобы избежать неограниченный установку нескольких версий пакета на сервере. Используйте локальный репозиторий для предоставления согласованного набора пакетов для использования аналитики. 

> [!TIP]
> Можно также использовать miniCRAN Подготовка пакетов для использования в машинном обучении Azure. Дополнительные сведения см. в записи: [С помощью miniCRAN в машинном Обучении Azure, с Мишель Usuelli](https://www.r-bloggers.com/using-minicran-in-azure-ml/) 

## <a name="install-minicran"></a>Установка miniCRAN

**MiniCRAN** сам пакет зависит от 18 пакетов CRAN среди это **RCurl** пакет, который не зависит от системы на **curl разраб** пакета. Аналогичным образом, пакет **XML** имеет зависимость от **libxml2 разраб**. Для разрешения зависимостей, рекомендуется создавать изначально локального репозитория на компьютере с полным доступом к Интернету. 

Выполните следующие команды на компьютере с базовым R, средства R и подключение к Интернету. Предполагается, что это *не* компьютера с SQL Server. Следующие команды устанавливают **miniCRAN** пакета и необходимые **igraph** пакета. В этом примере проверяет ли пакет уже установлен, но вы можете обойти это, если инструкции и установите пакеты напрямую.

```R
if(!require("miniCRAN")) install.packages("miniCRAN") 
if(!require("igraph")) install.packages("igraph") 
library("miniCRAN")
```

## <a name="set-the-cran-mirror-and-mran-snapshot"></a>Задайте зеркало CRAN и MRAN моментальных снимков

Указываете зеркальный сайт для использования при получении пакетов. Например можно использовать сайт MRAN или любого другого узла в вашем регионе, содержащий необходимые пакеты. Если загрузка прерывается, попробуйте другой зеркальный сайт.

```R
CRAN_mirror <- c(CRAN = "https://mran.microsoft.com")
CRAN_mirror <- c(CRAN = "https://cran.cnr.berkeley.edu")
```

## <a name="create-a-local-folder"></a>Создайте локальную папку

Создайте локальную папку, например `C:\mylocalrepo` в которой будут храниться собранные пакеты. Если повторить это часто, возможно, следует использовать более описательное имя, например «miniCRANZooPackages» или «miniCRANMyRPackagev2».

Задайте папку в качестве локального репозитория. Синтаксис R использует косой черты для пути, что является противоположностью от соглашений Windows.

```R
local_repo <- "C:/mylocalrepo"
```

## <a name="add-packages-to-the-local-repo"></a>Добавление пакетов в локальный репозиторий

После **miniCRAN** установки и загрузки, создать список, который указывает дополнительные пакеты, которые вы хотите загрузить.

Сделать **не** Добавление зависимостей к этот исходный список. **Igraph** пакете, используемом **miniCRAN** создает список зависимостей для вас. Дополнительные сведения об использовании на графе зависимостей созданный см. в разделе [с помощью miniCRAN для определения зависимостей пакетов](https://cran.r-project.org/web/packages/miniCRAN/vignettes/miniCRAN-dependency-graph.html).

1. Добавление пакетов для целевого сервера «zoo» и «forecast» переменной.

    ```R
    pkgs_needed <- c("zoo", "forecast")
    ```

2. При необходимости построения графика зависимостей, но может быть информативной.
    
    ```R
    plot(makeDepGraph(pkgs_needed))
    ```

3. Создание локального репозитория. Не забудьте изменить версию R, при необходимости, до версии, установленных на экземпляре SQL Server. Версия 3.2.2 на SQL Server 2016, версия 3.3 — в SQL Server 2017. Если вы выполнили обновление компонента, ваша версия может быть более новые. Дополнительные сведения см. в разделе [получить R и Python данные пакетов](../package-management/installed-package-information.md).

    ```R
    pkgs_expanded <- pkgDep(pkgs_needed, repos = CRAN_mirror);
    makeRepo(pkgs_expanded, path = local_repo, repos = CRAN_mirror, type = "win.binary", Rversion = "3.3");
    ```

   Владея этими сведениями, пакета miniCRAN создает структуру папок, необходимо скопировать пакеты для [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] позже.

На этом этапе вы должны иметь папку, содержащую пакеты, которые требуется, а дополнительные пакеты, которые были обязательным. Путь должен выглядеть как в этом примере: C:\mylocalrepo\bin\windows\contrib\3.3 и он должен содержать коллекцию сжатых пакетов. Не Распакуйте пакеты или переименуйте все файлы.

При необходимости запустите приведенный ниже, чтобы получить список пакетов, содержащихся в локальный репозиторий miniCRAN.

```R
pdb <- as.data.frame(pkgAvail(local_repo, type = "win.binary", Rversion = "3.3"), stringsAsFactors = FALSE);
head(pdb);
pdb$Package;
pdb[, c("Package", "Version", "License")]
```

## <a name="add-packages-to-the-instance-library"></a>Добавьте пакеты в библиотеку экземпляра

После локального репозитория с помощью необходимых пакетов, перемещение репозитория пакетов на компьютер SQL Server. Ниже описано, как для установки пакетов с помощью средств R.

1. Скопируйте папку, содержащую репозитория miniCRAN, целиком на сервер, на котором планируется установить пакеты. Обычно в папке имеет такую структуру: корневой miniCRAN > bin > windows > contrib > версии > все пакеты. В следующих примерах предполагается папку в корне диска: 

2. Откройте средство R, связанные с экземпляром (например, можно использовать Rgui.exe). Щелкните правой кнопкой мыши **Запуск от имени администратора** чтобы разрешить средству для обновления для системы.

    - Для SQL Server 2017 — расположение файлов для RGUI `C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\R_SERVICES\bin\x64`.

    - Для SQL Server 2016 — расположение файла для RGUI `C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\R_SERVICES\bin\x64`.

3. Получать путь к библиотеке экземпляр и добавьте его в список путей к библиотеке. В SQL Server 2017 путь подобен приведенному ниже.

    ```R
    outputlib <- "C:/Program Files/Microsoft SQL Server/MSSQL14.MSSQLSERVER/R_SERVICES/library"
    ```

4. Укажите новое расположение на сервере, который вы скопировали **miniCRAN** репозитория, как `server_repo`.

    В этом примере мы предполагаем, что вы скопировали репозитории во временную папку на сервере.

    ```R
    inputlib <- "C:/temp/mylocalrepo"
    ```

5. Так как вы работаете в новую рабочую область R на сервере, необходимо также указать список пакетов для установки.

    ```R
    mypackages <- c("zoo", "forecast")
    ```

6. Установите пакеты, указав путь локальной копии репозитория miniCRAN.

    ```R
    install.packages(mypackages, repos = file.path("file://", normalizePath(inputlib, winslash = "/")), lib = outputlib, type = "win.binary", dependencies = TRUE);
    ```

7. Из библиотеки экземпляра вы можете просмотреть установленные пакеты, используя следующую команду:

    ```R
    installed.packages()
    ```

## <a name="see-also"></a>См. также

+ [Получение сведений о пакете](../package-management/installed-package-information.md)
+ [Учебники по R](../tutorials/sql-server-r-tutorials.md)
