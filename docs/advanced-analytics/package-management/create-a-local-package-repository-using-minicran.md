---
title: Создание локального репозитория пакетов R с помощью miniCRAN
description: Узнайте, как установить пакеты R в автономном режиме с помощью пакета miniCRAN, чтобы создать локальный репозиторий пакетов и зависимостей.
ms.prod: sql
ms.technology: machine-learning
ms.date: 08/15/2019
ms.topic: conceptual
author: garyericson
ms.author: garye
ms.reviewer: davidph
monikerRange: '>=sql-server-2016||>=sql-server-linux-ver15||=sqlallproducts-allversions'
ms.openlocfilehash: 68f86d673b944a029c7bd0f74c9594692bd579f4
ms.sourcegitcommit: 00350f6ffb73c2c0d99beeded61c5b9baa63d171
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/30/2019
ms.locfileid: "70196337"
---
# <a name="create-a-local-r-package-repository-using-minicran"></a>Создание локального репозитория пакетов R с помощью miniCRAN
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

В этой статье описывается, как установить пакеты R в автономном режиме с помощью [miniCRAN](https://cran.r-project.org/web/packages/miniCRAN/index.html) , чтобы создать локальный репозиторий пакетов и зависимостей. **miniCRAN** определяет и скачивает пакеты и зависимости в одну папку, которая копируется на другие компьютеры для автономной установки пакета R.

Можно указать один или несколько пакетов, а **miniCRAN** рекурсивно считывает дерево зависимостей для этих пакетов. Затем он скачивает только перечисленные пакеты и их зависимости от CRAN или аналогичных репозиториев.

По завершении **miniCRAN** создает внутренний согласованный репозиторий, состоящий из выбранных пакетов и всех необходимых зависимостей. Этот локальный репозиторий можно переместить на сервер и перейти к установке пакетов без подключения к Интернету.

Опытные пользователи R часто ищут список зависимых пакетов в файле описания скачанного пакета. Однако у пакетов, перечисленных в Imports, могут быть зависимости второго уровня. По этой причине мы рекомендуем **miniCRAN** для сборки полного набора необходимых пакетов.

## <a name="why-create-a-local-repository"></a>Зачем создавать локальный репозиторий

Целью создания локального репозитория пакетов является предоставление единого расположения, которое администратор сервера или другие пользователи организации могут использовать для установки новых пакетов R на сервере, особенно для тех, у которых нет доступа к Интернету. После создания репозитория его можно изменить, добавив новые пакеты или обновив версию существующих пакетов.

Репозитории пакетов полезны в следующих сценариях:

- **Безопасность**: Многие пользователи R привыкли скачивать и устанавливать новые пакеты R, начиная с CRAN или одного из его зеркальных узлов. Однако в целях безопасности рабочие серверы, работающие [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] обычно, не имеют подключения к Интернету.

- **Упрощенная автономная установка**: Для установки пакета на автономный сервер необходимо также скачать все зависимости пакетов. Использование miniCRAN упрощает получение всех зависимостей в правильном формате. С помощью miniCRAN можно избежать ошибок зависимостей пакетов при подготовке пакетов к установке с помощью инструкции [CREATE External Library](https://docs.microsoft.com/sql/t-sql/statements/create-external-library-transact-sql) .

- **Улучшенное управление версиями**: В многопользовательской среде существуют веские причины, позволяющие избежать неограниченной установки нескольких версий пакетов на сервере. Используйте локальный репозиторий, чтобы обеспечить согласованный набор пакетов для пользователей.

## <a name="install-minicran"></a>Установка miniCRAN

Сам пакет **miniCRAN** зависит от 18 других пакетов Cran, между которыми является пакет **ркурл** , который имеет зависимость системы от пакета. Аналогичным образом пакет **XML** имеет зависимость от **libxml2-которые**. Для разрешения зависимостей рекомендуется сначала создать локальный репозиторий на компьютере с полным доступом к Интернету.

Выполните следующие команды на компьютере с базовыми инструментами R, R и подключением к Интернету. Предполагается, что это не SQL Server компьютере. Следующие команды устанавливают пакет **miniCRAN** и пакет **ИГРАФ** . В этом примере проверяется, установлен ли пакет, но можно обойти `if` инструкции и установить пакеты напрямую.

```R
if(!require("miniCRAN")) install.packages("miniCRAN") 
if(!require("igraph")) install.packages("igraph") 
library("miniCRAN")
```

## <a name="set-the-cran-mirror-and-mran-snapshot"></a>Настройка зеркального отображения CRAN и моментального снимка MRAN:

Укажите зеркальный сайт, который будет использоваться при получении пакетов. Например, можно использовать сайт MRAN: или любой другой сайт в вашем регионе, который содержит необходимые пакеты. Если загрузка завершается неудачно, попробуйте другой зеркальный сайт.

```R
CRAN_mirror <- c(CRAN = "https://cran.cnr.berkeley.edu")
```

## <a name="create-a-local-folder"></a>Создание локальной папки

Создайте локальную папку для хранения собранных пакетов. Если повторить это часто, может потребоваться использовать описательное имя, например "Миникранзупаккажес" или "miniCRANMyRPackageV2".

Укажите папку в качестве локального репозитория. Синтаксис R использует прямую косую черту для имен путей, которые противоположны соглашениям Windows.

```R
local_repo <- "C:/miniCRANZooPackages"
```

## <a name="add-packages-to-the-local-repo"></a>Добавление пакетов в локальный репозиторий

После установки и загрузки **miniCRAN** создайте список, указывающий дополнительные пакеты, которые требуется скачать.

**Не** добавляйте зависимости в этот начальный список. Пакет **ИГРАФ** , используемый **miniCRAN** , автоматически создает список зависимостей. Дополнительные сведения об использовании созданного графа зависимостей см. в разделе [Использование miniCRAN для указания зависимостей пакетов](https://cran.r-project.org/web/packages/miniCRAN/vignettes/miniCRAN-dependency-graph.html).

1. Добавьте целевые пакеты "Zoo" и "прогноз" в переменную.

    ```R
    pkgs_needed <- c("zoo", "forecast")
    ```

2. При необходимости можно построить график зависимостей. Это необязательно, но может быть информативным.

    ```R
    plot(makeDepGraph(pkgs_needed))
    ```

3. Создайте локальный репозиторий. При необходимости обязательно измените версию R на версию, установленную на экземпляре SQL Server. Если вы выполнили обновление компонента, ваша версия может быть новее исходной версии. Дополнительные сведения см. в разделе [Получение сведений о пакете R](../package-management/r-package-information.md).

    ```R
    pkgs_expanded <- pkgDep(pkgs_needed, repos = CRAN_mirror);
    makeRepo(pkgs_expanded, path = local_repo, repos = CRAN_mirror, type = "win.binary", Rversion = "3.3");
    ```

   На основе этих сведений пакет miniCRAN создает структуру папок, в которой необходимо скопировать пакеты [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] в дальнейшем.

На этом этапе у вас должна быть папка, содержащая необходимые пакеты, а также все необходимые дополнительные пакеты. Папка должна содержать коллекцию zip-пакетов. Не распакуйте пакеты или переименуйте файлы.

При необходимости выполните следующий код, чтобы вывести список пакетов, содержащихся в локальном репозитории miniCRAN.

```R
pdb <- as.data.frame(pkgAvail(local_repo, type = "win.binary", Rversion = "3.3"), stringsAsFactors = FALSE);
head(pdb);
pdb$Package;
pdb[, c("Package", "Version", "License")]
```

## <a name="add-packages-to-the-instance-library"></a>Добавление пакетов в библиотеку экземпляров

После создания локального репозитория с нужными пакетами переместите репозиторий пакетов на компьютер SQL Server. В следующей процедуре описывается установка пакетов с помощью средств R.

1. Скопируйте папку, содержащую репозиторий miniCRAN, целиком, на сервер, на котором планируется установить пакеты. Папка обычно имеет следующую структуру: 

   `<miniCRAN root>/bin/windows/contrib/version/<all packages>`

   В этой процедуре мы предполагаем, что папка находится на корневом диске.

2. Откройте средство R, связанное с экземпляром (например, можно использовать RGUI. exe). Щелкните правой кнопкой мыши и выберите **Запуск от имени администратора** , чтобы разрешить средству вносить обновления в систему.

   ::: moniker range="=sql-server-2016||=sqlallproducts-allversions"
   - Например, расположением файлов по умолчанию для RGUI `C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\R_SERVICES\bin\x64`является.
   ::: moniker-end

   ::: moniker range="=sql-server-2017||=sqlallproducts-allversions"
   - Например, расположением файла для RGUI является `C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\R_SERVICES\bin\x64`.
   ::: moniker-end

   ::: moniker range=">sql-server-2017||=sqlallproducts-allversions"
   - Например, расположением файла для RGUI является `C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\R_SERVICES\bin\x64`.
   ::: moniker-end

3. Получите путь к библиотеке экземпляров и добавьте ее в список путей к библиотекам.

   ::: moniker range="=sql-server-2016||=sqlallproducts-allversions"
   Например,

   ```R
   outputlib <- "C:/Program Files/Microsoft SQL Server/MSSQL13.MSSQLSERVER/R_SERVICES/library"
   ```

   ::: moniker-end

   ::: moniker range="=sql-server-2017||=sqlallproducts-allversions"
   Например,

   ```R
   outputlib <- "C:/Program Files/Microsoft SQL Server/MSSQL14.MSSQLSERVER/R_SERVICES/library"
   ```

   ::: moniker-end

   ::: moniker range=">sql-server-2017||=sqlallproducts-allversions"
   Например,

   ```R
   outputlib <- "C:/Program Files/Microsoft SQL Server/MSSQL15.MSSQLSERVER/R_SERVICES/library"
   ```

   ::: moniker-end

4. Укажите новое расположение на сервере, куда был скопирован `server_repo`репозиторий **miniCRAN** .

    В этом примере предполагается, что репозиторий скопирован во временную папку на сервере.

    ```R
    inputlib <- "C:/miniCRANZooPackages"
    ```

5. Так как вы работаете в новой рабочей области R на сервере, необходимо также добавить список пакетов для установки.

    ```R
    mypackages <- c("zoo", "forecast")
    ```

6. Установите пакеты, указав путь к локальной копии репозитория miniCRAN.

    ```R
    install.packages(mypackages, repos = file.path("file://", normalizePath(inputlib, winslash = "/")), lib = outputlib, type = "win.binary", dependencies = TRUE);
    ```

7. Из библиотеки экземпляров можно просмотреть установленные пакеты с помощью команды, как в следующем примере:

    ```R
    installed.packages()
    ```

## <a name="see-also"></a>См. также

+ [Получение сведений о пакете R](../package-management/r-package-information.md)
+ [Учебники по R](../tutorials/sql-server-r-tutorials.md)
