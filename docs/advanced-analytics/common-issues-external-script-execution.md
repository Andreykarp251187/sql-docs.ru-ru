---
title: Распространенные проблемы с выполнением службы панели запуска и внешним скриптом
ms.prod: sql
ms.technology: ''
ms.date: 07/30/2019
ms.topic: conceptual
author: dphansen
ms.author: davidph
monikerRange: '>=sql-server-2016||>=sql-server-linux-ver15||=sqlallproducts-allversions'
ms.openlocfilehash: c90c59f3b59850bb0e2d1cf4cf40eb569e965eba
ms.sourcegitcommit: 321497065ecd7ecde9bff378464db8da426e9e14
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/01/2019
ms.locfileid: "68715284"
---
# <a name="common-issues-with-launchpad-service-and-external-script-execution-in-sql-server"></a>Распространенные проблемы с выполнением службы панели запуска и внешним скриптом в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

SQL Server Доверенная служба панели запуска поддерживает выполнение внешних скриптов для R и Python. 

Несколько проблем могут препятствовать запуску панели запуска, включая проблемы конфигурации, изменения или отсутствие сетевых протоколов. В этой статье содержатся рекомендации по устранению неполадок для многих проблем. Для всех пропущенных вопросов можно отправить вопросы на [Machine Learning Server форуме](https://social.msdn.microsoft.com/Forums/en-US/home?category=MicrosoftR).

## <a name="determine-whether-launchpad-is-running"></a>Определение того, запущена ли панель запуска

1. Откройте панель **служб** (Services. msc). Чтобы открыть [Диспетчер конфигурации SQL Server](https://docs.microsoft.com/sql/relational-databases/sql-server-configuration-manager), в командной строке введите **SQLServerManager13. msc** или **SQLServerManager14. msc** .

2. Запишите учетную запись службы, под которой выполняется панель запуска. Каждый экземпляр, где включен R или Python, должен иметь собственный экземпляр службы панели запуска. Например, служба для именованного экземпляра может быть похожа на _MSSQLLaunchpad $ имя_экземпляра_.

3. Если служба остановлена, перезапустите ее. При перезапуске при возникновении проблем с конфигурацией сообщение публикуется в журнале системных событий, а служба снова останавливается. Проверьте журнал системных событий на наличие сведений о причинах остановки службы.

4. Проверьте содержимое файла Рсетуп. log и убедитесь в отсутствии ошибок в программе установки. Например, сообщение, которое *завершается с кодом 0* , указывает на сбой запуска службы.

5. Чтобы найти другие ошибки, просмотрите содержимое файла журнала rlauncher. log.

## <a name="check-the-launchpad-service-account"></a>Проверка учетной записи службы панели запуска

Учетная запись службы по умолчанию может иметь\$значение "NT Service SQL2016"\$или "NT Service SQL2017". Последняя часть может быть различной в зависимости от имени экземпляра SQL.

Служба панели запуска (запускает. exe) выполняется с использованием учетной записи службы с минимальными правами доступа. Однако, чтобы запустить R и Python и взаимодействовать с экземпляром базы данных, учетной записи службы панели запуска требуются следующие права пользователя:

- Вход в систему в качестве службы (SeServiceLogonRight)
- Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)
- Обход проходной проверки (SeChangeNotifyPrivilege)
- Настройка квот памяти для процесса (SeIncreaseQuotaSizePrivilege)

Сведения об этих правах пользователей см. в разделе "права и права Windows" статьи [Настройка учетных записей служб Windows и разрешений](../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).

> [!TIP]
> Если вы знакомы с использованием средства диагностики платформы поддержки (SDP) для диагностики SQL Server, можно использовать SDP для просмотра выходного файла с именем MachineName_UserRights. txt.

## <a name="user-group-for-launchpad-cannot-log-on-locally"></a>Группа пользователей для панели запуска не может войти в систему локально

Во время установки Службы машинного обучения SQL Server создает группу пользователей Windows **SQLRUserGroup** , а затем подготавливает ее ко всем правам, необходимым для запуска панели запуска для подключения к SQL Server и выполнения заданий внешнего скрипта. Если эта группа пользователей включена, она также используется для выполнения скриптов Python.

Однако в организациях, в которых применяются более строгие политики безопасности, права, которые требуются этой группе, могут быть удалены вручную или автоматически отменены политикой. Если права были удалены, панель запуска больше не может подключаться к SQL Server, и SQL Server не может вызвать внешнюю среду выполнения.

Чтобы устранить проблему, задайте для группы **SQLRUserGroup** разрешение **Локальный вход в систему**.

Дополнительные сведения см. в статье [Настройка учетных записей службы Windows и разрешений](../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).

## <a name="permissions-to-run-external-scripts"></a>Разрешения на запуск внешних скриптов

Даже если панель запуска настроена правильно, она возвращает ошибку, если у пользователя нет разрешения на выполнение скриптов R или Python.

Если вы установили SQL Server в качестве администратора базы данных или являетесь владельцем базы данных, вы автоматически предоставили это разрешение. Однако у других пользователей обычно есть более ограниченные разрешения. При попытке запустить скрипт R они получат ошибку панели запуска.

Чтобы устранить эту проблему, в SQL Server Management Studio администратор безопасности может изменить имя входа SQL или учетную запись пользователя Windows, выполнив следующий сценарий:

```sql
GRANT EXECUTE ANY EXTERNAL SCRIPT TO <username>
```

Дополнительные сведения см. в разделе [Grant (Transact-SQL](../t-sql/statements/grant-transact-sql.md)).

## <a name="common-launchpad-errors"></a>Распространенные ошибки панели запуска

В этом разделе перечислены наиболее распространенные сообщения об ошибках, возвращаемые панелью запуска.

::: moniker range=">=sql-server-2016||=sqlallproducts-allversions"
## <a name="unable-to-launch-runtime-for-r-script"></a>"Не удается запустить среду выполнения для скрипта R"

Если группа Windows для пользователей R (также используемая для Python) не может войти в экземпляр, на котором выполняются службы R, могут отобразиться следующие ошибки:

- Ошибки, возникающие при попытке выполнить скрипты R:

    * *Не удается запустить среду выполнения для скрипта R. Проверьте конфигурацию среды выполнения R*.

    * *Возникла ошибка во внешнем скрипте. Не удается запустить среду выполнения*.

- Ошибки, [!INCLUDE[rsql_launchpad](../includes/rsql-launchpad-md.md)] создаваемые службой:

    * *Не удалось инициализировать средство запуска RLauncher.dll*

    * *Библиотеки DLL средства запуска не зарегистрированы*

    * *Журналы безопасности указывают на то, что службе NT учетной записи не удалось выполнить вход*

Сведения о том, как предоставить этой группе пользователей необходимые разрешения, см. в разделе [Install SQL Server R Services](install/sql-r-services-windows-install.md).

> [!NOTE]
> Это ограничение не распространяется на тот случай, если вы используете имена входа SQL для выполнения скриптов R с удаленной рабочей станции.
::: moniker-end

## <a name="logon-failure-the-user-has-not-been-granted-the-requested-logon-type"></a>"Сбой входа: пользователь не предоставил запрошенный тип входа"

По умолчанию [!INCLUDE[rsql_launchpad_md](../includes/rsql-launchpad-md.md)] использует следующую учетную запись при запуске `NT Service\MSSQLLaunchpad`:. Учетная запись настраивается [!INCLUDE[ssNoVersion_md](../includes/ssnoversion-md.md)] программой установки и имеет все необходимые разрешения.

Если вы назначаете для панели запуска другую учетную запись или право удаляется политикой на SQL Server компьютере, учетная запись может не иметь необходимых разрешений, а также может появиться следующее сообщение об ошибке:

>*ERROR_LOGON_TYPE_NOT_GRANTED 1385 (0x569) Вход в систему не произведен: выбранный режим входа для данного пользователя на этом компьютере не предусмотрен*

Чтобы предоставить необходимые разрешения для новой учетной записи службы, используйте приложение локальной политики безопасности и обновите разрешения для учетной записи, включив в нее следующие разрешения:

+ Назначение квот памяти процессам (SeIncreaseQuotaPrivilege)
+ Обход проходной проверки (SeChangeNotifyPrivilege)
+ Вход в систему в качестве службы (SeServiceLogonRight)
+ Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)

## <a name="unable-to-communicate-with-the-launchpad-service"></a>"Не удается связаться со службой панели запуска"

Если вы установили и затем включили машинное обучение, но эта ошибка возникает при попытке запуска скрипта R или Python, служба панели запуска для экземпляра может быть остановлена.

1. Запустите диспетчер конфигурации SQL Server из командной строки Windows. Дополнительные сведения см. в разделе [SQL Server Configuration Manager](https://docs.microsoft.com/sql/relational-databases/sql-server-configuration-manager).

2. Щелкните правой кнопкой мыши панель запуска SQL Server экземпляра и выберите пункт **Свойства**.

3. Перейдите на вкладку **Служба** и убедитесь, что служба запущена. Если он не запущен, измените **режим запуска** на **Автоматический**и нажмите кнопку **Применить**.

4. Перезапуск службы обычно решает проблему, чтобы можно было запустить скрипты машинного обучения. Если перезагрузка не решает проблему, запишите путь и аргументы в свойстве путь к **двоичному** файлу и выполните следующие действия.

    1\. Проверьте файл. config средства запуска и убедитесь, что рабочий каталог является допустимым.

    2\. Убедитесь, что группа Windows, используемая панелью запуска, может подключаться к экземпляру SQL Server.

    В. При изменении каких бы то ни было свойств службы перезапустите службу панели запуска.

## <a name="fatal-error-creation-of-tmpfile-failed"></a>«Сбой создания неустранимой ошибки tmpFile»

В этом сценарии вы успешно установили компоненты машинного обучения, а панель запуска работает. Вы пытаетесь запустить некоторый простой код R или Python, но панель запуска завершается ошибкой следующего вида: 

>*Не удалось связаться со средой выполнения для скрипта R. Ознакомьтесь с требованиями среды выполнения R.*

В то же время среда выполнения внешнего скрипта записывает следующее сообщение как часть сообщения STDERR: 

>*Неустранимая ошибка: не удалось создать tmpfile.*

Эта ошибка означает, что учетная запись, которую пытается использовать панель запуска, не имеет разрешения на вход в базу данных. Такая ситуация может возникать, если реализованы политики безопасности. Чтобы определить, является ли это случайным, просмотрите журналы SQL Server и проверьте, не была ли учетная запись MSSQLSERVER01 запрещена при входе. Те же сведения предоставляются в журналах, относящихся к службам R\_или службам Python.\_ Найдите Екстлаунчеррор. log.

По умолчанию 20 учетных записей настраиваются и связываются с процессом панели запуска. exe с именами MSSQLSERVER01 по MSSQLSERVER20. При интенсивном использовании R или Python можно увеличить число учетных записей.

Чтобы устранить эту проблему, убедитесь, что группа *разрешает локальное подключение* к локальному экземпляру, где установлены и включены компоненты машинного обучения. В некоторых средах для этого уровня разрешений может потребоваться исключение GPO от сетевого администратора.

## <a name="not-enough-quota-to-process-this-command"></a>"Недостаточно квоты для обработки этой команды"

Эта ошибка может означать одно из следующих действий:

- Панель запуска может иметь недостаточно внешних пользователей для выполнения внешнего запроса. Например, при одновременном запуске более 20 внешних запросов и наличии только 20 пользователей по умолчанию может произойти сбой одного или нескольких запросов.

- Недостаточно памяти для обработки задачи R. Эта ошибка чаще всего возникает в среде по умолчанию, где SQL Server может использовать до 70 процентов ресурсов компьютера. Сведения о том, как изменить конфигурацию сервера для поддержки более высокого использования ресурсов на R, см. в разделе [эксплуатацию The r Code](r/operationalizing-your-r-code.md).

## <a name="cant-find-package"></a>"Не удается найти пакет"

Если запустить код R в SQL Server и получить это сообщение, но сообщение не получено при выполнении того же кода за пределами SQL Server, это означает, что пакет не был установлен в расположение библиотеки по умолчанию, используемое SQL Server.

Эта ошибка может возникать во многих случаях.

- На сервере был установлен новый пакет, но в доступе было отказано, поэтому R установил пакет в пользовательскую библиотеку.

- Вы установили службы R, а затем установили еще одно средство R или набор библиотек, включая Microsoft R Server (автономные), Microsoft R Client, RStudio и т. д.

Чтобы определить расположение библиотеки пакетов R, используемой экземпляром, откройте SQL Server Management Studio (или любое другое средство запроса базы данных), подключитесь к экземпляру служб, а затем выполните следующую хранимую процедуру:

```sql
EXEC sp_execute_external_script @language = N'R',  
@script = N' print(normalizePath(R.home())); print(.libPaths());'; 
```

#### <a name="sample-results"></a>Образец результатов

*Сообщения STDOUT из внешнего скрипта:*

*[1] "C:\\Program Files\\\\Microsoft SQL Server MSSQL13. SQL2016\\R_SERVICES "*

*[1] "C:/Program Files/Microsoft SQL Server/MSSQL13. SQL2016/R_SERVICES/Library "*

Чтобы устранить эту проблему, необходимо переустановить пакет в библиотеку экземпляров SQL Server.

::: moniker range=">=sql-server-2016||=sqlallproducts-allversions"
>[!NOTE]
>Если вы обновили экземпляр SQL Server 2016 для использования последней версии Microsoft R, расположение библиотеки по умолчанию отличается. Дополнительные сведения см. [в статье Использование SqlBindR для обновления экземпляра служб R](install/upgrade-r-and-python.md).
::: moniker-end

::: moniker range=">=sql-server-2016||=sqlallproducts-allversions"
## <a name="launchpad-shuts-down-due-to-mismatched-dlls"></a>Панель запуска завершает работу из-за несовпадений библиотек DLL

Если установить ядро СУБД с другими компонентами, исправить сервер, а затем добавить Машинное обучение компонент с помощью исходного носителя, может быть установлена неправильная версия компонентов Машинное обучение. Когда панель запуска обнаруживает несовпадение версий, она завершает работу и создает файл дампа.

Чтобы избежать этой проблемы, установите новые компоненты на том же уровне обновления, что и экземпляр сервера.

**Неправильный способ обновления:**

1. Установите SQL Server 2016 без служб R.
2. Обновление SQL Server 2016 накопительного пакета обновления 2.
3. Установите службы R (в базе данных) с помощью носителя RTM.

**Правильный способ обновления:**

1. Установите SQL Server 2016 без служб R.
2. Обновите SQL Server 2016 до требуемого уровня обновления. Например, установите пакет обновления 1 (SP1), а затем накопительное обновление 2.
3. Чтобы добавить компонент на правильном уровне обновления, запустите программу установки с пакетом обновления 1 (SP1) и CU2, а затем выберите службы R (в базе данных). 

## <a name="launchpad-fails-to-start-if-8dot3-notation-is-required"></a>Не удается запустить панель запуска, если требуется нотация 8.3

> [!NOTE] 
> В старых системах панель запуска может не запуститься, если задано требование нотации 8.3. Это требование было удалено в последующих выпусках. SQL Server 2016 служб R клиенты должны установить одну из следующих версий:
> * SQL Server 2016 с пакетом обновления 1 (SP1) и CU1: [Накопительное обновление 1 для SQL Server](https://support.microsoft.com/help/3208177/cumulative-update-1-for-sql-server-2016-sp1).
> * SQL Server 2016 RTM, Накопительное обновление 3 и это [исправление](https://support.microsoft.com/help/3210110/on-demand-hotfix-update-package-for-sql-server-2016-cu3), которое доступно по запросу.

Для совместимости с R SQL Server 2016 служб R (в базе данных) требуется диск, на котором установлена эта функция, для поддержки создания коротких имен файлов с помощью нотации *8dot3*. Имя файла 8,3 также называется *коротким именем файла*и используется для совместимости с более ранними версиями Microsoft Windows или в качестве альтернативы длинным именам файлов.

Если том, на котором устанавливается R, не поддерживает короткие имена файлов, то процессы, запускающие R с SQL Server, могут не иметь возможности выбрать нужный исполняемый файл, а панель запуска не запустится.

В качестве обходного решения можно включить нотацию 8dot3 на томе, где установлена SQL Server и где установлены службы R. Затем необходимо указать короткое имя для рабочего каталога в файле конфигурации служб R.

1. Чтобы включить нотацию 8dot3, запустите служебную программу fsutil с аргументом *8dot3name* , как описано здесь: [fsutil 8dot3name](https://technet.microsoft.com/library/ff621566(v=ws.11).aspx).

2. После включения нотации 8dot3 откройте файл RLauncher. config и обратите внимание на свойство объекта `WORKING_DIRECTORY`. Сведения о том, как найти этот файл, см. в разделе [сбор данных для машинное обучение устранении неполадок](data-collection-ml-troubleshooting-process.md).

3. Используйте служебную программу fsutil с аргументом *File* , чтобы указать короткий путь к файлу для папки, указанной в WORKING_DIRECTORY.

4. Измените файл конфигурации, указав тот же рабочий каталог, который вы указали в свойстве WORKING_DIRECTORY. Кроме того, можно указать другой рабочий каталог и выбрать существующий путь, который уже совместим с нотацией 8dot3.
::: moniker-end

## <a name="next-steps"></a>Следующие шаги

[Службы машинного обучения устранение неполадок и известные проблемы](machine-learning-troubleshooting-faq.md)

[Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md)

[Часто задаваемые вопросы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md)

[Устранение неполадок подключений к ядру СУБД](../database-engine/configure-windows/troubleshoot-connecting-to-the-sql-server-database-engine.md)
