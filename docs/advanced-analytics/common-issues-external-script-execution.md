---
title: Распространенные проблемы со службой панели запуска и выполнения внешнего скрипта - службы машинного обучения SQL Server
ms.prod: sql
ms.technology: ''
ms.date: 06/13/2019
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 2d7f82230dbc6b87bcc8f752c99b7c92ef759253
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "67963121"
---
# <a name="common-issues-with-launchpad-service-and-external-script-execution-in-sql-server"></a>Распространенные проблемы со службой панели запуска и выполнения внешних скриптов в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

 Служба запуска доверенного SQL Server поддерживает выполнение внешнего скрипта R и Python. В SQL Server 2016 R Services с пакетом обновления 1 предоставляет службу. SQL Server 2017 включает в себя службу панели запуска в процессе начальной установки.

Несколько проблемы могут препятствовать панели запуска с начала, включая проблемы с конфигурацией или изменения или отсутствуют сетевые протоколы. В этой статье содержатся рекомендации по устранению неполадок для многих проблем. Для любого мы пропустили, вы можете публиковать вопросы для [Machine Learning Server форум](https://social.msdn.microsoft.com/Forums/en-US/home?category=MicrosoftR).

## <a name="determine-whether-launchpad-is-running"></a>Определить, выполняется ли панель запуска

1. Откройте **служб** панели (Services.msc). Или из командной строки, введите **SQLServerManager13.msc** или **SQLServerManager14.msc** открыть [диспетчер конфигурации SQL Server](https://docs.microsoft.com/sql/relational-databases/sql-server-configuration-manager).

2. Запомните или запишите учетной записи службы, под которой работает панели запуска. Каждый экземпляр, где включена R или Python должен иметь свой собственный экземпляр службы панели запуска. Например, службы для именованного экземпляра может быть нечто вроде _MSSQLLaunchpad$ имя_экземпляра_.

3. Если служба остановлена, перезапустите его. На перезапуск, если возникли проблемы с конфигурацией, публикации сообщения в журнале событий системы и снова остановки службы. Проверьте журнал событий системы подробные сведения о остановки службы.

4. Просмотрите содержимое RSetup.log и убедитесь, что отсутствии ошибок в программе установки. Например, сообщение *выход с кодом 0* указывает на сбой службы для запуска.

5. Чтобы найти другие ошибки, просмотрите содержимое rlauncher.log.

## <a name="check-the-launchpad-service-account"></a>Проверьте учетную запись службы панели запуска

Учетная запись службы по умолчанию может быть «NT Service\$SQL2016» или «NT Service\$SQL2017». Заключительная часть может отличаться в зависимости от имени экземпляра SQL.

Служба панели запуска (Launchpad.exe) выполняется с помощью учетной записи службы с низким уровнем прав. Тем не менее чтобы запустить R и Python и взаимодействовать с экземпляром базы данных, учетной записи службы панели запуска требует следующие пользовательские права:

- Вход в систему в качестве службы (SeServiceLogonRight)
- Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)
- Обход проходной проверки (SeChangeNotifyPrivilege)
- Настройка квот памяти для процесса (SeIncreaseQuotaSizePrivilege)

Сведения о эти права пользователей, см. в разделе «Windows привилегии и права», в [Windows, настроить учетные записи и разрешения](../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).

> [!TIP]
> Если вы знакомы с использованием средства поддержки Diagnostics Platform (SDP) для диагностики SQL Server, можно использовать для просмотра выходного файла с именем MachineName_UserRights.txt SDP.

## <a name="user-group-for-launchpad-cannot-log-on-locally"></a>Группы пользователей для панели запуска не может выполнить вход

Во время установки служб машинного обучения SQL Server создает группу пользователей Windows **SQLRUserGroup** и затем настраивает его с полные права, необходимые для панели запуска для подключения к SQL Server и выполнения внешних скриптов заданий. Если этой группы пользователей включен, также используется для выполнения скриптов Python.

Тем не менее в организациях, где применяются более строгие политики безопасности, права, которые требуются от ошибок этой группой был вручную удален или они могут быть автоматически отозваны политикой. Если были удалены права, панель запуска больше не может подключиться к SQL Server и SQL Server не может вызывать внешние среду выполнения.

Чтобы устранить проблему, задайте для группы **SQLRUserGroup** разрешение **Локальный вход в систему**.

Дополнительные сведения см. в статье [Настройка учетных записей службы Windows и разрешений](../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).

## <a name="permissions-to-run-external-scripts"></a>Разрешения для выполнения внешних скриптов

Даже если панель запуска настроена правильно, он возвращает ошибку, если пользователь не имеет разрешения на выполнение сценариев R или Python.

Если вы являетесь владельцем базы данных SQL Server установлен как администратор базы данных, это разрешение автоматически предоставляются. Тем не менее другие пользователи обычно более ограниченные разрешения. При попытке выполнить сценарий R, они получают сообщение об ошибке панели запуска.

Чтобы решить эту проблему, в SQL Server Management Studio, администратор безопасности можно изменить имя входа SQL или учетная запись пользователя Windows, выполнив следующий сценарий:

```sql
GRANT EXECUTE ANY EXTERNAL SCRIPT TO <username>
```

Дополнительные сведения см. в разделе [GRANT (Transact-SQL](../t-sql/statements/grant-transact-sql.md).

## <a name="common-launchpad-errors"></a>Распространенные ошибки панели запуска

В этом разделе перечислены распространенные сообщения об ошибках, которые возвращает панели запуска.

## <a name="unable-to-launch-runtime-for-r-script"></a>«Не удается запустить среду выполнения для сценария R»

Если группы Windows для пользователей R (также используется для Python) не удается войти к экземпляру, на котором выполняются службы R, возможны следующие ошибки:

- Ошибки, создаваемые при попытке выполнения R-скриптов:

    * *Не удается запустить среду выполнения для скрипта R. Проверьте конфигурацию среды выполнения R*.

    * *Возникла ошибка во внешнем скрипте. Не удается запустить среду выполнения*.

- Ошибки, создаваемые [!INCLUDE[rsql_launchpad](../includes/rsql-launchpad-md.md)] службы:

    * *Не удалось инициализировать средство запуска RLauncher.dll*

    * *Библиотеки DLL средства запуска не зарегистрированы*

    * *Журналы безопасности указывают, что учетная запись NT SERVICE не удалось войти в систему*

Сведения о том, как предоставить необходимые разрешения для этой группы пользователей, см. в разделе [установить SQL Server 2016 R Services](install/sql-r-services-windows-install.md).

> [!NOTE]
> Это ограничение не распространяется на тот случай, если вы используете имена входа SQL для выполнения скриптов R с удаленной рабочей станции.

## <a name="logon-failure-the-user-has-not-been-granted-the-requested-logon-type"></a>«Ошибка входа в систему: пользователь не имеет режим входа»

По умолчанию [!INCLUDE[rsql_launchpad_md](../includes/rsql-launchpad-md.md)] использует при запуске следующую учетную запись: `NT Service\MSSQLLaunchpad`. Учетная запись настроена по [!INCLUDE[ssNoVersion_md](../includes/ssnoversion-md.md)] программу установки, чтобы все необходимые разрешения.

Если назначить другую учетную запись для запуска, или разрешение будет удалено политикой на компьютере с SQL Server, учетной записи могут отсутствовать необходимые разрешения, и может отображаться следующая ошибка:

>*ERROR_LOGON_TYPE_NOT_GRANTED 1385 (0x569) Вход в систему не произведен: выбранный режим входа для данного пользователя на этом компьютере не предусмотрен*

Чтобы предоставить необходимые разрешения для новой учетной записи службы, используйте приложение Локальная политика безопасности и обновить разрешения для учетной записи, включив следующие разрешения:

+ Назначение квот памяти процессам (SeIncreaseQuotaPrivilege)
+ Обход проходной проверки (SeChangeNotifyPrivilege)
+ Вход в систему в качестве службы (SeServiceLogonRight)
+ Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)

## <a name="unable-to-communicate-with-the-launchpad-service"></a>«Не удается связаться со службой панели запуска»

Если вы установили и затем включен машинного обучения, но вы получаете эту ошибку при попытке выполнить сценарий R или Python, служба панели запуска для экземпляра может остановки выполнения.

1. Запустите диспетчер конфигурации SQL Server из командной строки Windows. Дополнительные сведения см. в разделе [SQL Server Configuration Manager](https://docs.microsoft.com/sql/relational-databases/sql-server-configuration-manager).

2. Щелкните правой кнопкой мыши панель запуска SQL Server для экземпляра, а затем выберите **свойства**.

3. Выберите **службы** и убедитесь, что служба запущена. Если он не работает, измените **перейти в режим** для **автоматического**, а затем выберите **применить**.

4. Перезапуск службы обычно решает проблему, чтобы обеспечить возможность выполнения сценариев. Если перезапуск не устранит проблему, обратите внимание, путь и аргументы в **путь к двоичным файлам** свойства и выполните следующее:

    1\. Просмотрите средство запуска config-файл и проверьте правильность рабочего каталога.

    2\. Убедитесь, что группа Windows, которая используется панелью запуска может подключиться к экземпляру SQL Server.

    В. При изменении каких-либо свойств службы, перезапустите службу панели запуска.

## <a name="fatal-error-creation-of-tmpfile-failed"></a>«Не удалось создать Неустранимая ошибка tmpFile»

В этом сценарии вы успешно установили функции машинного обучения и панель запуска работает. Попытаться выполнить простой код R или Python, но панель запуска завершается с ошибкой следующим образом: 

>*Не удается связаться со средой выполнения для скрипта r. Проверьте требования среды выполнения R.*

В то же время среда выполнения внешнего скрипта записывает сообщение как часть сообщения STDERR: 

>*Неустранимая ошибка: создание tmpfile не удалось.*

Эта ошибка означает, что учетная запись, пытается использовать панель запуска не имеет разрешения на вход в базу данных. Эта ситуация может произойти при реализации строгие политики безопасности. Чтобы определить, является ли это так, просмотрите журналы SQL Server и проверьте для просмотра, запрещен ли MSSQLSERVER01 учетной записи при входе в систему. Те же сведения предоставляются в журналах, которые являются специфичными для R\_СЛУЖБ или PYTHON\_СЛУЖБ. Найдите ExtLaunchError.log.

По умолчанию настраиваются и связанный с процессом Launchpad.exe, с именами MSSQLSERVER01 через MSSQLSERVER20 20 учетных записей. Если вы активно использовать R или Python, можно увеличить количество учетных записей.

Чтобы устранить проблему, убедитесь, что группа имеет *локальный вход в систему* разрешения на локальном экземпляре, где установлены и включены функции машинного обучения. В некоторых средах этот уровень разрешений может потребоваться исключению объекта групповой Политики администратора сети.

## <a name="not-enough-quota-to-process-this-command"></a>«Недостаточно квот для обработки команды»

Эта ошибка может означать одной из следующих причин:

- Панель запуска может быть недостаточно внешних пользователей для запуска внешнего запроса. Например если вы используете более чем 20 внешних запросов одновременно, и имеется только 20 пользователей по умолчанию, один или несколько запросов может завершиться ошибкой.

- Недостаточно памяти для выполнения задачи «R». Эта ошибка возникает чаще всего в среде по умолчанию, в котором SQL Server может использоваться до 70 процентов ресурсов компьютера. Сведения о том, как изменить конфигурацию сервера для поддержки лучше использовать ресурсы по R, см. в разделе [ввод в эксплуатацию кода R](r/operationalizing-your-r-code.md).

## <a name="cant-find-package"></a>«Не удается найти пакет»

Если выполнять код R в SQL Server и получить это сообщение, но не получил сообщение, при выполнении один и тот же код за пределами SQL Server, это означает, что пакет не был установлен в расположение библиотеки по умолчанию, используемый сервером SQL Server.

Эта ошибка может возникнуть во многих отношениях:

- Вы установили новый пакет на сервере, но было отказано в доступе, поэтому R необходимо установить пакет в пользовательской библиотеке.

- Вы установили службы R установлен другой инструмент R или набор библиотек, включая Microsoft R Server (изолированный), Microsoft R Client, RStudio и так далее.

Чтобы определить расположение библиотеки пакетов R, который используется экземпляром, откройте SQL Server Management Studio (или другом средстве запросов базы данных), подключитесь к экземпляру и выполните следующую хранимую процедуру:

```sql
EXEC sp_execute_external_script @language = N'R',  
@script = N' print(normalizePath(R.home())); print(.libPaths());'; 
```

#### <a name="sample-results"></a>Образец результатов

*Сообщения STDOUT из внешнего скрипта:*

*[1] «C:\\Program Files\\Microsoft SQL Server\\MSSQL13. SQL2016\\R_SERVICES»*

*[1] «C:/Program файлы или Microsoft SQL Server/MSSQL13. SQL2016 / / библиотеку R_SERVICES»*

Чтобы устранить проблему, необходимо переустановить пакет в библиотеку экземпляра SQL Server.

>[!NOTE]
>При обновлении экземпляра SQL Server 2016, чтобы использовать последнюю версию Microsoft R, расположения библиотеки по умолчанию отличается. Дополнительные сведения см. в разделе [об использовании программы SqlBindR для обновления экземпляра служб R](install/upgrade-r-and-python.md).

## <a name="launchpad-shuts-down-due-to-mismatched-dlls"></a>Панель запуска завершает работу из-за несоответствия библиотек DLL

Если вы устанавливаете ядро базы данных с другими компонентами, исправление сервера и затем добавить функцию машинного обучения с помощью исходного носителя, могут устанавливаться неправильной версии компонентов машинного обучения. Когда панель запуска обнаруживает несоответствие версий, он завершает работу и создает файл дампа.

Чтобы избежать этой проблемы, не забудьте установить любыми новыми функциями с таким же уровнем исправлений как на экземпляре сервера.

**Неправильный способ обновления:**

1. Установка SQL Server 2016 без служб R Services.
2. Обновление SQL Server 2016 накопительный пакет обновления 2.
3. Установка служб R (в базе данных) с помощью носителя RTM.

**Правильный способ обновления:**

1. Установка SQL Server 2016 без служб R Services.
2. Обновление SQL Server 2016 до уровень нужного исправления. Например установите пакет обновления 1, а затем накопительный пакет обновления 2.
3. Чтобы добавить компонент на уровне правильные исправления, снова запустите программу установки с пакетом обновления 1 и накопительным пакетом обновления 2 и выберите службы R (в базе данных). 

## <a name="launchpad-fails-to-start-if-8dot3-notation-is-required"></a>Панель запуска не запускается, если требуется нотация 8dot3

> [!NOTE] 
> В старых системах панели запуска может не запускаться, если потребность в нотации 8dot3. Это требование был удален в последующих выпусках. SQL Server 2016 R Services пользователи должны установить одно из следующих значений:
> * SQL Server 2016 SP1 и CU1: [Накопительный пакет обновления 1 для SQL Server](https://support.microsoft.com/help/3208177/cumulative-update-1-for-sql-server-2016-sp1).
> * SQL Server 2016 RTM с накопительным обновлением 3 и это [исправление](https://support.microsoft.com/help/3210110/on-demand-hotfix-update-package-for-sql-server-2016-cu3), которая доступна по запросу.

Для совместимости с R, SQL Server 2016 R Services (в базе данных) требуется диск, где он установлен для поддержки создания коротких имен файлов с помощью *нотацию 8dot3*. Именем файла 8.3 также называется *короткое имя файла*, и он используется для совместимости с предыдущими версиями Microsoft Windows или в качестве альтернативы длинные имена файлов.

Если том, где вы устанавливаете R не поддерживает короткие имена файлов, процессы, запускающие R из SQL Server не может иметь возможность найти соответствующий исполняемый файл и панель запуска не запустится.

Обойти это ограничение вы можете включить нотацию 8dot3 в томе, где установлен SQL Server и где установлены службы R. Затем необходимо указать короткое имя для рабочего каталога в файле конфигурации служб R.

1. Чтобы включить нотацию 8dot3, выполните программу fsutil с *8dot3name* аргумент, как описано здесь: [fsutil 8dot3name](https://technet.microsoft.com/library/ff621566(v=ws.11).aspx).

2. После включения нотации 8dot3 откройте файл RLauncher.config и обратите внимание на свойство объекта `WORKING_DIRECTORY`. Сведения о том, как найти этот файл, см. в разделе [сбора данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md).

3. Используйте программу fsutil с *файл* аргумент, чтобы указать короткий путь к папке, указанной в свойстве WORKING_DIRECTORY.

4. Измените файл конфигурации, чтобы указать тот же рабочий каталог, который вы ввели в свойстве WORKING_DIRECTORY. Кроме того можно указать другой рабочий каталог и выберите существующий путь, который уже совместим с нотацией 8dot3.


## <a name="next-steps"></a>Следующие шаги

[Устранение неполадок службы обучения машины и известные проблемы](machine-learning-troubleshooting-faq.md)

[Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md)

[Часто задаваемые вопросы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md)

[Устранение неполадок соединения с ядром СУБД](../database-engine/configure-windows/troubleshoot-connecting-to-the-sql-server-database-engine.md)
