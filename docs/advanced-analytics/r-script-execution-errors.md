---
title: Ошибки и устранение неполадок в сценариях R
ms.prod: sql
ms.technology: machine-learning
ms.date: 05/31/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
monikerRange: '>=sql-server-2016||>=sql-server-linux-ver15||=sqlallproducts-allversions'
ms.openlocfilehash: 10ec78bf8627bfef3232dfc72d7ef7f638604b15
ms.sourcegitcommit: 321497065ecd7ecde9bff378464db8da426e9e14
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/01/2019
ms.locfileid: "68715754"
---
# <a name="r-scripting-errors-in-sql-server"></a>Ошибки скрипта R в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

В этой статье описываются некоторые ошибки, возникающие при выполнении кода R в SQL Server. Список не является исчерпывающим. Существует множество пакетов, и ошибки могут различаться в разных версиях одного пакета. Рекомендуется опубликовать ошибки сценария на [форуме Machine Learning Server](https://social.msdn.microsoft.com/Forums/en-US/home?category=MicrosoftR), который поддерживает компоненты машинного обучения, используемые в службах R (в базе данных), Microsoft R Client и Microsoft R Server.

## <a name="valid-script-fails-in-t-sql-or-in-stored-procedures"></a>Сбой допустимого скрипта в T-SQL или хранимых процедурах

Перед заключением кода R в хранимую процедуру рекомендуется запускать код R во внешней среде IDE или в одном из таких средств R, как RTerm или RGui. С помощью этих методов можно тестировать и отлаживать код с помощью подробных сообщений об ошибках, возвращаемых R.

Однако иногда код, который прекрасно работает в внешней среде IDE или служебной программе, может не запуститься в хранимой процедуре или в контексте SQL Serverного вычислений. В этом случае существует ряд проблем, которые необходимо выполнить, прежде чем можно будет предположить, что пакет не работает в SQL Server.

1. Проверьте, запущена ли панель запуска.

2. Просмотрите сообщения, чтобы узнать, содержат ли входные данные или выходные данные столбцы с несовместимыми или неподдерживаемыми типами данных. Например, запросы к базе данных SQL часто возвращают идентификаторы GUID или ROWGUID, которые не поддерживаются. Дополнительные сведения см. в разделе [библиотеки R и типы данных](r/r-libraries-and-data-types.md).

3. Проверьте страницы справки по отдельным функциям R, чтобы определить, поддерживаются ли для контекста вычислений SQL Server все параметры. Для справки по использованию функции масштабирования используйте встроенные команды R Help или см. раздел [Справочник](https://docs.microsoft.com/r-server/r-reference/revoscaler/revoscaler)по пакетам.

Если среда выполнения R работает, но скрипт возвращает ошибки, рекомендуется попробовать выполнить отладку скрипта в выделенной среде разработки R, например Инструменты R для Visual Studio.

Также рекомендуется проверить и немного переписать сценарий, чтобы устранить проблемы с типами данных, которые могут возникнуть при перемещении данных между R и ядром СУБД. Дополнительные сведения см. в разделе [библиотеки R и типы данных](r/r-libraries-and-data-types.md).

Кроме того, пакет sqlrutils можно использовать для объединения скрипта R в формате, который проще использовать в качестве хранимой процедуры. Дополнительные сведения см. в разделе:
* [пакет sqlrutils](r/ref-r-sqlrutils.md)
* [Создание хранимой процедуры с помощью sqlrutils](r/how-to-create-a-stored-procedure-using-sqlrutils.md)

## <a name="script-returns-inconsistent-results"></a>Скрипт возвращает непротиворечивые результаты

Скрипты R могут возвращать разные значения в контексте SQL Server по нескольким причинам:

- Неявное преобразование типов выполняется автоматически для некоторых типов данных, когда данные передаются между SQL Server и R. Дополнительные сведения см. в разделе [библиотеки R и типы данных](r/r-libraries-and-data-types.md).

- Определите, является ли разрядность коэффициентом. Например, часто возникают различия в результатах математических операций для 32-разрядных и 64-разрядных библиотек с плавающей точкой.

- Определите, были ли созданы значений NaN в любой операции. Это может сделать результаты недействительными.

- Небольшие различия могут быть усилителями, если вы принимаете обратное число, равное нулю.

- Накопленные ошибки округления могут вызвать такие вещи, как значения, которые меньше нуля, а не равны нулю.

## <a name="implied-authentication-for-remote-execution-via-odbc"></a>Подразумеваемая проверка подлинности для удаленного выполнения через ODBC

При подключении к [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] компьютеру для выполнения команд R с помощью функций **RevoScaleR** может возникнуть ошибка при использовании вызовов ODBC, которые записывают данные на сервер. Эта ошибка возникает только при использовании проверки подлинности Windows.

Причина заключается в том, что рабочие учетные записи, созданные для служб R, не имеют разрешения на подключение к серверу. Поэтому вызовы ODBC не могут выполняться от вашего имени. Проблема не возникает при использовании имен входа SQL, так как при использовании имен входа SQL учетные данные передаются явным образом с клиента R на экземпляр SQL Server, а затем в ODBC. Однако использование имен входа SQL также менее безопасно, чем использование проверки подлинности Windows.

Чтобы обеспечить безопасную передачу учетных данных Windows из сценария, который инициируется удаленно, SQL Server должны эмулировать учетные данные. Этот процесс называется неявной _проверкой_подлинности. Чтобы сделать это, рабочие учетные записи, выполняющие скрипты R или Python на компьютере SQL Server, должны иметь соответствующие разрешения.

1. Откройте [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] в качестве администратора на экземпляре, в котором нужно запустить код R.

2. Выполните приведенный ниже скрипт. Не забудьте изменить имя группы пользователей, если вы изменили значение по умолчанию, а также имена компьютера и экземпляра.

    ```sql
    USE [master]
    GO
    
    CREATE LOGIN [computername\\SQLRUserGroup] FROM WINDOWS WITH
    DEFAULT_DATABASE=[master], DEFAULT_LANGUAGE=[language]
    GO
    ```

## <a name="avoid-clearing-the-workspace-while-youre-running-r-in-a-sql-compute-context"></a>Избегайте очистки рабочей области во время выполнения R в контексте вычислений SQL

Хотя очистка рабочей области часто выполняется при работе в консоли R, она может иметь непредвиденные последствия в контексте вычислений SQL.

`revoScriptConnection`объект в рабочей области R, содержащий сведения о сеансе R, который вызывается из SQL Server. Однако если код R содержит команду для очистки рабочей области (например `rm(list=ls())`,), все сведения о сеансе и других объектах в рабочей области R также очищаются.

В качестве обходного решения старайтесь не разграничить очистку переменных и других объектов при запуске R в SQL Server. Вы можете удалить определенные переменные с помощью функции **Remove** :

```R
remove('name1', 'name2', ...)
```

Если необходимо удалить несколько переменных, рекомендуется сохранить имена временных переменных в списке, а затем выполнить периодические сборки мусора в списке.



## <a name="next-steps"></a>Следующие шаги

[Службы машинного обучения устранение неполадок и известные проблемы](machine-learning-troubleshooting-faq.md)

[Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md)

[Часто задаваемые вопросы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md)

[Устранение неполадок подключений к ядру СУБД](../database-engine/configure-windows/troubleshoot-connecting-to-the-sql-server-database-engine.md)
