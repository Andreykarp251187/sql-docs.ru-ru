---
title: R сценариев ошибки и устранение неполадок - службы машинного обучения SQL Server
ms.prod: sql
ms.technology: machine-learning
ms.date: 05/31/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.openlocfilehash: 49ac7419988df86d18f8e44edc8ef9fddacc7f7b
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "67962727"
---
# <a name="r-scripting-errors-in-sql-server"></a>Ошибок создания скриптов R в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье описываются несколько gerrors scriptin при выполнении кода R в SQL Server. Список не является исчерпывающим. Существует множество пакетов, и ошибки могут различаться между версиями одного пакета. Рекомендуется публиковать ошибки сценария на [Machine Learning Server форум](https://social.msdn.microsoft.com/Forums/en-US/home?category=MicrosoftR), который поддерживает машинного обучения компоненты, используемые в службы R (в базе данных), Microsoft R Client и Microsoft R Server.

**Применимо к:** Службы R SQL Server 2016, SQL Server 2017 службы машинного обучения


## <a name="valid-script-fails-in-t-sql-or-in-stored-procedures"></a>Допустимый сценарий завершается ошибкой, в T-SQL или хранимые процедуры

Перед упаковкой кода R в хранимой процедуре, рекомендуется запустить код R в внешнюю среду IDE или в одном из средств R, например RTerm и RGui. С помощью этих методов, можно протестировать и отладить код с помощью подробные сообщения об ошибках, возвращаемых функцией R.

Тем не менее иногда код, который отлично работает в внешнего интегрированной среды разработки или служебной программы может завершиться ошибкой для запуска в хранимой процедуре или контекст вычислений SQL Server. В этом случае существует множество проблем, искать, прежде чем можно предположить, что пакет не работает в SQL Server.

1. Проверьте, работает ли панель запуска.

2. Просмотрите сообщения, чтобы узнать, содержит ли выходные данные или входных данных столбцы с типами данных несовместимы или не поддерживается. Например запросы к базе данных SQL часто возвращают идентификаторы GUID или идентификаторами RowGUIDs, которые не поддерживаются. Дополнительные сведения см. в разделе [R библиотеки и типы данных](r/r-libraries-and-data-types.md).

3. Просмотрите страницы справки для отдельных функций R определить, поддерживаются ли все параметры для контекста вычислений SQL Server. Справку по ScaleR, используйте команды help встроенный R или см. в разделе [ссылки на пакет](https://docs.microsoft.com/r-server/r-reference/revoscaler/revoscaler).

Если среда выполнения R работает, но скрипт возвращает ошибки, рекомендуется попробовать отладки сценария в выделенную среду разработки R, например средства R для Visual Studio.

Мы также рекомендуем изучить и немного измените сценарий для исправления проблем с типами данных, которые могут возникнуть при перемещении данных между R и компонент database engine. Дополнительные сведения см. в разделе [R библиотеки и типы данных](r/r-libraries-and-data-types.md).

Кроме того можно использовать пакету sqlrutils для формирования пакета R-скриптов в формате, который является более простой в использовании как хранимую процедуру. Дополнительные сведения см. в разделе:
* [пакету sqlrutils](r/ref-r-sqlrutils.md)
* [Создание хранимой процедуры с помощью sqlrutils](r/how-to-create-a-stored-procedure-using-sqlrutils.md)

## <a name="script-returns-inconsistent-results"></a>Сценарий возвращает несогласованные результаты

Скрипты R могут возвращать различные значения в контексте SQL Server, по следующим причинам:

- Неявное преобразование типов выполняется автоматически на некоторые типы данных при передаче данных между SQL Server и R. Дополнительные сведения см. в разделе [R библиотеки и типы данных](r/r-libraries-and-data-types.md).

- Определение разрядности фактор. Например часто существуют различия в результатах выполнения математических операций для 32-разрядных и 64-разрядных библиотек точки с плавающей запятой.

- Определите, созданы ли значения NaN в любой операции. Это может нарушить целостность результатов.

- Могут быть более масштабными небольшие различия, при выполнении обратную величину номер близок к нулю.

- Накопленные ошибки округления может привести к, что значения, которые меньше нуля, а не с нуля.

## <a name="implied-authentication-for-remote-execution-via-odbc"></a>Неявная проверка подлинности для удаленного выполнения с помощью ODBC

При подключении к [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] компьютер для запуска R команды с помощью **RevoScaleR** функции, может появиться ошибка при использовании вызовов ODBC, которые записывают данные на сервер. Эта ошибка возникает только в том случае, если вы используете проверку подлинности Windows.

Причина заключается в том, что рабочие учетные записи, созданные для служб R имеет разрешение на подключение к серверу. Таким образом невозможно выполнить вызовы ODBC от вашего имени. Проблема возникает с именами входа SQL, поскольку с именами входа SQL, учетные данные передаются явно из клиента R в экземпляре SQL Server, а затем в ODBC. Тем не менее с помощью имен входа SQL также менее безопасной, чем с использованием проверки подлинности Windows.

Чтобы включить свои учетные данные Windows, чтобы безопасно передаваться из сценария, который запустил удаленно, SQL Server должна эмулировать систему учетные данные. Этот процесс называется _неявной проверки подлинности_. Для выполнения этой работы, рабочие учетные записи запуска сценариев R или Python на компьютере SQL Server должен иметь правильные разрешения.

1. Откройте [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] с правами администратора на экземпляре, где вы хотите запустить код R.

2. Выполните приведенный ниже скрипт. Не забудьте изменить имя группы пользователей, если вы изменили значение по умолчанию, а также имена компьютера и экземпляра.

    ```sql
    USE [master]
    GO
    
    CREATE LOGIN [computername\\SQLRUserGroup] FROM WINDOWS WITH
    DEFAULT_DATABASE=[master], DEFAULT_LANGUAGE=[language]
    GO
    ```

## <a name="avoid-clearing-the-workspace-while-youre-running-r-in-a-sql-compute-context"></a>Старайтесь не очищать рабочую область при запуске R в контексте вычислений SQL.

Несмотря на то, что очистка рабочих областей является распространенным, при работе в консоли R, он может иметь непредвиденные последствия в SQL контекста вычислений.

`revoScriptConnection` — Это объект в рабочем пространстве R, содержащий сведения о сеансе R, вызываемой из SQL Server. Тем не менее если код R содержит команду для очистки рабочей области (такие как `rm(list=ls())`), все сведения о сеансе и других объектов в рабочей области R также очищается.

Чтобы избежать этого не рекомендуется беспорядочное очищать переменные и другие объекты при запуске R в SQL Server. Переменные можно удалить с помощью **удалить** функции:

```R
remove('name1', 'name2', ...)
```

Если нужно удалить несколько переменных, рекомендуется сохранять имена временных переменных в списке и затем выполнить периодической сборки мусора в списке.



## <a name="next-steps"></a>Следующие шаги

[Устранение неполадок службы обучения машины и известные проблемы](machine-learning-troubleshooting-faq.md)

[Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md)

[Часто задаваемые вопросы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md)

[Устранение неполадок соединения с ядром СУБД](../database-engine/configure-windows/troubleshoot-connecting-to-the-sql-server-database-engine.md)
