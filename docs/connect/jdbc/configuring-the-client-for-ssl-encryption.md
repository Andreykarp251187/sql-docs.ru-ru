---
title: Настройка SSL-шифрования на клиенте | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
ms.assetid: ae34cd1f-3569-4759-80c7-7c9b33b3e9eb
author: MightyPen
ms.author: genemi
manager: jroth
ms.openlocfilehash: 9f5ec4a56beb5595353671c0f2aab18bf30e5f87
ms.sourcegitcommit: ad2e98972a0e739c0fd2038ef4a030265f0ee788
ms.translationtype: MTE75
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66797465"
---
# <a name="configuring-the-client-for-ssl-encryption"></a>Настройка SSL-шифрования на клиенте
[!INCLUDE[Driver_JDBC_Download](../../includes/driver_jdbc_download.md)]

  [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] или клиент должен проверить правильность сервера, а также убедиться, что его сертификат выдан центром сертификации, которому доверяет клиент. Чтобы проверить сертификат сервера, необходимо при соединении предоставить данные о доверии. Кроме того, поставщик сертификата сервера должен быть центром сертификации, которому доверяет клиент.  
  
 В начале этого раздела описано, как задать материал доверия на клиентском компьютере. Далее в этом разделе приведено описание того, как импортировать сертификат сервера в хранилище доверия клиентского компьютера, если экземпляр сертификата SSL для SQL Server выдан закрытым центром сертификации.  
  
 Дополнительные сведения о проверке сертификата сервера см. в разделе "Проверка сертификата SSL сервера" в секции [Основные сведения о поддержке SSL](../../connect/jdbc/understanding-ssl-support.md).  
  
## <a name="configuring-the-client-trust-store"></a>Настройка клиентского хранилища доверия  
 Для проверки сертификата сервера требуется, чтобы материал доверия был предоставлен во время соединения либо с помощью явно заданных свойств соединения **trustStore** и **trustStorePassword**, либо с помощью неявно заданного хранилища доверия по умолчанию базовой виртуальной машины Java. Дополнительные сведения о том, как задавать свойства **trustStore** и **trustStorePassword** в строке соединения, см. в разделе [Соединение с помощью SSL-шифрования](../../connect/jdbc/connecting-with-ssl-encryption.md).  
  
 Если свойство **trustStore** не задано или имеет значение NULL, то [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] полагается на поставщик безопасности базовой виртуальной машины Java, то есть расширение защищенных сокетов Java (SunJSSE). Поставщик SunJSSE предоставляет по умолчанию TrustManager, который используется для проверки сертификатов X.509, возвращенных SQL Server, по материалу доверия, предоставленному в хранилище доверия.  
  
 TrustManager предпринимает попытки найти предусмотренное по умолчанию свойство trustStore в следующем порядке поиска.  
  
-   Если системное свойство "javax.net.ssl.trustStore" определено, то TrustManager пытается найти файл trustStore по умолчанию с помощью имени файла, указанного этим системным свойством.  
  
-   Если свойство системы "javax.net.ssl.trustStore" не указано и существует файл "\<java-home>/lib/security/jssecacerts", то используется этот файл.  
  
-   Если файл"\<java-home>/lib/security/cacerts" существует, то используется именно он.  
  
 Дополнительные сведения см. в документации интерфейса SUNX509 TrustManager на веб-сайте Sun Microsystems.  
  
 Среда выполнения Java позволяет задавать системные свойства trustStore и trustStorePassword следующим образом.  
  
```  
java -Djavax.net.ssl.trustStore=C:\MyCertificates\storeName  
java -Djavax.net.ssl.trustStorePassword=storePassword  
```  
  
 В этом случае любое приложение, запущенное на данной виртуальной машине JVM, будет использовать данные параметры по умолчанию. Чтобы переопределить параметры по умолчанию в приложении, необходимо задать свойства соединения **trustStore** и **trustStorePassword** в строке соединения или в соответствующем методе задания класса [SQLServerDataSource](../../connect/jdbc/reference/sqlserverdatasource-class.md).  
  
 Кроме того, можно настраивать файлы хранилища доверия по умолчанию, например "\<java-home>/lib/security/jssecacerts" и "\<java-home>/lib/security/cacerts", и управлять ими. Для этого предназначена программа JAVA «keytool», которая устанавливается вместе со средой выполнения Java (JRE). Дополнительные сведения о программе «keytool» см. в документации по keytool на веб-сайте Sun Microsystems.  
  
### <a name="importing-the-server-certificate-to-trust-store"></a>Импорт сертификата сервера в хранилище доверия  
 Во время SSL-подтверждения сервер отправляет свой сертификат открытого ключа клиенту. Поставщик сертификата открытого ключа называется центром сертификации (ЦС). Клиент должен убедиться, что рассматриваемый центр сертификации является для клиента доверенным. Для этого заранее изучаются открытые ключи доверенных центров сертификации. JVM обычно поставляется со стандартным набором доверенных центров сертификации.  
  
 Если используемый экземпляр сертификата SSL для SQL Server выдан закрытым центром сертификации, то необходимо добавить этот сертификат центра сертификации к списку доверенных сертификатов в хранилище доверия клиентского компьютера.  
  
 Для этого используется программа JAVA «keytool», которая устанавливается со средой выполнения Java (JRE). В следующей командной строке показано, как использовать программу «keytool» для импорта сертификата из файла.  
  
```  
keytool -import -v -trustcacerts -alias myServer -file caCert.cer -keystore truststore.ks  
```  
  
 В этом примере в качестве файла сертификата используется файл «caCert.cer». Этот файл сертификата необходимо получить с сервера. Следующие шаги показывают, как экспортировать сертификат сервера в файл.  
  
1.  Нажмите «Пуск», затем «Выполнить» и введите MMC. (MMC — сокращение от Microsoft Management Console, консоль управления Microsoft.)  
  
2.  В программе MMC откройте окно «Сертификаты».  
  
3.  Разверните элемент «Личный», затем «Сертификаты».  
  
4.  Щелкните правой кнопкой мыши сертификат сервера и выберите «Все задачи/Экспорт».  
  
5.  Нажмите кнопку «Далее», чтобы перейти к окну, которое следует за диалоговым окном приветствия мастера экспорта сертификатов.  
  
6.  Убедитесь, что выбрано значение «Нет, не экспортировать закрытый ключ», затем нажмите «Далее».  
  
7.  Выберите либо двоичное значение в DER-кодировке X.509 (.CER), либо в Base64-кодировке X.509 (.CER) и нажмите кнопку «Далее».  
  
8.  Введите имя файла для экспорта.  
  
9. Нажмите кнопку «Далее», затем нажмите кнопку «Готово», чтобы экспортировать сертификат.  
  
## <a name="see-also"></a>См. также:  
 [Использование SSL-шифрования](../../connect/jdbc/using-ssl-encryption.md)   
 [Защита приложений драйвера JDBC](../../connect/jdbc/securing-jdbc-driver-applications.md)  
  
  
