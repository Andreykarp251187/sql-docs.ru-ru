---
title: Доступ к диагностическим сведениям в журнале расширенных событий | Документы Майкрософт
ms.custom: ''
ms.date: 07/11/2018
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
ms.assetid: a79e9468-2257-4536-91f1-73b008c376c3
author: MightyPen
ms.author: genemi
manager: jroth
ms.openlocfilehash: 0b13f081338e26aaa33306998d3e562088609a6a
ms.sourcegitcommit: ad2e98972a0e739c0fd2038ef4a030265f0ee788
ms.translationtype: MTE75
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66770516"
---
# <a name="accessing-diagnostic-information-in-the-extended-events-log"></a>Доступ к диагностическим сведениям в журнале расширенных событий
[!INCLUDE[Driver_JDBC_Download](../../includes/driver_jdbc_download.md)]

  В [!INCLUDE[jdbc_40](../../includes/jdbc_40_md.md)] трассировка ([Трассировка операций драйвера](../../connect/jdbc/tracing-driver-operation.md)) обновилась, что позволило упростить сопоставление событий клиентов с диагностической информацией, например ошибками соединения, из кольцевого буфера соединений сервера и со сведениями о производительности приложений в журнале расширенных событий. Дополнительные сведения о чтении журнала расширенных событий см. в разделе [View Event Session Data](https://msdn.microsoft.com/library/hh710068(SQL.110).aspx).  
  
## <a name="details"></a>Сведения  
 При выполнении операций соединения [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] передает идентификатор соединения клиента. Если подключение завершилось ошибкой, то можно в кольцевом буфере подключений ([Устранение связанных с подключением неполадок в SQL Server 2008 с использованием кольцевого буфера подключений](https://go.microsoft.com/fwlink/?LinkId=207752)) найти поле **ClientConnectionID** и получить диагностические данные по ошибке подключения. Идентификаторы подключений клиентов регистрируются в кольцевом буфере только при возникновении ошибки. (Если подключение завершилось сбоем до отправки предварительного пакета входа, то идентификатор подключения клиента не формируется.) Идентификатор клиентского соединения — это 16-байтовый идентификатор GUID. Идентификатор подключения клиента также можно найти в расположении вывода расширенных событий, если действие **client_connection_id** добавляется к событиям в сеансе расширенных событий. Если необходима дополнительная помощь в диагностике драйвера клиента, то можно включить трассировку, повторно выполнить команду соединения и проверить в трассировке поле **ClientConnectionID**.  
  
 Клиента можно получить идентификатор соединения программным способом с помощью [интерфейс ISQLServerConnection](../../connect/jdbc/reference/isqlserverconnection-interface.md). Идентификатор соединения также содержится во всех связанных с соединением исключениях.  
  
 В случае ошибки соединения идентификатор соединения клиента в трассировочной информации встроенной диагностики (BID) сервера и в кольцевом буфере соединений поможет сопоставить клиентские соединения с соединениями на сервере. Дополнительные сведения о трассировке BID на сервере см. в разделе [Трассировка доступа к данным](https://go.microsoft.com/fwlink/?LinkId=125805). Обратите внимание, что в статье о трассировке доступа к данным также содержатся сведения о трассировке доступа к данным, неприменимые к [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)]. Сведения о выполнении трассировки доступа к данным с помощью [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] см. в разделе [Трассировка операций драйвера](../../connect/jdbc/tracing-driver-operation.md).  
  
 Драйвер JDBC также отсылает идентификатор действия определенного процесса. Идентификатор активности регистрируется в сеансах расширенных событий, если сеанс запущен со включенным параметром TRACK_CAUSAILITY. В случае проблем с производительностью активного соединения получить идентификатор действия можно из трассировки клиента (поле ActivityID), а затем найти этот идентификатор действия в выходных данных расширенных событий. Идентификатором действия в расширенных событиях является 16-байтовый идентификатор GUID (который отличается от идентификатора GUID соединения клиента), к которому добавляется порядковый номер из четырех байт. Этот порядковый номер представляет порядок запроса в потоке. Значение ActivityId отправляется для пакетных инструкций SQL и запросов RPC. Чтобы включить отправку значения ActivityId на сервер, сначала необходимо указать следующую пару «ключ-значение» в файле Logging.Properties:  
  
```
com.microsoft.sqlserver.jdbc.traceactivity = on  
```  
  
 Любое значение больше `on` (учитывается регистр) отключает отправку ActivityId.  
  
 Дополнительные сведения см. в статье [Трассировка операций драйвера](../../connect/jdbc/tracing-driver-operation.md). Этот флаг трассировки используется совместно с соответствующими средствами ведения журнала объектов JDBC для определения того, следует ли выполнять трассировку и отправку значения ActivityId в драйвере JDBC. Помимо внесения изменений в файл Logging.Properties необходимо включить средство ведения журнала com.microsoft.sqlserver.jdbc на уровне FINER или более высоком уровне. Если требуется отправлять значение ActivityId на сервер в отношении запросов, выполняемых определенным классом, необходимо включить средство ведения журнала соответствующего класса на уровне FINER или FINEST. Например, если классом является класс SQLServerStatement, включите средство ведения журнала com.microsoft.sqlserver.jdbc.SQLServerStatement.  
  
 В следующем образце код [!INCLUDE[tsql](../../includes/tsql-md.md)] служит для запуска сеанса расширенных событий, который будет сохраняться в кольцевом буфере и регистрировать идентификаторы активности, отправляемые с клиента при выполнении операций RPC и пакетных операций:  
  
```sql
create event session MySession on server  
add event connectivity_ring_buffer_recorded,  
add event sql_statement_starting (action (client_connection_id)),  
add event sql_statement_completed (action (client_connection_id)),  
add event rpc_starting (action (client_connection_id)),  
add event rpc_completed (action (client_connection_id))  
add target ring_buffer with (track_causality=on)  
```  
  
## <a name="see-also"></a>См. также:  
 [Диагностика проблем с драйвером JDBC](../../connect/jdbc/diagnosing-problems-with-the-jdbc-driver.md)  
  
  
