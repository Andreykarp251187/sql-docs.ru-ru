---
title: С помощью escape-последовательностей SQL | Документация Майкрософт
ms.custom: ''
ms.date: 07/11/2018
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
ms.assetid: 00f9e25a-088e-4ac6-aa75-43eacace8f03
author: MightyPen
ms.author: genemi
manager: jroth
ms.openlocfilehash: d029bf6b0a1e50bec104879a64d9411774ffeda5
ms.sourcegitcommit: ad2e98972a0e739c0fd2038ef4a030265f0ee788
ms.translationtype: MTE75
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66798610"
---
# <a name="using-sql-escape-sequences"></a>Использование escape-последовательностей SQL

[!INCLUDE[Driver_JDBC_Download](../../includes/driver_jdbc_download.md)]

[!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] поддерживает использование escape-последовательностей SQL, описанных в определении API JDBC. Escape-последовательности используются в инструкции SQL для передачи драйверу сведений о том, что экранированные части SQL-строки должны обрабатываться иначе. При обработке драйвером JDBC части escape-последовательности SQL-строки выполняется преобразование этой части строки в SQL-код, распознаваемый SQL Server.  
  
 Существует пять типов escape-последовательностей, требуемых API JDBC, и все они поддерживаются драйвером JDBC:  
  
- Литералы-шаблоны LIKE
- Обработка функций
- Литералы даты и времени
- Вызовы хранимых процедур
- Внешние соединения
- Escape-синтаксис LIMIT

Драйвер JDBC использует следующий синтаксис escape-последовательности:  
  
`{keyword ...parameters...}`  
  
> [!NOTE]  
> Для драйвера JDBC всегда включена обработка escape-последовательностей SQL.  
  
В следующих разделах описывается пять типов escape-последовательностей и способы их поддержки драйвером JDBC.  
  
## <a name="like-wildcard-literals"></a>Литералы-шаблоны LIKE

Драйвер JDBC поддерживает синтаксис `{escape 'escape character'}` для использования шаблонов предложения LIKE в качестве литералов. Например, в следующем коде возвращаются значения col3, для которых значение col2 начинается с символа подчеркивания (и не используется как шаблон).  

```java
ResultSet rst = stmt.executeQuery("SELECT col3 FROM test1 WHERE col2   
LIKE '\\_%' {escape '\\'}");  
```

> [!NOTE]  
> Escape-последовательность должна быть в конце инструкции SQL. При наличии в командной строке нескольких инструкций SQL escape-последовательность должна быть в конце каждой соответствующей инструкции SQL.  

## <a name="function-handling"></a>Обработка функций

Драйвер JDBC поддерживает использование escape-последовательностей функций в инструкциях SQL со следующим синтаксисом:  

```sql
{fn functionName}  
```

где `functionName` представляет собой функцию, поддерживаемую драйвером JDBC. Пример: 

```sql
SELECT {fn UCASE(Name)} FROM Employee  
```

В следующей таблице перечислены различные функции, поддерживаемые драйвером JDBC при использовании escape-последовательностей функций:  
  
| Строковые функции                                                                                                                                                                                                                                                                                                                        | Числовые функции                                                                                                                                                                                                                                                                                                                                                                                                   | Функции Datetime                                                                                                                                                                                                                                                                                                                                             | Системные функции                             |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------- |
| ASCII<br /><br /> CHAR<br /><br /> CONCAT<br /><br /> DIFFERENCE<br /><br /> INSERT<br /><br /> LCASE<br /><br /> LEFT<br /><br /> LENGTH<br /><br /> LOCATE<br /><br /> LTRIM<br /><br /> REPEAT<br /><br /> REPLACE<br /><br /> RIGHT<br /><br /> RTRIM<br /><br /> SOUNDEX<br /><br /> SPACE<br /><br /> SUBSTRING<br /><br /> UCASE | ABS<br /><br /> ACOS<br /><br /> ASIN<br /><br /> ATAN<br /><br /> ATAN2<br /><br /> CEILING<br /><br /> COS<br /><br /> COT<br /><br /> DEGREES<br /><br /> EXP<br /><br /> FLOOR<br /><br /> LOG<br /><br /> LOG10<br /><br /> MOD<br /><br /> PI<br /><br /> POWER<br /><br /> RADIANS<br /><br /> RAND<br /><br /> ROUND<br /><br /> SIGN<br /><br /> SIN<br /><br /> SQRT<br /><br /> TAN<br /><br /> TRUNCATE | CURDATE<br /><br /> CURTIME<br /><br /> DAYNAME<br /><br /> DAYOFMONTH<br /><br /> DAYOFWEEK<br /><br /> DAYOFYEAR<br /><br /> EXTRACT<br /><br /> HOUR<br /><br /> MINUTE<br /><br /> MONTH<br /><br /> MONTHNAME<br /><br /> NOW<br /><br /> QUARTER<br /><br /> SECOND<br /><br /> TIMESTAMPADD<br /><br /> TIMESTAMPDIFF<br /><br /> WEEK<br /><br /> YEAR | DATABASE<br /><br /> IFNULL<br /><br /> Пользователь |

> [!NOTE]  
> Использование функции, не поддерживаемой базой данных, приведет к возникновению ошибки.  

## <a name="date-and-time-literals"></a>Литералы даты и времени

Ниже приводится синтаксис escape-последовательности для литералов даты, времени и отметок времени:  

```sql
{literal-type 'value'}  
```

где `literal-type` является одним из следующих:  
  
| Тип литерала | Описание | Формат значения               |
| ------------ | ----------- | -------------------------- |
| d            | Дата        | гггг-мм-дд                 |
| t            | Time        | чч:мм:сс [1]               |
| ts           | TimeStamp   | гггг-мм-дд чч:мм:сс[.f...] |
  
Пример:  

```sql
UPDATE Orders SET OpenDate={d '2005-01-31'}
WHERE OrderID=1025  
```

## <a name="stored-procedure-calls"></a>Вызовы хранимых процедур

Драйвер JDBC поддерживает синтаксис escape-последовательностей `{? = call proc_name(?,...)}` и `{call proc_name(?,...)}` для вызовов хранимых процедур, в зависимости от того, требуется ли обработка возвращаемого параметра.  
  
Процедура представляет собой исполняемый объект, который хранится в базе данных. Обычно процедурой является одна или несколько заранее скомпилированных инструкций SQL. Ниже приводится синтаксис escape-последовательности вызова хранимой процедуры:  

```sql
{[?=]call procedure-name[([parameter][,[parameter]]...)]}  
```

где `procedure-name` указывает имя хранимой процедуры, а `parameter` указывает параметр хранимой процедуры.  
  
Дополнительные сведения об использовании `call` escape-последовательности с помощью хранимых процедур, см. в разделе [с помощью инструкций, с помощью хранимых процедур](../../connect/jdbc/using-statements-with-stored-procedures.md).  

## <a name="outer-joins"></a>Внешние соединения

Драйвер JDBC поддерживает синтаксис левого, правого и полного внешнего соединения SQL92. Ниже приводится синтаксис escape-последовательности для внешних соединений:  

```sql
{oj outer-join}  
```

где внешнее соединение:  

```sql
table-reference {LEFT | RIGHT | FULL} OUTER JOIN
{table-reference | outer-join} ON search-condition  
```

где `table-reference` является именем таблицы, а `search-condition` представляет собой условия соединения, которые необходимо использовать для таблиц.  
  
Пример:  

```sql
SELECT Customers.CustID, Customers.Name, Orders.OrderID, Orders.Status
   FROM {oj Customers LEFT OUTER JOIN
      Orders ON Customers.CustID=Orders.CustID}
   WHERE Orders.Status='OPEN'  
```

Драйвер JDBC поддерживает следующие escape-последовательности внешнего соединения:  

- Левые внешние соединения
- Правые внешние соединения
- Полные внешние соединения
- Вложенные внешние соединения

## <a name="limit-escape-syntax"></a>Escape-синтаксис LIMIT  

> [!NOTE]  
> Escape-синтаксис LIMIT поддерживается только драйвером Microsoft JDBC Driver 4.2 (и более поздних версий) для SQL Server при использовании JDBC 4.1 или более поздней версии.  
  
 Escape-синтаксис LIMIT выглядит следующим образом:  

```sql
LIMIT <rows> [OFFSET <row offset>]  
```

Escape-синтаксис состоит из двух частей: \<*строки*> — это обязательная часть, которая указывает число возвращаемых строк. OFFSET и \<*смещение строки*> — это необязательные компоненты, указывающие число строк, которые необходимо пропустить перед началом получения строк. Драйвер JDBC поддерживает только обязательную часть, преобразуя запрос для использования TOP вместо LIMIT. SQL Server не поддерживает предложение LIMIT. **Драйвер JDBC не поддерживает необязательную часть \<смещение строки>. При ее использовании драйвер вызовет исключение**.  
  
## <a name="see-also"></a>См. также:

[Использование инструкций с драйвером JDBC](../../connect/jdbc/using-statements-with-the-jdbc-driver.md)  
