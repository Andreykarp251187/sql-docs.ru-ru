---
title: Использование возможности ожидания | Документация Майкрософт
ms.custom: ''
ms.date: 08/12/2019
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
ms.assetid: aa48306c-e7a0-4dcb-af21-9ebb6898e45a
author: MightyPen
ms.author: genemi
ms.openlocfilehash: 1c126385955ce6e9fa9098ec5a09ba115b94ffb0
ms.sourcegitcommit: b78f7ab9281f570b87f96991ebd9a095812cc546
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2020
ms.locfileid: "69026202"
---
# <a name="using-holdability"></a>Использование возможности ожидания

[!INCLUDE[Driver_JDBC_Download](../../includes/driver_jdbc_download.md)]

По умолчанию результирующий набор, созданный внутри транзакции, сохраняется открытым после фиксации транзакции в базе данных или ее отката. Однако иногда полезно закрыть результирующий набор после фиксации транзакции. Для этого [!INCLUDE[jdbcNoVersion](../../includes/jdbcnoversion_md.md)] поддерживает возможность ожидания результирующих наборов.

Возможность ожидания результирующего набора задается при помощи метода [setHoldability](../../connect/jdbc/reference/setholdability-method-sqlserverconnection.md) класса [SQLServerConnection](../../connect/jdbc/reference/sqlserverconnection-class.md). При настройке возможности ожидания с помощью метода setHoldability можно использовать константы возможности ожидания результирующего набора `ResultSet.HOLD_CURSORS_OVER_COMMIT` или `ResultSet.CLOSE_CURSORS_AT_COMMIT`.

Драйвер JDBC также поддерживает удержание при создании одного из объектов инструкции. При создании объектов инструкции, имеющих перегрузку параметров удержания результирующего набора, удержание объекта инструкции должно соответствовать удержанию подключения. Если они не соответствуют друг другу, возникает исключение. Это происходит, так как SQL Server поддерживает возможность ожидания только на уровне подключения.

Возможность ожидания результирующего набора соответствует возможности ожидания объекта SQLServerConnection, связанного с результирующим набором, в момент создания результирующего набора только для курсоров на стороне сервера. Это не применяется к курсорам на стороне клиента. Все результирующие наборы с курсорами на стороне клиента всегда имеют значение возможности ожидания `ResultSet.HOLD_CURSORS_OVER_COMMIT`.

Для серверных курсоров при соединении с SQL Server 2005 или более поздней версии параметр возможности сохранения влияет только на новые результирующие наборы, которые будут созданы для этого соединения. Это означает, что настройка возможности ожидания не влияет на результирующие наборы, которые были созданы ранее и открыты в настоящий момент для этого подключения.

В следующем примере возможность ожидания результирующего набора задается при выполнении локальной транзакции, состоящей из двух отдельных инструкций в блоке `try`. Инструкции выполняются с таблицей Production.ScrapReason в образце базы данных [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal_md.md)]. Сначала происходит переключение в режим выполнения транзакций вручную путем установки для автоматической фиксации значения `false`. После отключения режима автоматической фиксации инструкции SQL не будут фиксироваться, пока приложение не вызовет явным образом метод [commit](../../connect/jdbc/reference/commit-method-sqlserverconnection.md). Код в блоке catch откатит транзакцию, если возникнет исключение.

[!code[JDBC#UsingHoldability1](../../connect/jdbc/codesnippet/Java/using-holdability_1.java)]

## <a name="see-also"></a>См. также раздел

[Выполнение транзакций с помощью JDBC Driver](../../connect/jdbc/performing-transactions-with-the-jdbc-driver.md)
