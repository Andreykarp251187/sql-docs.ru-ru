---
title: Определить нужный номер SKU базы данных Azure SQL для вашей локальной базы данных (Data Migration Assistant) | Документация Майкрософт
description: Узнайте, как использовать помощник по миграции данных для выявления справа номер SKU базы данных SQL Azure для вашей локальной базы данных
ms.custom: ''
ms.date: 05/06/2019
ms.prod: sql
ms.prod_service: dma
ms.reviewer: ''
ms.technology: dma
ms.topic: conceptual
keywords: ''
helpviewer_keywords:
- Data Migration Assistant, Assess
ms.assetid: ''
author: HJToland3
ms.author: jtoland
manager: craigg
ms.openlocfilehash: 1ea0afb015bb457b067f1011bd3b602bf4142e09
ms.sourcegitcommit: bb5484b08f2aed3319a7c9f6b32d26cff5591dae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65106085"
---
# <a name="identify-the-right-azure-sql-databasemanaged-instance-sku-for-your-on-premises-database"></a>Определить справа базы данных или управляемого экземпляра Azure SQL SKU для локальной базы данных

Миграция баз данных в облаке, может быть затруднена, особенно в том случае, при попытке выбрать лучший целевой базы данных Azure и SKU для базы данных. Наша цель с Database Migration Assistant (DMA), — которые решить эти задачи и упрощает процесс, предоставляя эти рекомендации SKU в понятных выходных миграции базы данных.

Эта статья посвящена функция рекомендации DMA номер SKU базы данных SQL Azure. База данных SQL Azure имеет несколько вариантов развертывания, включая:

- Отдельная база данных
- Пулы эластичных баз данных
- управляемый экземпляр

Рекомендации по SKU, функция позволяет идентифицировать как минимальный рекомендуемый отдельной базы данных для базы данных SQL Azure или управляемого экземпляра, номер SKU на основании счетчики производительности, собранных с компьютеров, на котором размещены ваши базы данных. Компонент дает рекомендации, связанные с цены на уровень, уровень вычислений и максимальный объем данных, а также оценочная стоимость в месяц. Он предоставляет возможность массовой подготовки отдельных баз данных и управляемых экземпляров в Azure для всех рекомендуемых баз данных.

> [!NOTE]
> Эта функция сейчас доступна только через интерфейс командной строки (CLI).

Ниже приведены инструкции, которые помогут определить рекомендации номер SKU базы данных SQL Azure и подготовить соответствующий одной базы данных или управляемых экземпляров в Azure с помощью DMA.

## <a name="prerequisites"></a>предварительные требования

- Скачайте и установите последнюю версию [DMA](https://aka.sm/get-dma). Если вы уже более ранней версии средства, откройте его, и вам будет предложено обновить DMA.
- Убедитесь, что на компьютере установлены [PowerShell версии 5.1](https://www.microsoft.com/download/details.aspx?id=54616) или более поздней версии, который необходим для всех сценариев. Сведения о findoug, какие версии PowerShell установлена на компьютере, см. в статье [скачайте и установите Windows PowerShell 5.1](https://docs.microsoft.com/skypeforbusiness/set-up-your-computer-for-windows-powershell/download-and-install-windows-powershell-5-1).
- Убедитесь, что на компьютере установлены установлен модуль Azure Powershell. Дополнительные сведения см. в статье [установить модуль Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-1.8.0).
- Убедитесь, что файл PowerShell **SkuRecommendationDataCollectionScript.ps1**, которая необходима для сбора данных счетчиков производительности, устанавливается в папке DMA.
- Убедитесь, что компьютер, на котором будет выполняться этот процесс имеет разрешения администратора на компьютер, на котором размещены ваши базы данных.

## <a name="collect-performance-counters"></a>Сбор данных счетчиков производительности

Для сбора данных счетчиков производительности для баз данных является первым шагом в процессе. Можно собирать данные счетчиков производительности, выполнив команду PowerShell на компьютере, на котором размещены ваши базы данных. DMA предоставляет копию этого файла PowerShell, но можно также использовать свой собственный метод для записи счетчиков производительности с компьютера.

Не требуется для выполнения этой задачи для каждой базы данных по отдельности. Счетчики производительности, собранные с компьютера можно рекомендовать SKU для всех баз данных, подключенного к компьютеру.

1. В папке DMA найдите файл PowerShell SkuRecommendationDataCollectionScript.ps1. Этот файл необходим для сбора данных счетчиков производительности.

    ![Файл PowerShell, показанный в папке DMA](../dma/media/dma-sku-recommend-data-collection-file.png)

2. Запустите сценарий PowerShell со следующими аргументами:
    - **ComputerName**: Имя компьютера, на котором размещаются базы данных.
    - **OutputFilePath**: Выходной путь для сохранения собранных счетчиков.
    - **CollectionTimeInSeconds**: Количество времени, в течение которого вы хотите собирать данные счетчиков производительности. Сохранять данные счетчиков производительности в течение 40 минут получить осмысленные рекомендацию. Длительный срок, записи, тем точнее рекомендация будет. Также убедитесь, что рабочие нагрузки выполняются для необходимых баз данных для включения более точные рекомендации.
    - **DbConnectionString**: Строка подключения указывает на базу данных master, размещенной на компьютере, с которого вы будете собирать данные счетчиков производительности.

    Ниже приведен образец вызова.

    ```
    .\SkuRecommendationDataCollectionScript.ps1
     -ComputerName Foobar1
     -OutputFilePath D:\counters2.csv
     -CollectionTimeInSeconds 2400
     -DbConnectionString "Server=localhost;Initial Catalog=master;Integrated Security=SSPI;"
    ```

    После выполнения команды, процесс будет выводить файла, включая счетчики производительности в указанное расположение. Этот файл можно использовать как входные для следующей части процесса, который предоставит рекомендации SKU для отдельной базы данных и параметры управляемых экземпляров.

## <a name="use-the-dma-cli-to-get-sku-recommendations"></a>Использовать интерфейс командной строки DMA для получения рекомендаций SKU

Используйте выходной файл счетчики производительности, созданной как входные данные для этого процесса.

Для параметра отдельной базы данных DMA предоставит рекомендации для отдельной базы данных базы данных SQL Azure цены на уровень, уровень вычислений и максимальный размер данных для каждой базы данных на компьютере. При наличии нескольких баз данных на компьютере, можно также указать баз данных, для которых требуется получить рекомендации. DMA будет также отобразится расчетная Месячная стоимость для каждой базы данных.

Для управляемого экземпляра рекомендации по поддержке сценария lift-and-shift. В результате DMA предоставит рекомендации для управляемого экземпляра базы данных SQL Azure, цены на уровень, уровень вычислений и максимальный размер данных для набора баз данных на компьютере. Опять же если у вас есть несколько баз данных на компьютере, можно также указать баз данных, для которых требуется получить рекомендации. DMA будет также отобразится расчетная Месячная стоимость для управляемого экземпляра.

Чтобы использовать интерфейс командной строки DMA для получения рекомендаций SKU, в командной строке, выполните dmacmd.exe со следующими аргументами:

- **/ Action = SkuRecommendation**: Введите этот аргумент для выполнения оценки SKU.
- **/ SkuRecommendationInputDataFilePath**: Путь к файлу счетчика собираются в предыдущем разделе.
- **/ SkuRecommendationTsvOutputResultsFilePath**: Путь для записи выходных данных в формате TSV.
- **/ SkuRecommendationJsonOutputResultsFilePath**: Путь для записи выходных данных в формате JSON.
- **/ SkuRecommendationHtmlResultsFilePath**: Путь для записи выходных данных в формате HTML.

Кроме того выберите один из следующих аргументов:

- Предотвратить обновление цены
  - **/ SkuRecommendationPreventPriceRefresh**: Если присвоено значение True, предотвращает обновление цены и предполагается, что цены по умолчанию. Используйте, если выполняется в автономном режиме. Если вы не используете этот параметр, необходимо указать параметры ниже, чтобы получить последние цены на основе указанной области.
- Получите последние цены
  - **/ SkuRecommendationCurrencyCode**: Валюта, в которой отображаются цены (например) «ДОЛЛ. США»).
  - **/ SkuRecommendationOfferName**: Предложение name (например) "MS-AZR - 0003 P»). Дополнительные сведения см. в разделе [сведения о предложении Microsoft Azure](https://azure.microsoft.com/support/legal/offer-details/) страницы.
    - **/ SkuRecommendationRegionName**: Имя региона (например, «WestUS»).
    - **/ SkuRecommendationSubscriptionId**: Идентификатор подписки.
    - **/ AzureAuthenticationTenantId**: Клиент проверки подлинности.
    - **/ AzureAuthenticationClientId**: Идентификатор клиента приложения AAD, используемый для проверки подлинности.
    - Один из следующих режимов проверки подлинности:
      - Интерактивно
        - **AzureAuthenticationInteractiveAuthentication**: Значение true для всплывающего окна проверки подлинности.
      - На основе сертификатов
        - **AzureAuthenticationCertificateStoreLocation**: Значение в расположении хранилища сертификатов (например, «CurrentUser»).
        - **AzureAuthenticationCertificateThumbprint**: Значение отпечатка сертификата.
      - На основе маркера
        - **AzureAuthenticationToken**: Значение маркера сертификата.

> [!NOTE]
> Чтобы получить ClientId и идентификатор клиента для интерактивной проверки подлинности, вам потребуется настроить новое приложение AAD. Дополнительные сведения о проверке подлинности и получение учетных данных в этой статье [образцы кода API выставления счетов Microsoft Azure: RateCard API](https://azure.microsoft.com/resources/samples/billing-python-ratecard-api/), следуйте инструкциям в разделе **шаг 1: Настройка собственного клиентского приложения в клиенте AAD**.

Наконец есть необязательный аргумент, которые можно использовать для указания баз данных, для которых требуется получить рекомендации: 

- **/ SkuRecommendationDatabasesToRecommend**: Список баз данных, для которого для выработки рекомендаций. Найти в входных CSV-файл базы данных имен учитывается регистр и необходимо (1), (2) каждый заключить в двойные кавычки и (3) каждый отделяться пробел между именами (например /SkuRecommendationDatabasesToRecommend «Database1» = «Database2» «Database3») . Пропуск этого параметра убедитесь, что рекомендации предоставляются для всех пользовательских баз данных, определенных на входных CSV-файла.  

Ниже приведены некоторые вызовы образец.

**Пример 1. Получение рекомендаций по умолчанию, позволяющему. Используйте при работе в автономном режиме, или если у вас нет учетных данных проверки подлинности.**

```
.\DmaCmd.exe /Action=SkuRecommendation
/SkuRecommendationInputDataFilePath="C:\TestOut\out.csv"
/SkuRecommendationTsvOutputResultsFilePath="C:\TestOut\prices.tsv"
/SkuRecommendationJsonOutputResultsFilePath="C:\TestOut\prices.json"
/SkuRecommendationOutputResultsFilePath="C:\TestOut\prices.html"
/SkuRecommendationPreventPriceRefresh=true
```

**Пример 2. Получение рекомендаций с последними ценами для заданной области (например, «UKWest»).**

```
.\DmaCmd.exe /Action=SkuRecommendation
/SkuRecommendationInputDataFilePath="C:\TestOut\out.csv"
/SkuRecommendationTsvOutputResultsFilePath="C:\TestOut\prices.tsv"
/SkuRecommendationJsonOutputResultsFilePath="C:\TestOut\prices.json"
/SkuRecommendationOutputResultsFilePath="C:\TestOut\prices.html"
/SkuRecommendationCurrencyCode=USD
/SkuRecommendationOfferName=MS-AZR-0044p
/SkuRecommendationRegionName=UKWest
/SkuRecommendationSubscriptionId=<Your Subscription Id>
/AzureAuthenticationInteractiveAuthentication=true
/AzureAuthenticationClientId=<Your AzureAuthenticationClientId>
/AzureAuthenticationTenantId=<Your AzureAuthenticationTenantId>
```

**Пример 3. Получение рекомендаций для конкретных баз данных (например) “TPCDS1G,EDW_3G,TPCDS10G”).**

```
.\DmaCmd.exe /Action=SkuRecommendation 
/SkuRecommendationInputDataFilePath="C:\TestOut\out.csv" 
/SkuRecommendationTsvOutputResultsFilePath="C:\TestOut\prices.tsv" 
/SkuRecommendationJsonOutputResultsFilePath="C:\TestOut\prices.json" 
/SkuRecommendationOutputResultsFilePath="C:\TestOut\prices.html" 
/SkuRecommendationCurrencyCode=USD 
/SkuRecommendationOfferName=MS-AZR-0044p 
/SkuRecommendationRegionName=UKWest 
/SkuRecommendationSubscriptionId=<Your Subscription Id> 
/SkuRecommendationDatabasesToRecommend=“TPCDS1G” “EDW_3G” “TPCDS10G” 
/AzureAuthenticationInteractiveAuthentication=true 
/AzureAuthenticationClientId=<Your AzureAuthenticationClientId> 
/AzureAuthenticationTenantId=<Your AzureAuthenticationTenantId>
```

Рекомендации по отдельной базы данных TSV выходной файл будет выглядеть следующим образом:

![Файл PowerShell одним db, показанный в папке DMA](../dma/media/dma-sku-recommend-single-db-recommendations.png)

Рекомендации по управляемым экземпляром TSV выходной файл будет выглядеть следующим образом:

![Файл управляемый экземпляр PowerShell, показанный в папке DMA](../dma/media/dma-sku-recommend-mi-recommendations.png)

Описание каждого столбца в выходной файл.

- **Имя базы данных** -имя вашей базы данных.
- **MetricType** -базы данных SQL Azure рекомендуется одной базы данных/управляемого экземпляра уровня.
- **MetricValue** -базы данных SQL Azure рекомендуется одной базы данных или управляемые экземпляра SKU.
- **PricePerMonth** — приблизительная цена в месяц для соответствующего номера SKU.
- **RegionName** — имя региона для соответствующего номера SKU. 
- **IsTierRecommended** -предпринимаем Минимальное рекомендуемое SKU для каждого уровня. Затем мы применяем эвристику для определения правильного уровня для базы данных. Это отражает, какой уровень рекомендуется для базы данных. 
- **ExclusionReasons** -это значение пустым, если рекомендуем использовать уровень. Для каждого уровня, не рекомендуется мы предоставляем причин, почему он не выбраны.
- **AppliedRules** -короткий нотации правил, которые были применены.

Окончательный рекомендуемый уровень (т. е. **MetricType**) и значение (т. е. **MetricValue**)-где найти **IsTierRecommended** столбец имеет значение TRUE - отражает минимальный номер SKU требуется для запросов для запуска в Azure с помощью Доля успешных попыток, аналогичную локальных баз данных. Для управляемого экземпляра DMA в настоящее время поддерживает рекомендации по наиболее часто используемые 8vcore 40vcore номера SKU. Например если Рекомендуемый минимальный номер SKU уровня "стандартный" S4, а затем выбрав S3 или ниже будет запросы истечения времени ожидания или не могут быть выполнены.

HTML-файл, содержащий эту информацию в графическом формате. Предоставляет понятные средства просмотра заключительной рекомендации и следующая часть процесса подготовки. Дополнительные сведения о выходных данных HTML находится в следующем разделе.

## <a name="provision-recommended-skus-to-azure"></a>Подготовка, рекомендуется использовать номера SKU в Azure

С помощью нескольких щелчков можно использовать рекомендаций, выявленных для подготовки целевой SKU в Azure, к которому можно перенести базы данных. HTML-файл можно использовать для ввода подписки Azure; Выбор ценовой категории, вычислительных ресурсов уровня, а максимальный размер данных для баз данных; и создания скрипта для подготовки баз данных. Вы можете выполнить этот скрипт, с помощью PowerShell.

Вы можете выполнить этот процесс на одном компьютере, или можно выполнить эту процедуру на нескольких компьютерах, чтобы определить номер SKU рекомендации в масштабе. DMA в настоящее время делает более простое и масштабируемое возможности благодаря поддержке весь процесс с помощью интерфейса командной строки.

Для ввода сведений о подготовке и внести изменения в рекомендации, обновите файл HTML следующим образом.

**Рекомендации по отдельной базы данных**

![Azure SQL DB SKU рекомендации экрана](../dma/media/dma-sku-recommend-single-db-recommendations1.png)

1. Откройте HTML-файл и введите следующие сведения:
    - **Идентификатор подписки** -идентификатор подписки, к которому вы хотите подготовить базы данных подписки Azure.
    - **Группа ресурсов** -группе ресурсов, к которому вы хотите развернуть базы данных. Введите группу ресурсов, что существует.
    - **Регион** -область, в которой для подготовки баз данных. Убедитесь, что выбор области поддерживает ваша подписка.
    - **Имя сервера** -базы данных SQL server для баз данных, развернутых. Если ввести имя сервера, который не существует, он будет создан.
    - **Имя пользователя администратора** -имя входа администратора сервера.
    - **Пароль администратора** -пароля администратора сервера. Пароль должен содержать по крайней мере 8 символов и не более 128 символов. Пароль должен содержать символы трех из следующих категорий: прописные латинские буквы, строчные латинские буквы, цифры (0 – 9) и неалфавитные символы (!, $, #, %, и т.д.). Пароль не может содержать все или часть (3 + последовательных буквы) от имени пользователя.

2. Рекомендации для каждой базы данных, просмотреть и изменить ценовую категорию, вычислительные уровень и максимальный объем данных при необходимости. Не забудьте отменить выбор всех баз данных, которые вы не хотите в настоящее время подготовки.

3. Выберите **формирование скрипта подготовки**, сохраните сценарий и затем выполнить его в PowerShell.

    Этот процесс следует создать все базы данных, выбранного на странице HTML.

**Рекомендации для управляемого экземпляра**

![Azure SQL MI SKU рекомендации экрана](../dma/media/dma-sku-recommend-mi-recommendations1.png)

1. Откройте HTML-файл и введите следующие сведения:
    - **Идентификатор подписки** -идентификатор подписки, к которому вы хотите подготовить базы данных подписки Azure.
    - **Группа ресурсов** -группе ресурсов, к которому вы хотите развернуть базы данных. Введите группу ресурсов, что существует.
    - **Регион** -область, в которой для подготовки баз данных. Убедитесь, что выбор области поддерживает ваша подписка.
    - **Имя экземпляра** — экземпляр управляемого экземпляра SQL Azure для переноса баз данных. Имя экземпляра может содержать только строчные буквы, цифры, и "-", но не может начинаться или заканчиваться "-" или содержать больше 63 символов.
    - **Имя пользователя администратора экземпляра** — имя пользователя администратора экземпляра. Убедитесь, что имя для входа соответствует следующим требованиям — это идентификатор SQL и не имя, типичной системы (например, администратора, администратора, sa, корневой, dbmanager, loginmanager и др.), либо встроенной базой данных пользователя или роли (например, dbo, гостя, public т. д.). Убедитесь, что имя не содержит пробелов, символов Юникода или неалфавитные знаки, и что он не начинается с цифры или символа. 
    - **Пароль администратора экземпляра** -пароль администратора для экземпляра. Пароль должен содержать минимум 16 символов и не более 128 символов. Пароль должен содержать символы трех из следующих категорий: прописные латинские буквы, строчные латинские буквы, цифры (0 – 9) и неалфавитные символы (!, $, #, %, и т.д.). Пароль не может содержать все или часть (3 + последовательных буквы) от имени пользователя.
    - **Имя виртуальной сети** — имя виртуальной сети, в котором должен быть подготовлен управляемый экземпляр. Введите имя существующей виртуальной сети.
    - **Имя подсети** — имя подсети, в которой должен быть подготовлен управляемый экземпляр. Введите имя существующей подсети.

2. Просмотрите рекомендации для каждого экземпляра и изменить ценовую категорию, вычислительные уровень и максимальный объем данных при необходимости. Хотя рекомендации в настоящее время ограничены 8vcore 40vcore номера SKU, по-прежнему вариант подготовки 64vcore и 80vcore номера SKU, при необходимости. Должны быть отключены все экземпляры, которые вы не хотите в настоящее время подготовки.

    Этот процесс следует создать все базы данных, выбранного на странице HTML.

    > [!NOTE]
    > Создание управляемых экземпляров в подсети (особенно в первый раз) может занять несколько часов. После того как вы запустите скрипт подготовки с помощью PowerShell можно проверить состояние развертывания на портале Azure.

## <a name="next-step"></a>Следующий шаг

- Полный список команд для выполнения DMA из интерфейса командной строки, см. в статье [запустите помощник по миграции данных из командной строки](https://docs.microsoft.com/sql/dma/dma-commandline?view=sql-server-2017).
